{"version":3,"file":"js/948.abab6.js","mappings":"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","sources":["webpack://ocw-hugo-themes/./node_modules/nanogallery2/src/jquery.nanogallery2.core.js","webpack://ocw-hugo-themes/./node_modules/nanogallery2/src/css/nanogallery2.css"],"sourcesContent":["/*** IMPORTS FROM imports-loader ***/\nvar module = (module || {});\nmodule.exports = undefined;\nvar exports = undefined;\n\n/**!\r\n * @preserve nanogallery2 - javascript photo / video gallery and lightbox\r\n * Homepage: http://nanogallery2.nanostudio.org\r\n * Sources:  https://github.com/nanostudio-org/nanogallery2\r\n *\r\n * License:  GPLv3 and commercial licence\r\n * \r\n * Requirements:\r\n *  - jQuery (http://www.jquery.com) - version >= 1.7.1\r\n *\r\n * Embeded components:\r\n *  - shifty (https://github.com/jeremyckahn/shifty)\r\n *  - imagesloaded (https://github.com/desandro/imagesloaded)\r\n *  - hammer.js (http://hammerjs.github.io/)\r\n *  - screenfull.js (https://github.com/sindresorhus/screenfull.js)\r\n * Tools:\r\n *  - webfont generated with http://fontello.com - mainly based on Font Awesome Copyright (C) 2012 by Dave Gandy (http://fontawesome.io/)\r\n *  - ICO online converter: https://iconverticons.com/online/\r\n */\r\n\r\n \r\n \r\n// ###########################################\r\n// ##### nanogallery2 as a JQUERY PLUGIN #####\r\n// ###########################################\r\n\r\n\r\n// Expose plugin as an AMD module if AMD loader is present:\r\n(function (factory) {\r\n    \"use strict\";\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        // define('nanogallery2', ['jquery'], factory);\r\n        define(['jquery'], factory);\r\n    } else if (typeof exports === 'object' && typeof require === 'function') {\r\n        // Browserify\r\n        factory(require('jquery'));\r\n    } else {\r\n        // Browser globals\r\n        factory(jQuery);\r\n    }\r\n}(function ($) {\r\n// ;(function ($) {\r\n  \"use strict\";\r\n\r\n  //##### TOOLS/HELPERS ####\r\n\r\n  // Convert color to RGB/RGBA\r\n  function ColorHelperToRGB( color ) {\r\n    var obj = document.getElementById('ngyColorHelperToRGB');\r\n    if (obj === null) {\r\n      obj = document.createElement('div');\r\n      obj.id = \"ngyColorHelperToRGB\";\r\n      obj.style.cssText = 'display: none; color:' + color + ';';\r\n      document.body.appendChild(obj);\r\n    }\r\n    \r\n    var rgb = getComputedStyle(obj).color;\r\n\r\n    // to get HEX value:\r\n    // var rgb = getComputedStyle(obj).color.match(/\\d+/g);\r\n    // var r = parseInt(rgb[0]).toString(16);\r\n    // var g = parseInt(rgb[1]).toString(16);\r\n    // var b = parseInt(rgb[2]).toString(16);\r\n    // var hex = '#' + r + g + b;\r\n\r\n    return rgb;\r\n  }\r\n\r\n  \r\n  // ##### helper for color handling\r\n  // - normalise RGB/RGBA/HEX format\r\n  // - lighten/darken color\r\n  // Inspired by:          \r\n  // https://stackoverflow.com/questions/5560248/programmatically-lighten-or-darken-a-hex-color-or-rgb-and-blend-colors\r\n  // http://www.pimptrizkit.com/?t=20%20Shades\r\n  function ShadeBlendConvert (p, from, to) {\r\n    var rgba='';\r\n    if( from.toUpperCase().substring(0,5) == 'RGBA(' ) {\r\n      rgba='a';\r\n      from='rgb('+from.substring(5);\r\n    }\r\n\r\n    if(typeof(p)!=\"number\"||p<-1||p>1||typeof(from)!=\"string\"||(from[0]!='r'&&from[0]!='#')||(typeof(to)!=\"string\"&&typeof(to)!=\"undefined\"))return null;\r\n    //if(!this.sbcRip)this.sbcRip=function(d){\r\n    function sbcRip(d){\r\n      var l=d.length,RGB=new Object();\r\n      if(l>9){\r\n        d=d.split(\",\");\r\n        if(d.length<3||d.length>4)return null;\r\n        RGB[0]=i(d[0].slice(4)),RGB[1]=i(d[1]),RGB[2]=i(d[2]),RGB[3]=d[3]?parseFloat(d[3]):-1;\r\n      }else{\r\n        if(l==8||l==6||l<4)return null;\r\n        if(l<6)d=\"#\"+d[1]+d[1]+d[2]+d[2]+d[3]+d[3]+(l>4?d[4]+\"\"+d[4]:\"\");\r\n        d=i(d.slice(1),16),RGB[0]=d>>16&255,RGB[1]=d>>8&255,RGB[2]=d&255,RGB[3]=l==9||l==5?r(((d>>24&255)/255)*10000)/10000:-1;\r\n      }\r\n      return RGB;\r\n    }\r\n    var i=parseInt,r=Math.round,h=from.length>9,h=typeof(to)==\"string\"?to.length>9?true:to==\"c\"?!h:false:h,b=p<0,p=b?p*-1:p,to=to&&to!=\"c\"?to:b?\"#000000\":\"#FFFFFF\",f=sbcRip(from),t=sbcRip(to);\r\n    if(!f||!t)return null;\r\n    if(h)return \"rgb\"+rgba+\"(\"+r((t[0]-f[0])*p+f[0])+\",\"+r((t[1]-f[1])*p+f[1])+\",\"+r((t[2]-f[2])*p+f[2])+(f[3]<0&&t[3]<0?\")\":\",\"+(f[3]>-1&&t[3]>-1?r(((t[3]-f[3])*p+f[3])*10000)/10000:t[3]<0?f[3]:t[3])+\")\");\r\n    else return \"#\"+(0x100000000+(f[3]>-1&&t[3]>-1?r(((t[3]-f[3])*p+f[3])*255):t[3]>-1?r(t[3]*255):f[3]>-1?r(f[3]*255):255)*0x1000000+r((t[0]-f[0])*p+f[0])*0x10000+r((t[1]-f[1])*p+f[1])*0x100+r((t[2]-f[2])*p+f[2])).toString(16).slice(f[3]>-1||t[3]>-1?1:3);\r\n  }\r\n  \r\n  \r\n  // ##### clone a javascript object\r\n  function cloneJSObject( obj ) {\r\n    if (obj === null || typeof obj !== 'object') {\r\n      return obj;\r\n    }\r\n\r\n    var temp = obj.constructor(); // give temp the original obj's constructor\r\n    for (var key in obj) {\r\n        temp[key] = cloneJSObject(obj[key]);\r\n    }\r\n    return temp;\r\n  }\r\n  \r\n  // get viewport coordinates and size\r\n  function getViewport() {\r\n    var $win = jQuery(window);\r\n    return {\r\n      l: $win.scrollLeft(),\r\n      t: $win.scrollTop(),\r\n      w: $win.width(),\r\n      h: $win.height()\r\n    }\r\n  }\r\n\r\n\r\n  // avoid if possible (performance issue)\r\n  function inViewport( $elt, threshold ) {\r\n    var wp = getViewport(),\r\n    eltOS = $elt.offset(),\r\n    th = $elt.outerHeight(true),\r\n    tw = $elt.outerWidth(true);\r\n    if( eltOS.top >= (wp.t - threshold) \r\n      && (eltOS.top + th) <= (wp.t + wp.h + threshold)\r\n      && eltOS.left >= (wp.l - threshold) \r\n      && (eltOS.left + tw) <= (wp.l + wp.w + threshold) ) {\r\n      return true;\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // avoid if possible (performance issue)\r\n  function inViewportVert( $elt, threshold ) {\r\n    var wp = getViewport(),\r\n    eltOS = $elt.offset(),\r\n    th = $elt.outerHeight(true);\r\n    //var tw=$elt.outerWidth(true);\r\n\r\n    if( wp.t == 0 && (eltOS.top) <= (wp.t + wp.h ) ) { return true; }\r\n\r\n    if( eltOS.top >= (wp.t) \r\n      && (eltOS.top + th) <= (wp.t + wp.h - threshold) ) {\r\n        return true;\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n\r\n  // set z-index to display 2 elements on top of all others\r\n  function set2ElementsOnTop( start, elt1, elt2 ) {\r\n    var highest_index = 0;\r\n    if( start=='' ) { start= '*'; }\r\n    jQuery(start).each(function() {\r\n      var cur = parseInt(jQuery(this).css('z-index'));\r\n      highest_index = cur > highest_index ? cur : highest_index;\r\n    });\r\n    highest_index++;\r\n    jQuery(elt2).css('z-index',highest_index+1);\r\n    jQuery(elt1).css('z-index',highest_index);\r\n  }\r\n\r\n  // set z-index to display element on top of all others\r\n  function setElementOnTop( start, elt ) {\r\n    var highest_index = 0;\r\n    if( start == '' ) { start = '*'; }\r\n    jQuery(start).each(function() {\r\n      var cur = parseInt(jQuery(this).css('z-index'));\r\n      highest_index = cur > highest_index ? cur : highest_index;\r\n    });\r\n    highest_index++;\r\n    jQuery(elt).css('z-index',highest_index);\r\n  }\r\n  \r\n  // return the real type of the object\r\n  var toType = function( obj ) {\r\n    // by Angus Croll - http://javascriptweblog.wordpress.com/2011/08/08/fixing-the-javascript-typeof-operator/\r\n    return ({}).toString.call(obj).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()\r\n  };    \r\n    \r\n\r\n  $.nanogallery2 = function (elt, options) {\r\n    // To avoid scope issues, use '_this' instead of 'this'\r\n    // to reference this class from internal events and functions.\r\n    var _this = this;\r\n\r\n    // Access to jQuery and DOM versions of element\r\n    _this.$e  = jQuery(elt);\r\n    _this.e   = elt;\r\n\r\n    // Add a reverse reference to the DOM object\r\n    _this.$e.data('nanogallery2data', _this);\r\n\r\n    _this.init = function () {\r\n  \r\n      // define these global objects only once per HTML page\r\n      if (typeof window.NGY2Item === 'undefined') {\r\n  \r\n        window.NGY2Tools = (function () {\r\n\r\n          function NGY2Tools() {\r\n            var nextId = 1;                   // private static --> all instances\r\n          }\r\n\r\n          // check album name - albumList/blackList/whiteList\r\n          NGY2Tools.FilterAlbumName = function( title, ID ) {\r\n            var s = title.toUpperCase();\r\n            if( this.albumList.length > 0 ) {\r\n              for( var j=0; j < this.albumList.length; j++) {\r\n                if( s === this.albumList[j].toUpperCase() || ID === this.albumList[j] ) {\r\n                  return true;\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              var found = false;\r\n              if( this.whiteList !== null ) {\r\n                //whiteList : authorize only album cointaining one of the specified keyword in the title\r\n                for( var j = 0; j < this.whiteList.length; j++) {\r\n                  if( s.indexOf(this.whiteList[j]) !== -1 ) {\r\n                    found = true;\r\n                  }\r\n                }\r\n                if( !found ) { return false; }\r\n              }\r\n\r\n\r\n              if( this.blackList !== null ) {\r\n                //blackList : ignore album cointaining one of the specified keyword in the title\r\n                for( var j = 0; j < this.blackList.length; j++) {\r\n                  if( s.indexOf(this.blackList[j]) !== -1 ) { \r\n                    return false;\r\n                  }\r\n                }\r\n              }\r\n              return true;\r\n            }\r\n          };\r\n\r\n\r\n          /** @function nanoAlert */\r\n          /* Display an alert message in a specific element */\r\n          NGY2Tools.NanoAlert = function(context, msg, verbose) {\r\n            NGY2Tools.NanoConsoleLog.call(context, msg);\r\n            if( context.$E.conConsole != null ) {\r\n              context.$E.conConsole.css({visibility: 'visible', minHeight: '100px'});\r\n              if( verbose == false ) {\r\n                context.$E.conConsole.append('<p>' + msg + '</p>');\r\n              }\r\n              else {\r\n                context.$E.conConsole.append('<p>nanogallery2: '+ msg + ' [' + context.baseEltID + ']</p>');\r\n              }\r\n            }\r\n          };\r\n          \r\n  \r\n          /** @function NanoConsoleLog */\r\n          /* write message to the browser console */\r\n          NGY2Tools.NanoConsoleLog = function(context, msg) {\r\n            if (window.console) { console.log('nanogallery2: ' + msg + ' [' + context.baseEltID + ']'); }\r\n          };\r\n          \r\n\r\n          /** @function PreloaderDisplay() */\r\n          /* Display/hide preloader */\r\n          NGY2Tools.PreloaderDisplay = function(display) {\r\n            if( display === true ) {\r\n              this.$E.conLoadingB.removeClass('nanoGalleryLBarOff').addClass('nanoGalleryLBar');\r\n            }\r\n            else {\r\n              this.$E.conLoadingB.removeClass('nanoGalleryLBar').addClass('nanoGalleryLBarOff');\r\n            }\r\n          };\r\n\r\n          //+ Jonas Raoni Soares Silva\r\n          //@ http://jsfromhell.com/array/shuffle [v1.0]\r\n          NGY2Tools.AreaShuffle = function (o) {\r\n            for (var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);\r\n            return o;\r\n          };\r\n          \r\n          /** @function GetImageTitleFromURL() */\r\n          /* retrieve filemane */\r\n          NGY2Tools.GetImageTitleFromURL = function( imageURL ) {\r\n            if( this.O.thumbnailLabel.get('title') == '%filename' ) {\r\n              return (imageURL.split('/').pop()).replace('_',' ');\r\n            }\r\n            \r\n            if( this.O.thumbnailLabel.get('title') == '%filenameNoExt' ) {\r\n              var s=imageURL.split('/').pop();\r\n              return (s.split('.').shift()).replace('_',' ');\r\n            }\r\n            // return imageURL;\r\n            return '';\r\n          };\r\n          \r\n\r\n          /** @function AlbumPostProcess() */\r\n          /* post process one album based on plugin general parameters  --> sorting/maxItems*/\r\n          NGY2Tools.AlbumPostProcess = function(albumID) {\r\n\r\n            // this function can probably be optimized....\r\n          \r\n            var sortOrder = this.gallerySorting[this.GOM.curNavLevel];\r\n            var maxItems = this.galleryMaxItems[this.GOM.curNavLevel];\r\n          \r\n            if( sortOrder != '' || maxItems > 0 ) {\r\n            \r\n              // copy album's items to a new array\r\n              var currentAlbum = this.I.filter( function( obj ) {\r\n                return( obj.albumID == albumID && obj.kind != 'albumUp' );\r\n              });\r\n        \r\n              // sorting options\r\n              switch( sortOrder ) {\r\n                case 'RANDOM':\r\n                  currentAlbum = NGY2Tools.AreaShuffle(currentAlbum);\r\n                  break;\r\n                case 'REVERSED':\r\n                  currentAlbum = currentAlbum.reverse();\r\n                  break;\r\n                case 'TITLEASC':\r\n                  currentAlbum.sort(function (a, b) {\r\n                    return( (a.title.toUpperCase() < b.title.toUpperCase()) ? -1 : ((a.title.toUpperCase() > b.title.toUpperCase()) ? 1 : 0) );\r\n                  });\r\n                  break;\r\n                case 'TITLEDESC':\r\n                  currentAlbum.sort(function (a, b) {\r\n                    return( (a.title.toUpperCase() > b.title.toUpperCase()) ? -1 : ((a.title.toUpperCase() < b.title.toUpperCase()) ? 1 : 0) );\r\n                  });\r\n                  break;\r\n              }     \r\n\r\n              // max Items\r\n              if( maxItems > 0 && currentAlbum.length > maxItems ) {\r\n                currentAlbum.splice(maxItems - 1, currentAlbum.length-maxItems );\r\n              }\r\n              \r\n              // remove the albums's items from the global items array\r\n              this.I.removeIf( function( obj ) {\r\n                return( obj.albumID == albumID && obj.kind != 'albumUp' );\r\n              });\r\n              \r\n              // add the sorted items back to the album\r\n              this.I.push.apply(this.I, currentAlbum);\r\n\r\n            }\r\n          };\r\n          \r\n          return NGY2Tools;\r\n        })(); \r\n\r\n        // ====================\r\n        // ===== NGY2Item =====\r\n        // ====================\r\n        window.NGY2Item = (function() {\r\n          var nextId = 1;                   // private static --> all instances\r\n\r\n          // constructor\r\n          function NGY2Item( itemID ) {\r\n          //window.NGY2Item = function( itemID ) {\r\n            var ID = 0;                     // private\r\n\r\n            // public (this instance only)\r\n            if( itemID === undefined || itemID === null ) {\r\n              ID = nextId++;\r\n            }\r\n            else {\r\n              ID = itemID;\r\n            }\r\n            this.GetID = function () { return ID; };\r\n            \r\n            // public\r\n            this.kind =                 '';       // 'image', 'album' or 'albumUp'\r\n            this.mediaKind =            'img';    // 'img', 'iframe'\r\n            this.mediaMarkup =          '';\r\n            this.G =                    null;     // pointer to global instance\r\n            this.title =                '';       // image title\r\n            this.description =          '';       // image description\r\n            this.albumID =              0;        // ID of the parent album\r\n            this.src =                  '';       // full sized image URL\r\n            this.width =                0;        // image width\r\n            this.height =               0;        // image height\r\n            this.destinationURL =       '';       // thumbnail destination URL --> open URL instead of displaying image\r\n            this.downloadURL =          '';       // thumbnail download URL --> specify the image for download button\r\n            this.author =               '';       // image/album author\r\n            this.left=                  0;        // store position to animate from old to new\r\n            this.top=                   0;\r\n            this.width=                 0;        // store size to avoid setting width/height if not required\r\n            this.height=                0;\r\n            this.resizedContentWidth=   0;        // store size of content (image) to avoid setting width/height if not required\r\n            this.resizedContentHeight=  0;\r\n            this.thumbs = {                       // URLs and sizes for user defined\r\n              url:    { l1: { xs: '', sm:'', me: '', la: '', xl: '' }, lN: { xs: '', sm: '', me: '', la:'', xl: '' } },\r\n              width:  { l1: { xs: 0,  sm: 0, me: 0,  la: 0 , xl: 0  }, lN: { xs: 0 , sm: 0,  me: 0,  la: 0, xl: 0  } },\r\n              height: { l1: { xs: 0,  sm: 0, me: 0,  la: 0 , xl: 0  }, lN: { xs: 0,  sm: 0,  me: 0,  la: 0, xl: 0  } }\r\n            };\r\n            this.thumbnailImgRevealed   = false;  // thumbnail image already revealed\r\n            this.imageDominantColors    = null;   // base64 GIF\r\n            this.imageDominantColor     = null;   // HEX RGB\r\n            this.featured =             false;    // featured element\r\n            this.flickrThumbSizes =     {};       // store URLs for all available thumbnail sizes (flickr)\r\n            this.picasaThumbs =         null;     // store URLs and sizes\r\n            this.hovered =              false;    // is the thumbnail currently hovered?\r\n            this.hoverInitDone =        false;\r\n            this.contentIsLoaded =      false;    // album: are items already loaded?\r\n            this.contentLength =        0;        // album: number of items (real number of items in memory)\r\n            this.numberItems =          0;        // album: number of items (value returned by data source)\r\n            this.mediaNumber =          0;        // media number in the album\r\n            this.imageCounter =         0;        // number of images in an album\r\n            this.eltTransform =         [];       // store the CSS transformations\r\n            this.eltFilter =            [];       // store the CSS filters\r\n            this.eltEffect =            [];       // store data about hover effects animations\r\n            this.authkey =              '';       // for Google Photos private (hidden) albums\r\n            this.paginationLastPage =   0;        // for albums\r\n            this.paginationLastWidth =  0;        // for albums\r\n            this.customData =           {};\r\n            this.selected =             false;\r\n            this.imageWidth =           0;        // image natural (real) width\r\n            this.imageHeight =          0;        // image natural (real) height\r\n            this.$elt =                 null;     // pointer to the corresponding DOM element\r\n            this.$Elts =                [];       // cached pointers to the thumbnail content -> to avoid jQuery().find()\r\n            this.tags =                 [];       // list of tags of the current item\r\n            this.albumTagList =         [];       // list of all the tags of the items contained in the current album\r\n            this.albumTagListSel =      [];       // list of currently selected tags (only for albums)\r\n            this.exif = { exposure: '', flash: '', focallength: '', fstop: '', iso: '', model: '', time: '', location: ''};\r\n            this.deleted =              false;    // item is deleted -> do not display anymore\n            this.rotationAngle =        0;        // image display rotation angle\r\n          }\r\n\r\n          // public static\r\n          \r\n          NGY2Item.Get = function( instance, ID ) {\r\n            var l = instance.I.length;\r\n            for( var i = 0; i < l; i++ ) {\r\n              if( instance.I[i].GetID() == ID ) {\r\n                return instance.I[i];\r\n              }\r\n            }\r\n            return null;\r\n          };\r\n            \r\n          NGY2Item.GetIdx = function( instance, ID ) {\r\n            var l = instance.I.length;\r\n            for( var i = 0; i < l; i++ ) {\r\n              if( instance.I[i].GetID() == ID ) {\r\n                return i;\r\n              }\r\n            }\r\n            return -1;\r\n          };\r\n          \r\n          // create new item (image, album or albumUp)\r\n          NGY2Item.New = function( instance, title, description, ID, albumID, kind, tags ) {\r\n            var album = NGY2Item.Get( instance, albumID );\r\n            \r\n            if( albumID != -1 && albumID != 0 && title !='image gallery by nanogallery2 [build]'  ) {\r\n              if( instance.O.thumbnailLevelUp && album.getContentLength(false) == 0 && instance.O.album == '' ) {\r\n                // add navigation thumbnail (album up)\r\n                var item = new NGY2Item('0');\r\n                instance.I.push( item );\r\n                album.contentLength += 1;\r\n                item.title = 'UP';\r\n                item.albumID = albumID;\r\n                item.kind = 'albumUp';\r\n                item.G = instance;\r\n\r\n                jQuery.extend( true, item.thumbs.width, instance.tn.defaultSize.width);\r\n                jQuery.extend( true, item.thumbs.height, instance.tn.defaultSize.height);\r\n              }\r\n            }\r\n            \r\n            var item = NGY2Item.Get(instance, ID);\r\n            if( item === null ){\r\n              // create a new item (otherwise, just update the existing one)\r\n              item = new NGY2Item(ID);\r\n              instance.I.push(item);\r\n              if( albumID != -1 && title !='image gallery by nanogallery2 [build]' ) {\r\n                album.contentLength+=1;\r\n              }\r\n            }\r\n            item.G = instance;\r\n\r\n            item.albumID = albumID;\r\n            item.kind = kind;\r\n            if( kind == 'image' ) {\r\n              album.imageCounter += 1;\r\n              item.mediaNumber = album.imageCounter;\r\n            }\r\n\r\n            // check keyword to find features images/albums\r\n            var kw = instance.O.thumbnailFeaturedKeyword;\r\n            if( kw != '' ) {\r\n              // check if item featured based on a keyword in the title or in the description\r\n              kw = kw.toUpperCase();\r\n              var p = title.toUpperCase().indexOf(kw);\r\n              if( p > -1) {\r\n                item.featured = true;\r\n                // remove keyword case unsensitive\r\n                title = title.substring(0, p) + title.substring(p+kw.length, title.length);\r\n              }\r\n              p = description.toUpperCase().indexOf(kw);\r\n              if( p > -1) {\r\n                item.featured=true;\r\n                // remove keyword case unsensitive\r\n                description=description.substring(0, p) + description.substring(p + kw.length, description.length);\r\n              }\r\n            }\r\n            \r\n            // TAGS \r\n            // if( instance.galleryFilterTags.Get() != false ) {\r\n              // if( instance.galleryFilterTags.Get() == true ) {\r\n                // if( tags != '' && tags != undefined ) {\r\n                  // use set tags\r\n                  // item.setTags(tags.split(' '));\r\n                // }\r\n              // }\r\n              // else {\r\n                // extract tags starting with # (in title)\r\n              if( typeof instance.galleryFilterTags.Get() == 'string' ) {\r\n                switch( instance.galleryFilterTags.Get().toUpperCase() ) {\r\n                  case 'TITLE':\r\n                    var re = /(?:^|\\W)#(\\w+)(?!\\w)/g, match, matches = [];\r\n                    var tags = \"\";\r\n                    while (match = re.exec(title)) {\r\n                      matches.push(match[1].replace(/^\\s*|\\s*$/, ''));   //trim trailing/leading whitespace\r\n                    }\r\n                    item.setTags(matches);  //tags;\r\n                    title = title.split('#').join('');   //replaceall\r\n                    break;\r\n                  case 'DESCRIPTION':\r\n                    var re = /(?:^|\\W)#(\\w+)(?!\\w)/g, match, matches = [];\r\n                    var tags = \"\";\r\n                    while (match = re.exec(description)) {\r\n                      matches.push(match[1].replace(/^\\s*|\\s*$/, ''));   //trim trailing/leading whitespace\r\n                    }\r\n                    item.setTags(matches);  //tags;\r\n                    description = description.split('#').join('');   //replaceall\r\n                    break;\r\n                }\r\n              }\r\n                else {\r\n                  if( tags != '' && tags != undefined ) {\r\n                    // use set tags\r\n                    item.setTags(tags.split(' '));\r\n                  }\r\n                }\r\n              // }\r\n            // }\r\n            \r\n            // set (maybe modified) fields title and description\r\n            item.title = escapeHtml(instance, title);\r\n            item.description = escapeHtml(instance, description);\r\n            return item;\r\n          };\r\n          \r\n          \r\n          // removes logically current item\r\n          NGY2Item.prototype.delete = function( ) {\r\n            this.deleted = true;\r\n            \r\n            // update content length of parent album\r\n            this.G.I[NGY2Item.GetIdx(this.G, this.albumID)].contentLength--;\r\n            this.G.I[NGY2Item.GetIdx(this.G, this.albumID)].numberItems--;\r\n            \r\n            // check if in DOM and removes it\r\n            var nbTn = this.G.GOM.items.length;\r\n            var ID = this.GetID();\r\n            var foundIdx = -1;\r\n            var foundGOMidx = -1;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = this.G.GOM.items[i];\r\n              var item=this.G.I[curTn.thumbnailIdx];\r\n              if( item.GetID() == ID ) {\r\n                // FOUND\r\n                if( !curTn.neverDisplayed ) {\r\n                  foundIdx= curTn.thumbnailIdx;\r\n                  foundGOMidx= i;\r\n                }\r\n              }\r\n              else {\r\n                if( foundIdx != -1 ) {\r\n                  if( !curTn.neverDisplayed ) {\r\n                    // update index value\r\n                    item.$getElt('.nGY2GThumbnail').data('index', i-1);\r\n                    item.$getElt('.nGY2GThumbnailImg').data('index', i-1);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            if( foundIdx != -1 ) {\r\n              // delete item in GOM and delete thumbnail\r\n              var G = this.G;\r\n              if( this.selected == true ) {\r\n                this.selected = false;\r\n                G.GOM.nbSelected--;    // update the global counter\r\n              }\r\n              if( G.I[foundIdx].$elt !== null ) {\r\n                G.I[foundIdx].$elt.remove();      // delete thumbnail DOM object\r\n              }\r\n              G.GOM.items.splice(foundGOMidx, 1);   // delete in GOM\r\n              if( G.GOM.lastDisplayedIdx != -1 ) {\r\n                G.GOM.lastDisplayedIdx-=1;\r\n              }\r\n            }\r\n          }\r\n\r\n          NGY2Item.prototype.addToGOM = function( ) {\r\n            // retrieve index\r\n            var ID = this.GetID();\r\n            var l = this.G.I.length;\r\n            for( var idx = 0; idx < l; idx++ ) {\r\n              var item = this.G.I[idx];\r\n              if( item.GetID() == ID ) {\r\n                var w = item.thumbImg().width;\r\n                var h = item.thumbImg().height;\r\n                // set default size if required\r\n                if( h == 0 ) {\r\n                  h = this.G.tn.defaultSize.getHeight();\r\n                }\r\n                if( w == 0 ) {\r\n                  w = this.G.tn.defaultSize.getWidth();\r\n                }\r\n                // add to GOM -> will be displayed on next refresh/resize\r\n                var tn = new this.G.GOM.GTn(idx, w, h);\r\n                this.G.GOM.items.push(tn);\r\n                break;\r\n              }\r\n            }\r\n            \r\n          }\r\n          \r\n          \r\n          // function to avoid XSS issue - Cross Site Scripting\r\n          // original: https://github.com/janl/mustache.js/blob/master/mustache.js#L55\r\n          var entityMap = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#39;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;' };\r\n          function escapeHtml (instance, string) {\r\n            if( instance.O.allowHTMLinData == true ) {\r\n              return string;\r\n            }\r\n            else {\r\n              return String(string).replace(/[&<>\"'`=\\/]/g, function fromEntityMap (s) {\r\n                return entityMap[s];\r\n              });\r\n            }\r\n          }\r\n          \r\n          \r\n          NGY2Item.get_nextId = function () {\r\n            return nextId;\r\n          };\r\n\r\n          //=== public (shared across instances)\r\n\r\n          //--- cached sub elements\r\n          NGY2Item.prototype.$getElt = function( elt, forceRefresh ) {\r\n            if( this.$elt == null ) { return null; }\r\n            if( this.$Elts[elt] !== undefined && !forceRefresh == true ) {\r\n              return this.$Elts[elt];\r\n            }\r\n            else {\r\n              if( elt == '.nGY2GThumbnail' ) {\r\n                this.$Elts[elt]=this.$elt;\r\n              }\r\n              else {\r\n                this.$Elts[elt]=this.$elt.find(elt);\r\n              }\r\n              return this.$Elts[elt];\r\n            }\r\n          };\r\n          \r\n          // remove one element (in DOM and in cache)\r\n          NGY2Item.prototype.removeElt = function( elt ) {\r\n            if( this.$elt == null ) { return; }\r\n            if( this.$Elts[elt] == undefined) { return; }\r\n            this.$Elts[elt].remove();\r\n            var index = this.$Elts.indexOf(elt);\r\n            this.$Elts.splice(index, 1);\r\n          };\r\n\r\n          //--- returns the album containing the item\r\n          NGY2Item.prototype.album = function() {\r\n            return this.G.I[NGY2Item.GetIdx(this.G, this.albumID)];\r\n          };\r\n          \r\n          //--- viewer - transition can be disabled per media kind - returns true if current media supports transition (swipe)\r\n          NGY2Item.prototype.mediaTransition = function( ) {\r\n            if( this.G.O.viewerTransitionMediaKind.indexOf( this.mediaKind ) > -1 ) {\r\n              return true;\r\n            }\r\n            return false;\r\n          };\r\n\r\n          //--- set one image (url and size)\r\n          NGY2Item.prototype.imageSet = function( src, w, h ) {\r\n            this.src = src;\r\n            this.width = w;\r\n            this.height = h;\r\n          };\r\n          \r\n          //--- set one thumbnail (url and size) - screenSize and level are optionnal\r\n          NGY2Item.prototype.thumbSet = function( src, w, h, screenSize, level ) {\r\n            var lst=['xs','sm','me','la','xl'];\r\n            if( typeof screenSize === 'undefined' || screenSize == '' || screenSize == null ) {\r\n              for( var i=0; i< lst.length; i++ ) {\r\n                if( typeof level === 'undefined' || level == '' ) {\r\n                  this.thumbs.url.l1[lst[i]]=src;\r\n                  this.thumbs.height.l1[lst[i]]=h;\r\n                  this.thumbs.width.l1[lst[i]]=w;\r\n                  this.thumbs.url.lN[lst[i]]=src;\r\n                  this.thumbs.height.lN[lst[i]]=h;\r\n                  this.thumbs.width.lN[lst[i]]=w;\r\n                }\r\n                else {\r\n                  this.thumbs.url[level][lst[i]]=src;\r\n                  this.thumbs.height[level][lst[i]]=h;\r\n                  this.thumbs.width[level][lst[i]]=w;\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              if( typeof level === 'undefined' || level == '' || level == null ) {\r\n                this.thumbs.url.l1[screenSize]=src;\r\n                this.thumbs.height.l1[screenSize]=h;\r\n                this.thumbs.width.l1[screenSize]=w;\r\n                this.thumbs.url.lN[screenSize]=src;\r\n                this.thumbs.height.lN[screenSize]=h;\r\n                this.thumbs.width.lN[screenSize]=w;\r\n              }\r\n              else {\r\n                this.thumbs.url[level][screenSize]=src;\r\n                this.thumbs.height[level][screenSize]=h;\r\n                this.thumbs.width[level][screenSize]=w;\r\n              }\r\n            }\r\n          \r\n            var lst=['xs','sm','me','la','xl'];\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              this.thumbs.height.l1[lst[i]]=h;\r\n            }\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.lN[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.height.lN[lst[i]]=h;\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- set thumbnail image real height for current level/resolution, and for all others level/resolutions having the same settings\r\n          NGY2Item.prototype.thumbSetImgHeight = function( h ) {              \r\n            var lst=['xs','sm','me','la','xl'];\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.l1[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.height.l1[lst[i]]=h;\r\n              }\r\n            }\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.lN[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.height.lN[lst[i]]=h;\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- set thumbnail image real width for current level/resolution, and for all others level/resolutions having the same settings\r\n          NGY2Item.prototype.thumbSetImgWidth = function( w ) {              \r\n            var lst=['xs','sm','me','la','xl'];\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.l1[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.width.l1[lst[i]]=w;\r\n              }\r\n            }\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.lN[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.width.lN[lst[i]]=w;\r\n              }\r\n            }\r\n          };\r\n          \r\n          //--- Returns Thumbnail image (depending of the screen resolution)\r\n          NGY2Item.prototype.thumbImg = function () {   \r\n            var tnImg = { src: '', width: 0, height: 0 };\r\n\r\n            if( this.title == 'image gallery by nanogallery2 [build]' ) {\r\n              tnImg.src = this.G.emptyGif;\r\n              tnImg.url = this.G.emptyGif;\r\n              return tnImg;\r\n            }\r\n            tnImg.src = this.thumbs.url[this.G.GOM.curNavLevel][this.G.GOM.curWidth];\r\n            tnImg.width = this.thumbs.width[this.G.GOM.curNavLevel][this.G.GOM.curWidth];\r\n            tnImg.height = this.thumbs.height[this.G.GOM.curNavLevel][this.G.GOM.curWidth];\r\n            return tnImg;\r\n          };\r\n          \r\n          //--- Set tags to items and add these tags to the album\r\n          NGY2Item.prototype.setTags = function( tags ) {              \r\n          if( tags.length > 0 ) {\r\n              this.tags = tags;\r\n              var lstTags = this.album().albumTagList;\r\n              for( var i = 0; i < tags.length; i++ ) {\r\n                var tfound = false;\r\n                for( var j = 0; j < lstTags.length; j++ ) {\r\n                  if( tags[i].toUpperCase() == lstTags[j].toUpperCase() ) {\r\n                    tfound = true;\r\n                  }\r\n                }\r\n                if( tfound == false) {\r\n                  this.album().albumTagList.push(tags[i])\r\n                  this.album().albumTagListSel.push(tags[i])\r\n                }\r\n              }\r\n            }\r\n          };\r\n          \r\n          //--- check if 1 of current item's tags is selected (tag filter)\r\n          NGY2Item.prototype.checkTagFilter = function() {\r\n            if( this.G.galleryFilterTags.Get() != false && this.album().albumTagList.length > 0 ) {\r\n              if( this.G.O.thumbnailLevelUp && this.kind=='albumUp' ) {\r\n                return true;\r\n              }\r\n              var found = false;\r\n              var lstTags = this.album().albumTagListSel;\r\n              for( var i = 0; i < this.tags.length; i++ ) {\r\n                for( var j = 0; j < lstTags.length; j++ ) {\r\n                  if( this.tags[i].toUpperCase() == lstTags[j].toUpperCase() ) {\r\n                    found = true;\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n              return found;\r\n            }\r\n            else\r\n              return true;\r\n          };\r\n          \r\n          //--- check if 1 of current item's tags is found using API search\r\n          NGY2Item.prototype.isSearchTagFound = function() {\r\n            if( this.G.GOM.albumSearchTags == '' ) { return true; }\r\n            if( this.G.O.thumbnailLevelUp && this.kind == 'albumUp' ) { return true; }\r\n\r\n            //var lstTags=this.album().albumTagListSel;\r\n            for( var i = 0; i < this.tags.length; i++ ) {\r\n              if( this.tags[i].toUpperCase().indexOf( this.G.GOM.albumSearchTags ) >= 0 ) {\r\n                return true;\r\n              }\r\n            }\r\n            return false;\r\n          };\r\n          \r\n          //--- set the URL of the media to display in the viewer\r\n          //--- markup is defined for images\r\n          NGY2Item.prototype.setMediaURL = function( url, mediaKind ) {\r\n            this.src = url;\r\n            this.mediaKind = mediaKind;\r\n            if( mediaKind == 'img' ) {\r\n              this.mediaMarkup = '<img class=\"nGY2ViewerMedia\" src=\"' + url + '\" alt=\" \" itemprop=\"contentURL\" draggable=\"false\">';\r\n            }\r\n          };\r\n          \r\n          \r\n          //--- check if current item should be displayed\r\n          NGY2Item.prototype.isToDisplay = function( albumID ) {\r\n            return this.albumID == albumID && this.checkTagFilter() && this.isSearchFound() && this.isSearchTagFound() && this.deleted == false;\r\n          };\r\n          \r\n          \r\n          \r\n          //--- returns the number of items of the current album\r\n          //--- count using tags filter\r\n          NGY2Item.prototype.getContentLength = function( filterTags ) {\r\n            if( filterTags == false || this.albumTagList.length == 0 || this.G.galleryFilterTags.Get() == false ) {\r\n              return this.contentLength;\r\n            }\r\n            else {\r\n              var l = this.G.I.length;\r\n              var cnt = 0;\r\n              var albumID = this.GetID();\r\n              for( var idx = 0; idx < l; idx++ ) {\r\n                var item = this.G.I[idx];\r\n                if( item.isToDisplay(albumID) ) {\r\n                  cnt++;\r\n                }\r\n              }\r\n              return cnt;\r\n            }\r\n          };\r\n          \r\n          NGY2Item.prototype.isSearchFound = function() {\r\n            if( this.G.GOM.albumSearch != '' ) {\r\n              if( this.title.toUpperCase().indexOf( this.G.GOM.albumSearch ) == -1 ) {\r\n                return false;\r\n              }\r\n            }\r\n            return true;\r\n          }\r\n          \r\n          \r\n          //--- for future use...\r\n          NGY2Item.prototype.responsiveURL = function () {\r\n            var url = '';\r\n            switch(this.G.O.kind) {\r\n              case '':\r\n                url = this.src;\r\n                break;\r\n              case 'flickr':\r\n                url = this.src;\r\n                break;\r\n              case 'picasa':\r\n              case 'google':\r\n              case 'google2':\r\n              default:\r\n                url = this.src;\r\n                break;\r\n            }\r\n            return url;\r\n          };\r\n          \r\n          \r\n          //--- Reveal the thumbnail image with animation on opacity\r\n          NGY2Item.prototype.ThumbnailImageReveal = function () {\r\n\r\n            if( this.thumbnailImgRevealed == false ) {\r\n              this.thumbnailImgRevealed = true;\r\n              new NGTweenable().tween({\r\n                from:         { opacity: 0 },\r\n                to:           { opacity: 1 },\r\n                attachment:   { item: this },\r\n                delay:        30,\r\n                duration:     400,\r\n                easing:       'easeOutQuart',\r\n                step:         function (state, att) {\r\n                  var $e=att.item.$getElt('.nGY2TnImg');\r\n                  if( $e != null ) {\r\n                    $e.css( state );\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          };\r\n          \r\n          \r\n          // In case of thumbnails with stacks - apply a percent to a value which include a unit\r\n          function ValueApplyPercent( str, percent ) {\r\n            str=String(str);\r\n            if( str === '0' || percent == 1 ) { return str; }\r\n            var n = Number(str.replace(/[a-zA-Z]/g, ''));\r\n            var ar = str.match(/([^\\-0-9\\.]+)/g);\r\n            var a = '';\r\n            if( ar != null && ar.length > 0 ) {\r\n              a = ar.join();\r\n            }\r\n             \r\n            if( isNaN(n) || n == 0 ) {\r\n              return str;\r\n            }\r\n\r\n            n = n * percent;\r\n            return n + a;\r\n          } \r\n          \r\n          //--- 2D/3D CSS transform - apply the cached value to element\r\n          NGY2Item.prototype.CSSTransformApply = function ( eltClass ) {\r\n            var obj = this.eltTransform[eltClass];\r\n\r\n            if( eltClass == '.nGY2GThumbnail' ) {\r\n              // thumbnail\r\n              var nbStacks = obj.$elt.length-1;\r\n              var pTranslateX = 1;\r\n              var pTranslateY = 1;\r\n              var pTranslateZ = 1;\r\n              var pTranslate = 1;\r\n              var pRotateX = 1;\r\n              var pRotateY = 1;\r\n              var pRotateZ = 1;\r\n              var pRotate = 1;\r\n              var pScale = 1;\r\n              for( var n = nbStacks; n >= 0; n-- ) {\r\n                // units must be given with\r\n                var v = 'translateX(' + ValueApplyPercent(obj.translateX,pTranslateX) + ') translateY(' + ValueApplyPercent(obj.translateY,pTranslateY) + ') translateZ(' + ValueApplyPercent(obj.translateZ,pTranslateZ) + ') scale(' + ValueApplyPercent(obj.scale,pScale) + ') translate(' + ValueApplyPercent(obj.translate,pTranslate) + ')';\r\n                if( !(this.G.IE <= 9) && !this.G.isGingerbread ) {\r\n                  v += ' rotateX(' + ValueApplyPercent(obj.rotateX,pRotateX) + ') rotateY(' + ValueApplyPercent(obj.rotateY,pRotateY) + ') rotateZ(' + ValueApplyPercent(obj.rotateZ,pRotateZ) + ') rotate(' + ValueApplyPercent(obj.rotate,pRotate) + ')';\r\n                }\r\n                else {\r\n                  v += ' rotate(' + ValueApplyPercent(obj.rotateZ,pRotateZ) + ')';\r\n                }\r\n                obj.$elt[n].style[this.G.CSStransformName] = v;\r\n                \r\n                if( nbStacks > 0 ) {\r\n                  // apply a percent to the stack elements\r\n                  pTranslateX -= this.G.tn.opt.Get('stacksTranslateX');\r\n                  pTranslateY -= this.G.tn.opt.Get('stacksTranslateY');\r\n                  pTranslateZ -= this.G.tn.opt.Get('stacksTranslateZ');\r\n                  pRotateX    -= this.G.tn.opt.Get('stacksRotateX');\r\n                  pRotateY    -= this.G.tn.opt.Get('stacksRotateY');\r\n                  pRotateZ    -= this.G.tn.opt.Get('stacksRotateZ');\r\n                  pScale      -= this.G.tn.opt.Get('stacksScale');\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              // thumbnail sub element\r\n              if( obj.$elt != null ) {\r\n                for( var n = 0; n < obj.$elt.length; n++ ) {\r\n                  if( obj.$elt[n] != undefined ) {\r\n                    // units must be given with\r\n                    var v = 'translateX(' + obj.translateX + ') translateY(' + obj.translateY + ') translateZ(' + obj.translateZ + ') scale(' + obj.scale + ') translate(' + obj.translate + ')';\r\n                    if( !(this.G.IE <= 9) && !this.G.isGingerbread ) {\r\n                      v += ' rotateX(' + obj.rotateX + ') rotateY(' + obj.rotateY + ') rotateZ(' + obj.rotateZ + ') rotate(' + obj.rotate + ')';\r\n                    }\r\n                    else {\r\n                      v += ' rotate(' + obj.rotateZ + ')';\r\n                    }\r\n                    obj.$elt[n].style[this.G.CSStransformName] = v;\r\n                    }\r\n                }\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- 2D/3D CSS transform - set a value in cache\r\n          NGY2Item.prototype.CSSTransformSet = function ( eltClass, transform, value, forceRefresh ) {\r\n            if( this.eltTransform[eltClass] == undefined ) {\r\n              this.eltTransform[eltClass] = { translateX: 0, translateY: 0, translateZ: 0, rotateX: 0, rotateY: 0, rotateZ: 0, scale: 1, translate: '0px,0px', rotate: 0 };\r\n              this.eltTransform[eltClass].$elt = this.$getElt(eltClass);\r\n            }\r\n            this.eltTransform[eltClass][transform] = value;\r\n            if( forceRefresh === true ) {\r\n              this.eltTransform[eltClass].$elt = this.$getElt(eltClass, true);\r\n            }\r\n          };\r\n\r\n          //--- CSS Filters - apply the cached value to element\r\n          NGY2Item.prototype.CSSFilterApply = function ( eltClass ) {\r\n            var obj = this.eltFilter[eltClass];\r\n            var v = 'blur(' + obj.blur + ') brightness(' + obj.brightness + ') grayscale(' + obj.grayscale + ') sepia(' + obj.sepia + ') contrast(' + obj.contrast + ') opacity(' + obj.opacity + ') saturate(' + obj.saturate + ')';\r\n            if( obj.$elt != null ) {\r\n              for( var n = 0; n < obj.$elt.length; n++ ) {\r\n                if( obj.$elt[n] != undefined ) {\r\n                  obj.$elt[n].style.WebkitFilter = v;\r\n                  obj.$elt[n].style.filter = v;\r\n                }\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- CSS Filters - set a value in cache\r\n          NGY2Item.prototype.CSSFilterSet = function ( eltClass, filter, value, forceRefresh ) {\r\n            if( this.eltFilter[eltClass] == undefined ) {\r\n              this.eltFilter[eltClass] = { blur: 0, brightness: '100%', grayscale: '0%', sepia: '0%', contrast: '100%', opacity: '100%', saturate: '100%' };\r\n              this.eltFilter[eltClass].$elt = this.$getElt(eltClass);\r\n            }\r\n            this.eltFilter[eltClass][filter] = value;\r\n            if( forceRefresh === true ) {\r\n              this.eltTransform[eltClass].$elt = this.$getElt(eltClass, true);\r\n            }\r\n          };\r\n\r\n          //--- thumbnail hover animation\r\n          NGY2Item.prototype.animate = function ( effect, delay, hoverIn ) {\r\n            if( this.$getElt() == null  ) { return; }\r\n\r\n            var context = {};\r\n            context.G = this.G;\r\n            context.item = this;\r\n            context.effect = effect;\r\n            context.hoverIn = hoverIn;\r\n            context.cssKind = '';\r\n            if( hoverIn ) {\r\n              // HOVER IN\r\n              \r\n              if( this.eltEffect[effect.element] == undefined ) {\r\n                this.eltEffect[effect.element] = [];\r\n              }\r\n              if( this.eltEffect[effect.element][effect.type] == undefined ) {\r\n                this.eltEffect[effect.element][effect.type] = { initialValue: 0, lastValue: 0 };\r\n              }\r\n              if( effect.firstKeyframe ) {\r\n                // store initial and current value -> for use in the back animation\r\n                this.eltEffect[effect.element][effect.type] = { initialValue: effect.from, lastValue: effect.from};\r\n              }\r\n              \r\n              context.animeFrom = effect.from;\r\n              context.animeTo = effect.to;\r\n              context.animeDuration = parseInt(effect.duration);\r\n              context.animeDelay = 30 + parseInt(effect.delay + delay);  // 30ms is a default delay to avoid conflict with other initializations\r\n              context.animeEasing = effect.easing;\r\n            }\r\n            else {\r\n              // HOVER OUT\r\n              if( effect.firstKeyframe ) {\r\n                context.animeFrom = this.eltEffect[effect.element][effect.type].lastValue;\r\n                context.animeTo = this.eltEffect[effect.element][effect.type].initialValue;\r\n                // context.animeTo=effect.from;\r\n              }\r\n              else {\r\n                // context.animeFrom=effect.from;\r\n                context.animeFrom = this.eltEffect[effect.element][effect.type].lastValue;\r\n                context.animeTo = this.eltEffect[effect.element][effect.type].initialValue;\r\n                // context.animeTo=effect.to;\r\n                \r\n              }\r\n              \r\n              context.animeDuration = parseInt(effect.durationBack);\r\n              context.animeDelay = 30 + parseInt(effect.delayBack + delay);   // 30ms is a default delay to avoid conflict with other initializations\r\n              context.animeEasing = effect.easingBack;\r\n            }\r\n            \r\n\r\n            // detect if animation on CSS transform\r\n            var transform=['translateX', 'translateY', 'translateZ', 'scale', 'rotateX', 'rotateY', 'rotateZ'];\r\n            for( var i = 0; i < transform.length; i++ ) {\r\n              if( effect.type == transform[i] ) {\r\n                context.cssKind = 'transform';\r\n                break;\r\n              }\r\n            }\r\n\r\n            // detect if animation on CSS filter\r\n            var filter=['blur', 'brightness', 'grayscale', 'sepia', 'contrast', 'opacity', 'saturate'];\r\n            for( var i = 0; i < filter.length; i++ ) {\r\n              if( effect.type == filter[i] ) {\r\n                context.cssKind = 'filter';\r\n                break;\r\n              }\r\n            }\r\n            // handle some special cases\r\n            if( hoverIn && effect.element == '.nGY2GThumbnail' && ( effect.type == 'scale' || effect.type == 'rotateX') ) {\r\n              this.G.GOM.lastZIndex++;\r\n              this.$getElt(effect.element).css('z-index', this.G.GOM.lastZIndex);\r\n              // setElementOnTop(this.G.$E.base, this.$getElt(effect.element) );\r\n            }\r\n            \r\n            // animation\r\n            var tweenable = new NGTweenable();\r\n            context.tweenable=tweenable;\r\n            tweenable.tween({\r\n              attachment:   context,\r\n              from:         { 'v': context.animeFrom },\r\n              to:           { 'v': context.animeTo },\r\n              duration:     context.animeDuration,    //parseInt(effect.duration),\r\n              delay:        context.animeDelay,       //parseInt(effect.delay),\r\n              easing:       context.animeEasing,      //'easeOutQuart',\r\n              \r\n              step: function (state, att) {\r\n                if( att.item.$getElt() == null ) {\r\n                  // the thumbnail may be destroyed since the start of the animation\r\n                  att.tweenable.stop(false);\r\n                  // att.tweenable.dispose();\r\n                  return;\r\n                }\r\n                if( att.hoverIn && !att.item.hovered ) {\r\n                  // thumbnail no more hovered\r\n                  att.tweenable.stop(false);\r\n                  // att.tweenable.dispose();\r\n                  return;\r\n                }\r\n\r\n                if( att.G.VOM.viewerDisplayed ) {\r\n                  att.tweenable.stop(false);\r\n                  // att.tweenable.dispose();\r\n                  return;\r\n                }\r\n                \r\n                // test if in delay phase\r\n                if( state.v == att.animeFrom ) { return; }\r\n                \r\n                switch( att.cssKind ) {\r\n                  case 'transform':\r\n                    // window.ng_draf( function() {\r\n                      att.item.CSSTransformSet(att.effect.element, att.effect.type, state.v);\r\n                      att.item.CSSTransformApply( att.effect.element );\r\n                    // });\r\n                    break;\r\n                  case 'filter':\r\n                    // window.ng_draf( function() {\r\n                      att.item.CSSFilterSet(att.effect.element, att.effect.type, state.v);\r\n                      att.item.CSSFilterApply( att.effect.element );\r\n                    // });\r\n                    break;\r\n                  default:\r\n                    var v=state.v;\r\n                    if( state.v.substring(0,4) == 'rgb(' || state.v.substring(0,5) == 'rgba(' ) {\r\n                      // to remove values after the dot (not supported by RGB/RGBA)\r\n                      // v=ngtinycolor(state.v).toRgbString();\r\n                      v = ShadeBlendConvert(0, v);\r\n                    }\r\n                    // window.ng_draf( function() {\r\n                      att.item.$getElt( att.effect.element ).css( att.effect.type, v );\r\n                    // });\r\n                    break;\r\n                }\r\n                if( hoverIn ) {\r\n                  // store value for back animation\r\n                  att.item.eltEffect[att.effect.element][att.effect.type].lastValue = state.v;\r\n                }\r\n              },\r\n              \r\n              finish: function (state, att) {\r\n                if( hoverIn ) {\r\n                  // store value for back animation\r\n                  att.item.eltEffect[att.effect.element][att.effect.type].lastValue = state.v;\r\n                }\r\n\r\n                if( att.item.$getElt() == null ) {\r\n                  // the thumbnail may be destroyed since the start of the animation\r\n                  return;\r\n                }\r\n                if( att.hoverIn && !att.item.hovered ) {\r\n                  // thumbnail no more hovered\r\n                  return;\r\n                }\r\n\r\n                if( att.G.VOM.viewerDisplayed ) {\r\n                  return;\r\n                }\r\n\r\n                // window.ng_draf( function() {\r\n                  switch( att.cssKind ) {\r\n                    case 'transform':\r\n                      att.item.CSSTransformSet(att.effect.element, att.effect.type, att.animeTo);\r\n                      att.item.CSSTransformApply(att.effect.element);\r\n                      break;\r\n                    case 'filter':\r\n                      att.item.CSSFilterSet(att.effect.element, att.effect.type, att.animeTo);\r\n                      att.item.CSSFilterApply(att.effect.element);\r\n                      break;\r\n                    default:\r\n                      att.item.$getElt(att.effect.element).css(att.effect.type, att.animeTo);\r\n                      break;\r\n                  }\r\n                // });\r\n              }\r\n            });\r\n          };\r\n\r\n          return NGY2Item;\r\n        })();    \r\n          \r\n      }\r\n\r\n      _this.options = jQuery.extend(true, {}, jQuery.nanogallery2.defaultOptions, options);\r\n      // Initialization code\r\n      _this.nG2 = null;\r\n      _this.nG2 = new nanoGALLERY2();\r\n      _this.nG2.initiateGallery2(_this.e, _this.options );\r\n\r\n    };\r\n      \r\n    // PUBLIC EXPOSED METHODS\r\n    _this.test = function() {\r\n      //alert('test');\r\n      // console.dir(_this.nG.G.I.length);\r\n      // console.dir(_this.nG);\r\n      //privateTest();\r\n    }\r\n\r\n    \r\n    // Run initializer\r\n    _this.init();\r\n  };\r\n \r\n  jQuery.nanogallery2.defaultOptions = {\r\n    kind :                        '',\r\n    userID :                      '',\r\n    photoset :                    '',\r\n    album:                        '',\r\n    blackList :                   'scrapbook|profil|auto backup',\n    whiteList :                   '',\n    albumList :                   '',\r\n    albumList2 :                  null,\r\n    RTL :                         false,\r\n    poogleplusUseUrlCrossDomain : true,\r\n    flickrSkipOriginal :          true,\r\n    breadcrumbAutoHideTopLevel :  true,\r\n    displayBreadcrumb :           true,\r\n    breadcrumbOnlyCurrentLevel :  true,\r\n    breadcrumbHideIcons :         true,\r\n    theme :                       'nGY2',\r\n    galleryTheme :                'dark',\n    viewerTheme :                 'dark',\r\n    items :                       null,\r\n    itemsBaseURL :                '',\r\n    thumbnailSelectable :         false,\r\n    dataProvider:                 '',\r\n    dataCharset:                  'Latin',\r\n    allowHTMLinData:              false,\n    locationHash :                true,\n    slideshowDelay :              3000,\n    slideshowAutoStart :          false,\n\n    debugMode:                    false,\n\r\n    galleryDisplayMoreStep :      2,\r\n    galleryDisplayMode :          'fullContent',\r\n    galleryL1DisplayMode :        null,\r\n    galleryPaginationMode :       'rectangles',   // 'dots', 'rectangles', 'numbers'\r\n    // galleryThumbnailsDisplayDelay : 2000,\r\n    galleryMaxRows :              2,\r\n    galleryL1MaxRows :            null,\r\n    galleryLastRowFull:           false,\r\n    galleryLayoutEngine :         'default',\r\n    paginationSwipe:              true,\r\n    paginationVisiblePages :      10,\r\n    // paginationSwipeSensibilityVert : 10,\r\n    galleryFilterTags :           false,    // possible values: false, true, 'title', 'description'\r\n    galleryL1FilterTags :         null,     // possible values: false, true, 'title', 'description'\r\n    galleryMaxItems :             0,        // maximum number of items per album  --> only flickr, google2, nano_photos_provider2\r\n    galleryL1MaxItems :           null,     // maximum number of items per gallery page --> only flickr, google2, nano_photos_provider2\r\n    gallerySorting :              '',\r\n    galleryL1Sorting :            null,\r\n    galleryDisplayTransition :    'none',\r\n    galleryL1DisplayTransition :  null,\r\n    galleryDisplayTransitionDuration :    1000,\r\n    galleryL1DisplayTransitionDuration :  null,\r\n    galleryResizeAnimation :      true,\n    galleryRenderDelay :          60,\n\n    thumbnailCrop :               true,\r\n    thumbnailL1Crop :             null,\n    thumbnailCropScaleFactor :    1.5,\n    thumbnailLevelUp :            false,\n    thumbnailAlignment :          'fillWidth',\n    thumbnailWidth :              300,\r\n    thumbnailL1Width :            null,\n    thumbnailHeight :             200,\r\n    thumbnailL1Height :           null,\r\n    thumbnailBaseGridHeight :     0,\r\n    thumbnailL1BaseGridHeight :   null,\n    thumbnailGutterWidth :        2,\r\n    thumbnailL1GutterWidth :      null,\n    thumbnailGutterHeight :       2,\r\n    thumbnailL1GutterHeight :     null,\n    thumbnailBorderVertical :     2,\n    thumbnailBorderHorizontal :   2,\n    thumbnailFeaturedKeyword :    '*featured',\n    thumbnailAlbumDisplayImage :  false,\n    thumbnailHoverEffect2 :       'toolsAppear',\n    thumbnailBuildInit2 :         '',\r\n    thumbnailStacks :             0,\r\n    thumbnailL1Stacks :           null,\r\n    thumbnailStacksTranslateX :   0,\r\n    thumbnailL1StacksTranslateX : null,\r\n    thumbnailStacksTranslateY :   0,\r\n    thumbnailL1StacksTranslateY : null,\r\n    thumbnailStacksTranslateZ :   0,\r\n    thumbnailL1StacksTranslateZ : null,\r\n    thumbnailStacksRotateX :      0,\r\n    thumbnailL1StacksRotateX :    null,\r\n    thumbnailStacksRotateY :      0,\r\n    thumbnailL1StacksRotateY :    null,\r\n    thumbnailStacksRotateZ :      0,\r\n    thumbnailL1StacksRotateZ :    null,\r\n    thumbnailStacksScale :        0,\r\n    thumbnailL1StacksScale :      null,\r\n    thumbnailDisplayOutsideScreen: true,\r\n    thumbnailWaitImageLoaded:     true,\r\n    thumbnailSliderDelay:         2000,\r\n    galleryBuildInit2 :           '',\r\n    portable :                    false,\r\n    eventsDebounceDelay:          30,\n    \n    touchAnimation :              true,\r\n    touchAnimationL1 :            undefined,\n    touchAutoOpenDelay :          0,\n\n    thumbnailLabel : {\n      position :                  'overImageOnBottom',\n      align:                      'center',\n      display :                   true,\n      displayDescription :        false,\n      titleMaxLength :            0,\r\n      titleMultiLine :            false,\n      descriptionMaxLength :      0,\r\n      descriptionMultiLine :      false,\n      hideIcons :                 true,\n      title :                     ''\n    },\n\n    thumbnailToolbarImage :       { topLeft: 'select', topRight : 'featured' },\n    thumbnailToolbarAlbum :       { topLeft: 'select', topRight : 'counter'  },\n    thumbnailDisplayInterval :    15,\r\n    thumbnailL1DisplayInterval :  null,\n    thumbnailDisplayTransition :  'fadeIn',\r\n    thumbnailL1DisplayTransition : null,\n    thumbnailDisplayTransitionDuration:   240,\r\n    thumbnailL1DisplayTransitionDuration: null,\n    thumbnailOpenImage :          true,\r\n    thumbnailOpenOriginal :       false,\n    thumbnailGlobalImageTitle :   '',\n    thumbnailGlobalAlbumTitle :   '',\n    \n    viewer :                      'internal',\r\n    viewerFullscreen:             false,\r\n    viewerDisplayLogo :           false,\r\n    imageTransition :             'swipe2',\r\n    viewerTransitionMediaKind :   'img',\r\n    viewerZoom :                  true,\r\n    viewerImageDisplay :          '',\r\n    openOnStart :                 '',\r\n    viewerHideToolsDelay :        3000,\r\n    viewerToolbar : {\r\n      display :                   true,\r\n      position :                  'bottomOverImage',\r\n      fullWidth :                 true,\r\n      align :                     'center',\r\n      autoMinimize :              0,\r\n      standard :                  'minimizeButton,label',\r\n      minimized :                 'minimizeButton,label,infoButton,shareButton,downloadButton,linkOriginalButton,fullscreenButton'\r\n    },\r\n    viewerTools : {\r\n      topLeft :                   'pageCounter,playPauseButton',\r\n      topRight :                  'rotateLeft,rotateRight,fullscreenButton,closeButton' \r\n    },\r\n    \r\n    breakpointSizeSM :            480,\n    breakpointSizeME :            992,\n    breakpointSizeLA :            1200,\n    breakpointSizeXL :            1800,\r\n    \n    fnThumbnailInit :             null,\n    fnThumbnailHoverInit :        null,\n    fnThumbnailHover :            null,\n    fnThumbnailHoverOut :         null,\n    fnThumbnailDisplayEffect :    null,\r\n    fnViewerInfo :                null,\r\n    fnImgToolbarCustInit :        null,\n    fnImgToolbarCustDisplay :     null,\n    fnImgToolbarCustClick :       null,\r\n    fnProcessData :               null,\r\n    fnThumbnailSelection :        null,\r\n    fnGalleryRenderStart :        null,\r\n    fnGalleryRenderEnd :          null,\r\n    fnGalleryObjectModelBuilt :   null,\r\n    fnGalleryLayoutApplied :      null,\r\n    fnThumbnailClicked :          null,\n    fnShoppingCartUpdated :       null,\n    fnThumbnailToolCustAction :   null,\n    fnThumbnailOpen :             null,\n    fnImgDisplayed :              null,\n\n    i18n : {\r\n      'breadcrumbHome' : 'Galleries', 'breadcrumbHome_FR' : 'Galeries',\r\n      'thumbnailImageTitle' : '', 'thumbnailAlbumTitle' : '',\r\n      'thumbnailImageDescription' : '', 'thumbnailAlbumDescription' : '',\r\n      'infoBoxPhoto' : 'Photo', 'infoBoxDate' : 'Date', 'infoBoxAlbum' : 'Album', 'infoBoxDimensions' : 'Dimensions', 'infoBoxFilename' : 'Filename', 'infoBoxFileSize' : 'File size', 'infoBoxCamera' : 'Camera', 'infoBoxFocalLength' : 'Focal length', 'infoBoxExposure' : 'Exposure', 'infoBoxFNumber' : 'F Number', 'infoBoxISO' : 'ISO', 'infoBoxMake' : 'Make', 'infoBoxFlash' : 'Flash', 'infoBoxViews' : 'Views', 'infoBoxComments' : 'Comments'\r\n    },\r\n    icons : {\r\n      // sample for font awesome: <i style=\"color:#eee;\" class=\"fa fa-search-plus\"></i>\r\n      thumbnailAlbum:               '<i class=\"nGY2Icon-folder-empty\"></i>',\r\n      thumbnailImage:               '<i class=\"nGY2Icon-picture\"></i>',\r\n      breadcrumbAlbum:              '<i class=\"nGY2Icon-folder-empty\"></i>',\r\n      breadcrumbHome:               '<i class=\"nGY2Icon-home\"></i>',\r\n      breadcrumbSeparator:          '<i class=\"nGY2Icon-left-open\"></i>',\r\n      breadcrumbSeparatorRtl:       '<i class=\"nGY2Icon-right-open\"></i>',\r\n      navigationFilterSelected:     '<i style=\"color:#fff;\" class=\"nGY2Icon-toggle-on\"></i>',\r\n      navigationFilterUnselected:   '<i style=\"color:#ddd;\" class=\"nGY2Icon-toggle-off\"></i>',\r\n      navigationFilterSelectedAll:  '<i class=\"nGY2Icon-toggle-on\"></i><i class=\"nGY2Icon-ok\"></i>',\r\n      thumbnailSelected:            '<i style=\"color:#bff;\" class=\"nGY2Icon-ok-circled\"></i>',\r\n      thumbnailUnselected:          '<i style=\"color:#bff;\" class=\"nGY2Icon-circle-empty\"></i>',\r\n      thumbnailFeatured:            '<i style=\"color:#dd5;\" class=\"nGY2Icon-star\"></i>',\r\n      thumbnailCounter:             '<i class=\"nGY2Icon-picture\"></i>',\r\n      thumbnailShare:               '<i class=\"nGY2Icon-ngy2_share2\"></i>',\r\n      thumbnailDownload:            '<i class=\"nGY2Icon-ngy2_download2\"></i>',\r\n      thumbnailInfo:                '<i class=\"nGY2Icon-ngy2_info2\"></i>',\r\n      thumbnailCart:                '<i class=\"nGY2Icon-basket\"></i>',\r\n      thumbnailDisplay:             '<i class=\"nGY2Icon-ngy2_zoom_in2\"></i>',\r\n      thumbnailCustomTool1:         'T1',\r\n      thumbnailCustomTool2:         'T2',\r\n      thumbnailCustomTool3:         'T3',\r\n      thumbnailCustomTool4:         'T4',\r\n      thumbnailCustomTool5:         'T5',\r\n      thumbnailCustomTool6:         'T6',\r\n      thumbnailCustomTool7:         'T7',\r\n      thumbnailCustomTool8:         'T8',\r\n      thumbnailCustomTool9:         'T9',\r\n      thumbnailCustomTool10:        'T10',\r\n      thumbnailAlbumUp:             '<i style=\"font-size: 3em;\" class=\"nGY2Icon-ngy2_chevron_up2\"></i>',\r\n      paginationNext:               '<i class=\"nGY2Icon-right-open\"></i>',\r\n      paginationPrevious:           '<i class=\"nGY2Icon-left-open\"></i>',\n      galleryMoreButton:            '<i class=\"nGY2Icon-picture\"></i> &nbsp; <i class=\"nGY2Icon-right-open\"></i>',\r\n      buttonClose:                  '<i class=\"nGY2Icon-ngy2_close2\"></i>',\r\n      viewerPrevious:               '<i class=\"nGY2Icon-ngy2_chevron-left\"></i>',\r\n      viewerNext:                   '<i class=\"nGY2Icon-ngy2_chevron-right\"></i>',\r\n      viewerImgPrevious:            '<i class=\"nGY2Icon-ngy2_chevron_left3\"></i>',\r\n      viewerImgNext:                '<i class=\"nGY2Icon-ngy2_chevron_right3\"></i>',\r\n      viewerDownload:               '<i class=\"nGY2Icon-ngy2_download2\"></i>',\r\n      viewerToolbarMin:             '<i class=\"nGY2Icon-ellipsis-vert\"></i>',\r\n      viewerToolbarStd:             '<i class=\"nGY2Icon-menu\"></i>',\r\n      viewerPlay:                   '<i class=\"nGY2Icon-play\"></i>',\r\n      viewerPause:                  '<i class=\"nGY2Icon-pause\"></i>',\r\n      viewerFullscreenOn:           '<i class=\"nGY2Icon-resize-full\"></i>',\r\n      viewerFullscreenOff:          '<i class=\"nGY2Icon-resize-small\"></i>',\r\n      viewerZoomIn:                 '<i class=\"nGY2Icon-ngy2_zoom_in2\"></i>',\r\n      viewerZoomOut:                '<i class=\"nGY2Icon-ngy2_zoom_out2\"></i>',\r\n      viewerLinkOriginal:           '<i class=\"nGY2Icon-ngy2_external2\"></i>',\r\n      viewerInfo:                   '<i class=\"nGY2Icon-ngy2_info2\"></i>',\r\n      viewerShare:                  '<i class=\"nGY2Icon-ngy2_share2\"></i>',\n      viewerRotateLeft:             '<i class=\"nGY2Icon-ccw\"></i>',\n      viewerRotateRight:            '<i class=\"nGY2Icon-cw\"></i>',\r\n      user:                         '<i class=\"nGY2Icon-user\"></i>',\r\n      location:                     '<i class=\"nGY2Icon-location\"></i>',\r\n      config:                       '<i class=\"nGY2Icon-wrench\"></i>',\r\n      shareFacebook:                '<i style=\"color:#3b5998;\" class=\"nGY2Icon-facebook-squared\"></i>',\r\n      shareTwitter:                 '<i style=\"color:#00aced;\" class=\"nGY2Icon-twitter-squared\"></i>',\r\n      // shareGooglePlus:              '<i style=\"color:#dd4b39;\" class=\"nGY2Icon-gplus-squared\"></i>',\r\n      shareTumblr:                  '<i style=\"color:#32506d;\" class=\"nGY2Icon-tumblr-squared\"></i>',\r\n      sharePinterest:               '<i style=\"color:#cb2027;\" class=\"nGY2Icon-pinterest-squared\"></i>',\r\n      shareVK:                      '<i style=\"color:#3b5998;\" class=\"nGY2Icon-vkontakte\"></i>',\r\n      shareMail:                    '<i style=\"color:#555;\" class=\"nGY2Icon-mail-alt\"></i>',\r\n      viewerCustomTool1:            'T1',\r\n      viewerCustomTool2:            'T2',\r\n      viewerCustomTool3:            'T3',\r\n      viewerCustomTool4:            'T4',\r\n      viewerCustomTool5:            'T5',\r\n      viewerCustomTool6:            'T6',\r\n      viewerCustomTool7:            'T7',\r\n      viewerCustomTool8:            'T8',\r\n      viewerCustomTool9:            'T9',\r\n      viewerCustomTool10:           'T10'\r\n    }\r\n  };\r\n\r\n  jQuery.fn.nanogallery2 = function (args, option, value) {\r\n    \r\n    if( typeof jQuery(this).data('nanogallery2data') === 'undefined'){\r\n      if( args == 'destroy' ) {\r\n        // command to destroy but no instance yet --> exit\r\n        return;\r\n      }\r\n      \r\n      return this.each( function(){\r\n        (new jQuery.nanogallery2(this, args));\r\n      });\r\n    }\r\n    else {\r\n      // no options -->\r\n      // This function breaks the chain, but provides some API methods\r\n\r\n      var nG2=$(this).data('nanogallery2data').nG2;\r\n      switch(args){\r\n        case 'displayItem':\r\n          nG2.DisplayItem(option);\r\n          break;\r\n          \r\n        case 'search':\r\n          return( nG2.Search(option));\r\n          break;\r\n          \r\n        case 'search2':\r\n          return nG2.Search2(option, value);\r\n          break;\r\n          \r\n        case 'search2Execute':\r\n          return nG2.Search2Execute();\r\n          break;\r\n          \r\n        case 'refresh':\r\n          nG2.Refresh();\r\n          break;\r\n\r\n        case 'resize':\r\n          nG2.Resize();\r\n          break;\r\n          \r\n        case 'instance':\r\n          return nG2;\r\n          break;\r\n          \r\n        case 'data':\r\n          nG2.data= {\r\n            items: nG2.I,\r\n            gallery: nG2.GOM,\r\n            lightbox: nG2.VOM\r\n          };\r\n          return nG2.data;\r\n          break;\r\n          \r\n        case 'reload':\r\n          nG2.ReloadAlbum();\r\n          return $(this);\r\n          break;\r\n          \r\n        case 'itemsSelectedGet':\r\n          return nG2.ItemsSelectedGet();\r\n          break;\r\n          \r\n        case 'itemsSetSelectedValue':\r\n          nG2.ItemsSetSelectedValue(option, value);\r\n          break;\r\n          \r\n        case 'option':\r\n          if(typeof value === 'undefined'){\r\n            return nG2.Get(option);\r\n          }else{\r\n            nG2.Set(option,value);\r\n            if( option == 'demoViewportWidth' ) {\r\n              // force resize event -> for demo purposes\r\n              $(window).trigger('resize');\r\n            }\r\n          }\r\n          break;\r\n          \r\n        case 'destroy':\r\n          nG2.Destroy();\r\n          $(this).removeData('nanogallery2data');\r\n          break;\r\n          \r\n        case 'shoppingCartGet':\r\n          return nG2.shoppingCart;\r\n          break;\r\n          \r\n        case 'shoppingCartUpdate':\r\n          if( typeof value === 'undefined' || typeof option === 'undefined' ){\r\n            return false;\r\n          }\r\n          var ID = option;\r\n          var cnt = value;\r\n          for( var i = 0; i < nG2.shoppingCart.length; i++) {\r\n            if( nG2.shoppingCart[i].ID = ID ) {\r\n              nG2.shoppingCart[i].cnt = cnt;\r\n            }\r\n          }\r\n          var fu = G.O.fnShoppingCartUpdated;\r\n          if( fu !== null ) {\r\n            typeof  fu == 'function' ? fu(nG2.shoppingCart, NGY2Item.Get(G, ID)) : window[fu](nG2.shoppingCart, NGY2Item.Get(G, ID));\r\n          }\r\n          return nG2.shoppingCart;\r\n          break;\r\n          \r\n        case 'shoppingCartRemove':\r\n          if( typeof option === 'undefined' ){\r\n            return false;\r\n          }\r\n          var ID=option;\r\n          for( var i=0; i<nG2.shoppingCart.length; i++) {\r\n            if( nG2.shoppingCart[i].ID=ID ) {\r\n              nG2.shoppingCart.splice(i,1);\r\n              break;\r\n            }\r\n          }\r\n          var fu = G.O.fnShoppingCartUpdated;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(nG2.shoppingCart, NGY2Item.Get(G, ID)) : window[fu](nG2.shoppingCart, NGY2Item.Get(G, ID));\r\n          }\r\n          return nG2.shoppingCart;\r\n          break;\r\n         \r\n        case 'closeViewer':\r\n          nG2.CloseViewer();\r\n          break;\r\n        case 'minimizeToolbar':\r\n          nG2.MinimizeToolbar();\r\n          break;\r\n        case 'maximizeToolbar':\r\n          nG2.MaximizeToolbar();\r\n          break;\r\n        case 'paginationPreviousPage':\r\n          nG2.PaginationPreviousPage();\r\n          break;\r\n        case 'paginationNextPage':\r\n          nG2.paginationNextPage();\r\n          break;\r\n        case 'paginationGotoPage':\r\n          nG2.PaginationGotoPage( option );\r\n          break;\r\n        case 'paginationCountPages':\r\n          nG2.PaginationCountPages();\r\n          break;\r\n         \r\n      }\r\n      return $(this);\r\n\r\n    }\r\n  };\r\n  \r\n\r\n  // ###############################\r\n  // ##### nanogallery2 script #####\r\n  // ###############################\r\n\r\n  /** @function nanoGALLERY2 */\r\n  function nanoGALLERY2() {\r\n    \"use strict\";\r\n\r\n    /**\r\n    * Force reload the current album, if provided by Json\r\n    */\r\n    this.ReloadAlbum = function(){\r\n      if( G.O.kind === '' ) {\r\n        throw 'Not supported for this content source:' + G.O.kind;\r\n      }\r\n\r\n      var albumIdx = G.GOM.albumIdx;\r\n      if( albumIdx == -1 ) {\r\n        throw ('Current album not found.');\r\n      }\r\n      \r\n      var albumID = G.I[albumIdx].GetID();\r\n\r\n      // unselect everything & remove link to album (=logical delete)\r\n      var l = G.I.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        var item = G.I[i];\r\n        if( item.albumID == albumID ) {\r\n          item.selected = false;\r\n        }\r\n      }\r\n      \r\n      G.I[albumIdx].contentIsLoaded = false;\r\n      \r\n      DisplayAlbum('-1', albumID);\r\n    };\r\n    \r\n    /**\r\n     * Set one or several items selected/unselected\r\n     * @param {array} items\r\n     */\r\n    this.ItemsSetSelectedValue = function(items, value){\r\n      var l = items.length;\r\n      for( var j = 0; j < l ; j++) {\r\n        ThumbnailSelectionSet(items[j], value);\r\n      }\r\n    };\r\n    \r\n    /**\r\n     * Returns an array of selected items\r\n     * @returns {Array}\r\n     */\r\n    this.ItemsSelectedGet = function(){\r\n      var selectedItems = [];\r\n      var l = G.I.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        if( G.I[i].selected == true ) {\r\n          selectedItems.push(G.I[i]);\r\n        }\r\n      }\r\n      return selectedItems;\r\n    };    \r\n    \r\n    /**\r\n     * Returns the value of an option\r\n     * @param {string} option\r\n     * @returns {nanoGALLERY.G.O}\r\n     */\r\n    this.Get = function(option){\r\n        return G.O[option];\r\n    };\r\n\r\n    /**\r\n     * Set a new value for a defined option\r\n     * @param {string} option\r\n     */\r\n    this.Set = function(option, value){\r\n        G.O[option] = value;\r\n        switch( option ) {\r\n          case 'thumbnailSelectable':\r\n            ThumbnailSelectionClear();\r\n            // refresh the displayed gallery\r\n            GalleryRender( G.GOM.albumIdx );\r\n            break;\r\n        }\r\n    };\r\n    \r\n    /**\r\n     * refresh the current gallery\r\n     */\r\n    this.Refresh = function() {\r\n      // refresh the displayed gallery\r\n      GalleryRender( G.GOM.albumIdx );\r\n    };\r\n    /**\r\n     * resize the current gallery\r\n     */\r\n    this.Resize = function() {\r\n      // resize the displayed gallery\r\n      GalleryResize();\r\n    };\r\n\r\n    /**\r\n     * display one item (image or gallery)\r\n     *   itemID syntax:\r\n     *    - albumID --> display one album\r\n     *    - albumID/imageID --> display one image\r\n    */\r\n    this.DisplayItem = function( itemID ) {\r\n      var IDs=parseIDs( itemID );\r\n      if( IDs.imageID != '0' ) {\r\n        DisplayPhoto( IDs.imageID, IDs.albumID );\r\n      }\r\n      else {\r\n        DisplayAlbum( '-1', IDs.albumID );\r\n      }\r\n    };\r\n    \r\n      \r\n      \r\n    var CountItemsToDisplay = function( gIdx ) {\r\n      if( G.I[gIdx] == undefined ) { return 0; }\r\n      var albumID = G.I[gIdx].GetID();\r\n      var l = G.I.length;\r\n      var cnt = 0;\r\n      for( var idx = 0; idx < l; idx++ ) {\r\n        var item = G.I[idx];\r\n        if( item.isToDisplay(albumID) ) {\r\n          cnt++;\r\n        }\r\n      }\r\n      return cnt;\r\n    } \r\n    /**\r\n     * Search in the displayed gallery (in thumbnails title)\r\n     */\r\n    this.Search = function( search ) {\r\n      G.GOM.albumSearch = search.toUpperCase();\r\n      var gIdx = G.GOM.albumIdx;\r\n      GalleryRender( G.GOM.albumIdx );\r\n      return CountItemsToDisplay( gIdx );\r\n    };\r\n\r\n    /**\r\n     * Search2 in title and tags - set search values\r\n     */\r\n    this.Search2 = function( searchTitle, searchTags ) {\r\n      if( searchTitle != null && searchTitle != undefined ) {\r\n        G.GOM.albumSearch = searchTitle.toUpperCase();\r\n      }\r\n      else {\r\n        G.GOM.albumSearch = '';\r\n      }\r\n      \r\n      if( searchTags != null && searchTags != undefined ) {\r\n        G.GOM.albumSearchTags = searchTags.toUpperCase();\r\n      }\r\n      else {\r\n        G.GOM.albumSearchTags = '';\r\n      }\r\n      return CountItemsToDisplay( G.GOM.albumIdx );\r\n    };\r\n    \r\n    /**\r\n     * Search2 - execute the search on title and tags\r\n     */\r\n    this.Search2Execute = function() {\r\n      var gIdx = G.GOM.albumIdx;\r\n      GalleryRender( G.GOM.albumIdx );\r\n      return CountItemsToDisplay( gIdx );\r\n    };\r\n    \r\n    \r\n    /**\r\n     * Destroy the current gallery\r\n     */\r\n    this.Destroy = function(){\r\n      // alert('destroy');\r\n      // var event = new Event('build');\r\n      if( G.GOM.hammertime != null ) {\r\n        G.GOM.hammertime.destroy();\r\n        G.GOM.hammertime = null;\r\n      }\r\n      // G.GOM.userEvents.RemoveEvtListener();\r\n      // G.GOM.userEvents=null;\r\n      // G.VOM.userEvents.RemoveEvtListener();\r\n      // G.VOM.userEvents=null;\r\n      if( G.VOM.hammertime != null ) {\r\n        G.VOM.hammertime.destroy();\r\n        G.VOM.hammertime = null;\r\n      }\r\n      //ThumbnailHoverReInitAll();  \r\n      \r\n      // color scheme\r\n      $('#ngycs_' + G.baseEltID).remove()\r\n      \r\n      G.GOM.items = [];\r\n      NGY2Item.New( G, G.i18nTranslations.breadcrumbHome, '', '0', '-1', 'album' );\r\n      G.GOM.navigationBar.$newContent = null;\r\n      G.$E.base.empty();\r\n      G.$E.base.removeData();\r\n      if( G.O.locationHash ) {\r\n        jQuery(window).off('hashchange.nanogallery2.' + G.baseEltID);\r\n      }\r\n      jQuery(window).off('resize.nanogallery2.' + G.baseEltID);\r\n      jQuery(window).off('orientationChange.nanogallery2.' + G.baseEltID);\r\n      jQuery(window).off('scroll.nanogallery2.' + G.baseEltID);\r\n      G.GOM.firstDisplay = false;\n    };\r\n    \r\n    /**\r\n     * CloseViewer - close the media viewer\r\n     */\r\n    this.CloseViewer = function() {\r\n      CloseInternalViewer(null);\r\n      return false;\r\n    };\r\n    \r\n    /**\r\n     * MinimizeToolbar - display the minimized lightbox main toolbar\r\n     */\r\n    this.MinimizeToolbar = function() {\r\n      ViewerToolbarForVisibilityMin();\r\n      return false;\r\n    };\r\n    \r\n    /**\r\n     * MaximizeToolbar - display the maximized/standard lightbox main toolbar\r\n     */\r\n    this.MaximizeToolbar = function() {\r\n      ViewerToolbarForVisibilityStd();\r\n      return false;\r\n    };\r\n    \r\n    /**\r\n     * PaginationPreviousPage - gallery paginate to previous page\r\n     */\r\n    this.PaginationPreviousPage = function() {\r\n      paginationPreviousPage();\r\n      return false;\r\n    };\r\n    \r\n    \r\n    /**\r\n     * PaginationNextPage - gallery paginate to next page\r\n     */\r\n    this.PaginationNextPage = function() {\r\n      paginationNextPage();\r\n      return false;\r\n    };\r\n    \r\n    \r\n    /**\r\n     * PaginationGotoPage - gallery paginate to specific page\r\n     */\r\n    this.PaginationGotoPage = function( page ) {\r\n      var aIdx = G.$E.conPagin.data('galleryIdx');\r\n      if( page > 1 ) { page--; }\r\n      G.GOM.pagination.currentPage = page;\r\n\r\n      // scroll to top of gallery if not displayed\r\n      if( !inViewportVert(G.$E.base, 0) ) {\r\n        $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n      }\r\n      GalleryDisplayPart1( true );\r\n      GalleryDisplayPart2( true );\r\n      return false;\r\n    };\r\n\r\n    /**\r\n     * PaginationCountPages - gallery pagination - returns the number of pages\r\n     */\r\n    this.PaginationCountPages = function() {\r\n      if( G.GOM.items.length == 0 ) { return 0; }   // no thumbnail to display\r\n\r\n      var nbPages = Math.ceil((G.GOM.items[G.GOM.items.length - 1].row + 1) / G.galleryMaxRows.Get());\r\n      return nbPages;\r\n    };\r\n    \r\n    \r\n    \r\n    \r\n    // throttle()\r\n    // author: underscore.js - http://underscorejs.org/docs/underscore.html\r\n    // Returns a function, that, when invoked, will only be triggered at most once during a given window of time.\r\n    // Normally, the throttled function will run as much as it can, without ever going more than once per wait duration;\r\n    // but if you�d like to disable the execution on the leading edge, pass {leading: false}.\r\n    // To disable execution on the trailing edge, ditto.\r\n    var throttle = function(func, wait, options) {\r\n      var context, args, result;\r\n      var timeout = null;\r\n      var previous = 0;\r\n      if (!options) options = {};\r\n      var later = function() {\r\n        previous = options.leading === false ? 0 : new Date().getTime();\r\n        timeout = null;\r\n        result = func.apply(context, args);\r\n        if (!timeout) context = args = null;\r\n      };\r\n      return function() {\r\n        var now = new Date().getTime();\r\n        if (!previous && options.leading === false) previous = now;\r\n        var remaining = wait - (now - previous);\r\n        context = this;\r\n        args = arguments;\r\n        if (remaining <= 0 || remaining > wait) {\r\n          if (timeout) {\r\n            clearTimeout(timeout);\r\n            timeout = null;\r\n          }\r\n          previous = now;\r\n          result = func.apply(context, args);\r\n          if (!timeout) context = args = null;\r\n        } else if (!timeout && options.trailing !== false) {\r\n          timeout = setTimeout(later, remaining);\r\n        }\r\n        return result;\r\n      };\r\n    };\r\n    \r\n    \r\n    // DEBOUNCE\r\n    // author: John Hann - http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\r\n    // execAsap - false means executing at the end of the detection period\r\n    var debounce = function (func, threshold, execAsap) {\r\n      var timeout;\r\n      return function debounced () {\r\n          var obj = this, args = arguments;\r\n          function delayed () {\r\n              if (!execAsap)\r\n                  func.apply(obj, args);\r\n              timeout = null; \r\n          };\r\n   \r\n          if (timeout)\r\n              clearTimeout(timeout);\r\n              // clearRequestTimeout(timeout);\r\n          else if (execAsap)\r\n              func.apply(obj, args);\r\n          timeout = setTimeout(delayed, threshold || 100); \r\n          // timeout = requestTimeout(delayed, threshold || 100); \r\n      };\r\n    }\r\n    \r\n\r\n    // Double requestAnimationFrame\r\n    window.ng_draf = function (cb) {\r\n      return requestAnimationFrame(function() {\r\n        window.requestAnimationFrame(cb)\r\n      })\r\n    }    \r\n    \r\n    // REQUESTTIMEOUT - replace SETTIMEOUT - https://gist.github.com/joelambert/1002116\r\n    /**\r\n     * Behaves the same as setTimeout except uses requestAnimationFrame() where possible for better performance\r\n     * @param {function} fn The callback function\r\n     * @param {int} delay The delay in milliseconds\r\n     */\r\n\r\n    window.requestTimeout = function(fn, delay) {\r\n      // if( !window.requestAnimationFrame      \t&& \r\n        // !window.webkitRequestAnimationFrame && \r\n        // !(window.mozRequestAnimationFrame && window.mozCancelRequestAnimationFrame) && // Firefox 5 ships without cancel support\r\n        // !window.oRequestAnimationFrame      && \r\n        // !window.msRequestAnimationFrame)\r\n          return window.setTimeout(fn, delay);\r\n          \r\n      var start = new Date().getTime(),\r\n        handle = new Object();\r\n        \r\n      function loop(){\r\n        var current = new Date().getTime(),\r\n          delta = current - start;\r\n  delta = delay;\r\n  \r\n        delta >= delay ? fn.call() : handle.value = requestAnimFrame(loop);\r\n      };\r\n      \r\n      handle.value = requestAnimFrame(loop);\r\n      return handle;\r\n    };\r\n\r\n    \r\n    // requestAnimationFrame() shim by Paul Irish\r\n    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n    window.requestAnimFrame = (function() {\r\n      return  window.requestAnimationFrame       || \r\n          window.webkitRequestAnimationFrame || \r\n          window.mozRequestAnimationFrame    || \r\n          window.oRequestAnimationFrame      || \r\n          window.msRequestAnimationFrame     || \r\n          function(/* function */ callback, /* DOMElement */ element){\r\n            window.setTimeout(callback, 1000 / 60);\r\n          };\r\n    })();    \r\n    \r\n    \r\n    // CLEARREQUESTTIMEOUT - to replace CLEARTIMEOUT - https://gist.github.com/joelambert/1002116\r\n    /**\r\n     * Behaves the same as clearTimeout except uses cancelRequestAnimationFrame() where possible for better performance\r\n     * @param {int|object} fn The callback function\r\n     */\r\n    window.clearRequestTimeout = function(handle) {\r\n        window.cancelAnimationFrame ? window.cancelAnimationFrame(handle.value) :\r\n        window.webkitCancelAnimationFrame ? window.webkitCancelAnimationFrame(handle.value) :\r\n        window.webkitCancelRequestAnimationFrame ? window.webkitCancelRequestAnimationFrame(handle.value) : /* Support for legacy API */\r\n        window.mozCancelRequestAnimationFrame ? window.mozCancelRequestAnimationFrame(handle.value) :\r\n        window.oCancelRequestAnimationFrame\t? window.oCancelRequestAnimationFrame(handle.value) :\r\n        window.msCancelRequestAnimationFrame ? window.msCancelRequestAnimationFrame(handle.value) :\r\n        clearTimeout(handle);\r\n    };    \r\n    \r\n    \r\n    \r\n    /*\r\n    ** Global data for this nanogallery2 instance\r\n    **/\r\n    var G=this;\r\n    G.I =                       [];           // gallery items\r\n    G.Id =                      [];           // gallery items\r\n    G.O =                       null;         // user options\r\n    G.baseEltID =               null;         // ID of the base element\r\n    G.$E = { \r\n      base:                     null,         // base element\r\n      conTnParent:              null,         // $g_containerThumbnailsParent\r\n      conLoadingB:              null,         // loading bar - nanoGalleryLBarOff\r\n      conConsole:               null,         // console for error messages\r\n      conNavigationBar:         null,         // gallery navigation bar\r\n      conTnBottom:              null         // container on the bottom of the gallery\r\n    };\r\n    G.shoppingCart =            [];\r\n    G.layout = {                              // Layout informations\r\n      internal :                true,\r\n      engine :                  '',\r\n      support :                 { rows: false },\r\n      prerequisite :            { imageSize: false },\r\n      SetEngine: function() {\r\n\r\n      if( G.layout.internal ) {\r\n          if( G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth] == 'auto' || G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth] == '' ) {\r\n            // do not use getH() / getW() here!\r\n            G.layout.engine = 'JUSTIFIED';\r\n            G.layout.support.rows = true;\r\n            G.layout.prerequisite.imageSize = true;\r\n            return;\r\n          }\r\n          if( G.tn.settings.height[G.GOM.curNavLevel][G.GOM.curWidth] == 'auto' || G.tn.settings.height[G.GOM.curNavLevel][G.GOM.curWidth] == '' ) {\r\n            // do not use getH() / getW() here!\r\n            G.layout.engine = 'CASCADING';\r\n            G.layout.support.rows = false;\r\n            G.layout.prerequisite.imageSize = true;\r\n            return;\r\n          }\r\n\r\n          if( G.tn.settings.getMosaic() != null ) {\r\n            G.layout.engine = 'MOSAIC';\r\n            G.layout.support.rows = true;\r\n            G.layout.prerequisite.imageSize = false;\r\n            return;\r\n          }\r\n          \r\n          G.layout.engine='GRID';\r\n          G.layout.support.rows=true;\r\n          // if( G.tn.opt.Get('crop') === true ) {\r\n            // G.layout.prerequisite.imageSize = true;\r\n          // }\r\n          // else {\r\n            G.layout.prerequisite.imageSize = false;\r\n          // }\r\n        }\r\n      }\r\n    };\r\n    G.galleryResizeEventEnabled = false;\r\n    G.galleryMaxRows = { l1: 0, lN: 0,\r\n      Get: function() {\r\n        return G.galleryMaxRows[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryMaxItems = { l1: 0, lN: 0,\r\n      Get: function() {\r\n        return G.galleryMaxItems[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryFilterTags = { l1: 0, lN: 0,\r\n      Get: function() {\r\n        return G.galleryFilterTags[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryDisplayMode = { l1: 'FULLCONTENT', lN: 'FULLCONTENT',\r\n      Get: function() {\r\n        return G.galleryDisplayMode[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryLastRowFull = { l1: false, lN: false,\r\n      Get: function() {\r\n        return G.galleryLastRowFull[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.gallerySorting = { l1: '', lN: '',\r\n      Get: function() {\r\n        return G.gallerySorting[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryDisplayTransition = { l1: 'none', lN: 'none',\r\n      Get: function() {\r\n        return G.galleryDisplayTransition[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryDisplayTransitionDuration = { l1: 500, lN: 500,\r\n      Get: function() {\r\n        return G.galleryDisplayTransitionDuration[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.$currentTouchedThumbnail = null;    \r\n    \r\n    // ##### GENERAL THUMBNAILS PROPERTIES -->\r\n    G.tn = {\r\n      // levell specific options\r\n      opt:  {\r\n        l1: { crop: true, stacks: 0, stacksTranslateX: 0, stacksTranslateY: 0, stacksTranslateZ: 0, stacksRotateX: 0, stacksRotateY: 0, stacksRotateZ: 0, stacksScale: 0, gutterHeight: 0, gutterWidth: 0, baseGridHeight: 0, displayTransition: 'FADEIN', displayTransitionStartVal: 0, displayTransitionEasing: 'easeOutQuart', displayTransitionDuration: 240, displayInterval: 15 },\r\n        lN: { crop: true, stacks: 0, stacksTranslateX: 0, stacksTranslateY: 0, stacksTranslateZ: 0, stacksRotateX: 0, stacksRotateY: 0, stacksRotateZ: 0, stacksScale: 0, gutterHeight: 0, gutterWidth: 0, baseGridHeight: 0, displayTransition: 'FADEIN', displayTransitionStartVal: 0, displayTransitionEasing: 'easeOutQuart', displayTransitionDuration: 240, displayInterval: 15 },\r\n        Get: function(opt) {\r\n          return G.tn.opt[G.GOM.curNavLevel][opt];\r\n        }\r\n      },\r\n      scale:                          1,         // image scale depending of the hover effect\r\n      borderWidth:                    0,         // thumbnail container border width\r\n      borderHeight:                   0,         // thumbnail container border height\r\n      labelHeight: {                  // in case label on bottom, otherwise always=0\r\n        l1: 0, lN: 0,\r\n        get: function() {\r\n          return G.tn.labelHeight[G.GOM.curNavLevel];\r\n        }\r\n      },\r\n      defaultSize: {                  // default thumbnail size\r\n                                      // label height is not included\r\n        width: {  l1 : { xs:0, sm:0, me:0, la:0, xl:0 }, lN : { xs:0, sm:0, me:0, la:0, xl:0 } },\r\n        height: { l1 : { xs:0, sm:0, me:0, la:0, xl:0 }, lN : { xs:0, sm:0, me:0, la:0, xl:0 } },\r\n        getWidth: function() {\r\n          return G.tn.defaultSize.width[G.GOM.curNavLevel][G.GOM.curWidth];\r\n        },\r\n        getOuterWidth: function() {     // width border included\r\n          return G.tn.defaultSize.width[G.GOM.curNavLevel][G.GOM.curWidth]+G.tn.borderWidth*2;\r\n        },\r\n        getHeight: function() {\r\n          return G.tn.defaultSize.height[G.GOM.curNavLevel][G.GOM.curWidth];\r\n        },\r\n        getOuterHeight: function() {     // height, border included\r\n          return G.tn.defaultSize.height[G.GOM.curNavLevel][G.GOM.curWidth]+G.tn.borderHeight*2;\r\n        }\r\n      },\r\n      settings: {                     // user defined width/height of the image to display depending on the screen size\r\n        width: {  l1 : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' },\r\n                  lN : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' } },\r\n        height: { l1 : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' }, \r\n                  lN : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' } },\r\n        getH: function(l, w) {\r\n          var cl = (l == undefined ? G.GOM.curNavLevel : l);\r\n          var cw = (w == undefined ? G.GOM.curWidth : w);\r\n          if( G.layout.engine == 'MOSAIC' ) {\r\n          return G.tn.settings.height[cl][cw] * G.tn.settings.mosaic[cl+'Factor']['h'][cw];\r\n          }\r\n          else {\r\n            return G.tn.settings.height[cl][cw];\r\n          }\r\n        },\r\n        getW: function(l, w) {\r\n          var cl = (l == undefined ? G.GOM.curNavLevel : l);\r\n          var cw = (w == undefined ? G.GOM.curWidth : w);\r\n          if( G.layout.engine == 'MOSAIC' ) {\r\n            return G.tn.settings.width[cl][cw] * G.tn.settings.mosaic[cl+'Factor']['w'][cw];\r\n          }\r\n          else {\r\n            return G.tn.settings.width[cl][cw];\r\n            // return G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth];\r\n          }\r\n        },\r\n        mosaic: { l1 : { xs: null, sm: null, me: null, la: null, xl: null },\r\n                  lN : { xs: null, sm: null, me: null, la: null, xl: null },\r\n                  l1Factor : { h :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }, w :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }},\r\n                  lNFactor : { h :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }, w :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }}\r\n                  },\r\n        getMosaic: function() {\r\n          return G.tn.settings.mosaic[G.GOM.curNavLevel][G.GOM.curWidth];\r\n        },\r\n        mosaicCalcFactor: function(l, w) {\r\n            // retrieve max size multiplicator\r\n            var maxW = 1;\r\n            var maxH = 1;\r\n            for( var n = 0; n < G.tn.settings.mosaic[l][w].length; n++ ) {\r\n              maxW = Math.max(maxW, G.tn.settings.mosaic[l][w][n]['w']);\r\n              maxH = Math.max(maxH, G.tn.settings.mosaic[l][w][n]['h']);\r\n            }\r\n            G.tn.settings.mosaic[l + 'Factor']['h'][w] = maxH;\r\n            G.tn.settings.mosaic[l + 'Factor']['w'][w] = maxW;\r\n        }\r\n      },\r\n      // thumbnail hover effects\r\n      hoverEffects : {\r\n        std :   [],\r\n        level1: [],\r\n        get: function() {\r\n          if( G.GOM.curNavLevel == 'l1' && G.tn.hoverEffects.level1.length !== 0 ) {\r\n            return G.tn.hoverEffects.level1;\r\n          }\r\n          else {\r\n            return G.tn.hoverEffects.std;\r\n          }\r\n        }\r\n      },\r\n      // thumbnail init\r\n      buildInit : {\r\n        std :   [],\r\n        level1: [],\r\n        get: function() {\r\n          if( G.GOM.curNavLevel == 'l1' && G.tn.buildInit.level1.length !== 0 ) {\r\n            return G.tn.buildInit.level1;\r\n          }\r\n          else {\r\n            return G.tn.buildInit.std;\r\n          }\r\n        }\r\n      },\r\n      // thumbnail toolbars\r\n      toolbar: {\r\n        album :   { topLeft : '', topRight: '', bottomLeft: '', bottomRight: '' },\r\n        image :   { topLeft : '', topRight: '', bottomLeft: '', bottomRight: '' },\r\n        albumUp : { topLeft : '', topRight: '', bottomLeft: '', bottomRight: '' },\r\n        get: function( item ) {\r\n          return G.tn.toolbar[item.kind];\r\n        },\r\n      },\r\n      style: {\r\n        // inline CSS\r\n        l1 : { label: '', title: '', desc: '' },\r\n        lN : { label: '', title: '', desc: '' },\r\n        getTitle : function() {\r\n          return ('style=\"' + G.tn.style[G.GOM.curNavLevel].title + '\"');\r\n        },\r\n        getDesc : function() {\r\n          return ('style=\"' + G.tn.style[G.GOM.curNavLevel].desc + '\"');\r\n        },\r\n        getLabel: function() {\r\n          var s='style=\"'+ G.tn.style[G.GOM.curNavLevel].label;\r\n          s+= (G.O.RTL ? '\"direction:RTL;\"' :'');\r\n          s+='\"';\r\n          return s;\r\n        }\r\n      }\r\n    };\r\n    G.scrollTimeOut =             0;\r\n    G.i18nTranslations =          {'paginationPrevious':'Previous', 'paginationNext':'Next', 'breadcrumbHome':'List of Albums', 'thumbnailImageTitle':'', 'thumbnailAlbumTitle':'', 'thumbnailImageDescription':'', 'thumbnailAlbumDescription':'' };\r\n    G.emptyGif =                  'data:image/gif;base64,R0lGODlhEAAQAIAAAP///////yH5BAEKAAEALAAAAAAQABAAAAIOjI+py+0Po5y02ouzPgUAOw==';\r\n    G.CSStransformName =          FirstSupportedPropertyName([\"transform\", \"msTransform\", \"MozTransform\", \"WebkitTransform\", \"OTransform\"]);\r\n    // G.CSSfilterName =          FirstSupportedPropertyName([\"filter\", \"WebkitFilter\"]);\r\n    G.CSStransformStyle =         FirstSupportedPropertyName([\"transformStyle\", \"msTransformStyle\", \"MozTransformStyle\", \"WebkitTransformStyle\", \"OTransformStyle\"]);\r\n    G.CSSperspective =            FirstSupportedPropertyName([\"perspective\", \"msPerspective\", \"MozPerspective\", \"WebkitPerspective\", \"OPerspective\"]);\r\n    G.CSSbackfaceVisibilityName = FirstSupportedPropertyName([\"backfaceVisibility\", \"msBackfaceVisibility\", \"MozBackfaceVisibility\", \"WebkitBackfaceVisibility\", \"OBackfaceVisibility\"]);\r\n    G.CSStransitionName =         FirstSupportedPropertyName([\"transition\", \"msTransition\", \"MozTransition\", \"WebkitTransition\", \"OTransition\"]);\r\n    G.CSSanimationName =          FirstSupportedPropertyName([\"animation\", \"msAnimation\", \"MozAnimation\", \"WebkitAnimation\", \"OAnimation\"]);\r\n    G.GalleryResizeThrottled =    throttle(GalleryResize, 30, {leading: false});\r\n    \r\n    G.blackList =                 null;     // album white list\r\n    G.whiteList =                 null;     // album black list\r\n    G.albumList =                 [];       // album list\r\n    G.locationHashLastUsed =      '';\r\n    G.custGlobals =               {};\r\n    G.touchAutoOpenDelayTimerID = 0;\r\n    G.i18nLang =                  '';\r\n    G.timeLastTouchStart =        0;\r\n    G.custGlobals =               {};\r\n    G.markupOrApiProcessed =      false;\r\n    \r\n    //------------------------\r\n    //--- Gallery Object Model\r\n    G.GOM = {\r\n      albumIdx :                  -1, // index (in G.I) of the currently displayed album\r\n      clipArea :                  { top: 0, height: 0 }, // area of the GOM to display on screen\r\n      displayArea :               { width: 0 , height: 0 }, // size of the GOM area (=used area, not available area)\r\n      displayAreaLast :           { width: 0 , height: 0 }, // previous size of the GOM area\r\n      displayedMoreSteps :        0,  // current number of displayed steps (moreButton mode)\r\n      items:                      [], // current items of the GOMS\r\n      $imgPreloader:              [],\r\n      thumbnails2Display:         [],\r\n      itemsDisplayed :            0, // number of currently displayed thumbnails\r\n      firstDisplay :              true,\r\n      firstDisplayTime :          0,      // in conjunction with galleryRenderDelay\r\n      navigationBar : {           // content of the navigation bar (for breadcrumb and filter tags)\r\n        displayed:                false,\n        $newContent:              ''\r\n      },\r\n      cache : {                   // cached data\r\n        viewport:                 null,\n        containerOffset:          null,\r\n        areaWidth:                100         // available area width\r\n      },\r\n      nbSelected :                0,        // number of selected items\r\n      pagination :                { currentPage: 0 }, // pagination data\r\n      panThreshold:               60,       // threshold value (in pixels) to block horizontal pan/swipe\n      panYOnly:                   false,    // threshold value reach -> definitively block horizontal pan until end of pan\n      lastFullRow :               -1,       // number of the last row without holes\r\n      lastDisplayedIdx:           -1,       // used to display the counter of not displayed items\r\n      displayInterval :           { from: 0, len: 0 },\r\n      userEvents:                 null,\r\n      hammertime:                 null,\r\n      curNavLevel:                'l1',   // current navigation level (l1 or LN)\r\n      curWidth:                   'me',\r\n      albumSearch:                '',     // current search string -> title (used to filter the thumbnails on screen)\r\n      albumSearchTags:            '',     // current search string -> tags\r\n      lastZIndex:                 0,      // used to put a thumbnail on top of all others (for exemple for scale hover effect)\r\n      lastRandomValue:            0,\r\n      slider : {                          // slider on last thumbnail\r\n        hostIdx:                  -1,       // idx of the thumbnail hosting the slider\r\n        hostItem:                 null,     // item hosting the slider\r\n        currentIdx:               0,        // idx of the current displayed item\r\n        nextIdx:                  0,        // idx of the next item to display in the slider\r\n        timerID:                  0,\r\n        tween:                    null      // tranistion tween instance\r\n      },\r\n      NGY2Item: function( idx ) {   // returns a NGY2Item or null if it does not exist\r\n        if( G.GOM.items[idx] == undefined || G.GOM.items[idx] == null ) { return null; }\r\n        var i = G.GOM.items[idx].thumbnailIdx;\r\n        return G.I[i];\r\n      },\r\n      // One GOM item (thumbnail)\r\n      // function GTn(index, width, height) {\r\n      GTn: function(index, width, height) {\r\n        this.thumbnailIdx = index;\r\n        this.width =                0;      // thumbnail width\r\n        this.height =               0;      // thumbnail height\r\n        this.top =                  0;      // position: top\r\n        this.left =                 0;      // position: left\r\n        this.row =                  0;      // position: row number\r\n        this.imageWidth =           width;  // image width\r\n        this.imageHeight =          height; // image height\r\n        this.resizedContentWidth =  0;\r\n        this.resizedContentHeight = 0;\r\n        this.displayed =            false;\r\n        this.neverDisplayed =       true;\r\n        this.inDisplayArea =        false;\r\n      }\r\n    };\r\n    \r\n    \r\n    //------------------------\r\n    //--- Viewer Object Model\r\n    \r\n    G.VOM = {\r\n      viewerDisplayed:            false,  // is the viewer currently displayed\r\n      viewerIsFullscreen:         false,  // viewer in fullscreen mode\r\n      infoDisplayed:              false,  // is the info box displayed\r\n      toolbarsDisplayed:          true,   // the toolbars are displayed\r\n      toolsHide:                  null,\r\n      saveOverflowX:              'visible',    // store the value to restore it back after viewer is closed\r\n      saveOverflowY:              'visible',\r\n      zoom : {\r\n        posX:                     0,      // position to center zoom in/out\r\n        posY:                     0,\r\n        userFactor:               1,      // user zoom factor (applied to the baseZoom factor)\r\n        isZooming:                false\r\n      },\n      padding:                    { H: 0, V: 0 }, // padding for the image\r\n      window:                     { lastWidth: 0, lastHeight: 0 },\r\n      $cont:                      null,   // viewer container\r\n      $viewer:                    null,\r\n      $toolbar:                   null,   // viewerToolbar\r\n      $toolbarTL:                 null,   // viewer toolbar on top left\r\n      $toolbarTR:                 null,   // viewer toolbar on top right\r\n      $content:                   null,   // viewer content\r\n      \r\n      $mediaPrevious:             null,   // previous image\r\n      $mediaCurrent:              null,   // current image\r\n      $mediaNext:                 null,   // next image\r\n      toolbarMode:                'std',  // current toolbar mode (standard, minimized)\r\n      playSlideshow :             false,  // slide show mode status\r\n      playSlideshowTimerID:       0,      // slideshow mode time\r\n      slideshowDelay:             3000,   // slideshow mode - delay before next image\r\n      albumID:                    -1,\r\n      currItemIdx:                -1,\r\n      viewerMediaIsChanged:       false,  // media display is currently modified\r\n      items:                      [],     // current list of images to be managed by the viewer\r\n      NGY2Item: function( n ) {   // returns a NGY2Item\r\n        switch( n ) {\r\n          case -1:   // previous\r\n            var idx=this.IdxPrevious();\r\n            return G.I[this.items[idx].ngy2ItemIdx];\r\n            break;\r\n          case 1:   // next\r\n            var idx=this.IdxNext();\r\n            return G.I[this.items[idx].ngy2ItemIdx];\r\n            break;\r\n          case 0:   // current\r\n          default:\r\n            return G.I[this.items[G.VOM.currItemIdx].ngy2ItemIdx];\r\n            break;\r\n        }\r\n      },\r\n      IdxNext: function() {\r\n        var n = 0;\r\n        if( G.VOM.currItemIdx != (G.VOM.items.length-1) ) {\r\n          n = G.VOM.currItemIdx + 1;\r\n        }\r\n        return n;\r\n      },\r\n      IdxPrevious: function() {\r\n        var n = G.VOM.currItemIdx - 1;\r\n        if( G.VOM.currItemIdx == 0 ) {\r\n          n = G.VOM.items.length - 1;\r\n        }\r\n        return n;\r\n      },\r\n      userEvents:         null,   // user events management\r\n      hammertime:         null,   // hammer.js manager\r\n      swipePosX:          0,      // current horizontal swip position\r\n      panPosX:            0,      // position for manual pan\r\n      panPosY:            0,\n      panThreshold:       60,     // threshold value (in pixels) to block vertical pan\n      panXOnly:           false,  // threshold value reach -> definitively block vertical pan until end of pan\n      viewerTheme:        '',\r\n      timeImgChanged:     0,\r\n      ImageLoader: {\r\n        // fires a callback when image size is know (during download)\r\n        // inspired by ROB - http://stackoverflow.com/users/226507/rob\r\n        maxChecks:        1000,\r\n        list:             [],\r\n        intervalHandle :  null,\r\n\r\n        loadImage : function (callback, ngitem) {\r\n          if( ngitem.mediaKind != 'img' ) { return; }     // ignore - only for images\r\n          var img = new Image ();\r\n          img.src = ngitem.responsiveURL();\r\n          if (img.width && img.height) {\r\n            callback (img.width, img.height, ngitem, 0);\r\n            }\r\n          else {\r\n            var obj = {image: img, url: ngitem.responsiveURL(), ngitem: ngitem, callback: callback, checks: 1};\r\n            var i;\r\n            for (i=0; i < this.list.length; i++)    {\r\n              if (this.list[i] == null)\r\n                break;\r\n              }\r\n            this.list[i] = obj;\r\n            if (!this.intervalHandle)\r\n              this.intervalHandle = setInterval(this.interval, 50);\r\n            }\r\n          },\r\n\r\n        // called by setInterval  \r\n        interval : function () {\r\n          var count = 0;\r\n          var list = G.VOM.ImageLoader.list, item;\r\n          for (var i=0; i<list.length; i++) {\r\n            item = list[i];\r\n            if (item != null) {\r\n              if (item.image.width && item.image.height) {\r\n                G.VOM.ImageLoader.list[i] = null;\r\n                item.callback (item.image.width, item.image.height, item.ngitem, item.checks);\r\n                }\r\n              else if (item.checks > G.VOM.ImageLoader.maxChecks) {\r\n                G.VOM.ImageLoader.list[i] = null;\r\n                item.callback (0, 0, item.ngitem, item.checks);\r\n                }\r\n              else {\r\n                count++;\r\n                item.checks++;\r\n                }\r\n              }\r\n            }\r\n          if (count == 0) {\r\n            G.VOM.ImageLoader.list = [];\r\n            clearInterval (G.VOM.ImageLoader.intervalHandle);\r\n            delete G.VOM.ImageLoader.intervalHandle;\r\n            }\r\n          }\r\n        }\r\n    }\r\n    // One VOM item (image)\r\n    function VImg(index) {\r\n      this.$e = null;\r\n      this.ngy2ItemIdx = index;\r\n      this.mediaNumber = 0;     \r\n      this.posX = 0;    // to center the element\r\n      this.posY = 0;\r\n    }\r\n    \r\n    \r\n    //------------------------\r\n    //--- popup\r\n    G.popup = {\r\n      isDisplayed:      false,\r\n      $elt:             null,\r\n      close: function() {\r\n        if( this.$elt != null ) {\r\n          var tweenable = new NGTweenable();\r\n          tweenable.tween({\r\n            from:       { opacity:1  },\r\n            to:         { opacity:0 },\r\n            attachment: { t: this },\r\n            easing:     'easeInOutSine',\r\n            duration:   100,\r\n            step: function (state, att) {\r\n              if( att.t.$elt != null ) {\r\n                att.t.$elt.css('opacity',state.opacity);\r\n              }\r\n            },\r\n            finish: function (state, att) {\r\n              if( att.t.$elt != null ) {\r\n                att.t.$elt.remove();\r\n                att.t.$elt=null;\r\n              }\r\n              att.t.isDisplayed=false;\r\n            }\r\n          });\r\n        }\r\n      }\r\n    }\r\n    \r\n    \r\n    // Color schemes - Gallery\r\n    // gadrient generator: https://www.grabient.com/\r\n    G.galleryTheme_dark = {\r\n      navigationBar :         { background: 'none', borderTop: '', borderBottom: '', borderRight: '', borderLeft: '' },\r\n      navigationBreadcrumb :  { background: '#111', color: '#fff', colorHover: '#ccc', borderRadius: '4px' },\r\n      navigationFilter :      { color: '#ddd', background: '#111', colorSelected: '#fff', backgroundSelected: '#111', borderRadius: '4px' },\r\n      thumbnail :             { background: '#444', backgroundImage: 'linear-gradient(315deg, #111 0%, #445 90%)', borderColor: '#000', labelOpacity : 1, labelBackground: 'rgba(34, 34, 34, 0)', titleColor: '#fff', titleBgColor: 'transparent', titleShadow: '', descriptionColor: '#ccc', descriptionBgColor: 'transparent', descriptionShadow: '', stackBackground: '#aaa' },\r\n      thumbnailIcon :         { padding: '5px', color: '#fff' },\r\n      pagination :            { background: '#181818', backgroundSelected: '#666', color: '#fff', borderRadius: '2px', shapeBorder: '3px solid #666', shapeColor: '#444', shapeSelectedColor: '#aaa'}\r\n    };\r\n\r\n    G.galleryTheme_light = {\r\n      navigationBar :         { background: 'none', borderTop: '', borderBottom: '', borderRight: '', borderLeft: '' },\r\n      navigationBreadcrumb :  { background: '#eee', color: '#000', colorHover: '#333', borderRadius: '4px' },\r\n      navigationFilter :      { background: '#eee', color: '#222', colorSelected: '#000', backgroundSelected: '#eee', borderRadius: '4px' },\r\n      thumbnail :             { background: '#444', backgroundImage: 'linear-gradient(315deg, #111 0%, #445 90%)', borderColor: '#000', labelOpacity : 1, labelBackground: 'rgba(34, 34, 34, 0)', titleColor: '#fff', titleBgColor: 'transparent', titleShadow: '', descriptionColor: '#ccc', descriptionBgColor: 'transparent', descriptionShadow: '', stackBackground: '#888' },\r\n      thumbnailIcon :         { padding: '5px', color: '#fff' },\r\n      pagination :            { background: '#eee', backgroundSelected: '#aaa', color: '#000', borderRadius: '2px', shapeBorder: '3px solid #666', shapeColor: '#444', shapeSelectedColor: '#aaa'}\r\n    };\r\n\r\n    // Color schemes - lightbox\r\n    G.viewerTheme_dark = {\r\n      background:             '#000',\n      imageBorder:            'none',\n      imageBoxShadow:         'none',\r\n      barBackground:          'rgba(4, 4, 4, 0.2)',\n      barBorder:              '0px solid #111',\n      barColor:               '#eee',\n      barDescriptionColor:    '#aaa'\r\n    };\r\n    G.viewerTheme_border = {\r\n      background:             'rgba(1, 1, 1, 0.75)',\n      imageBorder:            '4px solid #f8f8f8',\n      imageBoxShadow:         '#888 0px 0px 20px',\r\n      barBackground:          'rgba(4, 4, 4, 0.2)',\n      barBorder:              '0px solid #111',\n      barColor:               '#eee',\n      barDescriptionColor:    '#aaa'\r\n    };\r\n    G.viewerTheme_light = {\r\n      background:             '#f8f8f8',\n      imageBorder:            'none',\n      imageBoxShadow:         'none',\r\n      barBackground:          'rgba(4, 4, 4, 0.7)',\n      barBorder:              '0px solid #111',\n      barColor:               '#eee',\n      barDescriptionColor:    '#aaa'\r\n    };\r\n\r\n      \r\n    \r\n    // shortcut with G context to NGY2TOOLS\r\n    // var NanoAlert =           NGY2Tools.NanoAlert.bind(G);\r\n    // var NanoConsoleLog =      NGY2Tools.NanoConsoleLog.bind(G);\r\n    var NanoAlert =           NGY2Tools.NanoAlert;\r\n    var NanoConsoleLog =      NGY2Tools.NanoConsoleLog;\r\n\r\n    \r\n    /** @function initiateGallery2 */\r\n    this.initiateGallery2 = function( element, params ) {\r\n\r\n      // GLOBAL OPTIONS\r\n      G.O =               params;\r\n      // Base element\r\n      G.$E.base =         jQuery(element);\r\n      G.baseEltID =       G.$E.base.attr('id');\r\n      if( G.baseEltID == undefined ) {\r\n        // set a default ID to the root container\r\n        G.baseEltID='my_nanogallery';\r\n        G.$E.base.attr('id', G.baseEltID)\r\n      }\r\n      G.O.$markup =       [];\r\n      DefineVariables();\r\n      SetPolyFills();\r\n      BuildSkeleton();\r\n      G.GOM.firstDisplayTime=Date.now();\r\n      \r\n      SetGlobalEvents();\r\n\r\n      // check if only one specific album will be used\r\n      var albumToDisplay = G.O.album;\r\n      if( albumToDisplay == '' && G.O.photoset != '' ) {\r\n        albumToDisplay = G.O.photoset;\r\n        G.O.album = G.O.photoset;\r\n      }\r\n      if( albumToDisplay != '' ) {\r\n        G.O.displayBreadcrumb = false;    // no breadcrumb since only 1 album\r\n        if( albumToDisplay.toUpperCase() != 'NONE' ) {\r\n          // open specific album\r\n        \r\n          var p=albumToDisplay.indexOf('&authkey=');\r\n          if( p == -1 ) {\r\n            p=albumToDisplay.indexOf('?authkey=');\r\n          }\r\n          if( p > 0 ) {\r\n            // privat album with authkey\r\n            G.O.locationHash=false;   // disable hash location for hidden/privat albums --> impossible to handle\r\n            var albumID=albumToDisplay.substring(0,p);\r\n            var opt=albumToDisplay.substring(p);\r\n            if( opt.indexOf('Gv1sRg') == -1 ) {\r\n              opt = '&authkey=Gv1sRg'+opt.substring(9);\r\n            }\r\n            var newItem = NGY2Item.New( G, '', '', albumID, '-1', 'album' );\r\n            newItem.authkey = opt;\r\n            DisplayAlbum('-1', albumID);\r\n          }\r\n          else {\r\n            // open a public album\r\n            if( G.O.kind == \"nano_photos_provider2\") {\r\n              if( albumToDisplay == decodeURIComponent(albumToDisplay)) {\r\n                // album ID must be encoded\r\n                albumToDisplay = encodeURIComponent(albumToDisplay);\r\n                G.O.album = albumToDisplay;\r\n              }\r\n            }\r\n            NGY2Item.New( G, '', '', albumToDisplay, '-1', 'album' );\r\n            if( !ProcessLocationHash() ) {\r\n              DisplayAlbum('-1', albumToDisplay);\r\n            }\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // use full content\r\n      // add base album\r\n      NGY2Item.New( G, G.i18nTranslations.breadcrumbHome, '', '0', '-1', 'album' );\r\n\r\n      processStartOptions();\r\n\r\n    }\r\n\r\n\r\n    /** @function processStartOptions */\r\n    function processStartOptions() {\r\n      // open image or album\r\n      // 1. load hidden albums\r\n      // 2. check if location hash set (deep linking)\r\n      // 3. check openOnStart parameter\r\n      // 4. open root album (ID=-1)\r\n\r\n      // hidden/private albums are loaded on plugin start (Picasa) --> no more available in Google Photos\r\n      // if( G.albumListHidden.length > 0 ) {\r\n      //  jQuery.nanogallery2['data_'+G.O.kind](G, 'GetHiddenAlbums', G.albumListHidden, processStartOptionsPart2);\r\n      //  return;\r\n      //}\r\n      \r\n      if( !ProcessLocationHash() ) {\r\n        processStartOptionsPart2();\r\n      }\r\n    }\r\n\r\n    /** @function processStartOptionsPart2 */\r\n    function processStartOptionsPart2() {\r\n  \r\n      // Check location hash + start parameters -> determine what to do on start\r\n      // openOnStart parameter\r\n      if( G.O.openOnStart != '' ) {\r\n        var IDs = parseIDs(G.O.openOnStart);\r\n        if( IDs.imageID != '0' ) {\r\n          DisplayPhoto(IDs.imageID, IDs.albumID);\r\n        }\r\n        else {\r\n          DisplayAlbum('-1', IDs.albumID);\r\n        }\r\n      }\r\n      else {\r\n        // open root album (ID = -1)\r\n        DisplayAlbum('-1', 0);\r\n      }\r\n    }\r\n    \r\n    // Parse string to extract albumID and imageID (format albumID/imageID)\r\n    function parseIDs( IDs ) {\r\n      var r={ albumID: '0', imageID: '0' };\r\n      \r\n      var t=IDs.split('/');\r\n      if( t.length > 0 ) {\r\n        r.albumID = t[0];\r\n        if( t.length > 1 ) {\r\n          r.imageID = t[1];\r\n        }\r\n      }\r\n      return r;\r\n    }\r\n    \r\n\r\n    /** @function DisplayAlbum */\r\n    function DisplayAlbum( imageID, albumID ) {\r\n      // close viewer if already displayed\r\n      if( G.VOM.viewerDisplayed ) {\r\n        CloseInternalViewer(null);\r\n      }\r\n    \r\n      // set current navigation level (l1 or lN)\r\n      var albumIdx = NGY2Item.GetIdx(G, albumID);\r\n      G.GOM.curNavLevel = 'lN';\r\n      if( albumIdx == 0 ) {\r\n        G.GOM.curNavLevel = 'l1';\r\n      }\r\n      G.layout.SetEngine();\r\n      G.galleryResizeEventEnabled = false;\r\n\r\n      if( albumIdx == -1 ) {\r\n        NGY2Item.New( G, '', '', albumID, '0', 'album' );    // create empty album\r\n        albumIdx = G.I.length - 1;\r\n      }\r\n    \r\n      if( !G.I[albumIdx].contentIsLoaded ) {\r\n        // get content of the album if not already loaded\r\n        AlbumGetContent( albumID, DisplayAlbum, imageID, albumID );\r\n        return;\r\n      }\r\n    \r\n      ThumbnailSelectionClear();\r\n    \r\n      G.GOM.pagination.currentPage = 0;\r\n      SetLocationHash( albumID, '' );\r\n      GalleryRender( albumIdx );\r\n    \r\n    }\r\n\r\n\r\n    //----- manage the bottom area of the gallery -> \"pagination\" or \"more button\"\r\n    function GalleryBottomManage() {\r\n\r\n      switch( G.galleryDisplayMode.Get() ) {\r\n        case 'PAGINATION':\r\n          if( G.layout.support.rows && G.galleryMaxRows.Get() > 0 ) {\r\n            ManagePagination( G.GOM.albumIdx );\r\n          }\r\n          break;\r\n        case 'MOREBUTTON':\r\n          G.$E.conTnBottom.off('click');\r\n          var nb = G.GOM.items.length-G.GOM.itemsDisplayed;\r\n          if( nb == 0 ) {\r\n            G.$E.conTnBottom.empty();\r\n          }\r\n          else {\r\n            G.$E.conTnBottom.html('<div class=\"nGY2GalleryMoreButton\"><div class=\"nGY2GalleryMoreButtonAnnotation\">+'+nb+' ' + G.O.icons.galleryMoreButton +'</div></div>');\r\n            G.$E.conTnBottom.on('click', function(e) {\r\n              G.GOM.displayedMoreSteps++;\r\n              GalleryResize();\r\n            });\r\n          }\r\n          break;\r\n        case 'FULLCONTENT':\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n    \r\n    \r\n    // add one album/folder to the breadcrumb\r\n    function breadcrumbAdd( albumIdx ) {\r\n\r\n      var ic='';\r\n      if( !G.O.breadcrumbHideIcons ) {\r\n        ic=G.O.icons.breadcrumbAlbum;\r\n        if( albumIdx == 0 ) {\r\n          ic=G.O.icons.breadcrumbHome;\r\n        }\r\n      }\r\n      var $newDiv =jQuery('<div class=\"oneItem\">'+ic + G.I[albumIdx].title+'</div>').appendTo(G.GOM.navigationBar.$newContent.find('.nGY2Breadcrumb'));\r\n      if( G.O.breadcrumbOnlyCurrentLevel ) {\r\n        // link to parent folder (only 1 level is displayed in the breadcrumb)\r\n        if( albumIdx == 0 ) {\r\n          // no parent level -> stay on current one\r\n          jQuery($newDiv).data('albumID','0');\r\n        }\r\n        else {\r\n          jQuery($newDiv).data('albumID',G.I[albumIdx].albumID);\r\n        }\r\n      }\r\n      else {\r\n        // link to current folder\r\n        jQuery($newDiv).data('albumID',G.I[albumIdx].GetID());\r\n      }\r\n      $newDiv.click(function() {\r\n        var cAlbumID=jQuery(this).data('albumID');\r\n        DisplayAlbum('-1', cAlbumID);\r\n        return;\r\n      });\r\n    }\r\n\r\n    // add one separator to breadcrumb\r\n    function breadcrumbAddSeparator( lastAlbumID ) {\r\n      var $newSep=jQuery('<div class=\"oneItem\">'+(G.O.RTL ? G.O.icons.breadcrumbSeparatorRtl : G.O.icons.breadcrumbSeparator)+'</div>').appendTo(G.GOM.navigationBar.$newContent.find('.nGY2Breadcrumb'));\r\n      jQuery($newSep).data('albumIdx',lastAlbumID);\r\n      $newSep.click(function() {\r\n        var sepAlbumIdx=jQuery(this).data('albumIdx');\r\n        DisplayAlbum('-1', G.I[sepAlbumIdx].GetID());\r\n        return;\r\n      });\r\n    }\r\n\r\n    \r\n    \r\n    // Manage the gallery toolbar (breadcrumb + tag filter)\r\n    function GalleryNavigationBar( albumIdx ) {\r\n\r\n      // Title + background image\r\n      // var bgImage='';\r\n      // var l=G.I.length;\r\n      // var albumID = G.I[albumIdx].GetID();\r\n      // for( var idx=0; idx<l ; idx++) {\r\n        // var item=G.I[idx];\r\n        // if( item.kind == 'image' && item.isToDisplay(albumID) ) {\r\n          // bgImage='<div id=\"pipo\" class=\"pipo\" style=\"height: 150px; width:100%; background-image: url(\"' + item.responsiveURL() + '\"); background-size: cover; background-position: center center; filter:blur(2px)\">pipo</div>';\r\n          // break;\r\n        // }\r\n      // }\r\n\r\n      //console.log(bgImage);\r\n    \r\n      // new navigation bar items are not build in the DOM, but in memory\r\n      G.GOM.navigationBar.$newContent=jQuery('<div class=\"nGY2Navigationbar\"></div>');\r\n      //G.GOM.navigationBar.$newContent = jQuery(bgImage );\r\n      //console.log(G.GOM.navigationBar.$newContent);\r\n\r\n      //-- manage breadcrumb\r\n      if( G.O.displayBreadcrumb == true && !G.O.thumbnailAlbumDisplayImage) {\r\n        // retrieve new folder level\r\n        var newLevel = 0,\r\n        lstItems=[];\r\n        if( albumIdx != 0 ) {\r\n          var l=G.I.length,\r\n          parentID=0;\r\n          \r\n          lstItems.push(albumIdx);\r\n          var curIdx=albumIdx;\r\n          newLevel++;\r\n          \r\n          while( G.I[curIdx].albumID != 0 && G.I[curIdx].albumID != -1) {\r\n            for(var i=1; i < l; i++ ) {\r\n              if( G.I[i].GetID() == G.I[curIdx].albumID ) {\r\n                curIdx=i;\r\n                lstItems.push(curIdx);\r\n                newLevel++;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // build breadcrumb\r\n        if( !(G.O.breadcrumbAutoHideTopLevel && newLevel == 0) ) {\r\n          BreadcrumbBuild( lstItems );\r\n        }\r\n      }\r\n\r\n      \r\n      //-- manage and build tag filters\r\n      if( G.galleryFilterTags.Get() != false ) {\r\n        var nTags=G.I[albumIdx].albumTagList.length;\r\n        if( nTags > 0 ) {\r\n          for(var i=0; i < nTags; i++ ) {\r\n            var s=G.I[albumIdx].albumTagList[i];\r\n            var ic=G.O.icons.navigationFilterUnselected;\r\n            var tagClass='Unselected';\r\n            if( jQuery.inArray(s, G.I[albumIdx].albumTagListSel) >= 0 ) {\r\n              tagClass='Selected';\r\n              ic=G.O.icons.navigationFilterSelected;\r\n            }\r\n            var $newTag=jQuery('<div class=\"nGY2NavigationbarItem nGY2NavFilter'+tagClass+'\">'+ic+' '+s+'</div>').appendTo(G.GOM.navigationBar.$newContent);\r\n            $newTag.click(function() {\r\n              var $this=jQuery(this);\r\n              var tag=$this.text().replace(/^\\s*|\\s*$/, '');  //trim trailing/leading whitespace\r\n              // if( $this.hasClass('oneTagUnselected') ){\r\n              if( $this.hasClass('nGY2NavFilterUnselected') ){\r\n                G.I[albumIdx].albumTagListSel.push(tag);\r\n              }\r\n              else {\r\n                var tidx=jQuery.inArray(tag,G.I[albumIdx].albumTagListSel);\r\n                if( tidx != -1 ) {\r\n                  G.I[albumIdx].albumTagListSel.splice(tidx,1);\r\n                }\r\n              }\r\n              $this.toggleClass('nGY2NavFilters-oneTagUnselected nGY2NavFilters-oneTagSelected');\r\n              DisplayAlbum('-1', G.I[albumIdx].GetID());\r\n            });\r\n          }\r\n          var $newClearFilter=jQuery('<div class=\"nGY2NavigationbarItem nGY2NavFilterSelectAll\">'+G.O.icons.navigationFilterSelectedAll+'</div>').appendTo(G.GOM.navigationBar.$newContent);\r\n          $newClearFilter.click(function() {\r\n            var nTags=G.I[albumIdx].albumTagList.length;\r\n            G.I[albumIdx].albumTagListSel=[];\r\n            for(var i=0; i <nTags; i++ ) {\r\n              var s=G.I[albumIdx].albumTagList[i];\r\n              G.I[albumIdx].albumTagListSel.push(s);\r\n            }\r\n            DisplayAlbum('-1', G.I[albumIdx].GetID());\r\n          });\r\n        }\r\n      }\r\n\r\n    }\r\n    \r\n    function BreadcrumbBuild(lstItems) {\r\n\r\n    // console.log(G.GOM.navigationBar.$newContent);\r\n    jQuery('<div class=\"nGY2NavigationbarItem nGY2Breadcrumb\"></div>').appendTo(G.GOM.navigationBar.$newContent);\r\n    // console.log(G.GOM.navigationBar.$newContent);\r\n      \r\n      if( G.O.breadcrumbOnlyCurrentLevel ) {\r\n        // display only 1 separator and the current folder level\r\n        if( lstItems.length == 0 ) {\r\n          breadcrumbAdd(0);\r\n        }\r\n        else {\r\n          var last=lstItems.length-1;\r\n          if( lstItems.length == 1 ) {\r\n            breadcrumbAddSeparator(0);    // root level\r\n          }\r\n          else {\r\n            breadcrumbAddSeparator(lstItems[0]);\r\n          }\r\n          breadcrumbAdd(lstItems[0]);\r\n        }\r\n      }\r\n      else {\r\n        // display the full breadcrum (full folder levels including root level)\r\n        breadcrumbAdd(0);\r\n        if( lstItems.length > 0 ) {\r\n          breadcrumbAddSeparator(0);\r\n          for(var i=lstItems.length-1; i>=0 ; i-- ) {\r\n            breadcrumbAdd(lstItems[i]);\r\n            if( i > 0 ) {\r\n              breadcrumbAddSeparator(lstItems[i-1]);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    \r\n    }\r\n    \r\n\r\n    // Display gallery pagination\r\n    function ManagePagination( albumIdx ) {\r\n\r\n      G.$E.conTnBottom.css('opacity', 0);\r\n      G.$E.conTnBottom.children().remove();\r\n\r\n      if( G.GOM.items.length == 0 ) { return; }   // no thumbnail to display\r\n\r\n      // calculate the number of pages\r\n      var nbPages=Math.ceil((G.GOM.items[G.GOM.items.length - 1].row + 1)/G.galleryMaxRows.Get());\r\n\r\n      // only one page -> do not display pagination\r\n      if( nbPages == 1 ) { return; }\r\n\r\n      // check if current page still exists (for example after a resize)\r\n      if( G.GOM.pagination.currentPage > (nbPages-1) ) {\r\n        G.GOM.pagination.currentPage = nbPages-1;\r\n      }\r\n      \r\n      GalleryRenderGetInterval();\r\n      // nothing to display --> exit\r\n      if( G.GOM.displayInterval.len == 0 ) { return; }\r\n      \r\n      // display \"previous\"\r\n      if( G.O.galleryPaginationMode == 'NUMBERS' && G.GOM.pagination.currentPage > 0 ) {\r\n        var $eltPrev = jQuery('<div class=\"nGY2PaginationPrev\">'+G.O.icons.paginationPrevious+'</div>').appendTo(G.$E.conTnBottom);\r\n        $eltPrev.click(function(e) {\r\n          paginationPreviousPage();\r\n        });\r\n      }\r\n\r\n      var firstPage = 0;\r\n      var lastPage = nbPages;\r\n      if( G.O.galleryPaginationMode != 'NUMBERS' ) {\r\n        // no 'previous'/'next' and no max number of pagination items\r\n        firstPage = 0;\r\n      }\r\n      else {\r\n        // display pagination numbers and previous/next\r\n        var vp = G.O.paginationVisiblePages;\r\n        var numberOfPagesToDisplay = G.O.paginationVisiblePages;\r\n        if( numberOfPagesToDisplay >= nbPages ) {\r\n          firstPage = 0;\r\n        }\r\n        else {\r\n          // we have more pages than we want to display\r\n          var nbBeforeAfter = 0;\r\n          if( isOdd(numberOfPagesToDisplay) ) {\r\n            nbBeforeAfter = (numberOfPagesToDisplay + 1) / 2;\r\n          }\r\n          else {\r\n            nbBeforeAfter = numberOfPagesToDisplay / 2;\r\n          }\r\n          \r\n          if( G.GOM.pagination.currentPage < nbBeforeAfter ) {\r\n            firstPage = 0;\r\n            lastPage = numberOfPagesToDisplay - 1;\r\n            if( lastPage > nbPages ) {\r\n              lastPage = nbPages - 1;\r\n            }\r\n          }\r\n          else {\r\n            firstPage = G.GOM.pagination.currentPage - nbBeforeAfter;\r\n            lastPage = firstPage + numberOfPagesToDisplay;\r\n            if( lastPage > nbPages ) {\r\n              lastPage = nbPages - 1;\r\n            }\r\n          }\r\n          \r\n          if( (lastPage - firstPage) < numberOfPagesToDisplay ) {\r\n            firstPage = lastPage - numberOfPagesToDisplay;\r\n            if( firstPage < 0 ) {\r\n              firstPage = 0;\r\n            }\r\n          }\r\n\r\n        }\r\n      }\r\n\r\n      // render pagination items\r\n      for(var i = firstPage; i < lastPage; i++ ) {\r\n        var c = '';\r\n        var p = '';\r\n\r\n        switch( G.O.galleryPaginationMode ) {\r\n          case 'NUMBERS':\r\n            c = 'nGY2paginationItem';\r\n            p = i + 1;\r\n            break;\r\n          case 'DOTS':\r\n            c = 'nGY2paginationDot';\r\n            break;\r\n          case 'RECTANGLES':\r\n            c = 'nGY2paginationRectangle';\r\n            break;\r\n        }\r\n        if( i == G.GOM.pagination.currentPage ) {\r\n          c += 'CurrentPage';\r\n        }\r\n\r\n        var elt$ = jQuery('<div class=\"' + c + '\">' + p + '</div>').appendTo(G.$E.conTnBottom);\r\n        elt$.data('pageNumber', i );\r\n        elt$.click( function(e) {\r\n          G.GOM.pagination.currentPage = jQuery(this).data('pageNumber');\r\n          TriggerCustomEvent('pageChanged');\r\n\r\n          // scroll to top of gallery if not displayed\r\n          if( !inViewportVert(G.$E.base, 0) ) {\r\n            $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n          }\r\n          GalleryDisplayPart1( true );\r\n          GalleryDisplayPart2( true );\r\n        });\r\n\r\n      }\r\n\r\n      // display \"next\"\r\n      if( G.O.galleryPaginationMode == 'NUMBERS' && (G.GOM.pagination.currentPage + 1) < nbPages ) {\r\n        var $eltNext = jQuery('<div class=\"nGY2PaginationNext\">' + G.O.icons.paginationNext + '</div>').appendTo(G.$E.conTnBottom);\r\n        $eltNext.click( function(e) {\r\n          paginationNextPage();\r\n        });\r\n      }\r\n\r\n      G.$E.conTnBottom.css('opacity', 1);\r\n\r\n    }\r\n    function isOdd(num) { return (num % 2) == 1;}\r\n    \r\n    // pagination - next page\r\n    function paginationNextPage() {\r\n      var aIdx = G.GOM.albumIdx,\r\n      n1 = 0;\r\n      ThumbnailHoverOutAll();\n      \r\n      // pagination - max lines per page mode\r\n      if( G.galleryMaxRows.Get() > 0 ) {\r\n        // number of pages\r\n        n1 = (G.GOM.items[G.GOM.items.length - 1].row + 1) / G.galleryMaxRows.Get();\r\n      }\r\n      var n2 = Math.ceil(n1);\r\n      var pn = G.GOM.pagination.currentPage;\r\n      if( pn < (n2-1) ) {\r\n        pn++;\r\n      }\r\n      else {\r\n        pn = 0;\r\n      }\r\n      \r\n      G.GOM.pagination.currentPage = pn;\r\n      TriggerCustomEvent('pageChanged');\r\n\r\n      // scroll to top of gallery if not displayed\r\n      if( !inViewportVert(G.$E.base, 0) ) {\r\n        $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n      }\r\n      GalleryDisplayPart1( true );\r\n      GalleryDisplayPart2( true );\r\n    }\r\n    \r\n    // pagination - previous page\r\n    function paginationPreviousPage() {\r\n      // var aIdx=G.$E.conTnBottom.data('galleryIdx'),\r\n      var aIdx = G.GOM.albumIdx,\r\n      n1 = 0;\r\n\n      ThumbnailHoverOutAll();\n      \r\n      // pagination - max lines per page mode\r\n      if( G.galleryMaxRows.Get() > 0 ) {\r\n        // number of pages\r\n        n1 = (G.GOM.items[G.GOM.items.length - 1].row + 1) / G.galleryMaxRows.Get();\r\n      }\r\n      var n2 = Math.ceil(n1);\r\n      \r\n      // var pn=G.$E.conTnBottom.data('currentPageNumber');\r\n      var pn = G.GOM.pagination.currentPage;\r\n      if( pn > 0 ) {\r\n        pn--;\r\n      }\r\n      else {\r\n        pn = n2 - 1;\r\n      }\r\n\r\n      G.GOM.pagination.currentPage = pn;\r\n      TriggerCustomEvent('pageChanged');\r\n\r\n      // scroll to top of gallery if not displayed\r\n      if( !inViewportVert(G.$E.base, 0) ) {\r\n        $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n      }\r\n      GalleryDisplayPart1( true );\r\n      GalleryDisplayPart2( true );\r\n    }\r\n\r\n    // retrieve the from/to intervall for gallery thumbnail render\r\n    function GalleryRenderGetInterval() {\r\n      G.GOM.displayInterval.from = 0;\r\n      G.GOM.displayInterval.len = G.I.length;\r\n      \r\n      switch( G.galleryDisplayMode.Get() ) {\r\n        case 'PAGINATION':\r\n          if( G.layout.support.rows ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var firstRow = G.GOM.pagination.currentPage * G.galleryMaxRows.Get();\r\n            var lastRow = firstRow + G.galleryMaxRows.Get();\r\n            var firstTn = -1;\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row >= firstRow && curTn.row < lastRow ) {\r\n                if( firstTn == -1 ) {\r\n                  G.GOM.displayInterval.from = i;\r\n                  firstTn = i;\r\n                }\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 'MOREBUTTON':\r\n          if( G.layout.support.rows ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var lastRow = G.O.galleryDisplayMoreStep * (G.GOM.displayedMoreSteps+1);\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row < lastRow ) {\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 'ROWS':\r\n          if( G.layout.support.rows ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var lastRow = G.galleryMaxRows.Get();\r\n            if( G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1 ) {\r\n              if( lastRow > (G.GOM.lastFullRow + 1) ) {\r\n                lastRow = G.GOM.lastFullRow + 1;\r\n              }\r\n            }\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row < lastRow ) {\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n        case 'FULLCONTENT':\r\n        if( G.layout.support.rows && G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1 ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var lastRow = G.GOM.lastFullRow + 1;\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row < lastRow ) {\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    \r\n    \r\n    // RENDER THE GALLERY\r\n    function GalleryRender( albumIdx ) {\r\n      TriggerCustomEvent('galleryRenderStart');\r\n      \r\n      clearTimeout(G.GOM.slider.timerID);\r\n      G.GOM.slider.hostIdx = -1;      // disabled slider on thumbnail\r\n      \r\n      var fu=G.O.fnGalleryRenderStart;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(albumIdx) : window[fu](albumIdx);\r\n      }\r\n\r\n      G.layout.SetEngine();\r\n      G.galleryResizeEventEnabled = false;\r\n      G.GOM.albumIdx = -1;\r\n      G.GOM.lastDisplayedIdx = -1;\r\n\r\n      // pagination\r\n      if( G.$E.conTnBottom !== undefined ) {\r\n        // G.$E.conTnBottom.children().remove();\r\n        G.$E.conTnBottom.empty();\r\n      }\r\n\r\n      // navigation toolbar (breadcrumb + tag filters)\r\n      GalleryNavigationBar(albumIdx);\r\n      \r\n      if( G.GOM.firstDisplay ) {\r\n        G.GOM.firstDisplay = false;\r\n        var d = Date.now()-G.GOM.firstDisplayTime;\r\n        if( d < G.O.galleryRenderDelay ) {\r\n          // setTimeout( function() { GalleryRenderPart1( albumIdx )}, G.O.galleryRenderDelay-d );\r\n          requestTimeout( function() { GalleryRenderPart1( albumIdx )}, G.O.galleryRenderDelay-d );\r\n        }\r\n        else {\r\n          GalleryRenderPart1( albumIdx );\r\n        }\r\n        G.O.galleryRenderDelay = 0;\r\n        \n      }\r\n      else {\r\n        var hideNavigationBar = false;\r\n        if( G.GOM.navigationBar.$newContent.children().length == 0 ) {\r\n          hideNavigationBar = true;\r\n        }\r\n\r\n        // hide everything\r\n        var tweenable = new NGTweenable();\r\n        tweenable.tween({\r\n          from:         { 'opacity': 1 },\r\n          to:           { 'opacity': 0 },\r\n          duration:     300,\r\n          easing:       'easeInQuart',\r\n          attachment:   { h: hideNavigationBar },\r\n          step:         function (state, att) {\r\n            // window.ng_draf( function() {\r\n              G.$E.conTnParent.css({'opacity': state.opacity });\r\n              if( att.h ) {\r\n                G.$E.conNavigationBar.css({ 'opacity': state.opacity });\r\n              }\r\n            // });\r\n          },\r\n          finish:       function (state, att) {\r\n            // window.ng_draf( function() {\r\n              if( att.h ) {\r\n                G.$E.conNavigationBar.css({ 'opacity': 0, 'display': 'none' });\r\n              }\r\n              // scroll to top of the gallery if needed\r\n              var galleryOTop = G.$E.base.offset().top;\r\n              if( galleryOTop < G.GOM.cache.viewport.t ) {\r\n                // jQuery('html, body').animate({scrollTop: galleryOTop}, 200);\r\n                jQuery('html, body').animate({scrollTop: galleryOTop}, 500, \"linear\", function() {\r\n                  GalleryRenderPart1( albumIdx );\r\n                });\r\n              }\r\n              else {\r\n                GalleryRenderPart1( albumIdx );\r\n              }\r\n            // });\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n    function GalleryRenderPart1( albumIdx ) {\r\n      // display new navigation bar\r\n      var oldN = G.$E.conNavigationBar.children().length;\r\n      G.$E.conNavigationBar.empty();\r\n      G.GOM.navigationBar.$newContent.children().clone(true,true).appendTo(G.$E.conNavigationBar);\r\n      // G.GOM.navigationBar.$newContent.appendTo(G.$E.conNavigationBar);\r\n      if( G.$E.conNavigationBar.children().length > 0 && oldN == 0 ) {\r\n        G.$E.conNavigationBar.css({ 'opacity': 0, 'display': 'block' });\r\n        var tweenable = new NGTweenable();\r\n        tweenable.tween({\r\n          from:     { opacity: 0 },\r\n          to:       { opacity: 1 },\r\n          duration: 200,\r\n          easing:   'easeInQuart',\r\n          step:     function (state) {\r\n            // window.ng_draf( function() {\r\n              G.$E.conNavigationBar.css( state );\r\n            // });\r\n          },\r\n          finish:   function (state) {\r\n            // window.ng_draf( function() {\r\n              G.$E.conNavigationBar.css({ 'opacity': 1 });\r\n              // display gallery\r\n              // GalleryRenderPart2( albumIdx );\r\n              // setTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n              requestTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n            // });\r\n          }\r\n        });\r\n      }\r\n      else {\r\n        // display gallery\r\n        // GalleryRenderPart2( albumIdx );\r\n            // setTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n            requestTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n      }\r\n\r\n    }\r\n    \r\n    // Gallery render part 2 -> remove all thumbnails\r\n    function GalleryRenderPart2(albumIdx) {\r\n      G.GOM.lastZIndex = parseInt(G.$E.base.css('z-index'));\r\n      if( isNaN(G.GOM.lastZIndex) ) {\r\n        G.GOM.lastZIndex=0;\r\n      }\r\n      G.$E.conTnParent.css({ 'opacity': 0 });\r\n      G.$E.conTn.off().empty();\r\n      var l = G.I.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        // reset each item\r\n        var item = G.I[i];\r\n        item.hovered = false;\r\n        item.$elt = null;\r\n        item.$Elts = [];\r\n        item.eltTransform = [];\r\n        item.eltFilter = [];\r\n        item.width = 0;\r\n        item.height = 0;\r\n        item.left = 0;\r\n        item.top = 0;\r\n        item.resizedContentWidth = 0;\r\n        item.resizedContentHeight = 0;\r\n        item.thumbnailImgRevealed = false;\r\n      }\r\n\r\n      if( G.CSStransformName == null ) {\r\n        G.$E.conTn.css('left', '0px');\r\n      }\r\n      else {\r\n        // G.$E.conTn.css( G.CSStransformName, 'translateX(0px)');\r\n        G.$E.conTn.css( G.CSStransformName, 'none');\r\n      }\r\n      \r\n      // setTimeout(function(){ GalleryRenderPart3(albumIdx) }, 60);\r\n      requestTimeout(function(){ GalleryRenderPart3(albumIdx) }, 60);\r\n      // GalleryRenderPart3(albumIdx);\r\n\r\n    }\r\n    \r\n    // Gallery render part 2 -> start building the new gallery\r\n    function GalleryRenderPart3(albumIdx) {\r\n      var d = new Date();      \r\n      \r\n      G.$E.conTnParent.css( 'opacity', 1);\r\n\r\n      G.GOM.items = [];\r\n      G.GOM.displayedMoreSteps = 0;\r\n      // retrieve label height      \r\n      if( G.O.thumbnailLabel.get('position') == 'onBottom' ) {\r\n        // retrieve height each time because size can change depending on thumbnail's settings\r\n        G.tn.labelHeight[G.GOM.curNavLevel]=ThumbnailGetLabelHeight();\r\n      }\r\n      else {\r\n        G.tn.labelHeight[G.GOM.curNavLevel]=0;\r\n      }\r\n      G.GOM.albumIdx=albumIdx;\r\n\r\n      TriggerCustomEvent('galleryRenderEnd');\r\n      var fu=G.O.fnGalleryRenderEnd;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(albumIdx) : window[fu](albumIdx);\r\n      }\r\n\r\n      // Step 1: populate GOM\r\n      if( GalleryPopulateGOM() ) {\r\n\r\n        // step 2: calculate layout\r\n        GallerySetLayout();\r\n\r\n        // step 3: display gallery\r\n        GalleryAppear();\r\n        // GalleryDisplay( false );\r\n        GalleryDisplayPart1( false );\r\n        // setTimeout(function(){ GalleryDisplayPart2( false ) }, 120);\r\n        requestTimeout(function(){ GalleryDisplayPart2( false ) }, 120);\r\n      }\r\n      else {\r\n        G.galleryResizeEventEnabled = true;\r\n      }\r\n      \r\n      if( G.O.debugMode ) { console.log('GalleryRenderPart3: '+ (new Date()-d)); }\r\n\r\n    }\r\n    \r\n    \r\n    // Resize the gallery\r\n    function GalleryResize() {\r\n      var d = new Date();\r\n      G.galleryResizeEventEnabled = false;\r\n      // G.GOM.cache.areaWidth=G.$E.conTnParent.width();\r\n      if( GallerySetLayout() == false ) {\r\n        G.galleryResizeEventEnabled = true;\r\n        if( G.O.debugMode ) { console.log('GalleryResize1: '+ (new Date()-d)); }\r\n        return;\r\n      }\r\n      if( G.O.debugMode ) { console.log('GalleryResizeSetLayout: '+ (new Date()-d)); }\r\n\r\n      GalleryDisplayPart1( false );\r\n      GalleryDisplayPart2( false );\r\n\r\n      if( G.O.debugMode ) { console.log('GalleryResizeFull: '+ (new Date()-d)); }\r\n    }\r\n    \r\n    \r\n    \r\n    // copy items (album content) to GOM\r\n    function GalleryPopulateGOM() {\r\n      \r\n      var preloadImages = '';\r\n      var imageSizeRequested = false;\r\n      var albumID = G.I[G.GOM.albumIdx].GetID();\r\n      var l = G.I.length;\r\n      var cnt = 0;\r\n\r\n      for( var idx = 0; idx < l; idx++ ) {\r\n        var item = G.I[idx];\r\n        // check album\r\n        if( item.isToDisplay(albumID) ) {\r\n          var w = item.thumbImg().width;\r\n          var h = item.thumbImg().height;\r\n          // if unknown image size and layout is not grid --> we need to retrieve the size of the images\r\n          if( G.layout.prerequisite.imageSize && ( w == 0 || h == 0) ) {\r\n          // if( true ) {\r\n            imageSizeRequested = true;\r\n            preloadImages += '<img src=\"'+item.thumbImg().src+'\" data-idx=\"'+cnt+'\" data-albumidx=\"'+G.GOM.albumIdx+'\">';\r\n          }\r\n          \r\n          // set default size if required\r\n          if( h == 0 ) {\r\n            h = G.tn.defaultSize.getHeight();\r\n          }\r\n          if( w == 0 ) {\r\n            w = G.tn.defaultSize.getWidth();\r\n          }\r\n          var tn = new G.GOM.GTn(idx, w, h);\r\n          G.GOM.items.push(tn);\r\n          cnt++;\r\n        }\r\n      }\r\n\r\n      TriggerCustomEvent('galleryObjectModelBuilt');\r\n      var fu = G.O.fnGalleryObjectModelBuilt;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu() : window[fu]();\r\n      }\r\n      \r\n      if( imageSizeRequested ) {\r\n        // preload images to retrieve their size and then resize the gallery (=GallerySetLayout()+ GalleryDisplay())\r\n        var $newImg = jQuery(preloadImages);\r\n        var gi_imgLoad = ngimagesLoaded( $newImg );\r\n        $newImg = null;\r\n        gi_imgLoad.on( 'progress', function( instance, image ) {\r\n        \r\n          if( image.isLoaded ) {\r\n            var idx = image.img.getAttribute('data-idx');\r\n            var albumIdx = image.img.getAttribute('data-albumidx');\r\n            if( albumIdx == G.GOM.albumIdx ) {\r\n              // ignore event if not on current album\r\n              var curTn = G.GOM.items[idx];\r\n              curTn.imageWidth = image.img.naturalWidth;\r\n              curTn.imageHeight = image.img.naturalHeight;\r\n              var item = G.I[curTn.thumbnailIdx];\r\n              item.thumbs.width[G.GOM.curNavLevel][G.GOM.curWidth] = curTn.imageWidth;\r\n              item.thumbs.height[G.GOM.curNavLevel][G.GOM.curWidth] = curTn.imageHeight;\r\n \r\n              // resize the gallery\r\n              G.GalleryResizeThrottled();\r\n              \r\n              // set the retrieved size to all levels with same configuration  \r\n              var object = item.thumbs.width.l1;\r\n              for (var property in object) {\r\n                if (object.hasOwnProperty(property)) {\r\n                  if( property != G.GOM.curWidth ) {\r\n                    if( G.tn.settings.width.l1[property] == G.tn.settings.getW() && G.tn.settings.height.l1[property] == G.tn.settings.getH() ) {\r\n                      item.thumbs.width.l1[property] = curTn.imageWidth;\r\n                      item.thumbs.height.l1[property] = curTn.imageHeight;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n              object = item.thumbs.width.lN;\r\n              for (var property in object) {\r\n                if (object.hasOwnProperty(property)) {\r\n                  if( property != G.GOM.curWidth ) {\r\n                    if( G.tn.settings.width.lN[property] == G.tn.settings.getW() && G.tn.settings.height.lN[property] == G.tn.settings.getH() ) {\r\n                      item.thumbs.width.lN[property] = curTn.imageWidth;\r\n                      item.thumbs.height.lN[property] = curTn.imageHeight;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        });\r\n        G.galleryResizeEventEnabled = true;\r\n        return false;\r\n      }\r\n      else {\r\n        return true;\r\n      }\r\n      \r\n    }\r\n    \r\n    //----- Calculate the layout of the thumbnails\r\n    function GallerySetLayout() {\r\n      var r = true;\r\n      // width of the available area\r\n      G.GOM.cache.areaWidth = G.$E.conTnParent.width();\r\n      G.GOM.displayArea = { width:0, height:0 };\r\n\r\n      switch( G.layout.engine ) {\r\n        case 'JUSTIFIED':\r\n          r = GallerySetLayoutWidthtAuto();\r\n          break;\r\n        case 'CASCADING':\r\n          r = GallerySetLayoutHeightAuto();\r\n          break;\r\n        case 'MOSAIC':\r\n          r = GallerySetLayoutMosaic();\r\n          break;\r\n        case 'GRID':\r\n        default:\r\n          r = GallerySetLayoutGrid();\r\n          break;\r\n      }\r\n      \r\n      TriggerCustomEvent('galleryLayoutApplied');\r\n      var fu = G.O.fnGalleryLayoutApplied;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu() : window[fu]();\r\n      }\r\n      return r;\r\n\r\n    }\r\n    \r\n    \r\n    //----- CASCADING LAYOUT\r\n    function GallerySetLayoutHeightAuto() {\r\n      var curCol =      0,\r\n      areaWidth =       G.GOM.cache.areaWidth,\r\n      curRow =          0,\r\n      colHeight =       [],\r\n      maxCol =          NbThumbnailsPerRow(areaWidth),\r\n      gutterWidth =     0,\r\n      gutterHeight =    G.tn.opt.Get('gutterHeight');\r\n      var w =           0;\r\n      var scaleFactor = 1;\r\n      var tnWidth =     G.tn.defaultSize.getOuterWidth();\r\n      var nbTn =        G.GOM.items.length;\r\n      var curPosY = 0;\r\n\r\n      if( G.O.thumbnailAlignment == 'justified' ) {\r\n        maxCol = Math.min(maxCol, nbTn);\r\n        gutterWidth = ( maxCol == 1 ? 0 : (areaWidth - (maxCol * tnWidth) ) / (maxCol - 1) );\r\n      }\r\n      else {\r\n        gutterWidth=G.tn.opt.Get('gutterWidth');\r\n      }\r\n\r\n\r\n      var borderWidth = G.tn.borderWidth * 2;\r\n      var borderHeight = G.tn.borderHeight * 2;\r\n\r\n      G.GOM.lastFullRow=-1;   // feature disabled\r\n\r\n      // Retrieve the real used width of the area (the evaluation is based on the content of the first line)\r\n      if( G.O.thumbnailAlignment == 'fillWidth' ) {\r\n        // fillWidth --> evaluate scale factor and number of columns\r\n        var totalGutterWidth = (maxCol - 1) * gutterWidth;\r\n        scaleFactor = (areaWidth - totalGutterWidth) / (maxCol * tnWidth);\r\n        if( scaleFactor > 1 ) {\r\n          maxCol++; // add one column and re-evaluate the scale factor\r\n        }\r\n        totalGutterWidth = (maxCol - 1) * gutterWidth;\r\n        scaleFactor = Math.min( (areaWidth - totalGutterWidth) / (maxCol*tnWidth), 1);   // no upscale\r\n      }\r\n\r\n      \r\n      tnWidth = tnWidth * scaleFactor;\r\n      var contentWidth = tnWidth - borderWidth;\r\n\r\n      // loop to position the thumbnails, and set their size\r\n      var baseHeight = G.tn.opt.Get('baseGridHeight') * scaleFactor;\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.deleted == true ) { break; }    // item is logically deleted\r\n        if( curTn.imageHeight > 0 && curTn.imageWidth > 0 ) {\r\n          var curPosX = 0,\r\n          curPosY = 0;\r\n          var imageRatio = curTn.imageHeight / curTn.imageWidth;\r\n          // curTn.resizedContentWidth = tnWidth - borderWidth;\r\n          curTn.resizedContentWidth = contentWidth;\r\n          curTn.resizedContentHeight = curTn.resizedContentWidth * imageRatio;\r\n          if( baseHeight > 0 ) {\r\n            // grid based vertical position\r\n            var t= Math.max( Math.trunc(curTn.resizedContentHeight/baseHeight), 1) ;\r\n            curTn.resizedContentHeight = baseHeight * t + ((t-1)*(borderHeight+gutterHeight));\r\n          }\r\n          \r\n          curTn.height = curTn.resizedContentHeight + borderHeight + G.tn.labelHeight.get();\r\n          curTn.width = tnWidth;\r\n          curTn.row = 0;\r\n          \r\n          if( curRow == 0 ) {\r\n            // first row\r\n            curPosX = curCol * (tnWidth + gutterWidth);\r\n            colHeight[curCol] = curTn.height + gutterHeight;\r\n            \r\n            curCol++;\r\n            if( curCol >= maxCol ) {\r\n              curCol = 0;\r\n              curRow++;\r\n            }\r\n          }\r\n          else {\r\n            var c=0,\r\n            minColHeight=colHeight[0];\r\n            for( var j = 1; j < maxCol; j++) {\r\n              if( (colHeight[j] + 5) < minColHeight ) {     // +5 --> threshold\r\n                minColHeight = colHeight[j];\r\n                c = j;\r\n                //break;\r\n              }\r\n            }\r\n            curPosY = colHeight[c];\r\n            curPosX = c * (tnWidth + gutterWidth);\r\n            colHeight[c] = curPosY + curTn.height + gutterHeight;\r\n          }\r\n\r\n          var x = curPosX;\r\n          if( G.O.RTL) {\r\n            x= w - curPosX - tnWidth;\r\n          }\r\n\r\n          curTn.left = x;\r\n          curTn.top = curPosY;\r\n        }\r\n      }\r\n\r\n      G.GOM.displayArea.width= maxCol * (tnWidth + gutterWidth) - gutterWidth;\r\n      return true;\r\n    }\r\n    \r\n    \r\n    //----- JUSTIFIED LAYOUT\r\n    function GallerySetLayoutWidthtAuto() {\r\n      var curWidth =               0,\r\n      areaWidth =                  G.GOM.cache.areaWidth,\r\n      lastPosX =                   0,\r\n      curPosY =                    0,\r\n      rowLastItem =                [],\r\n      rowNum =                     0,\r\n      rowHeight =                  [],\r\n      bNewRow =                    false,\r\n      cnt =                        0,\r\n      gutterWidth =                G.tn.opt.Get('gutterWidth'),\r\n      gutterHeight =               G.tn.opt.Get('gutterHeight');\r\n      // by grief-of-these-days\r\n      var maxRowHeightVertical =   0; // max height of a row with vertical thumbs\r\n      var maxRowHeightHorizontal = 0; // max height of a row with horizontal thumbs\r\n      var rowHasVertical =         false; // current row has vertical thumbs\r\n      var rowHasHorizontal =       false; // current row has horizontal thumbs\r\n\r\n      var tnHeight = G.tn.defaultSize.getOuterHeight();\r\n      var borderWidth = G.tn.borderWidth * 2;\r\n      var borderHeight = G.tn.borderHeight * 2;\r\n      var nbTnInCurrRow = 1;\r\n      var nbTn = G.GOM.items.length;\r\n\r\n      // first loop --> retrieve each row image height\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.deleted == true ) { break; }    // item is logically deleted\r\n        if( curTn.imageWidth > 0 ) {\r\n          var imageRatio = curTn.imageWidth / curTn.imageHeight;\r\n          var imageWidth = Math.floor( tnHeight * imageRatio );\r\n\r\n          if( bNewRow ) {\r\n            bNewRow = false;\r\n            rowNum++;\r\n            curWidth = 0;\r\n            rowHasVertical = false;\r\n            rowHasHorizontal = false;\r\n            nbTnInCurrRow = 1;\r\n          }\r\n          // by grief-of-these-days\r\n          if( curTn.imageHeight > curTn.imageWidth ) {\r\n            rowHasVertical = true;\r\n          }\r\n          else {\r\n            rowHasHorizontal = true;\r\n          }\r\n          \r\n          if( (curWidth + gutterWidth + imageWidth) < (areaWidth - (nbTnInCurrRow * borderWidth)) ) {\r\n            // enough place left in the current row\r\n            curWidth += imageWidth + gutterWidth;\r\n            rowHeight[rowNum] = tnHeight;\r\n            \r\n            // prevent incomplete row from being heigher than the previous ones.\r\n            // by grief-of-these-days\r\n            var rowHeightLimit = Math.max(rowHasVertical ? maxRowHeightVertical : 0, rowHasHorizontal ? maxRowHeightHorizontal : 0);\r\n            if( rowHeightLimit > 0 ) {\r\n              rowHeight[rowNum] = Math.min(rowHeight[rowNum], rowHeightLimit);\r\n            }\r\n            \r\n            rowLastItem[rowNum] = i;\r\n          }\r\n          else {\r\n            // new row after current item --> we need to adujet the row height to have enough space for the current thumbnail\r\n            curWidth += gutterWidth+imageWidth;\r\n            var ratio = (areaWidth - nbTnInCurrRow * borderWidth) / curWidth;\r\n            var rH = Math.floor(tnHeight * ratio);\r\n            rowHeight[rowNum] = rH;\r\n            \r\n            // save the max row height for each thumb orientation.\r\n            // by grief-of-these-days\r\n            if( rowHasVertical ) {\r\n              maxRowHeightVertical = Math.max( maxRowHeightVertical, rH );\r\n            }\r\n            if( rowHasHorizontal ) {\r\n              maxRowHeightHorizontal = Math.max( maxRowHeightHorizontal, rH );\r\n            }\r\n            \r\n            rowLastItem[rowNum] = i;\r\n            bNewRow = true;\r\n          }\r\n          cnt++;\r\n          nbTnInCurrRow++;\r\n        }\r\n      }\r\n\r\n      rowNum = 0;\r\n      curPosY = 0;\r\n      lastPosX = 0;\r\n      cnt = 0;\r\n      \r\n      G.GOM.lastFullRow = 0;    // display at leat 1 row (even if not full)\r\n      \r\n      // second loop --> calculate each thumbnail size\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.imageWidth > 0 ) {\r\n          var imageRatio = curTn.imageWidth / curTn.imageHeight;\r\n          var imageWidth = Math.floor( imageRatio * rowHeight[rowNum] ); // border is already NOT included\r\n\r\n          if( i == rowLastItem[rowNum] ) {\r\n            // row last item --> adjust image width because of rounding problems\r\n            if( rowLastItem.length != (rowNum+1) ) {\r\n              // last item in current row -> use the full remaining width\r\n              imageWidth = areaWidth - lastPosX - borderWidth;\r\n            }\r\n            else {\r\n              // very last item (on the last row)\r\n              if( (lastPosX + gutterWidth + imageWidth + borderWidth ) > areaWidth ) {\r\n                // reduce size if image is wider as the remaining space\r\n                imageWidth = areaWidth - lastPosX - borderWidth;\r\n              }\r\n            }\r\n          }\r\n          \r\n          var rh = parseInt( rowHeight[rowNum] );\r\n          imageWidth = parseInt( imageWidth );\r\n\r\n          // thumbnail image size\r\n          curTn.resizedContentWidth = imageWidth;\r\n          curTn.resizedContentHeight = rh;\r\n          // thumbnail position and size\r\n          curTn.width = imageWidth + borderWidth;\r\n          curTn.height= rh + G.tn.labelHeight.get() + borderHeight;\r\n          curTn.row = rowNum;\r\n\r\n          curTn.top = curPosY;\r\n          var x = lastPosX;\r\n          if( G.O.RTL) {\r\n            x = areaWidth - lastPosX - curTn.width ;\r\n          }\r\n          curTn.left = x;\r\n\r\n          lastPosX += curTn.width + gutterWidth;\r\n\r\n          if( i == rowLastItem[rowNum] ) {\r\n            // start a new row\r\n            curPosY += curTn.height + gutterHeight;\r\n            G.GOM.lastFullRow = rowNum - 1;\r\n            rowNum++;\r\n            lastPosX = 0;\r\n          }\r\n          cnt++;\r\n        }\r\n        else {\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      if( false ) {\r\n        var newTop = 0;\r\n        if( typeof GOMidx !== 'undefined' ) {\r\n          // hover effect on gallery (vs on thumbnail) --> experimental / not used\r\n          if( G.GOM.albumIdx != -1 ) {\r\n            var hoveredTn = G.GOM.items[GOMidx];\r\n            var item = G.I[hoveredTn.thumbnailIdx];\r\n            \r\n            // hovered thumbnail\r\n            hoveredTn.width += 40;\r\n            hoveredTn.height += 40;\r\n            // todo : left\r\n            \r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.imageWidth > 0 ) {\r\n                if( curTn.row == hoveredTn.row ) {\r\n                  // hovered row\r\n                  newTop = 40;\r\n                  if( hoveredTn.thumbnailIdx != curTn.thumbnailIdx ) {\r\n                    // not hovered thumbnail\r\n                    // curTn.resizedContentWidth+=10;\r\n                    // curTn.resizedContentHeight+=20;\r\n                    // curTn.width+=10;\r\n                    curTn.top += 30;\r\n                    curTn.width -= 20;\r\n                    curTn.height -= 20;\r\n                  }\r\n                }\r\n                else {\r\n                  // not hovered row\r\n                  if( curTn.row == 0 ) {\r\n                    // first row\r\n                  }\r\n                  else {\r\n                    curTn.top += newTop;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      G.GOM.displayArea.width = areaWidth;\r\n      return true;\r\n    }    \r\n    \r\n\r\n    //----- MOSAIC LAYOUT\r\n    // Grid using a user defined pattern layout\r\n    // With this layout, a pattern definition is handeld a row\r\n    function GallerySetLayoutMosaic() {\r\n      var areaWidth =     G.GOM.cache.areaWidth;\r\n      var gutterHeight =  G.tn.opt.Get('gutterHeight');\r\n      var gutterWidth =   G.tn.opt.Get('gutterWidth');\r\n      var borderWidth =   G.tn.borderWidth * 2;\r\n      var borderHeight =  G.tn.borderHeight * 2;\r\n\r\n      var nbTn = G.GOM.items.length;\r\n      var row = 0;\r\n      var h = 0;\r\n      var n = 0;\r\n      \r\n      \r\n      // first loop: evaluate the gallery width based on the first row\r\n      var nbCols = 0;\r\n      var maxW = 0;\r\n      var mosaicPattern = G.tn.settings.getMosaic();\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curPatternElt = mosaicPattern[n];\r\n\r\n        var cLeft = (curPatternElt.c - 1) * G.tn.defaultSize.getOuterWidth() + (curPatternElt.c - 1) * gutterWidth;\r\n        var cWidth = curPatternElt.w * G.tn.defaultSize.getOuterWidth() + (curPatternElt.w - 1) * gutterWidth;\r\n        \r\n        maxW=Math.max(maxW, cLeft + cWidth );\r\n        \r\n        nbCols=Math.max(nbCols, (curPatternElt.c - 1) + curPatternElt.w );\r\n\r\n        n++;\r\n        if( n >= mosaicPattern.length ) {\r\n          // end of pattern\r\n          break;\r\n        }\r\n      }\r\n      var totalGutterWidth = (nbCols - 1) * gutterWidth;\r\n      var scaleFactor = Math.min( (areaWidth - totalGutterWidth ) / ( maxW - totalGutterWidth ), 1);\r\n      \r\n      // second loop: position all the thumbnails based on the layout pattern\r\n      row = 0;\r\n      n = 0;\r\n      var mosaicPattern = G.tn.settings.getMosaic();\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        var curPatternElt = mosaicPattern[n];\r\n        \r\n        curTn.top = (curPatternElt.r - 1) * G.tn.defaultSize.getOuterHeight()*scaleFactor + (curPatternElt.r - 1) * gutterHeight + row * h + (G.tn.labelHeight.get()*(curPatternElt.r-1)) ;\r\n        if( row > 0 ) {\r\n          curTn.top += gutterHeight;\r\n        }\r\n\r\n        curTn.left = (curPatternElt.c - 1) * G.tn.defaultSize.getOuterWidth()*scaleFactor + (curPatternElt.c - 1) * gutterWidth;\r\n\r\n        curTn.height = curPatternElt.h * G.tn.defaultSize.getOuterHeight() * scaleFactor + (curPatternElt.h - 1) * gutterHeight + (G.tn.labelHeight.get() * curPatternElt.h);\r\n        curTn.resizedContentHeight = curTn.height - G.tn.labelHeight.get() - borderHeight;\r\n\r\n        curTn.width = curPatternElt.w * G.tn.defaultSize.getOuterWidth()*scaleFactor + (curPatternElt.w - 1) * gutterWidth;\r\n        curTn.resizedContentWidth = curTn.width - borderWidth ;\r\n\r\n        curTn.row = row;\r\n        if( row == 0 ) {\r\n          h=Math.max(h, curTn.top + curTn.height);\r\n        }\r\n\r\n        n++;\r\n        if( n >= mosaicPattern.length ) {\r\n          // end pattern -> new line\r\n          n = 0;\r\n          row++;\r\n        }\r\n      }\r\n      \r\n      G.GOM.displayArea.width = (maxW - totalGutterWidth) * scaleFactor + totalGutterWidth;\r\n      return true;\r\n    }\r\n    \r\n    \r\n    \r\n    // --- GRID LAYOUT\r\n    function GallerySetLayoutGrid() {\r\n      var curPosX=      0,\r\n      curPosY=          0,   \r\n      areaWidth=        G.GOM.cache.areaWidth,\r\n      gutterWidth=      0,\r\n      gutterHeight=     G.tn.opt.Get('gutterHeight'),\r\n      maxCol=           NbThumbnailsPerRow(areaWidth),\r\n      w=                0,\r\n      cols=             [],\r\n      curCol=           0,\r\n      newAreaWidth =    areaWidth,\r\n      tnWidth=          G.tn.defaultSize.getOuterWidth();\r\n      var scaleFactor = 1;\r\n      var nbTn=         G.GOM.items.length;\r\n      var borderWidth = G.tn.borderWidth * 2;\r\n      var borderHeight =G.tn.borderHeight * 2;\r\n      \r\n      // retrieve gutter width\r\n      if( G.O.thumbnailAlignment == 'justified' ) {\r\n        maxCol = Math.min( maxCol, nbTn);\r\n        gutterWidth = (maxCol==1 ? 0 : (areaWidth-(maxCol*tnWidth))/(maxCol-1));\r\n      }\r\n      else {\r\n        gutterWidth = G.tn.opt.Get('gutterWidth');\r\n      }\r\n\r\n      // first loop to retrieve the real used width of the area (the evaluation is based on the content of the first line)\r\n      // Retrieve the real used width of the area (the evaluation is based on the content of the first line)\r\n      if( G.O.RTL || G.O.thumbnailAlignment == 'fillWidth' ) {\r\n        // scaled --> evaluate scale factor and number of columns\r\n        var totalGutterWidth = (maxCol-1) * gutterWidth;\r\n        scaleFactor = (areaWidth - totalGutterWidth) / (maxCol*tnWidth);\r\n        if( scaleFactor > 1 ) {\r\n          maxCol++; // add one column and re-evaluate the scale factor\r\n        }\r\n        totalGutterWidth = (maxCol-1) * gutterWidth;\r\n        scaleFactor = Math.min( (areaWidth - totalGutterWidth) / (maxCol*tnWidth), 1);   // no upscale\r\n        newAreaWidth = (maxCol*tnWidth) + totalGutterWidth;\r\n      }\r\n\r\n      \r\n      G.GOM.lastFullRow = 0 ;    // display at leat 1 row (even if not full)\r\n      var lastPosY = 0;\r\n      var row = 0;\r\n      \r\n      tnWidth = tnWidth * scaleFactor;\r\n      var contentWidth = tnWidth - borderWidth;\r\n      var tnHeight = G.tn.defaultSize.getOuterHeight() * scaleFactor + G.tn.labelHeight.get();\r\n      var contentHeight = G.tn.defaultSize.getOuterHeight() * scaleFactor - borderHeight;\r\n      \r\n      // loop to position and to set size of all thumbnails\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        if( curPosY == 0 ) {\r\n          curPosX = curCol * (tnWidth + gutterWidth)\r\n          cols[curCol] = curPosX;\r\n          w = curPosX + tnWidth;\r\n        }\r\n        else {\r\n          curPosX = cols[curCol];\r\n        }\r\n\r\n        var x = curPosX;\r\n        if( G.O.RTL ) {\r\n          x = parseInt(newAreaWidth) - curPosX - tnWidth;\r\n        }\r\n        \r\n        // MANDATORY : set thumbnail position AND size\r\n        var curTn=G.GOM.items[i];\r\n        curTn.top = curPosY;\r\n        curTn.left = x;\r\n        curTn.height = tnHeight;\r\n        curTn.width = tnWidth;\r\n        // image size\r\n        if( G.O.thumbnailAlignment == 'fillWidth' ) {\r\n          curTn.resizedContentWidth = contentWidth;\r\n          curTn.resizedContentHeight = contentHeight;\r\n        }\r\n        curTn.row = row;\r\n        lastPosY = curPosY;\r\n\r\n        curCol++;\r\n        if( curCol >= maxCol ){\r\n          // new line\r\n          curCol = 0;\r\n          curPosY += tnHeight + gutterHeight;\r\n          G.GOM.lastFullRow = row;\r\n          row++;\r\n        }\r\n      }\r\n      G.GOM.displayArea.width = w;\r\n      return true;\r\n    }\r\n\r\n\r\n    //----- Display the thumbnails according to the calculated layout\r\n    function GalleryDisplayPart1( forceTransition ) {\r\n      if( G.CSStransformName == null ) {\r\n        G.$E.conTn.css( 'left' , '0px');\r\n      }\r\n      else {\r\n        G.$E.conTn.css( G.CSStransformName , 'none');\r\n      }\r\n      CacheViewport();\r\n    }\r\n    \r\n    function CacheViewport() {\r\n      G.GOM.cache.viewport = getViewport();\r\n      G.GOM.cache.areaWidth = G.$E.conTnParent.width();\r\n      G.GOM.cache.containerOffset = G.$E.conTnParent.offset();\r\n    }\r\n\r\n\r\n    \r\n    function GalleryDisplayPart2( forceTransition ) {\r\n\r\n      var nbTn = G.GOM.items.length;\r\n      G.GOM.itemsDisplayed = 0;\r\n      var threshold = 50;\r\n      var cnt = 0;    // counter for delay between each thumbnail display\r\n      \r\n\r\n      GalleryRenderGetInterval();\r\n      \r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( i >= G.GOM.displayInterval.from && cnt < G.GOM.displayInterval.len ) {\r\n          curTn.inDisplayArea = true;\r\n          if( forceTransition ) {\r\n            curTn.neverDisplayed = true;\r\n          }\r\n          G.GOM.itemsDisplayed++;\r\n          cnt++;\r\n        }\r\n        else{\r\n          curTn.inDisplayArea = false;\r\n        }\r\n      }\r\n\r\n      // bottom of the gallery (pagination, more button...)\r\n      GalleryBottomManage();\r\n\r\n      var tnToDisplay = [];\r\n      var tnToReDisplay = [];\r\n      \r\n      G.GOM.clipArea.top = -1;\r\n      cnt = 0 ;\r\n      var lastTnIdx = -1;\r\n      G.GOM.clipArea.height = 0;\r\n      // NOTE: loop always the whole GOM.items --> in case an already displayed thumbnail needs to be removed\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.inDisplayArea ) {\r\n          if( G.GOM.clipArea.top == -1 ) {\r\n            G.GOM.clipArea.top = curTn.top;\r\n          }\r\n          if( (curTn.top - G.GOM.clipArea.top) <= -1 ) {\r\n            // with mosaic layout, the first thumbnail may not give the top position\r\n            G.GOM.clipArea.top = curTn.top;\r\n          }\r\n\r\n          G.GOM.clipArea.height = Math.max( G.GOM.clipArea.height, curTn.top-G.GOM.clipArea.top + curTn.height);\r\n        \r\n          if( curTn.neverDisplayed ) {\r\n            // thumbnail is not displayed -> check if in viewport to display or not\r\n            var top = G.GOM.cache.containerOffset.top + (curTn.top - G.GOM.clipArea.top);\r\n            // var left=containerOffset.left+curTn.left;\r\n            if( (top + curTn.height) >= (G.GOM.cache.viewport.t - threshold) && top <= (G.GOM.cache.viewport.t + G.GOM.cache.viewport.h + threshold) ) {\r\n              // build thumbnail\r\n              var item = G.I[curTn.thumbnailIdx];\r\n              if( item.$elt == null ) {\r\n                ThumbnailBuild( item, curTn.thumbnailIdx, i, (i+1) == nbTn );\r\n              }\r\n              tnToDisplay.push({idx:i, delay:cnt});\r\n              cnt++;\r\n            }\r\n          }\r\n          else {\r\n            tnToReDisplay.push({idx: i, delay: 0});\r\n          }\r\n          // G.GOM.itemsDisplayed++;\r\n          lastTnIdx = i;\r\n        }\r\n        else {\r\n          curTn.displayed = false;\r\n          var item = G.I[curTn.thumbnailIdx];\r\n          if( item.$elt != null ){\r\n            item.$elt.css({ opacity: 0, display: 'none' });\r\n          }\r\n        }\r\n      }\r\n\r\n      var areaWidth = G.$E.conTnParent.width();\r\n\r\n      // set gallery area really used size\r\n      // if( G.GOM.displayArea.width != G.GOM.displayAreaLast.width || G.GOM.displayArea.height != G.GOM.displayAreaLast.height ) {\r\n      if( G.GOM.displayArea.width != G.GOM.displayAreaLast.width || G.GOM.clipArea.height != G.GOM.displayAreaLast.height ) {\r\n        G.$E.conTn.width( G.GOM.displayArea.width ).height( G.GOM.clipArea.height );\r\n        G.GOM.displayAreaLast.width = G.GOM.displayArea.width;\r\n        G.GOM.displayAreaLast.height = G.GOM.clipArea.height;\r\n        // G.GOM.displayAreaLast.height=G.GOM.displayArea.height-G.GOM.clipArea.top;\r\n      }\r\n\r\n      if( areaWidth != G.$E.conTnParent.width() ) {\r\n        // gallery area width changed since layout calculation (for example when a scrollbar appeared)\r\n        // so we need re-calculate the layout before displaying the thumbnails\r\n        G.GOM.cache.areaWidth = G.$E.conTnParent.width();\r\n        GallerySetLayout();\r\n        GalleryDisplayPart1( forceTransition );\r\n        GalleryDisplayPart2( forceTransition );\r\n        return;\r\n      }\r\n\r\n      // counter of not displayed images (is displayed on the last thumbnail)\r\n      if( G.layout.support.rows ) {\r\n        if( G.galleryDisplayMode.Get() == 'ROWS' || (G.galleryDisplayMode.Get() == 'FULLCONTENT' && G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1) ){\r\n          if( lastTnIdx < (nbTn - 1) ) {\r\n            G.GOM.lastDisplayedIdxNew = lastTnIdx;\r\n          }\r\n          else {\r\n            G.GOM.lastDisplayedIdxNew =- 1;\r\n          }\r\n          // remove last displayed counter\r\n          if( G.GOM.lastDisplayedIdx != -1 ) {\r\n            var item = G.I[G.GOM.items[G.GOM.lastDisplayedIdx].thumbnailIdx];\r\n            item.$getElt('.nGY2GThumbnailIconsFullThumbnail').html('');\r\n          }\r\n        }\r\n      }\r\n\r\n      \r\n      // batch set position (and display animation) to all thumbnails\r\n      // first display newly built thumbnails\r\n      var nbBuild = tnToDisplay.length;\r\n      G.GOM.thumbnails2Display=[];\r\n      for( var i = 0; i < nbBuild ; i++ ) {\r\n        // ThumbnailSetPosition(tnToDisplay[i].idx, tnToDisplay[i].delay+10);\r\n        ThumbnailSetPosition(tnToDisplay[i].idx, i);\r\n      }\r\n      \r\n      // then re-position already displayed thumbnails\r\n      var n = tnToReDisplay.length;\r\n      for( var i = 0; i < n ; i++ ) {\r\n        // ThumbnailSetPosition(tnToReDisplay[i].idx, nbBuild+1);\r\n        ThumbnailSetPosition(tnToReDisplay[i].idx, i);\r\n      }\r\n      \r\n      ThumbnailDisplayAnimBatch();\r\n\r\n      if( G.tn.opt.Get('displayTransition') == 'NONE' ) {\r\n        G.galleryResizeEventEnabled = true;\r\n        // GalleryThumbnailSliderBuildAndStart();  // image slider on last displayed thumbnail\r\n        TriggerCustomEvent('galleryDisplayed');\r\n      }\r\n      else {\r\n        // setTimeout(function() {\r\n        requestTimeout( function() {\r\n          // change value after the end of the display transistion of the newly built thumbnails\r\n          G.galleryResizeEventEnabled = true;\r\n          // GalleryThumbnailSliderBuildAndStart();  // image slider on last displayed thumbnail\r\n          TriggerCustomEvent('galleryDisplayed');\r\n        }, nbBuild * G.tn.opt.Get('displayInterval'));\r\n      }\r\n      \r\n    }\r\n    \r\n    \r\n    // Thumbnail: set the new position\r\n    function ThumbnailSetPosition( GOMidx, cnt ) {\r\n      var newTop=   0;\r\n      var curTn=    G.GOM.items[GOMidx];\r\n      var idx=      G.GOM.items[GOMidx].thumbnailIdx;\r\n      var item=     G.I[idx];\r\n    \r\n      if( curTn.neverDisplayed ) {\r\n        // thumbnail is built but has never been displayed (=first display)\r\n        var top = curTn.top - G.GOM.clipArea.top;\r\n        if( G.tn.opt.Get('stacks') > 0 ) {\r\n          // we have stacks -> do not display them here. They will be displayed at the end of the display animation\r\n          item.$elt.last().css({ display: 'block'});\r\n          item.$elt.css({ top: top , left: curTn.left });\r\n        }\r\n        else {\r\n          item.$elt.css({ display: 'block', top: top , left: curTn.left });\r\n        }\r\n        newTop=top;\r\n        \r\n        // display the image of the thumbnail when fully loaded\r\n        if( G.O.thumbnailWaitImageLoaded === true ) {\r\n          var gi_imgLoad = ngimagesLoaded( item.$getElt('.nGY2TnImg2') );\r\n          gi_imgLoad.on( 'progress', function( instance, image ) {\r\n            if( image.isLoaded ) {\r\n              var albumIdx = image.img.getAttribute('data-albumidx');\r\n              if( albumIdx == G.GOM.albumIdx ) {\r\n                // ignore event if not on current album\r\n                var idx = image.img.getAttribute('data-idx');\r\n                G.I[idx].ThumbnailImageReveal();\r\n              }\r\n            }\r\n          });\r\n        }\r\n        // display the thumbnail\r\n        ThumbnailAppear(GOMidx, cnt);\r\n\r\n        curTn.displayed = true;\r\n        curTn.neverDisplayed = false;\r\n      }\r\n      else {\r\n        var topOld = G.GOM.cache.containerOffset.top + item.top;\r\n        var top = G.GOM.cache.containerOffset.top + (curTn.top - G.GOM.clipArea.top);\r\n        newTop = curTn.top - G.GOM.clipArea.top;\r\n        var vp = G.GOM.cache.viewport;\r\n        if( G.O.thumbnailDisplayOutsideScreen || ( ( (topOld + curTn.height) >= (vp.t - vp.h) && topOld <= (vp.t + vp.h * 4) ) ||\r\n              ( (top + curTn.height) >= (vp.t - vp.h) && top <= (vp.t + vp.h * 4) ) )  ) {\r\n          // thumbnail positioned in enlarged viewport (viewport + 4 x viewport height) (v1.5: changed from 2 to 4)\r\n          if( curTn.displayed ) {\r\n            // thumbnail is displayed\r\n            if( item.top != curTn.top || item.left != curTn.left ) {\r\n              // set position\r\n              if( G.O.galleryResizeAnimation == true ) {\r\n                // with transition\r\n                var tweenable = new NGTweenable();\r\n                tweenable.tween({\r\n                  from:       { top: item.top, left: item.left,  height: item.height,  width: item.width },\r\n                  to:         { top: newTop,   left: curTn.left, height: curTn.height, width: curTn.width },\r\n                  attachment: { $e: item.$elt },\r\n                  duration:   100,\r\n                  delay:      cnt * G.tn.opt.Get('displayInterval') / 5,\r\n                  // easing:     'easeInOutQuad',\r\n                  easing:     'easeOutQuart',\r\n                  step:       function (state, att) {\r\n                    // window.ng_draf( function() {\r\n                      att.$e.css(state);\r\n                    // });\r\n                  },\r\n                  finish:     function (state, att) {\r\n                    var _this=this;\r\n                    // window.ng_draf( function() {\r\n                      _this.dispose();\r\n                    // });\r\n                  }\r\n                });\r\n              }\r\n              else {\r\n                // set position without transition\r\n                // item.$elt.css({ top: curTn.top , left: curTn.left });\r\n                item.$elt.css({ top: newTop , left: curTn.left });\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            // re-display thumbnail\r\n            curTn.displayed = true;\r\n            // item.$elt.css({ display: 'block', top: curTn.top , left: curTn.left, opacity:1 });\r\n            item.$elt.css({ display: 'block', top: newTop, left: curTn.left, opacity: 1 });\r\n            ThumbnailAppearFinish(item);\r\n          }\r\n        }\r\n        else {\r\n          // undisplay thumbnail if not in viewport+margin --> performance gain\r\n          curTn.displayed = false;\r\n          item.$elt.css({ display: 'none'});\r\n        }\r\n      }\r\n      item.left = curTn.left;\r\n      item.top = newTop;\r\n      \r\n      // set new size if changed\r\n      if( item.width != curTn.width || item.height != curTn.height ) {\r\n        item.$elt.css({ width: curTn.width , height: curTn.height });\r\n        item.width = curTn.width;\r\n        item.height = curTn.height;\r\n        \r\n        // if( curTn.resizedContentWidth > 0 ) {\r\n        // resize also the content (=image)\r\n        if( item.resizedContentWidth != curTn.resizedContentWidth || item.resizedContentHeight != curTn.resizedContentHeight ) {\r\n          if( item.kind == 'albumUp' ) {\r\n            // item.$getElt('.nGY2GThumbnailAlbumUp').css({'height': curTn.resizedContentHeight, 'width': curTn.resizedContentWidth});\r\n          }\r\n          else {\r\n            item.$getElt('.nGY2GThumbnailImage').css({'height': curTn.resizedContentHeight, 'width': curTn.resizedContentWidth});\r\n\r\n            if( G.layout.engine == 'JUSTIFIED'  ) {\r\n              item.$getElt('.nGY2GThumbnailImg').css({'height': curTn.resizedContentHeight, 'width': curTn.resizedContentWidth});\r\n            }\r\n          }\r\n          item.resizedContentWidth = curTn.resizedContentWidth;\r\n          item.resizedContentHeight = curTn.resizedContentHeight;\r\n        }\r\n      }\r\n      \r\n      \r\n      // add counter of remaining (not displayed) images \r\n      if( G.GOM.lastDisplayedIdxNew == GOMidx &&  G.layout.support.rows ) {\r\n        if( (G.galleryDisplayMode.Get() == 'ROWS' && G.galleryMaxRows.Get() > 0) || (G.galleryDisplayMode.Get() == 'FULLCONTENT' && G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1) ){\r\n          // number of items\r\n          var nb = G.GOM.items.length - GOMidx - 1;\r\n          if( item.albumID != '0' && G.O.thumbnailLevelUp ) {\r\n            nb--;\r\n          }\r\n\r\n          if( nb > 0 ) {\r\n            // display counter\r\n            if( G.O.thumbnailOpenImage || G.O.thumbnailSliderDelay > 0  ) {\r\n              item.$getElt('.nGY2GThumbnailIconsFullThumbnail').html( '+' + nb);\r\n            }\r\n\r\n            // if( G.layout.engine == 'GRID' && G.GOM.slider.hostItem != G.GOM.NGY2Item(GOMidx) ) {\r\n            // image slider on last displayed thumbnail\r\n            if( G.GOM.slider.hostItem != G.GOM.NGY2Item(GOMidx) ) {\r\n\r\n              // set current slider back to initial content\r\n              GalleryThumbnailSliderSetContent( G.GOM.slider.hostItem );\r\n              // new slider\r\n              G.GOM.slider.hostIdx = GOMidx;\r\n              G.GOM.slider.hostItem = G.GOM.NGY2Item(GOMidx);\r\n              G.GOM.slider.nextIdx = GOMidx;\r\n              G.GOM.slider.currentIdx = GOMidx;\r\n              GalleryThumbnailSliderBuildAndStart();  // image slider on last displayed thumbnail\r\n              // GalleryThumbnailSliderSetNextContent();\r\n            }\r\n          }\r\n          else {\r\n            // reset slider content to initial content because all thumbnails are displayed\r\n            GalleryThumbnailSliderSetContent( G.GOM.slider.hostItem );\r\n            G.GOM.slider.hostIdx = -1;\r\n          }\r\n          \r\n          G.GOM.lastDisplayedIdx = GOMidx;\r\n        }\r\n      }\r\n\r\n    }\r\n    \r\n    // ---------------------\r\n    // replace image on last thumbnails with not displayed ones (mode ROWS or FULLCONTENT with galleryLastRowFull enabled)\r\n    // function GalleryLastThumbnailSlideImage() {\r\n    function GalleryThumbnailSliderBuildAndStart() {\r\n\r\n      if( G.O.thumbnailSliderDelay == 0 || G.GOM.slider.hostIdx == -1 ) {\r\n        return;\r\n      }\r\n      clearTimeout(G.GOM.slider.timerID);\r\n      \r\n      var item = G.GOM.slider.hostItem;\r\n\r\n      // dupplicate image layer -> for the next image\r\n      if( item.$getElt('.nGY2TnImgNext').length == 0 ) {\r\n        item.$getElt('.nGY2TnImg').clone().removeClass('nGY2TnImg').addClass('nGY2TnImgNext').insertAfter(item.$getElt('.nGY2TnImg'));\r\n        item.$getElt('.nGY2TnImgBack').clone().removeClass('nGY2TnImgBack').addClass('nGY2TnImgBackNext').insertAfter(item.$getElt('.nGY2TnImg', true));\r\n        item.$getElt('.nGY2GThumbnailImage', true); // important -> refresh the cache\r\n        item.$getElt('.nGY2GThumbnailImg', true);   // important -> refresh the cache\r\n      }\r\n\r\n      item.CSSTransformSet('.nGY2TnImgNext', 'translateX', '100%', true);\r\n      item.CSSTransformApply( '.nGY2TnImgNext' );\r\n      item.CSSTransformSet('.nGY2TnImgBackNext', 'translateX', '100%', true);\r\n      item.CSSTransformApply( '.nGY2TnImgBackNext' );\r\n\r\n      GalleryThumbnailSliderSetNextContent();\r\n      \r\n      // clearTimeout(G.GOM.slider.timerID);\r\n      // G.GOM.slider.timerID = setTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n      G.GOM.slider.timerID = requestTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n    }\r\n\r\n    \r\n    function GalleryThumbnailSliderSetNextContent() {\r\n\r\n      G.GOM.slider.nextIdx++;\r\n      if( G.GOM.slider.nextIdx >= G.GOM.items.length ) {\r\n        G.GOM.slider.nextIdx = G.GOM.slider.hostIdx;\r\n      }\r\n      \r\n      // new image\r\n      var newItem = G.GOM.NGY2Item(G.GOM.slider.nextIdx);\r\n      var imgBlurred = G.emptyGif;\r\n      var bgImg = \"url('\" + G.emptyGif + \"')\";\r\n      if( newItem.imageDominantColors != null ) {\r\n        imgBlurred = newItem.imageDominantColors;\r\n        bgImg = \"url('\" + newItem.imageDominantColors + \"')\";\r\n      }\r\n      G.GOM.slider.hostItem.$getElt('.nGY2TnImgBackNext', true).css({'background-image': bgImg, opacity: 1 });\r\n      G.GOM.slider.hostItem.$getElt('.nGY2TnImgNext', true).css({ 'background-image': \"url('\" + newItem.thumbImg().src + \"')\", opacity: 1 });\r\n      G.GOM.slider.hostItem.$getElt('.nGY2TnImgNext .nGY2GThumbnailImg', true).attr('src', newItem.thumbImg().src );\r\n      \r\n\r\n    }\r\n    \r\n    // thumbnail slider - transition from one image to the next one\r\n    function GalleryThumbnailSliderStartTransition() {\r\n      \r\n      if( G.GOM.slider.hostItem.$getElt() != null ) {\r\n\r\n        // slider transition\r\n        var tweenable = new NGTweenable();\r\n        G.GOM.slider.tween = tweenable;\r\n        tweenable.tween({\r\n          from:         { 'left': 100 },\r\n          to:           { 'left': 0 },\r\n          duration:     800,\r\n          delay:        0,\r\n          // easing:       'easeInOutQuad',\r\n          easing:       'easeOutQuart',\r\n          \r\n          step: function (state) {\r\n            if( G.GOM.slider.hostItem.$getElt() == null ) {\r\n              // the thumbnail may have been destroyed since the start of the animation\r\n              G.GOM.slider.tween.stop(false);\r\n              return;\r\n            }\r\n\r\n            // window.ng_draf( function() {\r\n              // slide current content\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBack', 'translateX', -(100 - state.left) + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBack' );\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImg', 'translateX', -(100 - state.left) + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImg' );\r\n\r\n              // slide new content\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBackNext', 'translateX', state.left + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBackNext' );\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgNext', 'translateX', state.left + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgNext' );\r\n            // });\r\n\r\n            \r\n          },\r\n          finish: function (state) {\r\n            if( G.GOM.slider.hostItem.$getElt() == null ) {\r\n              // the thumbnail may be destroyed since the start of the animation\r\n              return;\r\n            }\r\n           \r\n            if( G.GOM.NGY2Item(G.GOM.slider.nextIdx) == null ) { return; } // item does not exist anymore\r\n            \r\n            // window.ng_draf( function() {\r\n              // set new content as current content\r\n              GalleryThumbnailSliderSetContent( G.GOM.NGY2Item(G.GOM.slider.nextIdx) );\r\n              G.GOM.slider.currentIdx = G.GOM.slider.nextIdx;\r\n              GalleryThumbnailSliderSetNextContent();\r\n              \r\n              clearTimeout(G.GOM.slider.timerID);\r\n              // G.GOM.slider.timerID=setTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n              G.GOM.slider.timerID = requestTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n            // });\r\n          }\r\n        });\r\n      }\r\n    }\r\n    \r\n    // set main content of the thumbnail hosting the slider\r\n    // hide the elements for the next content of the slider\r\n    function GalleryThumbnailSliderSetContent( ngy2itemContent ) {\r\n        if( G.GOM.slider.hostIdx == -1 ) { return; }\r\n        \r\n        if( G.GOM.slider.tween != null ) {\r\n          if( G.GOM.slider.tween._isTweening  == true ) {\r\n            G.GOM.slider.tween.stop(false);\r\n          }\r\n        }\r\n\r\n        var bgImg = \"url('\" + G.emptyGif + \"')\";\r\n        if( ngy2itemContent.imageDominantColors != null ) {\r\n          bgImg = \"url('\" + ngy2itemContent.imageDominantColors + \"')\";\r\n        }\r\n        G.GOM.slider.hostItem.$getElt('.nGY2TnImgBack').css('background-image', bgImg);\r\n        G.GOM.slider.hostItem.$getElt('.nGY2TnImg').css('background-image', \"url('\" + ngy2itemContent.thumbImg().src + \"')\" );\r\n        G.GOM.slider.hostItem.$getElt('.nGY2TnImg .nGY2GThumbnailImg').attr('src', ngy2itemContent.thumbImg().src );\r\n        \r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBack', 'translateX', '0');\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBack' );\r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImg', 'translateX', '0');\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImg' );\r\n\r\n        // place the containers for the next image slider outside of the thumbnail (=hidden)\r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBackNext', 'translateX', '100%', true);\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBackNext' );\r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgNext', 'translateX', '100%', true);\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgNext' );\r\n\r\n        // set new title and description\r\n        if( G.O.thumbnailLabel.get('display') == true ) {\r\n          var icons = G.O.icons.thumbnailAlbum;\r\n          if( ngy2itemContent.kind != 'album' ) {\r\n            icons = G.O.icons.thumbnailImage;\r\n          }\r\n          G.GOM.slider.hostItem.$getElt('.nGY2GThumbnailTitle').html(icons + getThumbnailTitle(ngy2itemContent));\r\n          G.GOM.slider.hostItem.$getElt('.nGY2GThumbnailDescription').html(icons + getTumbnailDescription(ngy2itemContent));\r\n        }\r\n      }\r\n    \r\n   \r\n    \r\n    // Compute the height of the label part of a thumbnail (title+description, both single line)\r\n    function ThumbnailGetLabelHeight() {\r\n      var newElt = [],\r\n      newEltIdx =  0;\r\n\r\n      // if( G.O.thumbnailLabel.get('display') == false && G.tn.toolbar.getWidth(item) <= 0 ) {\r\n      if( G.O.thumbnailLabel.get('display') == false  ) {\r\n        return 0;\r\n      }\r\n      \r\n      var desc='';\r\n      if( G.O.thumbnailLabel.get('displayDescription') == true ) {\r\n        desc = 'aAzZjJ';\r\n      }\r\n\r\n      // visibility set to hidden\r\n      newElt[newEltIdx++] = '<div class=\"nGY2GThumbnail ' + G.O.theme + '\" style=\"display:block;visibility:hidden;position:absolute;top:-9999px;left:-9999px;\" ><div class=\"nGY2GThumbnailSub\">';\r\n      if( G.O.thumbnailLabel.get('display') == true ) {\r\n        // Labels: title and description\r\n        newElt[newEltIdx++] = '  <div class=\"nGY2GThumbnailLabel\" '+ G.tn.style.getLabel() +'>';\r\n        newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailAlbumTitle\" '+G.tn.style.getTitle()+'>aAzZjJ</div>';\r\n        if( G.O.thumbnailLabel.get('displayDescription') == true ) {\r\n          newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailDescription\" '+G.tn.style.getDesc()+'>'+'aAzZjJ'+'</div>';\r\n        }\r\n        newElt[newEltIdx++] = '  </div>';\r\n      }\r\n      \r\n      newElt[newEltIdx++] = '</div></div>';\r\n    \r\n      var $newDiv = jQuery(newElt.join('')).appendTo(G.$E.conTn);\r\n      var h = $newDiv.find('.nGY2GThumbnailLabel').outerHeight(true);\r\n      $newDiv.remove();\r\n\r\n      return h;\r\n    }\r\n    \r\n    function ThumbnailBuildStacks( bgColor ) {\r\n      var ns=G.tn.opt.Get('stacks');\r\n      if( ns == 0 ) { return ''; }\r\n     \r\n      var s='';\r\n      for( var i=0; i<ns; i++ ) {\r\n        s='<div class=\"nGY2GThumbnailStack \" style=\"display:none;'+bgColor+'\"></div>'+s;\r\n      }\r\n      return s;\r\n    }\r\n    \r\n    //----- Build one UP thumbnail (=navigation thumbnail)\r\n    function ThumbnailBuildAlbumpUp( item, idx, GOMidx ) {\r\n      var newElt = [],\r\n      newEltIdx = 0;\r\n      \r\n      var mp = '';\r\n      if( G.O.thumbnailOpenImage === false ) {\r\n        mp = 'cursor:default;'\r\n      }\r\n      \r\n      newElt[newEltIdx++] = ThumbnailBuildStacks('') + '<div class=\"nGY2GThumbnail\" style=\"display:none;opacity:0;' + mp + '\" >';\r\n      newElt[newEltIdx++] = '  <div class=\"nGY2GThumbnailSub\">';\r\n\r\n      var h=G.tn.defaultSize.getHeight(),\r\n      w=G.tn.defaultSize.getWidth();\r\n\r\n      newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailImage\" style=\"width:'+w+'px;height:'+h+'px;\"><img class=\"nGY2GThumbnailImg\" src=\"'+G.emptyGif+'\" alt=\"\" style=\"max-width:'+w+'px;max-height:'+h+'px;\" ></div>';\r\n      // newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailAlbumUp\" style=\"width:'+w+'px;height:'+h+'px;\">'+G.O.icons.thumbnailAlbumUp+'</div>';\r\n      newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailAlbumUp\" >'+G.O.icons.thumbnailAlbumUp+'</div>';\r\n      newElt[newEltIdx++] = '  </div>';\r\n      newElt[newEltIdx++] = '</div>';\r\n      \r\n      var $newDiv = jQuery(newElt.join('')).appendTo(G.$E.conTn); //.animate({ opacity: 1},1000, 'swing');  //.show('slow'); //.fadeIn('slow').slideDown('slow');\r\n      \r\n      item.$elt = $newDiv;\r\n      $newDiv.data('index', GOMidx);\r\n      item.$getElt('.nGY2GThumbnailImg').data('index', GOMidx);\r\n      \r\n      return;\r\n    }\r\n\r\n    \r\n    //----- Build one thumbnail\r\n    function ThumbnailBuild( item, idx, GOMidx, lastOne ) {\r\n      item.eltTransform =  [];\r\n      item.eltFilter =     [];\r\n      item.hoverInitDone = false;\r\n      item.$Elts =         [];\r\n\r\n      if( item.kind == 'albumUp' ) {\r\n        ThumbnailBuildAlbumpUp( item, idx, GOMidx);\r\n        return;\r\n      }\r\n\r\n      var newElt = [],\r\n      newEltIdx = 0;\r\n\r\n      var mp = '';\r\n      if( G.O.thumbnailOpenImage === false ) {\r\n        mp = 'cursor:default;'\r\n      }\r\n\r\n      // var src = encodeURI(item.thumbImg().src),\r\n      var src = (item.thumbImg().src).replace(/'/g, \"%27\"),   // replace single quote with %27\r\n      sTitle = getThumbnailTitle(item);\r\n\r\n      // image background -> visible during image download\r\n      var bg = '';\r\n      var bgImg = \"background-image: url('\" + G.emptyGif + \"');\";\r\n      if( item.imageDominantColors != null ) {\r\n        // dominant colorS (blurred preview image)\r\n        bgImg = \"background-image: url('\" + item.imageDominantColors + \"');\";\r\n      }\r\n      else {\r\n        // dominant color -> background color\r\n        if( item.imageDominantColor != null ) {\r\n          bg = 'background-color:' + item.imageDominantColor + ';';\r\n        }\r\n        else {\r\n          bgImg = '';\r\n        }\r\n      }\r\n\r\n      var op = 'opacity:1;';\r\n      if( G.O.thumbnailWaitImageLoaded == true ) {\r\n        op = 'opacity:0;';\r\n      }\r\n\r\n      // ##### thumbnail containers  (with stacks)\r\n      newElt[newEltIdx++] = ThumbnailBuildStacks(bg) + '<div class=\"nGY2GThumbnail\" style=\"display:none;opacity:0;' + mp + '\"><div class=\"nGY2GThumbnailSub ' + ( G.O.thumbnailSelectable && item.selected ? \"nGY2GThumbnailSubSelected\" : \"\" ) + '\">';\r\n\r\n      \r\n      // image size\r\n      var w = G.tn.settings.getW();\r\n      var h = G.tn.settings.getH();\r\n      if( G.tn.settings.getMosaic() !== null ) {\r\n        // mosaic layout -> \r\n        w = G.GOM.items[GOMidx].width;\r\n        h = G.GOM.items[GOMidx].height;\r\n      }\r\n\r\n      var bgSize = 'contain';\r\n      if( G.tn.opt.Get('crop') ) {\r\n        bgSize = 'cover';\r\n      }\r\n      \r\n      // ##### layer for image background (color, dominant color, blurred preview)\r\n      var s1 = \"position: absolute; top: 0px; left: 0px; width:\" + w + \"px; height:\" + h + \"px;\"+ bg + bgImg + \" background-position: center center;  background-repeat: no-repeat; background-size:\" + bgSize + \"; overflow: hidden;\";\r\n      newElt[newEltIdx++]='<div class=\"nGY2GThumbnailImage nGY2TnImgBack\" style=\"' + s1 + '\"></div>';\r\n      \r\n      // #### layer for image \r\n      var s2 = op + \"position: absolute; top: 0px; left: 0px; width:\" + w + \"px; height:\" + h + \"px; background-image: url('\" + src + \"'); background-position: center center; background-repeat: no-repeat; background-size:\" + bgSize + \"; overflow: hidden;\";\r\n      newElt[newEltIdx++]='<div class=\"nGY2GThumbnailImage nGY2TnImg\" style=\"' + s2 + '\">';\r\n      newElt[newEltIdx++]='  <img class=\"nGY2GThumbnailImg nGY2TnImg2\" src=\"' + src + '\" alt=\"' + sTitle + '\" style=\"opacity:0;\" data-idx=\"' + idx + '\" data-albumidx=\"' + G.GOM.albumIdx + '\" >';\r\n      newElt[newEltIdx++]='</div>';\r\n      \r\n      // ##### layer for user customization purposes\r\n      newElt[newEltIdx++]='<div class=\"nGY2GThumbnailCustomLayer\"></div>';\r\n\r\n      // ##### layer for labels (title + description and their icons)\r\n      if( G.O.thumbnailLabel.get('display') == true ) {\r\n        // Labels: title and description\r\n        newElt[newEltIdx++]= '  <div class=\"nGY2GThumbnailLabel\" '+ G.tn.style.getLabel(item) + '>';\r\n        if( item.kind == 'album' ) {\r\n          // album kind\r\n          newElt[newEltIdx++]= '    <div class=\"nGY2GThumbnailTitle nGY2GThumbnailAlbumTitle\" ' + G.tn.style.getTitle() + '>' + G.O.icons.thumbnailAlbum + sTitle + '</div>';\r\n        }\r\n        else {\r\n          // image/media kind\r\n          newElt[newEltIdx++]= '    <div class=\"nGY2GThumbnailTitle nGY2GThumbnailImageTitle\" ' + G.tn.style.getTitle() + '>' + G.O.icons.thumbnailImage + sTitle + '</div>';\r\n        }\r\n        newElt[newEltIdx++]= '    <div class=\"nGY2GThumbnailDescription\" ' + G.tn.style.getDesc() + '>' + getTumbnailDescription(item) + '</div>';\r\n        newElt[newEltIdx++]= '  </div>';\r\n      }\r\n\r\n      // ##### layer for tools\r\n      newElt[newEltIdx++] = ThumbnailBuildTools(item, lastOne);\r\n      \r\n      // close containers\r\n      newElt[newEltIdx++]='</div></div>';\r\n      \r\n      var $newDiv =jQuery(newElt.join('')).appendTo(G.$E.conTn);\r\n\r\n      item.$elt=$newDiv;\r\n      $newDiv.data('index',GOMidx);\r\n      item.$getElt('.nGY2GThumbnailImg').data('index',GOMidx);\r\n      \r\n      // Custom init function\r\n      var fu=G.O.fnThumbnailInit;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu($newDiv, item, GOMidx) : window[fu]($newDiv, item, GOMidx);\r\n      }\r\n\r\n      if( item.title != 'image gallery by nanogallery2 [build]' ) {\r\n        ThumbnailOverInit(GOMidx);\r\n      }\r\n      \r\n      return ;\r\n    }\r\n\r\n    \r\n    // Thumbnail layer for tools (toolbars and counter)\r\n    function ThumbnailBuildTools( item, lastThumbnail ) {\r\n    \r\n      // toolbars\r\n      var tb = ThumbnailBuildToolbarOne(item, 'topLeft') + ThumbnailBuildToolbarOne(item, 'topRight') + ThumbnailBuildToolbarOne(item, 'bottomLeft') + ThumbnailBuildToolbarOne(item, 'bottomRight');\r\n      \r\n      // counter of not displayed images\r\n      tb += '<div class=\"nGY2GThumbnailIconsFullThumbnail\"></div>';\r\n\r\n      return tb;\r\n    }\r\n    \r\n    function ThumbnailBuildToolbarOne( item, position ) {\r\n      var toolbar = '';\r\n      var tb =      G.tn.toolbar.get(item);\r\n      var width =   { xs:0, sm:1, me:2, la:3, xl:4 };\r\n      var cnt =     0;\r\n      \r\n      if( tb[position] != '' ) {\r\n        var pos='top: 0; right: 0; text-align: right;';     // 'topRight' and default\r\n        switch( position ) {\r\n          case 'topLeft':\r\n            pos = 'top: 0; left: 0; text-align: left;';\r\n            break;\r\n          case 'bottomRight':\r\n            pos = 'bottom: 0; right: 0; text-align: right;';\r\n            break;\r\n          case 'bottomLeft':\r\n            pos = 'bottom: 0; left: 0; text-align: left;';\r\n            break;\r\n        }\r\n        \r\n        toolbar += '  <ul class=\"nGY2GThumbnailIcons\" style=\"' + pos + '\">';\r\n        \r\n        var icons = tb[position].split(',');\r\n        var nb = icons.length;\r\n        for( var i = 0; i < nb; i++ ) {\r\n          var icon = icons[i].replace(/^\\s*|\\s*$/, '');   //trim trailing/leading whitespace\r\n\r\n          var minWidth = icon.substring(0,2).toLowerCase();\r\n          var tIcon = icon;\r\n          var display = true;\r\n          if( /xs|sm|me|la|xl/i.test(minWidth) ) {\r\n            // check visbility (depending on screen width)\r\n            if( width[minWidth] > width[G.GOM.curWidth] ) {\r\n              display = false;\r\n            }\r\n            tIcon = icon.substring(2);\r\n          }\r\n          \r\n          if( display ) {\r\n            var sp=(i+1<nb ? '&nbsp;' :'');\r\n            switch( tIcon ) {\r\n              case 'COUNTER':\r\n                if( item.kind == 'album' ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"\">';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconImageCounter\"></div>';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconText\">' + G.O.icons.thumbnailCounter+Math.max((item.getContentLength(false)),item.numberItems) + sp + '</div>';\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n              case 'COUNTER2':\r\n                if( item.kind == 'album' ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"\">';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconTextBadge\">' + G.O.icons.thumbnailCounter+Math.max((item.getContentLength(false)),item.numberItems) + sp + '</div>';\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n              case 'SHARE':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailShare + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'DOWNLOAD':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailDownload + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'INFO':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailInfo + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'CART':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailCart + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'DISPLAY':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"DISPLAY\">';\r\n                toolbar += '      <div class=\"nGY2GThumbnailIconImageShare\">' + G.O.icons.thumbnailDisplay + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'CUSTOM1':\r\n              case 'CUSTOM2':\r\n              case 'CUSTOM3':\r\n              case 'CUSTOM4':\r\n              case 'CUSTOM5':\r\n              case 'CUSTOM6':\r\n              case 'CUSTOM7':\r\n              case 'CUSTOM8':\r\n              case 'CUSTOM9':\r\n              case 'CUSTOM10':\r\n                var cust = tIcon.replace('CUSTOM', '');\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon.toLowerCase() + '\">';\r\n                toolbar += '      <div class=\"nGY2GThumbnailIconImageShare\">' + G.O.icons['thumbnailCustomTool' + cust] + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'FEATURED':\r\n                if( item.featured === true ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"\">';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconImageFeatured\">' + G.O.icons.thumbnailFeatured + '</div>';\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n              case 'SELECT':\r\n                if( G.O.thumbnailSelectable == true ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"TOGGLESELECT\">';\r\n                  if( item.selected === true ) {\r\n                    toolbar += '      <div class=\"nGY2GThumbnailIconImageSelect nGY2ThumbnailSelected\">' + G.O.icons.thumbnailSelected + '</div>';\r\n                  }\r\n                  else {\r\n                    toolbar += '      <div class=\"nGY2GThumbnailIconImageSelect nGY2ThumbnailUnselected\">' + G.O.icons.thumbnailUnselected + '</div>';\r\n                  }\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n            }\r\n          }\r\n        }\r\n        toolbar += '  </ul>';\r\n      }\r\n      \r\n      if( cnt > 0 ) {\r\n        return toolbar;\r\n      }\r\n      else {\r\n        return '';\r\n      }\r\n    }\r\n    \r\n    function getThumbnailTitle( item ) {\r\n    \r\n      var sTitle = item.title;\r\n      if( G.O.thumbnailLabel.get('display') == true ) {\r\n        if( sTitle === undefined || sTitle.length == 0 ) { sTitle = '&nbsp;'; }\r\n\r\n        if( G.i18nTranslations.thumbnailImageTitle != '' ) {\r\n          sTitle = G.i18nTranslations.thumbnailImageTitle;\r\n        }\r\n        var ml = G.O.thumbnailLabel.get('titleMaxLength');\r\n        if( ml > 3 && sTitle.length > ml ){\r\n          sTitle = sTitle.substring(0, ml) + '...';\r\n        }\r\n      }\r\n      \r\n      return sTitle;\r\n    }\r\n\r\n    function getTumbnailDescription( item ) {\r\n      var sDesc = '';\r\n      if( G.O.thumbnailLabel.get('displayDescription') == true ) { \r\n        if( item.kind == 'album' ) {\r\n          if( G.i18nTranslations.thumbnailImageDescription != '' ) {\r\n            sDesc = G.i18nTranslations.thumbnailAlbumDescription;\r\n          }\r\n          else {\r\n            sDesc = item.description;\r\n          }\r\n        }\r\n        else {\r\n          if( G.i18nTranslations.thumbnailImageDescription != '' ) {\r\n            sDesc = G.i18nTranslations.thumbnailImageDescription;\r\n          }\r\n          else {\r\n            sDesc = item.description;\r\n          }\r\n        }\r\n        var ml = G.O.thumbnailLabel.get('descriptionMaxLength');\r\n        if( ml > 3 && sDesc.length > ml ){\r\n          sDesc = sDesc.substring(0, ml) + '...';\r\n        }\r\n        if( sDesc.length == 0 ) {\r\n          sDesc = '&nbsp;';\r\n        }\r\n      }\r\n      \r\n      return sDesc;\r\n    }\r\n\r\n    \r\n    \r\n    // Retrieve the maximum number of thumbnails that fits in one row\r\n    function NbThumbnailsPerRow( areaWidth ) {\r\n      var tnW = G.tn.defaultSize.getOuterWidth();\r\n      \r\n      var nbMaxTn = 0;\r\n      if( G.O.thumbnailAlignment == 'justified' ) {\r\n        nbMaxTn = Math.floor((areaWidth)/(tnW));\r\n      }\r\n      else {\r\n        nbMaxTn = Math.floor((areaWidth + G.tn.opt.Get('gutterWidth'))/(tnW + G.tn.opt.Get('gutterWidth')));\r\n      }\r\n      \r\n      if(  G.O.maxItemsPerLine >0 && nbMaxTn >  G.O.maxItemsPerLine ) {\r\n        nbMaxTn = G.O.maxItemsPerLine;\r\n      }\r\n      \r\n      if( nbMaxTn < 1 ) { nbMaxTn = 1; }\r\n      \r\n      return nbMaxTn\r\n    }\r\n  \r\n    // Thumbnail display animation\r\n    function ThumbnailAppear( n, cnt ) {\r\n      var curTn = G.GOM.items[n];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n\r\n    \r\n      if( G.tn.opt.Get('displayTransition') == 'NONE' ) {\r\n        item.$elt.css({ opacity: 1 });\r\n        ThumbnailAppearFinish( item );\r\n      }\r\n      else {\r\n        if( item.$elt == null ) { return; }\r\n        var top = G.GOM.cache.containerOffset.top + ( curTn.top - G.GOM.clipArea.top );\r\n        var vp = G.GOM.cache.viewport;\r\n        if( (top + (curTn.top - G.GOM.clipArea.top)) >= (vp.t - 50) && top <= (vp.t + vp.h + 50) ) {\r\n          // display animation only if in the current viewport\r\n          var delay = cnt * G.tn.opt.Get('displayInterval');\r\n          if( G.tn.opt.Get('displayTransition') == 'CUSTOM' ) {\r\n            if( G.GOM.curNavLevel == 'lN' ) {\r\n              G.O.fnThumbnailDisplayEffect(item.$elt, item, n, delay);\r\n            }\r\n            else {\r\n              G.O.fnThumbnailL1DisplayEffect(item.$elt, item, n, delay);\r\n            }\r\n          }\r\n          else {\r\n            G.GOM.thumbnails2Display.push({itm: item, d: delay});\r\n            // ThumbnailDisplayAnim2(item, delay);\r\n          }\r\n          return;\r\n        }\r\n        else {\r\n          item.$elt.css({ opacity: 1 });\r\n          ThumbnailAppearFinish(item);\r\n        }\r\n      }\r\n    }\r\n    \r\n    \r\n    // displays thumbnail stacks at the end of the display animation\r\n    function ThumbnailAppearFinish( item ) {\r\n    \r\n      // add stacks\r\n      var ns = G.tn.opt.Get('stacks');\r\n      if( ns > 0 ) {\r\n        // display stacks\r\n        item.$elt.css({ display: 'block'});\r\n        var o = 0.9;\r\n        // set stack opacity\r\n        for( var i = ns-1; i>=0; i-- ) {\r\n          item.$elt.eq(i).css('opacity', o);\r\n          o = o - 0.2;\r\n        }\r\n\r\n      }\r\n    }\r\n    \r\n\r\n    function ThumbnailDisplayAnim2( item, delay ) {\r\n      function randomIntFromInterval(min,max) {\r\n        return Math.floor(Math.random()*(max-min+1)+min);\r\n      }\r\n      var oFrom = {};\r\n      var oTo = {};\r\n    \r\n      switch (G.tn.opt.Get('displayTransition')) {\r\n        case 'RANDOMSCALE':\r\n          var scales = [0.95, 1, 1.05, 1.1];\r\n          var zi = [1, 2, 3, 4];\r\n          \r\n          var r = randomIntFromInterval(0,3);\r\n          while( r == G.GOM.lastRandomValue ) {\r\n            r = randomIntFromInterval(0,3);\r\n          }\r\n          G.GOM.lastRandomValue = r;\r\n          var f = scales[r];\r\n          // item.$elt.css({ 'z-index': G.GOM.lastZIndex+zi[r], 'box-shadow': '-1px 2px 5px 1px rgba(0, 0, 0, 0.7)' });\r\n          item.$elt.css({ 'z-index': G.GOM.lastZIndex+zi[r], 'box-shadow': '0px 0px 5px 3px rgba(0,0,0,0.74)' });\r\n          \r\n          oFrom = { scale: 0.5, opacity:0 };\r\n          oTo =   { scale: f,   opacity:1 };\r\n          break;\r\n\r\n        case 'SCALEUP':\r\n          var f = G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f = 0.6; }   // default value\r\n          oFrom = { scale: f, opacity: 0 };\r\n          oTo =   { scale: 1, opacity: 1 };\r\n          break;\r\n\r\n        case 'SCALEDOWN':\r\n          var f = G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=1.3; }   // default value\r\n          oFrom = { scale: f, opacity: 0 };\r\n          oTo =   { scale: 1, opacity: 1 };\r\n          break;\r\n        case 'SLIDEUP':\r\n          var f = G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=50; }   // default value\r\n          oFrom = { opacity: 0, translateY: f };\r\n          oTo =   { opacity: 1, translateY: 0 };\r\n          break;\r\n        case 'SLIDEDOWN':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-50; }   // default value\r\n          oFrom = { opacity: 0, translateY: f };\r\n          oTo =   { opacity: 1, translateY: 0 };\r\n          break;\r\n        case 'FLIPUP':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateX: 45 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateX: 0  };\r\n          break;\r\n          \r\n        case 'FLIPDOWN':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateX: -45 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateX: 0 };\r\n          break;\r\n        case 'SLIDEUP2':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateY: 40 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateY: 0  };\r\n          break;\r\n        case 'SLIDEDOWN2':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateY: 40 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateY: 0  };\r\n          break;\r\n        case 'SLIDERIGHT':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-150; }   // default value\r\n          oFrom = { opacity: 0, translateX: f };\r\n          oTo =   { opacity: 1, translateX: 0 };\r\n          break;\r\n\r\n        case 'SLIDELEFT':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=150; }   // default value\r\n          oFrom = { opacity: 0, translateX: f };\r\n          oTo =   { opacity: 1, translateX: 0 };\r\n          break;\r\n          \r\n        case 'FADEIN':\r\n          oFrom = { opacity: 0 };\r\n          oTo =   { opacity: 1 };\r\n          break;\r\n          \r\n          \r\n      }\r\n    \r\n      var tweenable = new NGTweenable();\r\n      tweenable.tween({\r\n        from:         oFrom,\r\n        to:           oTo,\r\n        attachment:   { $e:item.$elt, item: item, tw: tweenable },\r\n        delay:        delay,\r\n        duration:     G.tn.opt.Get('displayTransitionDuration'),\r\n        easing:       G.tn.opt.Get('displayTransitionEasing'),\r\n        step:         function (state, att) {\r\n          window.requestAnimationFrame( function() {\r\n            if( att.item.$elt === null ) {  // the thumbnail may have been destroyed since the start of the animation\r\n              att.tw.stop(false);\r\n              return;\r\n            }\r\n            switch (G.tn.opt.Get('displayTransition')) {\r\n              case 'RANDOMSCALE':\r\n                att.$e.css( G.CSStransformName , 'scale(' + state.scale + ')').css('opacity', state.opacity);\r\n                break;\r\n              case 'SCALEUP':\r\n                att.$e.css( G.CSStransformName , 'scale('+state.scale+')').css('opacity',state.opacity);\r\n                break;\r\n              case 'SCALEDOWN':\r\n                att.item.$elt.last().css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'scale', state.scale);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEUP':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px, '+state.translateY + 'px');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEDOWN':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,'+state.translateY+'px');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'FLIPUP':\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,'+state.translateY+'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateX', state.rotateX+'deg');\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'FLIPDOWN':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,' + state.translateY + 'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateX', state.rotateX + 'deg');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEUP2':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,' + state.translateY + 'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateY', state.rotateY + 'deg');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEDOWN2':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px, ' + state.translateY + 'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateY', state.rotateY + 'deg');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDERIGHT':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', state.translateX + 'px, 0px');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDELEFT':\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', state.translateX + 'px, 0px');\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'FADEIN':\r\n                att.$e.css(state);\r\n                break;\r\n            }\r\n          });\r\n          // att.$e.css( G.CSStransformName , 'scale('+state.scale+')').css('opacity',state.opacity);\r\n        },\r\n        finish:       function (state, att) {\r\n          window.requestAnimationFrame( function() {\r\n            if( att.item.$elt === null ) { return; }\r\n            \r\n            switch (G.tn.opt.Get('displayTransition')) {\r\n              case 'RANDOMSCALE':\r\n                att.$e.css( G.CSStransformName , 'scale('+state.scale+')').css('opacity', '');\r\n                break;\r\n              case 'SCALEUP':\r\n                att.$e.css( G.CSStransformName , '').css('opacity', '');\r\n                break;\r\n              case 'SCALEDOWN':\r\n                att.item.$elt.last().css('opacity', '');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'scale', state.scale);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEUP':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDEDOWN':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'FLIPUP':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'FLIPDOWN':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDEUP2':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDEDOWN2':\r\n                att.item.$elt.css('opacity', '');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDERIGHT':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDELEFT':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'FADEIN':\r\n                att.$e.css('opacity', '');\r\n                break;\r\n            }\r\n            ThumbnailAppearFinish(att.item);\r\n          });\r\n\r\n        }\r\n      });\r\n    \r\n    }\r\n    \r\n    // batch display thumbnails with animation\r\n    function ThumbnailDisplayAnimBatch() {\r\n      \r\n      G.GOM.thumbnails2Display.forEach( function(one) {\r\n        ThumbnailDisplayAnim2(one.itm, one.d);\r\n      });\r\n      G.GOM.thumbnails2Display=[];\r\n    }\r\n    \r\n    \r\n\r\n    // ######################################\r\n    // Gallery display animation\r\n    function GalleryAppear() {\r\n      \r\n      var d=G.galleryDisplayTransitionDuration.Get();\r\n      switch( G.galleryDisplayTransition.Get() ){\r\n        case 'ROTATEX':\r\n          G.$E.base.css({ perspective: '1000px', 'perspective-origin': '50% 0%' });\r\n          var tweenable = new NGTweenable();\r\n          tweenable.tween({\r\n            from:         { r: 50 },\r\n            to:           { r: 0  },\r\n            attachment:   { orgIdx: G.GOM.albumIdx },\r\n            duration:     d,\r\n            easing:       'easeOutCirc',\r\n            step:         function (state, att) {\r\n              if( att.orgIdx == G.GOM.albumIdx ) {\r\n                // window.ng_draf( function() {\r\n                  G.$E.conTnParent.css( G.CSStransformName , 'rotateX(' + state.r + 'deg)');\r\n                // });\r\n              }\r\n            }\r\n          });\r\n          break;\r\n        case 'SLIDEUP':\r\n          G.$E.conTnParent.css({ opacity: 0 });\r\n          var tweenable = new NGTweenable();\r\n          tweenable.tween({\r\n            from:         { y: 200, o: 0 },\r\n            to:           { y: 0,   o: 1 },\r\n            attachment:   { orgIdx: G.GOM.albumIdx },\r\n            duration:     d,\r\n            easing:       'easeOutCirc',\r\n            step:         function (state, att) {\r\n              if( att.orgIdx == G.GOM.albumIdx ) {\r\n                // window.ng_draf( function() {\r\n                  G.$E.conTnParent.css( G.CSStransformName , 'translate( 0px, '+state.y + 'px)').css('opacity', state.o);\r\n                // });\r\n              }\r\n            }\r\n          });\r\n          break;\r\n        case 'NONE':\r\n        default:\r\n          break;\r\n      }\r\n\r\n\r\n    }\r\n    \r\n    // ######################################\r\n    // ##### THUMBNAIL HOVER MANAGEMENT #####\r\n    // ######################################\r\n\r\n    function ThumbnailOverInit( GOMidx ) {\r\n      // Over init in 2 step:\r\n      // 1) init with thumbnailBuildInit2 parameter\r\n      // 2) init with the hover effect parameter\r\n      \r\n      \r\n      var curTn = G.GOM.items[GOMidx];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n\r\n      if( item.$elt == null ) { return; } // zombie\r\n      \r\n      var fu = G.O.fnThumbnailHoverInit;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu($e, item, GOMidx) : window[fu]($e, item, GOMidx);\r\n      }\r\n\r\n      // build initialization\r\n      var inits = G.tn.buildInit.get();\n      for( var j = 0; j < inits.length; j++) {\r\n        switch( inits[j].property ) {\r\n          // CSS Transform\r\n          case 'scale':\r\n          case 'rotateX':\r\n          case 'rotateY':\r\n          case 'rotateZ':\r\n          case 'translateX':\r\n          case 'translateY':\r\n          case 'translateZ':\r\n            item.CSSTransformSet(inits[j].element, inits[j].property, inits[j].value);\r\n            item.CSSTransformApply(inits[j].element);\r\n            break;\r\n          // CSS filter\r\n          case 'blur':\r\n          case 'brightness':\r\n          case 'grayscale':\r\n          case 'sepia':\n          case 'contrast':\n          case 'opacity':\n          case 'saturate':\r\n            item.CSSFilterSet(inits[j].element, inits[j].property, inits[j].value);\r\n            item.CSSFilterApply(inits[j].element);\r\n            break;\r\n          default:\r\n            var $t=item.$getElt(inits[j].element);\r\n            $t.css( inits[j].property, inits[j].value );\r\n            break;\r\n        }\r\n      }\r\n      \r\n      // hover\r\n      var effects = G.tn.hoverEffects.get();\n      for( var j = 0; j < effects.length; j++) {\r\n        if( effects[j].firstKeyframe === true ) {\r\n          switch( effects[j].type ) {\r\n            case 'scale':\r\n            case 'rotateX':\r\n            case 'rotateY':\r\n            case 'rotateZ':\r\n            case 'translateX':\r\n            case 'translateY':\r\n            case 'translateZ':\r\n              item.CSSTransformSet(effects[j].element, effects[j].type, effects[j].from);\r\n              item.CSSTransformApply(effects[j].element);\r\n              break;\r\n            case 'blur':\r\n            case 'brightness':\r\n            case 'grayscale':\r\n            case 'sepia':\r\n            case 'contrast':\n            case 'opacity':\n            case 'saturate':\n              item.CSSFilterSet(effects[j].element, effects[j].type, effects[j].from);\r\n              item.CSSFilterApply(effects[j].element);\r\n              break;\r\n            default:\r\n              var $t = item.$getElt(effects[j].element);\r\n              $t.css( effects[j].type, effects[j].from );\r\n              break;\r\n              \r\n          }\r\n        }\r\n      }\r\n      item.hoverInitDone=true;\r\n    }\r\n\r\n    function ThumbnailHoverReInitAll() {\r\n      if( G.GOM.albumIdx == -1 ) { return; };\r\n      var l = G.GOM.items.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        ThumbnailOverInit(i);\r\n        // G.GOM.items[i].hovered=false;\r\n        G.I[G.GOM.items[i].thumbnailIdx].hovered = false;\r\n      }\r\n    }\r\n\r\n\r\n    function ThumbnailHover( GOMidx ) {\r\n      if( G.GOM.albumIdx == -1 || !G.galleryResizeEventEnabled ) { return; };\r\n      if( G.GOM.slider.hostIdx == GOMidx ) {\r\n        // slider hosted on thumbnail -> no hover effect\r\n        return;\r\n      }\r\n      var curTn = G.GOM.items[GOMidx];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n      if( item.kind == 'albumUp' || item.$elt == null ) { return; }\r\n\r\n      item.hovered = true;\r\n\r\n      var fu = G.O.fnThumbnailHover;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item, GOMidx) : window[fu](item.$elt, item, GOMidx);\r\n      }\r\n      var effects = G.tn.hoverEffects.get();\r\n\r\n      try {\r\n        for( var j = 0; j < effects.length; j++) {\r\n          if( effects[j].hoverin === true ) {\r\n            //item.animate( effects[j], j*10,  true );\r\n            item.animate( effects[j], 0,  true );\r\n          }\r\n        }\r\n        // effects on whole layout\r\n        // GalleryResize( GOMidx );\r\n      }\r\n      catch (e) { \r\n        NanoAlert(G, 'error on hover: ' + e.message );\r\n      }\r\n\r\n    }\r\n\r\n    function ThumbnailHoverOutAll() {\r\n      if( G.GOM.albumIdx == -1 ) { return; };\r\n      var l = G.GOM.items.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        if( G.GOM.items[i].inDisplayArea ) {\r\n          ThumbnailHoverOut(i);\r\n        }\r\n        else {\r\n          G.I[G.GOM.items[i].thumbnailIdx].hovered = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    \r\n    function ThumbnailHoverOut( GOMidx ) {\r\n      if( G.GOM.albumIdx == -1 || !G.galleryResizeEventEnabled ) { return; }\r\n\r\n      if( G.GOM.slider.hostIdx == GOMidx ) {\r\n        // slider on thumbnail -> no hover effect\r\n        return;\r\n      }\r\n\r\n      var curTn = G.GOM.items[GOMidx];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n      if( item.kind == 'albumUp' || !item.hovered ) { return; }\r\n      item.hovered = false;\r\n      if( item.$elt == null ) { return; }\r\n\r\n      var fu = G.O.fnThumbnailHoverOut;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item, GOMidx) : window[fu](item.$elt, item, GOMidx);\r\n      }\r\n\r\n      var effects = G.tn.hoverEffects.get();\r\n      try {\r\n        for( var j = 0; j < effects.length; j++) {\r\n          if( effects[j].hoverout === true ) {\r\n            // item.animate( effects[j], j*10, false );\r\n            item.animate( effects[j], 0, false );\r\n          }\r\n        }\r\n        // effects on whole layout\r\n        // GalleryResize( );\r\n      }\r\n      catch (e) { \r\n        NanoAlert(G, 'error on hoverOut: ' + e.message );\r\n      }\r\n      \r\n    }\r\n    \r\n\r\n    /** @function DisplayPhoto */\r\n    function DisplayPhoto( imageID, albumID ) {\r\n\r\n      if( G.O.debugMode ) { console.log('#DisplayPhoto : '+  albumID +'-'+ imageID); }\r\n      var albumIdx = NGY2Item.GetIdx(G, albumID);\r\n      if( albumIdx == 0 ) {\r\n        G.GOM.curNavLevel = 'l1';\r\n      }\r\n      else {\r\n        G.GOM.curNavLevel = 'lN';\r\n      }\r\n\r\n      if( albumIdx == -1 ) {\r\n        // get content of album on root level\r\n        if( G.O.kind != '' ) {\r\n          // do not add album if Markup or Javascript data\r\n          NGY2Item.New( G, '', '', albumID, '0', 'album' );    // create empty album\r\n          albumIdx = G.I.length - 1;\r\n        }\r\n      }\r\n\r\n      var ngy2ItemIdx = NGY2Item.GetIdx(G, imageID);\r\n      if( ngy2ItemIdx == -1 ) {\r\n        // get content of the album\r\n        AlbumGetContent( albumID, DisplayPhoto, imageID, albumID );\r\n        return;\r\n      }\r\n      \r\n      if( G.O.debugMode ) { console.log('#DisplayPhoto : '+  ngy2ItemIdx); }\r\n     \r\n      DisplayPhotoIdx(ngy2ItemIdx);\r\n    \r\n    }\r\n\r\n\r\n    // BETA -> NOT finished and not used at this time\r\n    // Retrieve the title+description of ONE album\r\n    function albumGetInfo( albumIdx, fnToCall ) {\r\n      var url =   '';\r\n      var kind =  'image';\r\n      \r\n      switch( G.O.kind ) {\r\n        case 'json':\r\n          // TODO\r\n        case 'flickr':\r\n          // TODO\r\n        case 'picasa':\r\n        case 'google':\r\n        case 'google2':\r\n        default:\r\n          url = G.Google.url() + 'user/'+G.O.userID+'/albumid/'+G.I[albumIdx].GetID()+'?alt=json&&max-results=1&fields=title';\r\n          break;\r\n      }\r\n\r\n      jQuery.ajaxSetup({ cache: false });\r\n      jQuery.support.cors = true;\r\n      \r\n      var tId = setTimeout( function() {\r\n        // workaround to handle JSONP (cross-domain) errors\r\n        //PreloaderHide();\r\n        NanoAlert(G, 'Could not retrieve AJAX data...');\r\n      }, 60000 );\r\n      jQuery.getJSON(url, function(data, status, xhr) {\r\n        clearTimeout(tId);\r\n        //PreloaderHide();\r\n        \r\n        fnToCall( G.I[albumIdx].GetID() );\r\n\r\n      })\r\n      .fail( function(jqxhr, textStatus, error) {\r\n        clearTimeout(tId);\r\n        //PreloaderHide();\r\n        var err = textStatus + ', ' + error;\r\n        NanoAlert('Could not retrieve ajax data: ' + err);\r\n      });      \r\n    \r\n    }\r\n\r\n    \r\n    // function AlbumGetContent( albumIdx, fnToCall ) {\r\n    function AlbumGetContent( albumID, fnToCall, fnParam1, fnParam2 ) {\r\n      // var url='';\r\n      // var kind='image';\r\n      // var albumIdx=NGY2Item.GetIdx(G, albumID);\r\n      // var photoIdx=NGY2Item.GetIdx(G, photoID);\r\n      \r\n      switch( G.O.kind ) {\r\n        // MARKUP / API\r\n        case '':\r\n          AlbumGetMarkupOrApi(fnToCall, fnParam1, fnParam2);\r\n          break;\r\n        // JSON, Flickr, Picasa, ...\r\n        default:\r\n          jQuery.nanogallery2['data_'+G.O.kind](G, 'AlbumGetContent', albumID, fnToCall, fnParam1, fnParam2 );\r\n      }\r\n      \r\n    }\r\n    \r\n    var mediaList = {\r\n      youtube : {\r\n        getID: function( url ) {\r\n          // https://stackoverflow.com/questions/10591547/how-to-get-youtube-video-id-from-url\r\n          var s = url.match( /(?:https?:\\/{2})?(?:w{3}\\.)?youtu(?:be)?\\.(?:com|be)(?:\\/watch\\?v=|\\/)([^\\s&]+)/ );\r\n          return s != null ? s[1] : null;\r\n        },\r\n        thumbUrl: function( id ) {\r\n          return 'https://img.youtube.com/vi/' + id + '/hqdefault.jpg';\r\n        },\r\n        url: function( id ) {\r\n          return 'https://www.youtube.com/embed/' + id;\r\n        },\r\n        markup: function( id ) {\r\n          // return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.youtube.com/embed/' + id + '?rel=0\" frameborder=\"0\" gesture=\"media\" allowfullscreen></iframe>';\r\n          return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.youtube.com/embed/' + id + '?rel=0\" frameborder=\"0\" allow=\"autoplay\" allowfullscreen></iframe>';\r\n        },\r\n        kind: 'iframe'\r\n      },\r\n      vimeo : {\r\n        getID: function( url ) {\r\n          // https://stackoverflow.com/questions/2916544/parsing-a-vimeo-id-using-javascript\r\n          var s = url.match( /^.*(vimeo\\.com\\/)((channels\\/[A-z]+\\/)|(groups\\/[A-z]+\\/videos\\/))?([0-9]+)/ );\r\n          return s != null ? s[5] : null;\r\n        },\r\n        url: function( id ) {\r\n          return 'https://player.vimeo.com/video/' + id;\r\n        },\r\n        markup: function( id ) {\r\n          // return '<iframe class=\"nGY2ViewerMedia\" src=\"https://player.vimeo.com/video/' + id + '?rel=0\" frameborder=\"0\" gesture=\"media\" allowfullscreen></iframe>';\r\n          return '<iframe class=\"nGY2ViewerMedia\" src=\"https://player.vimeo.com/video/' + id + '?rel=0\" frameborder=\"0\" allow=\"autoplay\" allowfullscreen></iframe>';\r\n        },\r\n        kind: 'iframe'\r\n      },\r\n      dailymotion : {\r\n        getID: function( url ) {\r\n          // https://stackoverflow.com/questions/12387389/how-to-parse-dailymotion-video-url-in-javascript\r\n          var m = url.match(/^.+dailymotion.com\\/(video|hub)\\/([^_]+)[^#]*(#video=([^_&]+))?/);\r\n          if (m !== null) {\r\n              if(m[4] !== undefined) {\r\n                  return m[4];\r\n              }\r\n              return m[2];\r\n          }\r\n          return null;\r\n        },\r\n        thumbUrl: function( id ) {\r\n          return 'https://www.dailymotion.com/thumbnail/video/' + id;\r\n        },\r\n        url: function( id ) {\r\n          return 'https://www.dailymotion.com/embed/video/' + id;\r\n        },\r\n        markup: function( id ) {\r\n          // return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.dailymotion.com/embed/video/' + id + '?rel=0\" frameborder=\"0\" gesture=\"media\" allowfullscreen></iframe>';\r\n          return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.dailymotion.com/embed/video/' + id + '?rel=0\" frameborder=\"0\" allow=\"autoplay\" allowfullscreen></iframe>';\r\n        },\r\n        kind: 'iframe'\r\n      },\r\n      selfhosted : {\r\n\t\t\t\t// SELF-HOSTED VIDEOS\r\n        getID: function( url ) {\r\n          // In order to leave things as is, I used ID to identify the extension\r\n          // https://stackoverflow.com/questions/6997262/how-to-pull-url-file-extension-out-of-url-string-using-javascript\r\n          // Make sure the method used for verifying the extension matches the kind of url your selfhosted video has\r\n          var extension = url.split('.').pop();\r\n\r\n          // supported extensions\r\n          var s = ( extension === 'mp4' || extension === 'webm' || extension === 'ogv' || extension === '3gp' ) ? extension : null ;\r\n          return s;\r\n        },\r\n        markup: function( url ) {\r\n          // return '<video controls class=\"nGY2ViewerMedia\"><source src=\"${id.src}\" type=\"video/${id.type}\" preload=\"auto\">Your browser does not support the video tag (HTML 5).</video>';\r\n          var extension = url.split('.').pop();\r\n          return '<video controls class=\"nGY2ViewerMedia\"><source src=\"'+ url +'\" type=\"video/'+ extension +'\" preload=\"auto\">Your browser does not support the video tag (HTML 5).</video>';\r\n        },\r\n        kind: 'video',\r\n        selfhosted : true\r\n      }\r\n    };\r\n        \r\n    function AlbumGetMarkupOrApi ( fnToCall, fnParam1, fnParam2 ) {\r\n    \r\n      if( G.markupOrApiProcessed === true ) {\r\n        // already processed (maybe location hash to unknow reference) -> display root album\r\n        DisplayAlbum('-1', 0);\r\n        return;\r\n      }\r\n      \r\n      if( G.O.items !== undefined && G.O.items !== null ) {\r\n        // data defined as an object in an option parameter\r\n        GetContentApiObject();\r\n      }\r\n      else {\r\n      if( G.O.$markup.length > 0 ) {\r\n          // data defined as markup (href elements)\r\n          GetContentMarkup( G.O.$markup );\r\n          G.O.$markup=[]  ;\r\n        }\r\n        else {\r\n          NanoConsoleLog(G, 'error: no media to process.');\r\n          return;\r\n        }\r\n      }\r\n      \r\n      G.markupOrApiProcessed = true;\r\n      if( fnToCall !== null &&  fnToCall !== undefined) {\r\n        fnToCall( fnParam1, fnParam2, null );\r\n      }\r\n    }\r\n    \r\n    function StartsWithProtocol ( path ) {\r\n      if( path == null || path == undefined ) { return false; }\r\n      \r\n      var pattern = /^((http|https|ftp|ftps|file):\\/\\/)/;\r\n      if( !pattern.test(path) ) {\r\n        // not a full URL\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    \r\n    function GetContentApiObject() {\r\n      var foundAlbumID=false;\r\n      var nbTitles = 0;\r\n      var AlbumPostProcess = NGY2Tools.AlbumPostProcess.bind(G);\r\n\r\n      G.I[0].contentIsLoaded=true;\r\n\r\n      jQuery.each(G.O.items, function(i,item){\r\n        \r\n        var title = '';\r\n        title=GetI18nItem(item, 'title');\r\n        if( title === undefined ) { title=''; }\r\n        \r\n        var src='';\r\n        if( item['src'+RetrieveCurWidth().toUpperCase()] !== undefined ) {\r\n          src = item['src'+RetrieveCurWidth().toUpperCase()];\r\n        }\r\n        else {\r\n          src = item.src;\r\n        }\r\n        if( !StartsWithProtocol(src) ) {\r\n          src = G.O.itemsBaseURL + src;\r\n        }\r\n\r\n        var thumbsrc = '';\r\n        if( item.srct !== undefined && item.srct.length > 0 ) {\r\n          thumbsrc = item.srct;\r\n          if( !StartsWithProtocol(thumbsrc) ) {\r\n            thumbsrc = G.O.itemsBaseURL + thumbsrc;\r\n          }\r\n        }\r\n        else {\r\n          thumbsrc = src;\r\n        }\r\n        \r\n        var thumbsrcX2 = '';\r\n        if( item.srct2x !== undefined && item.srct2x.length > 0 ) {\r\n          thumbsrcX2 = item.srct2x;\r\n          if( !StartsWithProtocol(thumbsrcX2) ) {\r\n            thumbsrcX2 = G.O.itemsBaseURL + thumbsrcX2;\r\n          }\r\n        }\r\n        else {\r\n          if( thumbsrc != '' ) {\r\n            thumbsrcX2 = thumbsrc;\r\n          }\r\n          else {\r\n            thumbsrcX2 = src;\r\n          }\r\n        }\r\n\r\n        if( G.O.thumbnailLabel.get('title') != '' ) {\r\n          title = GetImageTitle(src);\r\n        }\r\n\r\n        var description='';     //'&nbsp;';\r\n        description=GetI18nItem(item,'description');\r\n        if( description === undefined ) { description=''; }\r\n        //if( toType(item.description) == 'string' ) {\r\n        //  description=item.description;\r\n        //}\r\n\r\n        var tags = GetI18nItem(item, 'tags');\r\n        if( tags === undefined ) { tags=''; }\r\n\r\n        var albumID = 0;\r\n        if( item.albumID !== undefined  ) {\r\n          albumID=item.albumID;\r\n          foundAlbumID = true;\r\n        }\r\n        var ID = null;\r\n        if( item.ID !== undefined ) {\r\n          ID = item.ID;\r\n        }\r\n        var kind = 'image';\r\n        if( item.kind !== undefined && item.kind.length > 0 ) {\r\n          kind = item.kind;\r\n        }\r\n        \r\n        var newItem=NGY2Item.New( G, title, description, ID, albumID, kind, tags );\r\n        if( title != '' ) {\r\n          nbTitles++;\r\n        }\r\n        \r\n        // media source url - img is the default media kind\r\n        newItem.setMediaURL( src, 'img');\r\n\r\n        // manage media kinds other than IMG\r\n        jQuery.each(mediaList, function ( n, media ) {\r\n          var id = media.getID(src);\r\n          if( id != null ) {\r\n            if( typeof media.url == 'function' ) { src = media.url(id);  }\r\n            if( typeof media.thumbUrl == 'function' ) { thumbsrc = media.thumbUrl(id);  }\r\n            newItem.mediaKind = media.kind;\r\n            newItem.mediaMarkup = ( media.selfhosted ) ? media.markup( src ) : media.markup(id);\r\n            return false;\r\n          }\r\n        });\r\n\r\n        // image size\r\n        if( item.imageWidth !== undefined ) { newItem.imageWidth = item.width; }\r\n        if( item.imageHeight !== undefined ) { newItem.imageHeight = item.height; }\r\n\r\n        // THUMBNAILS\r\n        \r\n        // thumbnail image size\r\n        var tw = item.imgtWidth !== undefined ? item.imgtWidth : 0;\r\n        var th = item.imgtHeight !== undefined ? item.imgtHeight : 0;\r\n\r\n        // default thumbnail URL and size\r\n        newItem.thumbs = {\r\n          url:    { l1 : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc }, lN : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc } },\r\n          width:  { l1 : { xs: tw, sm: tw, me: tw, la: tw, xl: tw }, lN : { xs: tw, sm: tw, me: tw, la: tw, xl: tw } },\r\n          height: { l1 : { xs: th, sm: th, me: th, la: th, xl: th }, lN : { xs: th, sm: th, me: th, la: th, xl: th } }\r\n        };\r\n        \r\n        // default media type -> IMG\r\n        if( newItem.mediaKind == 'img' ) {\r\n        \r\n          // responsive thumbnails URL and size\r\n          var lst=['xs', 'sm', 'me', 'la', 'xl'];\r\n          for( var i=0; i< lst.length; i++ ) {\r\n            // url\r\n            var turl = item['srct' + lst[i].toUpperCase()];\r\n            if( turl !== undefined ) {\r\n              if( !StartsWithProtocol(turl) ) {\r\n                turl = G.O.itemsBaseURL + turl;\r\n              }\r\n              newItem.url.l1[lst[i]] = turl;\r\n              newItem.url.lN[lst[i]] = turl;\r\n            }\r\n            // width\r\n            var tw = item['imgt' + lst[i].toUpperCase() + 'Width'];\r\n            if( tw != undefined ) {\r\n              newItem.width.l1[lst[i]] = parseInt(tw);\r\n              newItem.width.lN[lst[i]] = parseInt(tw);\r\n            }\r\n            // height\r\n            var th = item['imgt' + lst[i].toUpperCase() + 'Height'];\r\n            if( th != undefined ) {\r\n              newItem.height.l1[lst[i]] = parseInt(th);\r\n              newItem.height.lN[lst[i]] = parseInt(th);\r\n            }\r\n          }\r\n        }\r\n        \r\n        // dominant colors (needs to be a base64 gif)\r\n        if( item.imageDominantColors !== undefined ) {\r\n          newItem.imageDominantColors = item.imageDominantColors;\r\n        }\r\n        // dominant color (rgb hex)\r\n        if( item.imageDominantColor !== undefined ) {\r\n          newItem.imageDominantColor = item.imageDominantColor;\r\n        }\r\n        \r\n        // dest url\r\n        if( item.destURL !== undefined && item.destURL.length>0 ) {\r\n          newItem.destinationURL = item.destURL;\r\n        }\r\n        \r\n        // download image url\r\n        if( item.downloadURL !== undefined && item.downloadURL.length>0 ) {\r\n          newItem.downloadURL = item.downloadURL;\r\n        }\r\n        \r\n        // EXIF DATA\r\n        // Exif - model\r\n        if( item.exifModel !== undefined ) { newItem.exif.model = item.exifModel; }\r\n        // Exif - flash\r\n        if( item.exifFlash !== undefined ) { newItem.exif.flash = item.exifFlash; }\r\n        // Exif - focallength\r\n        if( item.exifFocalLength !== undefined ) { newItem.exif.focallength = item.exifFocalLength; }\r\n        // Exif - fstop\r\n        if( item.exifFStop !== undefined ) { newItem.exif.fstop = item.exifFStop; }\r\n        // Exif - exposure\r\n        if( item.exifExposure !== undefined ) { newItem.exif.exposure = item.exifExposure; }\r\n        // Exif - time\r\n        if( item.exifIso !== undefined ) { newItem.exif.iso = item.exifIso; }\r\n        // Exif - iso\r\n        if( item.exifTime !== undefined ) { newItem.exif.time = item.exifTime; }\r\n        // Exif - location\r\n        if( item.exifLocation !== undefined ) { newItem.exif.location  = item.exifLocation; }\r\n        \r\n        \r\n        // custom data\r\n        if( item.customData !== null ) {\r\n          newItem.customData = cloneJSObject( item.customData );\r\n        }\r\n\r\n        newItem.contentIsLoaded = true;\r\n        \r\n        var fu = G.O.fnProcessData;\r\n        if( fu !== null ) {\r\n          typeof fu == 'function' ? fu(newItem, 'api', item) : window[fu](newItem, 'api', item);\r\n        }\r\n        \n        AlbumPostProcess(albumID);\r\n      });\r\n      \r\n      // if( foundAlbumID ) { G.O.displayBreadcrumb=true; }\r\n      if( nbTitles == 0 ) { G.O.thumbnailLabel.display=false; }\r\n\r\n    }\r\n    \r\n    \r\n    function GetContentMarkup( $elements ) {\r\n      var foundAlbumID = false;\r\n      var nbTitles = 0;\r\n      var AlbumPostProcess = NGY2Tools.AlbumPostProcess.bind(G);\r\n\r\n      G.I[0].contentIsLoaded = true;\r\n\r\n      jQuery.each($elements, function(i, item){\r\n\r\n        // create dictionnary with all data attribute name in lowercase (to be case unsensitive)\r\n        var data = {\r\n          // some default values\r\n          'data-ngdesc':                  '',         // item description\r\n          'data-ngid':                    null,       // ID\r\n          'data-ngkind':                  'image',    // kind (image, album, albumup)\r\n          'data-ngtags':                  null,       // tags\r\n          'data-ngdest':                  '',         // destination URL\r\n          'data-ngthumbimgwidth':         0,          // thumbnail width\r\n          'data-ngthumbimgheight':        0,          // thumbnail height\r\n          'data-ngimagewidth':            0,          // image width\r\n          'data-ngimageheight':           0,          // image height\r\n          'data-ngimagedominantcolors':   null,       // image dominant colors\r\n          'data-ngimagedominantcolor':    null,       // image dominant colors\r\n          'data-ngexifmodel':             '',         // EXIF data\r\n          'data-ngexifflash':             '',\r\n          'data-ngexiffocallength':       '',\r\n          'data-ngexiffstop':             '',\r\n          'data-ngexifexposure':          '',\r\n          'data-ngexifiso':               '',\r\n          'data-ngexiftime':              '',\r\n          'data-ngexiflocation':          ''\r\n        };\r\n        [].forEach.call( item.attributes, function(attr) {\r\n          data[attr.name.toLowerCase()] = attr.value;\r\n        });\r\n\r\n        // responsive image source\r\n        var src = '',\r\n        st = RetrieveCurWidth().toUpperCase();\r\n        if( data.hasOwnProperty('data-ngsrc'+st) ) {\r\n          src = data['data-ngsrc'+st];\r\n        }\r\n        if( src == '' ) {\r\n          src = data['href'];\r\n        }\r\n        if( !StartsWithProtocol(src) ) {\r\n          src = G.O.itemsBaseURL + src;\r\n        }\r\n\r\n        // thumbnail\r\n        var thumbsrc = '';\r\n        if( data.hasOwnProperty('data-ngthumb') ) {\r\n          thumbsrc = data['data-ngthumb'];\r\n          if( !StartsWithProtocol(thumbsrc) ) {\r\n            thumbsrc = G.O.itemsBaseURL + thumbsrc;\r\n          }\r\n        }\r\n        else {\r\n          thumbsrc = src;\r\n        }\r\n        var thumbsrcX2 = '';\r\n        if( data.hasOwnProperty('data-ngthumb2x') ) {\r\n          thumbsrcX2 = data['data-ngthumb2x'];\r\n          if( !StartsWithProtocol(thumbsrcX2) ) {\r\n            thumbsrcX2 = G.O.itemsBaseURL + thumbsrcX2;\r\n          }\r\n        }\r\n        \r\n        //newObj.description=jQuery(item).attr('data-ngdesc');\r\n        var description = data['data-ngdesc'];\r\n        var ID = data['id'];\r\n        if( ID == undefined ) {\r\n          ID = data['data-ngid'];\r\n        }\r\n        var kind = data['data-ngkind'];\r\n        var tags = data['data-ngtags'];\r\n\r\n        var albumID = '0';\r\n        if( data.hasOwnProperty('data-ngalbumid') ) {\r\n          albumID = data['data-ngalbumid'];\r\n          foundAlbumID = true;\r\n        }\r\n        \r\n        var title = jQuery(item).text();\r\n        if( !(G.O.thumbnailLabel.get('title') == '' || G.O.thumbnailLabel.get('title') == undefined) ) {\r\n          title = GetImageTitle(src);\r\n        }\r\n\r\n\r\n        var newItem = NGY2Item.New( G, title, description, ID, albumID, kind, tags );\r\n        if( title != '' ) {\r\n          nbTitles++;\r\n        }\r\n\r\n        // media source url - img is the default media kind\r\n        newItem.setMediaURL( src, 'img');\r\n\r\n        // manage media kinds other than IMG\r\n        newItem.mediaKind = 'img';\r\n        jQuery.each(mediaList, function ( n, media ) {\r\n          var id = media.getID(src);\r\n          if( id != null ) {\r\n            if( typeof media.url == 'function' ) { src = media.url(id);  }\r\n            if( typeof media.thumbUrl == 'function' ) { thumbsrc = media.thumbUrl(id);  }\r\n            newItem.mediaKind = media.kind;\r\n            newItem.mediaMarkup = ( media.selfhosted ) ? media.markup( src ) : media.markup(id);\r\n            return false;\r\n          }\r\n        });\r\n        \r\n        \r\n        // image size\r\n        newItem.imageWidth = parseInt( data['data-ngimagewidth'] );\r\n        newItem.imageHeight = parseInt( data['data-ngimageheight'] );\r\n        \r\n        // default thumbnail image URL and size\r\n        var tw = parseInt(data['data-ngthumbimgwidth']);\r\n        var th = parseInt(data['data-ngthumbimgheight']);\r\n        newItem.thumbs = {\r\n          url:    { l1 : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc }, lN : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc } },\r\n          width:  { l1 : { xs: tw, sm: tw, me: tw, la: tw, xl: tw }, lN : { xs: tw, sm: tw, me: tw, la: tw, xl: tw } },\r\n          height: { l1 : { xs: th, sm: th, me: th, la: th, xl: th }, lN : { xs: th, sm: th, me: th, la: th, xl: th } }\r\n        };\r\n\r\n        // default media type -> IMG\r\n        if( newItem.mediaKind == 'img' ) {\r\n        \r\n          // responsive thumbnails URL and size\r\n          var lst = ['xs', 'sm', 'me', 'la', 'xl'];\r\n          for( var i = 0; i < lst.length; i++ ) {\r\n            // url\r\n            if( data.hasOwnProperty('data-ngthumb' + lst[i]) ) {\r\n              var turl=data['data-ngthumb' + lst[i]];\r\n              if( !StartsWithProtocol(turl) ) {\r\n                turl = G.O.itemsBaseURL + turl;\r\n              }\r\n              newItem.url.l1[lst[i]] = turl;\r\n              newItem.url.lN[lst[i]] = turl;\r\n            }\r\n\r\n            // width\r\n            if( data.hasOwnProperty('data-ngthumb' + lst[i] + 'width') ) {\r\n              var tw=parseInt(data['data-ngthumb' + lst[i] + 'width']);\r\n              newItem.width.l1[lst[i]] = tw;\r\n              newItem.width.lN[lst[i]] = tw;\r\n            }\r\n            // height\r\n            if( data.hasOwnProperty('data-ngthumb' + lst[i] + 'height') ) {\r\n              var th=parseInt('data-ngthumb' + lst[i] + 'height');\r\n              newItem.height.l1[lst[i]] = th;\r\n              newItem.height.lN[lst[i]] = th;\r\n            }\r\n          }\r\n        }\r\n        \r\n        \r\n        // dominant colorS (needs to be a base64 gif)\r\n        newItem.imageDominantColors = data['data-ngimagedominantcolors'];\r\n        // dominant color (rgb hex)\r\n        newItem.imageDominantColor = data['data-ngimagedominantcolors'];\r\n\r\n        newItem.destinationURL = data['data-ngdest'];\r\n        newItem.downloadURL = data['data-ngdownloadurl'];\r\n\r\n        // Exif - model\r\n        newItem.exif.model=data['data-ngexifmodel'];\r\n        // Exif - flash\r\n        newItem.exif.flash=data['data-ngexifflash'];\r\n        // Exif - focallength\r\n        newItem.exif.focallength=data['data-ngexiffocallength'];\r\n        // Exif - fstop\r\n        newItem.exif.fstop=data['data-ngexiffstop'];\r\n        // Exif - exposure\r\n        newItem.exif.exposure=data['data-ngexifexposure'];\r\n        // Exif - iso\r\n        newItem.exif.iso=data['data-ngexifiso'];\r\n        // Exif - time\r\n        newItem.exif.time=data['data-ngexiftime'];\r\n        // Exif - location\r\n        newItem.exif.location=data['data-ngexiflocation'];\r\n        \r\n        newItem.contentIsLoaded=true;\r\n\r\n        // custom data\r\n        if( jQuery(item).data('customdata') !== undefined ) {\r\n          newItem.customData=cloneJSObject(jQuery(item).data('customdata'));\r\n        }\r\n        // custom data\r\n        if( jQuery(item).data('ngcustomdata') !== undefined ) {\r\n          newItem.customData=cloneJSObject(jQuery(item).data('ngcustomdata'));\r\n        }\r\n\r\n        var fu=G.O.fnProcessData;\r\n        if( fu !== null ) {\r\n          typeof fu == 'function' ? fu(newItem, 'markup', item) : window[fu](newItem, 'markup', item);\r\n        }\r\n        \r\n        AlbumPostProcess(albumID);\r\n\r\n      });\r\n      \r\n      // if( foundAlbumID ) { G.O.displayBreadcrumb=true; }\r\n      if( nbTitles == 0 ) { G.O.thumbnailLabel.display = false; }\r\n\r\n    }\r\n\r\n    \r\n    // ################################\r\n    // ##### DEFINE VARIABLES     #####\r\n    // ################################\r\n\r\n    \r\n    /** @function DefineVariables */\r\n    function DefineVariables() {\r\n    \r\n      // change 'picasa' to 'google' for compatibility reason\r\n      if( G.O.kind.toUpperCase() == 'PICASA'  || G.O.kind.toUpperCase() == 'GOOGLE') {\r\n        G.O.kind='google2';\r\n      }\r\n    \r\n      // management of screen width\r\n      G.GOM.cache.viewport = getViewport();\r\n      G.GOM.curWidth = RetrieveCurWidth();\r\n      \r\n      // tumbnail toolbar\r\n      jQuery.extend(true, G.tn.toolbar.image, G.O.thumbnailToolbarImage );\r\n      jQuery.extend(true, G.tn.toolbar.album, G.O.thumbnailToolbarAlbum );\r\n      var t = ['image', 'album'];\r\n      var pos= ['topLeft', 'topRight', 'bottomLeft', 'bottomRight']\r\n      for( var i=0; i < t.length ; i++ ) {\r\n        for( var j=0; j < pos.length ; j++ ) {\r\n          G.tn.toolbar[t[i]][pos[j]] = G.tn.toolbar[t[i]][pos[j]].toUpperCase();\r\n        }\r\n      }\r\n\r\n      // thumbnails label - level dependant settings\r\n      G.O.thumbnailLabel.get = function( opt ) {\r\n        if( G.GOM.curNavLevel == 'l1' && G.O.thumbnailL1Label !== undefined && G.O.thumbnailL1Label[opt] !== undefined ) {\r\n          return G.O.thumbnailL1Label[opt];\r\n        }\r\n        else {\r\n          return G.O.thumbnailLabel[opt];\r\n        }\r\n      };\r\n      G.O.thumbnailLabel.set = function( opt, value ) {\r\n        if( G.GOM.curNavLevel == 'l1' && G.O.thumbnailL1Label !== undefined && G.O.thumbnailL1Label[opt] !== undefined ) {\r\n          G.O.thumbnailL1Label[opt]=value;\r\n        }\r\n        else {\r\n          G.O.thumbnailLabel[opt]=value;\r\n        }\r\n      };\r\n\r\n      if( G.O.blackList != '' ) { G.blackList=G.O.blackList.toUpperCase().split('|'); }\r\n      if( G.O.whiteList != '' ) { G.whiteList=G.O.whiteList.toUpperCase().split('|'); }\r\n\r\n      if( G.O.albumList2 !== undefined && G.O.albumList2 !== null && G.O.albumList2.constructor === Array  ) {\r\n        var l=G.O.albumList2.length;\r\n        for(var i=0; i< l; i++ ) {\r\n          G.albumList.push(G.O.albumList2[i]);\r\n        }\r\n        // G.albumList=G.O.albumList.toUpperCase().split('|');\r\n      }\r\n      if( G.O.albumList2 !== undefined && typeof G.O.albumList2 == 'string'   ) {\r\n        G.albumList.push(G.O.albumList2);\r\n      }\r\n      \r\n      \r\n      // thumbnail image crop\r\n      G.tn.opt.lN.crop = G.O.thumbnailCrop;\r\n      G.tn.opt.l1.crop = G.O.thumbnailL1Crop != null ? G.O.thumbnailL1Crop : G.O.thumbnailCrop;\r\n\r\n\r\n      function ThumbnailOpt( lN, l1, opt) {\r\n        G.tn.opt.lN[opt]=G.O[lN];\r\n        G.tn.opt.l1[opt]=G.O[lN];\r\n        if( toType(G.O[l1]) == 'number' ) {\r\n          G.tn.opt.l1[opt]=G.O[l1];\r\n        }\r\n      }\r\n      // thumbnail stacks\r\n      ThumbnailOpt('thumbnailStacks', 'thumbnailL1Stacks', 'stacks');\r\n      // thumbnail stacks translate X\r\n      ThumbnailOpt('thumbnailStacksTranslateX', 'thumbnailL1StacksTranslateX', 'stacksTranslateX');\r\n      // thumbnail stacks translate Y\r\n      ThumbnailOpt('thumbnailStacksTranslateY', 'thumbnailL1StacksTranslateY', 'stacksTranslateY');\r\n      // thumbnail stacks translate Z\r\n      ThumbnailOpt('thumbnailStacksTranslateZ', 'thumbnailL1StacksTranslateZ', 'stacksTranslateZ');\r\n      // thumbnail stacks rotate X\r\n      ThumbnailOpt('thumbnailStacksRotateX', 'thumbnailL1StacksRotateX', 'stacksRotateX');\r\n      // thumbnail stacks rotate Y\r\n      ThumbnailOpt('thumbnailStacksRotateY', 'thumbnailL1StacksRotateY', 'stacksRotateY');\r\n      // thumbnail stacks rotate Z\r\n      ThumbnailOpt('thumbnailStacksRotateZ', 'thumbnailL1StacksRotateZ', 'stacksRotateZ');\r\n      // thumbnail stacks scale\r\n      ThumbnailOpt('thumbnailStacksScale', 'thumbnailL1StacksScale', 'stacksScale');\r\n      // thumbnail gutter width\r\n      ThumbnailOpt('thumbnailGutterWidth', 'thumbnailL1GutterWidth', 'gutterWidth');\r\n      // thumbnail gutter height\r\n      ThumbnailOpt('thumbnailGutterHeight', 'thumbnailL1GutterHeight', 'gutterHeight');\r\n      // thumbnail grid base height (for cascading layout)\r\n      ThumbnailOpt('thumbnailBaseGridHeight', 'thumbnailL1BaseGridHeight', 'baseGridHeight');\r\n      \r\n      // gallery display mode\r\n      G.galleryDisplayMode.lN = G.O.galleryDisplayMode.toUpperCase();\r\n      G.galleryDisplayMode.l1 = G.O.galleryL1DisplayMode != null ? G.O.galleryL1DisplayMode.toUpperCase() : G.O.galleryDisplayMode.toUpperCase();\r\n      \r\n      // gallery maximum number of lines of thumbnails\r\n      G.galleryMaxRows.lN = G.O.galleryMaxRows;\r\n      G.galleryMaxRows.l1 = toType(G.O.galleryL1MaxRows) == 'number' ? G.O.galleryL1MaxRows : G.O.galleryMaxRows;\r\n\r\n      // gallery last row full\r\n      G.galleryLastRowFull.lN = G.O.galleryLastRowFull;\r\n      G.galleryLastRowFull.l1 = G.O.galleryL1LastRowFull != null ? G.O.galleryL1LastRowFull : G.O.galleryLastRowFull;\r\n      \r\n      // gallery sorting\r\n      G.gallerySorting.lN = G.O.gallerySorting.toUpperCase();\r\n      G.gallerySorting.l1 = G.O.galleryL1Sorting != null ? G.O.galleryL1Sorting.toUpperCase() : G.gallerySorting.lN;\r\n      \r\n      // gallery display transition\r\n      G.galleryDisplayTransition.lN = G.O.galleryDisplayTransition.toUpperCase();\r\n      G.galleryDisplayTransition.l1 = G.O.galleryL1DisplayTransition != null ? G.O.galleryL1DisplayTransition.toUpperCase() : G.galleryDisplayTransition.lN;\r\n\r\n      // gallery display transition duration\r\n      G.galleryDisplayTransitionDuration.lN = G.O.galleryDisplayTransitionDuration;\r\n      G.galleryDisplayTransitionDuration.l1 = G.O.galleryL1DisplayTransitionDuration != null ? G.O.galleryL1DisplayTransitionDuration : G.galleryDisplayTransitionDuration.lN;\r\n      \r\n      // gallery max items per album (not for inline/api defined items)\r\n      G.galleryMaxItems.lN = G.O.galleryMaxItems;\r\n      G.galleryMaxItems.l1 = toType(G.O.galleryL1MaxItems) == 'number' ? G.O.galleryL1MaxItems : G.O.galleryMaxItems;\r\n\r\n      // gallery filter tags\r\n      G.galleryFilterTags.lN = G.O.galleryFilterTags;\r\n      G.galleryFilterTags.l1 = G.O.galleryL1FilterTags != null ? G.O.galleryL1FilterTags : G.O.galleryFilterTags;\r\n      \r\n      // gallery pagination\r\n      G.O.galleryPaginationMode = G.O.galleryPaginationMode.toUpperCase();\r\n\r\n      if( toType(G.O.slideshowDelay) == 'number' && G.O.slideshowDelay >= 2000 ) {\r\n        G.VOM.slideshowDelay = G.O.slideshowDelay;\r\n      }\r\n      else {\r\n        NanoConsoleLog(G, 'Parameter \"slideshowDelay\" must be an integer >= 2000 ms.');\r\n      }\r\n\r\n      // gallery display transition\r\n      if( typeof G.O.thumbnailDisplayTransition == 'boolean' ) {\r\n        if( G.O.thumbnailDisplayTransition === true ) {\r\n          G.tn.opt.lN.displayTransition = 'FADEIN';\r\n          G.tn.opt.l1.displayTransition = 'FADEIN';\r\n        }\r\n        else {\r\n          G.tn.opt.lN.displayTransition = 'NONE';\r\n          G.tn.opt.l1.displayTransition = 'NONE';\r\n        }\r\n      }\r\n\r\n      if( G.O.fnThumbnailDisplayEffect !== '' ) {\n        G.tn.opt.lN.displayTransition = 'CUSTOM';\n        G.tn.opt.l1.displayTransition = 'CUSTOM';\n      }\n      if( G.O.fnThumbnailL1DisplayEffect !== '' ) {\n        G.tn.opt.l1.displayTransition = 'CUSTOM';\r\n      }\r\n      \r\n      // parse thumbnail display transition\r\n      function thumbnailDisplayTransitionParse( cfg, level ) {\r\n        if( typeof cfg == 'string' ) {\r\n          var st=cfg.split('_');\r\n          if( st.length == 1 ) {\r\n            G.tn.opt[level]['displayTransition'] = cfg.toUpperCase();\r\n          }\r\n          if( st.length == 2 ) {\r\n            G.tn.opt[level]['displayTransition'] = st[0].toUpperCase();\r\n            G.tn.opt[level]['displayTransitionStartVal'] = Number(st[1]);\r\n          }\r\n          if( st.length == 3 ) {\r\n            G.tn.opt[level]['displayTransition'] = st[0].toUpperCase();\r\n            G.tn.opt[level]['displayTransitionStartVal'] = Number(st[1]);\r\n            G.tn.opt[level]['displayTransitionEasing'] = st[2];\r\n          }\r\n        }\r\n      }\r\n      thumbnailDisplayTransitionParse( G.O.thumbnailDisplayTransition, 'lN');\r\n      thumbnailDisplayTransitionParse( G.O.thumbnailDisplayTransition, 'l1');\r\n      thumbnailDisplayTransitionParse( G.O.thumbnailL1DisplayTransition, 'l1');\r\n\r\n      \r\n      // thumbnail display transition duration\r\n      ThumbnailOpt('thumbnailDisplayTransitionDuration', 'thumbnailL1DisplayTransitionDuration', 'displayTransitionDuration');\r\n      // thumbnail display transition interval duration\r\n      ThumbnailOpt('thumbnailDisplayInterval', 'thumbnailL1DisplayInterval', 'displayInterval');\r\n\r\n      \r\n      // resolution breakpoints --> convert old syntax to new one\r\n      if( G.O.thumbnailSizeSM !== undefined ) { G.O.breakpointSizeSM = G.O.thumbnailSizeSM; }\r\n      if( G.O.thumbnailSizeME !== undefined ) { G.O.breakpointSizeME = G.O.thumbnailSizeME; }\r\n      if( G.O.thumbnailSizeLA !== undefined ) { G.O.breakpointSizeLA = G.O.thumbnailSizeLA; }\r\n      if( G.O.thumbnailSizeXL !== undefined ) { G.O.breakpointSizeXL = G.O.thumbnailSizeXL; }\r\n\r\n      // THUMBNAIL BUILD INIT\r\n      //level 1\r\n      if( G.O.thumbnailL1BuildInit2 !== undefined ) {\r\n      var t1 = G.O.thumbnailL1BuildInit2.split('|');\r\n        for( var i = 0; i < t1.length; i++ ) {\r\n          var o1 = t1[i].trim().split('_');\r\n          if( o1.length == 3 ) {\r\n            var i1 = NewTBuildInit();\r\n            i1.element = ThumbnailOverEffectsGetCSSElement(o1[0], '');\r\n            i1.property = o1[1];\r\n            i1.value = o1[2];\r\n            G.tn.buildInit.level1.push(i1);\r\n          }\r\n        }\r\n      }\r\n      //level N\r\n      if( G.O.thumbnailBuildInit2 !== undefined ) {\r\n        var t1 = G.O.thumbnailBuildInit2.split('|');\r\n        for( var i = 0; i < t1.length; i++ ) {\r\n          var o1 = t1[i].trim().split('_');\r\n          if( o1.length == 3 ) {\r\n            var i1 = NewTBuildInit();\r\n            i1.element = ThumbnailOverEffectsGetCSSElement(o1[0], '');\r\n            i1.property = o1[1];\r\n            i1.value = o1[2];\r\n            G.tn.buildInit.std.push(i1);\r\n          }\r\n        }\r\n      }\r\n\r\n      \r\n      // THUMBNAIL HOVER EFFETCS\r\n      \r\n      // thumbnails hover effects - Level1\r\n      var tL1HE = G.O.thumbnailL1HoverEffect2;\r\n      if( tL1HE !== undefined ) {\r\n        switch( toType(tL1HE) ) {\r\n          case 'string':\r\n            var tmp = tL1HE.split('|');\r\n            for(var i = 0; i < tmp.length; i++) {\r\n              var oDef = NewTHoverEffect();\r\n              oDef = ThumbnailHoverEffectExtract( tmp[i].trim(), oDef );\r\n              if(  oDef != null ) {\r\n                G.tn.hoverEffects.level1.push(oDef);\r\n              }\r\n            }\r\n            break;\r\n          case 'object':\r\n            var oDef = NewTHoverEffect();\r\n            oDef = jQuery.extend(oDef,tL1HE);\r\n            oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n            if(  oDef != null ) {\r\n              G.tn.hoverEffects.level1.push(oDef);\r\n            }\r\n            break;\r\n          case 'array':\r\n            for(var i = 0; i < tL1HE.length; i++) {\r\n              var oDef = NewTHoverEffect();\r\n              oDef = jQuery.extend(oDef,tL1HE[i]);\r\n              oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n              if(  oDef != null ) {\r\n                G.tn.hoverEffects.level1.push(oDef);\r\n              }\r\n            }\r\n            break;\r\n          case 'null':\r\n            break;\r\n          default:\r\n            NanoAlert(G, 'incorrect parameter for \"thumbnailL1HoverEffect2\".');\r\n        }\r\n      }\r\n      G.tn.hoverEffects.level1 = ThumbnailOverEffectsPreset(G.tn.hoverEffects.level1);\r\n  \r\n      // thumbnails hover effects - other levels\r\n      var tHE = G.O.thumbnailHoverEffect2;\r\n      switch( toType(tHE) ) {\r\n        case 'string':\r\n          var tmp = tHE.split('|');\r\n          for(var i = 0; i < tmp.length; i++) {\r\n            var oDef = NewTHoverEffect();\r\n            oDef = ThumbnailHoverEffectExtract( tmp[i].trim(), oDef );\r\n            if(  oDef != null ) {\r\n              G.tn.hoverEffects.std.push(oDef);\r\n            }\r\n          }\r\n          break;\r\n        case 'object':\r\n          var oDef = NewTHoverEffect();\r\n          oDef = jQuery.extend(oDef, tHE);\r\n          oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n          if(  oDef != null ) {\r\n            G.tn.hoverEffects.std.push(oDef);\r\n          }\r\n          break;\r\n        case 'array':\r\n          for(var i = 0; i < tHE.length; i++) {\r\n            var oDef = NewTHoverEffect();\r\n            oDef = jQuery.extend(oDef,tHE[i]);\r\n            oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n            if(  oDef!= null ) {\r\n              G.tn.hoverEffects.std.push(oDef);\r\n            }\r\n          }\r\n          break;\r\n        case 'null':\r\n          break;\r\n        default:\r\n          NanoAlert(G, 'incorrect parameter for \"thumbnailHoverEffect2\".');\r\n      }\r\n      G.tn.hoverEffects.std = ThumbnailOverEffectsPreset(G.tn.hoverEffects.std);\r\n\r\n      \r\n      if( G.O.touchAnimationL1 == undefined ) {\r\n        G.O.touchAnimationL1 = G.O.touchAnimation;\r\n      }\r\n      \r\n      // disable thumbnail touch animation when no hover effect defined\r\n      if( G.tn.hoverEffects.std.length == 0 ) {\r\n        if( G.tn.hoverEffects.level1.length == 0 ) {\r\n          G.O.touchAnimationL1 = false;\r\n        }\r\n        G.O.touchAnimation = false;\r\n      }      \r\n      \r\n      \r\n      // thumbnail sizes\r\n      if( G.O.thumbnailHeight == 0 || G.O.thumbnailHeight == ''  ) { G.O.thumbnailHeight = 'auto'; }\r\n      if( G.O.thumbnailWidth == 0 || G.O.thumbnailWidth == '' ) { G.O.thumbnailWidth = 'auto'; }\r\n      if( G.O.thumbnailL1Height == 0 || G.O.thumbnailL1Height == '' ) { G.O.thumbnailL1Height = 'auto'; }\r\n      if( G.O.thumbnailL1Width == 0 || G.O.thumbnailL1Width == '' ) { G.O.thumbnailL1Width = 'auto'; }\r\n\r\n      // RETRIEVE ALL THUMBNAIL SIZES\r\n      function ThumbnailSizes( srcOpt, onlyl1, opt) {\r\n        if( G.O[srcOpt] == null ) { return; }\r\n        \r\n        if( toType(G.O[srcOpt]) == 'number' ) {\r\n          ThumbnailsSetSize( opt, 'l1', G.O[srcOpt], 'u');\r\n          if( !onlyl1 ) {\r\n            ThumbnailsSetSize( opt, 'lN', G.O[srcOpt], 'u');\r\n          }\r\n        }\r\n        else {\r\n          var ws=G.O[srcOpt].split(' ');\r\n          var v = 'auto';\r\n          if( ws[0].substring(0,4) != 'auto' ) { v=parseInt(ws[0]); }\r\n          var c = 'u';\r\n          if( ws[0].charAt(ws[0].length - 1) == 'C' ) { c='c'; }\r\n          ThumbnailsSetSize( opt, 'l1', v, c );   // default value for all resolutions and navigation levels\r\n          if( !onlyl1 ) {\r\n            ThumbnailsSetSize( opt, 'lN', v, c );\r\n          }\r\n          for( var i = 1; i < ws.length; i++ ) {\r\n            var r = ws[i].substring(0,2).toLowerCase();\r\n            if( /xs|sm|me|la|xl/i.test(r) ) {\r\n              var w = ws[i].substring(2);\r\n              var v = 'auto';\r\n              if( w.substring(0,4) != 'auto' ) { v = parseInt(w); }\r\n              var c = 'u';\r\n              if( w.charAt(w.length - 1) == 'C' ) { c = 'c'; }\r\n              G.tn.settings[opt]['l1'][r] = v;\r\n              G.tn.settings[opt]['l1'][r + 'c'] = c;\r\n              if( !onlyl1 ) {\r\n                G.tn.settings[opt]['lN'][r] = v;\r\n                G.tn.settings[opt]['lN'][r + 'c'] = c;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      ThumbnailSizes( 'thumbnailWidth', false, 'width');\r\n      ThumbnailSizes( 'thumbnailL1Width', true, 'width');\r\n      \r\n      ThumbnailSizes( 'thumbnailHeight', false, 'height');\r\n      ThumbnailSizes( 'thumbnailL1Height', true, 'height');\r\n\r\n      \r\n      G.O.thumbnailBorderHorizontal = parseInt(G.O.thumbnailBorderHorizontal);\r\n      G.O.thumbnailBorderVertical = parseInt(G.O.thumbnailBorderVertical);\r\n      G.O.thumbnailLabelHeight = parseInt(G.O.thumbnailLabelHeight);\r\n\r\n      \r\n      // retrieve all mosaic layout patterns\r\n      // default pattern\r\n      if( G.O.galleryMosaic != undefined ) {\r\n        // clone object\r\n        G.tn.settings.mosaic.l1.xs = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.sm = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.me = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.la = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.xl = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.xs = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.sm = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.me = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.la = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.xl = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xs');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'sm');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'me');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'la');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xl');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'xs');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'sm');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'me');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'la');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'xl');\r\n      }\r\n      if( G.O.galleryL1Mosaic != undefined ) {\r\n        // default L1 pattern\r\n        G.tn.settings.mosaic.l1.xs = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.sm = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.me = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.la = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.xl = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xs');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'sm');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'me');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'la');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xl');\r\n      }\r\n      for( var w = 0; w < G.tn.settings.mosaic.l1; w++ ) {\r\n        if( G.O['galleryMosaic' + G.tn.settings.mosaic.l1[w].toUpperCase()] != undefined ) {\r\n          G.tn.settings.mosaic.lN[tn.settings.mosaic.l1[w]] = JSON.parse(JSON.stringify( G.O['galleryMosaic' + G.tn.settings.mosaic.l1[w].toUpperCase()] ));\r\n          G.tn.settings.mosaic.l1[tn.settings.mosaic.l1[w]] = JSON.parse(JSON.stringify( G.O['galleryMosaic' + G.tn.settings.mosaic.l1[w].toUpperCase()] ));\r\n          G.tn.settings.mosaicCalcFactor('l1', G.tn.settings.mosaic.l1[w]);\r\n          G.tn.settings.mosaicCalcFactor('lN', G.tn.settings.mosaic.l1[w]);\r\n        }\r\n      }\r\n      for( var w = 0; w < G.tn.settings.mosaic.l1; w++ ) {\r\n        if( G.O['galleryL1Mosaic'+G.tn.settings.mosaic.l1[w].toUpperCase()] != undefined ) {\r\n          G.tn.settings.mosaic.l1[tn.settings.mosaic.l1[w]] = JSON.parse(JSON.stringify( G.O['galleryL1Mosaic'+G.tn.settings.mosaic.l1[w].toUpperCase()] ));\r\n          G.tn.settings.mosaicCalcFactor('l1', G.tn.settings.mosaic.l1[w]);\r\n        }\r\n      }\r\n      \r\n      G.O.imageTransition = G.O.imageTransition.toUpperCase();\r\n\r\n      G.layout.SetEngine();\r\n      \r\n      // init plugins\r\n      switch( G.O.kind ) {\r\n        // MARKUP / API\r\n        case '':\r\n          break;\r\n        // JSON, Flickr, Picasa, ...\r\n        default:\r\n        jQuery.nanogallery2['data_' + G.O.kind](G, 'Init' );\r\n      }\r\n\r\n    }\r\n\r\n    // HOVER EFFECTS\r\n    function ThumbnailHoverEffectExtract( name, effect) {\r\n      var easings = [ 'easeInQuad', 'easeOutQuad', 'easeInOutQuad', 'easeInCubic', 'easeOutCubic', 'easeInOutCubic', 'easeInQuart', 'easeOutQuart', 'easeInOutQuart', 'easeInQuint', 'easeOutQuint', 'easeInOutQuint', 'easeInSine', 'easeOutSine', 'easeInOutSine', 'easeInExpo', 'easeOutExpo', 'easeInOutExpo', 'easeInCirc', 'easeOutCirc', 'easeInOutCirc', 'easeOutBounce', 'easeInBack', 'easeOutBack', 'easeInOutBack', 'elastic', 'bounce'];\r\n    \r\n      var sp = name.split('_');\r\n      if( sp.length >= 4 ) {\r\n        // var oDef=NewTHoverEffect();\r\n        effect.name = '';\r\n        effect.type = sp[1];\r\n        effect.from = sp[2];\r\n        effect.to = sp[3];\r\n        if( sp.length >= 5 ) {\r\n          // effect.duration=sp[4];\r\n\r\n          for( var n = 4; n < sp.length; n++ ) {\r\n            var v = sp[n];\r\n            \r\n            // check if an easing name\r\n            var foundEasing = false;\r\n            for( var e = 0; e < easings.length; e++) {\r\n              if( v == easings[e] ) {\r\n                foundEasing = true;\r\n                effect.easing = v;\r\n                break;\r\n              }\r\n            }\r\n            if( foundEasing === true ) {\r\n              continue;\r\n            }\r\n            \r\n            v = v.toUpperCase();\r\n            \r\n            if( v == 'HOVERIN' ) {\r\n              effect.hoverout = false;\r\n              continue;\r\n            }\r\n            if( v == 'HOVEROUT' ) {\r\n              effect.hoverin = false;\r\n              continue;\r\n            }\r\n            \r\n            if( v == 'KEYFRAME' ) {\r\n              effect.firstKeyframe = false;\r\n              continue;\r\n            }\r\n            \r\n            var num = parseInt(v.replace(/[^0-9\\.]/g, ''), 10);   // extract a number if one exists\r\n\r\n            if( num > 0 ) {\r\n              // the string contains a numbers > 0\r\n              if( v.indexOf('DURATION') >= 0 ) {\r\n                effect.duration = num;\r\n                continue;\r\n              }\r\n              if( v.indexOf('DURATIONBACK') >= 0 ) {\r\n                effect.durationBack = num;\r\n                continue;\r\n              }\r\n              if( v.indexOf('DELAY') >= 0 ) {\r\n                effect.delay = num;\r\n                continue;\r\n              }\r\n              if( v.indexOf('DELAYBACK') >= 0 ) {\r\n                effect.delayBack = num;\r\n                continue;\r\n              }\r\n              \r\n              // no parameter name found -> default is duration\r\n              effect.duration = num;\r\n            }\r\n          }\r\n        }        \r\n        effect.element=ThumbnailOverEffectsGetCSSElement(sp[0], effect.type);\r\n        \r\n      }\r\n      else {\r\n        effect.name = name;\r\n        // NanoAlert(G, 'incorrect parameter for \"thumbnailHoverEffect\": ' + name);\r\n        // return null;\r\n      }\r\n      return effect;\r\n    }\r\n    \r\n    \r\n    function ThumbnailOverEffectsGetCSSElement( element, property ) {\r\n        var r = element;\r\n        \r\n        switch ( element ) {\r\n          case 'image':\r\n            if( property == 'blur' || property == 'brightness' || property == 'grayscale' || property == 'sepia' || property == 'contrast' || property == 'opacity'|| property == 'saturate' ) {\r\n              // r='.nGY2GThumbnailImg';\r\n              r = '.nGY2GThumbnailImage';\r\n            }\r\n            else {\r\n              r = '.nGY2GThumbnailImage';\r\n            }\r\n            break;\r\n          case 'thumbnail':\r\n            r = '.nGY2GThumbnail';\r\n            break;\r\n          case 'label':\r\n            r = '.nGY2GThumbnailLabel';\r\n            break;\r\n          case 'title':\r\n            r = '.nGY2GThumbnailTitle';\r\n            break;\r\n          case 'description':\r\n            r = '.nGY2GThumbnailDescription';\r\n            break;\r\n          case 'tools':\r\n            r = '.nGY2GThumbnailIcons';\r\n            break;\r\n          case 'customlayer':\r\n            r = '.nGY2GThumbnailCustomLayer';\r\n            break;\r\n        }\r\n        return r;\r\n    }\r\n    \r\n    // convert preset hover effects to new ones (nanogallery2)\r\n    function ThumbnailOverEffectsPreset( effects ) {\r\n\r\n      // COMPATIBILITY WITH nanoGALLERY\r\n      // OK:\r\n      //  'borderLighter', 'borderDarker', 'scale120', 'labelAppear', 'labelAppear75', 'labelOpacity50', 'scaleLabelOverImage'\r\n      //  'overScale', 'overScaleOutside', 'descriptionAppear'\r\n      //  'slideUp', 'slideDown', 'slideRight', 'slideLeft'\r\n      //  'imageScale150', 'imageScaleIn80', 'imageScale150Outside', 'imageSlideUp', 'imageSlideDown', 'imageSlideRight', 'imageSlideLeft'\r\n      //  'labelSlideUpTop', 'labelSlideUp', 'labelSlideDown', 'descriptionSlideUp'\r\n      // KO:\r\n      //  'labelSplit4', 'labelSplitVert', 'labelAppearSplit4', 'labelAppearSplitVert' \r\n      // TODO:\r\n      //  'rotateCornerBL', 'rotateCornerBR', 'imageSplit4', 'imageSplitVert', 'imageRotateCornerBL', 'imageRotateCornerBR', 'imageFlipHorizontal', 'imageFlipVertical'\r\n\r\n    \r\n   \r\n      var newEffects=[];\r\n      for( var i=0; i< effects.length; i++ ) {\r\n        switch( effects[i].name.toUpperCase() ) {\r\n          case 'BORDERLIGHTER':\r\n            // var color=ngtinycolor(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            // name='thumbnail_borderColor_'+color.toRgbString()+'_'+color.lighten(50).toRgbString();\r\n            \r\n            var rgb = ColorHelperToRGB(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            name = 'thumbnail_borderColor_'+rgb+'_'+ShadeBlendConvert(0.5, rgb );\r\n            newEffects.push(ThumbnailHoverEffectExtract(name, effects[i]));\r\n            break;\r\n          case 'BORDERDARKER':\r\n            // var color=ngtinycolor(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            // name='thumbnail_borderColor_'+color.toRgbString()+'_'+color.darken(50).toRgbString();\r\n            var rgb = ColorHelperToRGB(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            name = 'thumbnail_borderColor_'+rgb+'_'+ShadeBlendConvert(-0.5, rgb );\r\n            newEffects.push(ThumbnailHoverEffectExtract(name, effects[i]));\r\n            break;\r\n          case 'SCALE120':\r\n            newEffects.push(ThumbnailHoverEffectExtract('thumbnail_scale_1.00_1.20', effects[i]));\r\n            break;\r\n          case 'LABELAPPEAR':\r\n          case 'LABELAPPEAR75':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_opacity_0.00_1.00', effects[i]));\r\n            break;\r\n          case 'TOOLSAPPEAR':\r\n            newEffects.push(ThumbnailHoverEffectExtract('tools_opacity_0_1', effects[i]));\r\n            break;\r\n          case 'TOOLSSLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('tools_translateY_-100%_0%', effects[i]));\r\n            break;\r\n          case 'TOOLSSLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('tools_translateY_100%_0%', effects[i]));\r\n            break;\r\n          case 'LABELOPACITY50':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_opacity_1.00_0.50', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEUPTOP':\r\n          case 'LABELSLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_100%_0%', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_-100%_0%', effects[i]));\r\n            break;\r\n          case 'SCALELABELOVERIMAGE':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_scale_0.00_1.00', effects[i]));\r\n            var n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.00_0.00', n));\r\n            break;\r\n          case 'OVERSCALE':\r\n          case 'OVERSCALEOUTSIDE':\r\n            name = 'label_scale_0_100';\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_scale_2.00_1.00', effects[i]));\r\n            var n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_opacity_0.00_1.00', n));\r\n            n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.00_0.00', n));\r\n            n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_opacity_1.00_0.00', n));\r\n            break;\r\n          case 'DESCRIPTIONAPPEAR':\r\n            newEffects.push(ThumbnailHoverEffectExtract('description_opacity_0_1', effects[i]));\r\n            break;\r\n          case 'SLIDERIGHT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateX_-100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'SLIDELEFT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_-100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateX_100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'SLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_-100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'SLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_-100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'IMAGESCALE150':\r\n          case 'IMAGESCALE150OUTSIDE':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.00_1.50', effects[i]));\r\n            break;\r\n          case 'IMAGESCALEIN80':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.20_1.00', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDERIGHT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_100%', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDELEFT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_-100%', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_-100%', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_100%', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEUP':\r\n          case 'LABELSLIDEUPTOP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_100%_0%', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEUPDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_0%_100%', effects[i]));\r\n            break;\r\n          case 'DESCRIPTIONSLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('description_translateY_110%_0%', effects[i]));\r\n            break;\r\n\r\n          case 'IMAGEBLURON':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_blur_2.00px_0.00px', effects[i]));\r\n            break;\r\n          case 'IMAGEBLUROFF':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_blur_0.00px_2.00px', effects[i]));\r\n            break;\r\n          case 'IMAGEGRAYON':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_grayscale_0%_100%', effects[i]));\r\n            break;\r\n          case 'IMAGEGRAYOFF':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_grayscale_100%_0%', effects[i]));\r\n            break;\r\n          case 'IMAGESEPIAON':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_sepia_100%_1%', effects[i]));\r\n            break;\r\n          case 'IMAGESEPIAOFF':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_sepia_1%_100%', effects[i]));\r\n            break;\r\n            \r\n          default:\r\n            newEffects.push(effects[i]);\r\n            break;\r\n        }\r\n      }\r\n      \r\n      return newEffects;\r\n    }\r\n\r\n\r\n    // Thumbnail hover effect definition\r\n    function NewTHoverEffect() {\r\n      var oDef={ \r\n          name:           '',\r\n          element:        '',               // element class\r\n          type:           '',               \r\n          from:           '',               // start value\r\n          to:             '',               // end value\r\n          hoverin:        true,\r\n          hoverout:       true,\r\n          firstKeyframe:  true,\r\n          delay:          0,\r\n          delayBack:      0,\r\n          duration:       400,\r\n          durationBack:   300,\r\n          easing:         'easeOutQuart',\r\n          easingBack:     'easeOutQuart',\r\n          animParam:      null\r\n        };\r\n      return oDef;\r\n    }\r\n\r\n    function NewTBuildInit() {\r\n      // to set CSS properties\r\n      var oDef={ element: '', property: '', value: '' };\r\n      return oDef;\r\n    }\r\n\r\n    \r\n    function ThumbnailStyle( cfg, level) {\r\n    \r\n      switch( cfg.position ){\r\n        case 'onBottom' :\r\n          G.tn.style[level]['label'] = 'bottom:0; ';\r\n          break;\r\n        case 'overImageOnTop' :\r\n          G.tn.style[level]['label'] = 'top:0; position:absolute;';\r\n          break;\r\n        case 'overImageOnMiddle' :\r\n          G.tn.style[level]['label'] = 'top:0; bottom:0;';\r\n          G.tn.style[level]['title'] = 'position:absolute; bottom:50%;';\r\n          G.tn.style[level]['desc'] = 'position:absolute; top:50%;';\r\n          break;\r\n        case 'custom' :\r\n          break;\r\n        case 'overImageOnBottom' :\r\n        default :\r\n          G.O.thumbnailLabel.position = 'overImageOnBottom';\r\n          G.tn.style[level].label = 'bottom:0; position:absolute;';\r\n          break;\r\n      }\r\n      // if( G.layout.engine != 'CASCADING' ) {\r\n      if( cfg.position != 'onBottom' ) {\r\n        // multi-line\r\n        if( cfg.titleMultiLine ) {\r\n          G.tn.style[level]['title'] = 'white-space:normal;';\r\n        }\r\n        if( cfg.descriptionMultiLine ) {\r\n          G.tn.style[level]['desc'] = 'white-space:normal;';\r\n        }\r\n      }\r\n      \r\n      \r\n      switch( cfg.align ) {\r\n        case 'right':\r\n            G.tn.style[level].label += 'text-align:right;';\r\n          break;\r\n        case 'left':\r\n            G.tn.style[level].label += 'text-align:left;';\r\n          break;\r\n        default:\r\n            G.tn.style[level].label += 'text-align:center;';\r\n          break;\r\n      }\r\n      if( cfg.titleFontSize != undefined && cfg.titleFontSize != '' ) {\r\n        G.tn.style[level].title += 'font-size:' + cfg.titleFontSize + ';';\r\n      }\r\n      if( cfg.descriptionFontSize != undefined && cfg.descriptionFontSize != '' ) {\r\n        G.tn.style[level].desc += 'font-size:' + cfg.descriptionFontSize + ';';\r\n      }\r\n      \r\n      if( cfg.displayDescription == false ) {\r\n        G.tn.style[level].desc += 'display:none;';\r\n      }\r\n    }\r\n\r\n    \r\n    // cache some thumbnail settings\r\n    function ThumbnailDefCaches() {\r\n      // thumbnail content CSS styles\r\n\r\n      // settings for level L1 and LN\r\n      ThumbnailStyle( G.O.thumbnailLabel, 'lN');\r\n      ThumbnailStyle( G.O.thumbnailLabel, 'l1');\r\n\r\n      if( G.O.thumbnailL1Label && G.O.thumbnailL1Label.display ) {\r\n        // settings for level L1\r\n        ThumbnailStyle( G.O.thumbnailL1Label, 'l1');\r\n      }\r\n      \r\n      G.tn.borderWidth = G.O.thumbnailBorderHorizontal;\r\n      G.tn.borderHeight = G.O.thumbnailBorderVertical;\r\n      \r\n\r\n      // default thumbnail sizes levels l1 and lN\r\n      var lst=['xs','sm','me','la','xl'];\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var w = G.tn.settings.width.lN[lst[i]];\r\n        if( w != 'auto' ) {\r\n          G.tn.defaultSize.width.lN[lst[i]] = w;\r\n          G.tn.defaultSize.width.l1[lst[i]] = w;\r\n        }\r\n        else {\r\n          var h = G.tn.settings.height.lN[lst[i]];\r\n          G.tn.defaultSize.width.lN[lst[i]] = h;      // dynamic width --> set height value as default for the width\r\n          G.tn.defaultSize.width.l1[lst[i]] = h;      // dynamic width --> set height value as default\r\n        }\r\n      }\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var h = G.tn.settings.height.lN[lst[i]];\r\n        if( h != 'auto' ) {\r\n          // grid or justified layout\r\n          G.tn.defaultSize.height.lN[lst[i]] = h;  //+G.tn.labelHeight.get();\r\n          G.tn.defaultSize.height.l1[lst[i]] = h;  //+G.tn.labelHeight.get();\r\n        }\r\n        else {\r\n          var w = G.tn.settings.width.lN[lst[i]];\r\n          G.tn.defaultSize.height.lN[lst[i]] = w;      // dynamic height --> set width value as default for the height\r\n          G.tn.defaultSize.height.l1[lst[i]] = w;      // dynamic height --> set width value as default\r\n        }\r\n      }\r\n\r\n      // default thumbnail sizes levels l1\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var w = G.tn.settings.width.l1[lst[i]];\r\n        if( w != 'auto' ) {\r\n          G.tn.defaultSize.width.l1[lst[i]] = w;\r\n        }\r\n        else {\r\n          var h = G.tn.settings.height.l1[lst[i]];\r\n          G.tn.defaultSize.width.l1[lst[i]] = h;      // dynamic width --> set height value as default\r\n        }\r\n      }\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var h = G.tn.settings.height.l1[lst[i]];\r\n        if( h != 'auto' ) {\r\n          // grid or justified layout\r\n          G.tn.defaultSize.height.l1[lst[i]] = h;  //+G.tn.labelHeight.get();\r\n        }\r\n        else {\r\n          var w = G.tn.settings.width.l1[lst[i]];\r\n          G.tn.defaultSize.height.l1[lst[i]]= w ;      // dynamic height --> set width value as default\r\n        }\r\n      }\r\n      \r\n    }\r\n    \r\n\r\n    // ##### THUMBNAIL SIZE MANAGEMENT\r\n    function ThumbnailsSetSize( dir, level, v, crop ) {\r\n      G.tn.settings[dir][level]['xs'] = v;\r\n      G.tn.settings[dir][level]['sm'] = v;\r\n      G.tn.settings[dir][level]['me'] = v;\r\n      G.tn.settings[dir][level]['la'] = v;\r\n      G.tn.settings[dir][level]['xl'] = v;\r\n      G.tn.settings[dir][level]['xsc'] = crop;\r\n      G.tn.settings[dir][level]['smc'] = crop;\r\n      G.tn.settings[dir][level]['mec'] = crop;\r\n      G.tn.settings[dir][level]['lac'] = crop;\r\n      G.tn.settings[dir][level]['xlc'] = crop;\r\n    }\r\n\r\n\r\n    //\r\n    function GalleryThemeGetCurrent() {\r\n\r\n      var cs=null;\r\n      switch(toType(G.O.galleryTheme)) {\r\n        case 'object':    // user custom color scheme object \r\n          cs = G.galleryTheme_dark;  // default color scheme\r\n          jQuery.extend(true,cs,G.O.galleryTheme);\r\n          break;\r\n        case 'string':    // name of an internal defined color scheme\r\n          switch( G.O.galleryTheme ) {\r\n            case 'light':\r\n              cs = G.galleryTheme_light;\r\n              break;\r\n            case 'default':\r\n            case 'dark':\r\n            case 'none':\r\n            default:\r\n              cs = G.galleryTheme_dark;\r\n          }\r\n          break;\r\n        default:\r\n          cs = G.galleryTheme_dark;\r\n      }\r\n      return cs;\r\n    }\r\n    \r\n    // ##### BREADCRUMB/THUMBNAIL COLOR SCHEME #####\r\n    function SetGalleryTheme() {\r\n    \r\n      if( typeof G.O.colorScheme  !== 'undefined' ) {\r\n        G.O.galleryTheme = G.O.colorScheme;\r\n      }\r\n\r\n      var cs = null;\r\n      var galleryTheme = '';\r\n      switch(toType(G.O.galleryTheme)) {\r\n        case 'object':    // user custom color scheme object \r\n          cs = G.galleryTheme_dark;  // default color scheme\r\n          jQuery.extend(true,cs,G.O.galleryTheme);\r\n          galleryTheme='nanogallery_gallerytheme_custom_' + G.baseEltID;\r\n          break;\r\n        case 'string':    // name of an internal defined color scheme\r\n          switch( G.O.galleryTheme ) {\r\n            case 'light':\r\n              cs = G.galleryTheme_light;\r\n              galleryTheme='nanogallery_gallerytheme_light_' + G.baseEltID;\r\n              break;\r\n            case 'default':\r\n            case 'dark':\r\n            case 'none':\r\n            default:\r\n              cs = G.galleryTheme_dark;\r\n              galleryTheme='nanogallery_gallerytheme_dark_' + G.baseEltID;\r\n          }\r\n          break;\r\n        default:\r\n          NanoAlert(G, 'Error in galleryTheme parameter.');\r\n          return;\r\n      }\r\n\r\n      //var s1='.nanogallery_theme_'+G.O.theme+' ';\r\n      var s1='.' + galleryTheme + ' ';\r\n    \r\n      // navigation bar\r\n      var s=s1+'.nGY2Navigationbar { background:'+cs.navigationBar.background+'; }'+'\\n';\r\n      if( cs.navigationBar.border !== undefined && cs.navigationBar.border !== '' ) { s+=s1+'.nGY2Navigationbar { border:'+cs.navigationBar.border+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderTop !== undefined && cs.navigationBar.borderTop !== '' ) { s+=s1+'.nGY2Navigationbar { border-top:'+cs.navigationBar.borderTop+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderBottom !== undefined && cs.navigationBar.borderBottom !== '' ) { s+=s1+'.nGY2Navigationbar { border-bottom:'+cs.navigationBar.borderBottom+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderRight !== undefined && cs.navigationBar.borderRight !== '' ) { s+=s1+'.nGY2Navigationbar { border-right:'+cs.navigationBar.borderRight+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderLeft !== undefined && cs.navigationBar.borderLeft !== '' ) { s+=s1+'.nGY2Navigationbar { border-left:'+cs.navigationBar.borderLeft+'; }'+'\\n'; }\r\n      \r\n      // navigation bar - breadcrumb\r\n      s+=s1+'.nGY2Breadcrumb { background:'+cs.navigationBreadcrumb.background+'; border-radius:'+cs.navigationBreadcrumb.borderRadius+'; }'+'\\n';\r\n      s+=s1+'.nGY2Breadcrumb .oneItem  { color:'+cs.navigationBreadcrumb.color+'; }'+'\\n';\r\n      s+=s1+'.nGY2Breadcrumb .oneItem:hover { color:'+cs.navigationBreadcrumb.colorHover+'; }'+'\\n';\r\n\r\n      // navigation bar - tag filter\r\n      s+=s1+'.nGY2NavFilterUnselected { color:'+cs.navigationFilter.color+'; background:'+cs.navigationFilter.background+'; border-radius:'+cs.navigationFilter.borderRadius+'; }'+'\\n';\r\n      s+=s1+'.nGY2NavFilterSelected { color:'+cs.navigationFilter.colorSelected+'; background:'+cs.navigationFilter.backgroundSelected+'; border-radius:'+cs.navigationFilter.borderRadius+'; }'+'\\n';\r\n      s+=s1+'.nGY2NavFilterSelectAll { color:'+cs.navigationFilter.colorSelected+'; background:'+cs.navigationFilter.background+'; border-radius:'+cs.navigationFilter.borderRadius+'; }'+'\\n';\r\n      \r\n      // thumbnails\r\n      s+=s1+'.nGY2GThumbnail { background:'+cs.thumbnail.background+'; border-color:'+cs.thumbnail.borderColor+'; border-top-width:'+G.O.thumbnailBorderVertical+'px; border-right-width:'+G.O.thumbnailBorderHorizontal+'px; border-bottom-width:'+G.O.thumbnailBorderVertical+'px; border-left-width:'+G.O.thumbnailBorderHorizontal+'px;}'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailStack { background:'+cs.thumbnail.stackBackground+'; }'+'\\n';\r\n      // s+=s1+'.nGY2GThumbnailImage { background:'+cs.thumbnail.background+'; background-image:'+cs.thumbnail.backgroundImage+'; }'+'\\n';\r\n      s+=s1+'.nGY2TnImgBack { background:'+cs.thumbnail.background+'; background-image:'+cs.thumbnail.backgroundImage+'; }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailAlbumUp { background:'+cs.thumbnail.background+'; background-image:'+cs.thumbnail.backgroundImage+'; color:'+cs.thumbnail.titleColor+'; }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailIconsFullThumbnail { color:'+cs.thumbnail.titleColor+'; }\\n';\r\n      s+=s1+'.nGY2GThumbnailLabel { background:'+cs.thumbnail.labelBackground+'; opacity:'+cs.thumbnail.labelOpacity+'; }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailImageTitle  { color:'+cs.thumbnail.titleColor+'; background-color:'+cs.thumbnail.titleBgColor+'; '+(cs.thumbnail.titleShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.titleShadow+';')+' }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailAlbumTitle { color:'+cs.thumbnail.titleColor+'; background-color:'+cs.thumbnail.titleBgColor+'; '+(cs.thumbnail.titleShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.titleShadow+';')+' }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailDescription { color:'+cs.thumbnail.descriptionColor+'; background-color:'+cs.thumbnail.descriptionBgColor+'; '+(cs.thumbnail.descriptionShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.descriptionShadow+';')+' }'+'\\n';\r\n\r\n      // thumbnails - icons\r\n      s+=s1+'.nGY2GThumbnailIcons { padding:'+cs.thumbnailIcon.padding+'; }\\n';\r\n      s+=s1+'.nGY2GThumbnailIcon { color:'+cs.thumbnailIcon.color+'; }\\n';\r\n      s+=s1+'.nGY2GThumbnailIconTextBadge { background-color:'+cs.thumbnailIcon.color+'; }\\n';\r\n      \r\n      // gallery pagination -> dot/rectangle based\r\n      if( G.O.galleryPaginationMode != 'NUMBERS' ) {\r\n        s+=s1+'.nGY2paginationDot { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeColor+';}\\n';\r\n        s+=s1+'.nGY2paginationDotCurrentPage { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeSelectedColor+';}\\n';\r\n        s+=s1+'.nGY2paginationRectangle { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeColor+';}\\n';\r\n        s+=s1+'.nGY2paginationRectangleCurrentPage { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeSelectedColor+';}\\n';\r\n      } else {\r\n        s+=s1+'.nGY2paginationItem { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2paginationItemCurrentPage { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2PaginationPrev { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2PaginationNext { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2paginationItemCurrentPage { background:'+cs.pagination.backgroundSelected+'; }\\n';\r\n      }\r\n      \r\n      // gallery more button\r\n      s+=s1+'.nGY2GalleryMoreButtonAnnotation { background:'+cs.thumbnail.background+'; border-color:'+cs.thumbnail.borderColor+'; border-top-width:'+G.O.thumbnailBorderVertical+'px; border-right-width:'+G.O.thumbnailBorderHorizontal+'px; border-bottom-width:'+G.O.thumbnailBorderVertical+'px; border-left-width:'+G.O.thumbnailBorderHorizontal+'px;}\\n';\r\n      s+=s1+'.nGY2GalleryMoreButtonAnnotation  { color:'+cs.thumbnail.titleColor+'; '+(cs.thumbnail.titleShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.titleShadow)+'; }\\n';\r\n      \r\n      jQuery('head').append('<style id=\"ngycs_'+G.baseEltID+'\">'+s+'</style>');\r\n      G.$E.base.addClass(galleryTheme);\r\n\r\n    };\r\n    \r\n    // ##### VIEWER COLOR SCHEME #####\r\n    function SetViewerTheme( ) {\r\n\r\n      if( G.VOM.viewerTheme != '' ) {\r\n        G.VOM.$cont.addClass(G.VOM.viewerTheme);\r\n        return;\r\n      }\r\n\r\n      if( typeof G.O.colorSchemeViewer  !== 'undefined' ) {\r\n        G.O.viewerTheme = G.O.colorSchemeViewer;\r\n      }\r\n\r\n      var cs=null;\r\n      switch(toType(G.O.viewerTheme)) {\r\n        case 'object':    // user custom color scheme object \r\n          cs = G.viewerTheme_dark;\r\n          jQuery.extend(true, cs, G.O.viewerTheme);\r\n          G.VOM.viewerTheme = 'nanogallery_viewertheme_custom_' + G.baseEltID;\r\n          break;\r\n        case 'string':    // name of an internal defined color scheme\r\n          switch( G.O.viewerTheme ) {\r\n            case 'none':\r\n              return;\r\n              break;\r\n            case 'light':\r\n              cs = G.viewerTheme_light;\r\n              G.VOM.viewerTheme = 'nanogallery_viewertheme_light_' + G.baseEltID;\r\n              break;\r\n            case 'border':\r\n              cs = G.viewerTheme_border;\r\n              G.VOM.viewerTheme = 'nanogallery_viewertheme_border_' + G.baseEltID;\r\n              break;\r\n            case 'dark':\r\n            case 'default':\r\n              cs = G.viewerTheme_dark;\r\n              G.VOM.viewerTheme = 'nanogallery_viewertheme_dark_' + G.baseEltID;\r\n              break;\r\n          }\r\n          break;\r\n        default:\r\n          NanoAlert(G, 'Error in viewerTheme parameter.');\r\n          return;\r\n      }\r\n\r\n      var s1 = '.' + G.VOM.viewerTheme + ' ';\r\n      var s = s1 + '.nGY2Viewer { background:' + cs.background + '; }'+'\\n';\r\n      s += s1 + '.nGY2ViewerMedia { border:' + cs.imageBorder + '; box-shadow:' + cs.imageBoxShadow + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbarBackground { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerToolsTopLeft { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerToolsTopRight { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerAreaNext { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerAreaPrevious { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar { border:' + cs.barBorder + '; color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .previousButton:after { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .nextButton:after { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .closeButton:after { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .label .title { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .label .description { color:' + cs.barDescriptionColor + '; }'+'\\n';\r\n      jQuery('head').append('<style>' + s + '</style>');\r\n      G.VOM.$cont.addClass(G.VOM.viewerTheme);\r\n    };\r\n\r\n    \r\n    \r\n    /** @function SetPolyFills */\r\n    function SetPolyFills() {\r\n\r\n      // POLYFILL FOR BIND function --> for older Safari mobile\r\n      // found on MDN: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind#Compatibility\r\n      if (!Function.prototype.bind) {\r\n        Function.prototype.bind = function (oThis) {\r\n          if (typeof this !== \"function\") {\r\n            // closest thing possible to the ECMAScript 5\r\n            // internal IsCallable function\r\n            throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\r\n          }\r\n\r\n          var aArgs = Array.prototype.slice.call(arguments, 1), \r\n              fToBind = this, \r\n              fNOP = function () {},\r\n              fBound = function () {\r\n                return fToBind.apply(this instanceof fNOP && oThis\r\n                       ? this\r\n                       : oThis,\r\n                       aArgs.concat(Array.prototype.slice.call(arguments)));\r\n              };\r\n\r\n          fNOP.prototype = this.prototype;\r\n          fBound.prototype = new fNOP();\r\n\r\n          return fBound;\r\n        };\r\n      }\r\n\r\n      // requestAnimationFrame polyfill by Erik M�ller. fixes from Paul Irish and Tino Zijdel\r\n      // http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n      // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\r\n      // MIT license\r\n      (function() {\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n          window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\r\n          window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame)\r\n          window.requestAnimationFrame = function(callback, element) {\r\n            var currTime = new Date().getTime();\r\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);\r\n            lastTime = currTime + timeToCall;\r\n            return id;\r\n          };\r\n       \r\n        if (!window.cancelAnimationFrame)\r\n          window.cancelAnimationFrame = function(id) {\r\n            clearTimeout(id);\r\n          };\r\n      }());\r\n      \r\n      // array.removeIf -> removes items from array base on a function's result\r\n      Array.prototype.removeIf = function(callback) {\r\n        var i = this.length;\r\n        while (i--) {\r\n          if (callback(this[i], i)) {\r\n            this.splice(i, 1);\r\n          }\r\n        }\r\n      };  \n\n      // IE11 for startsWith \n      // thanks to @lichtamberg - https://github.com/lichtamberg\n      if (!String.prototype.startsWith) {\n        String.prototype.startsWith = function(searchString, position) {\n          position = position || 0;\n          return this.indexOf(searchString, position) === position;\n        };\n      }\r\n      \r\n    }\r\n    \r\n    \r\n    // Gallery clicked/touched -> retrieve & execute action\r\n    function GalleryClicked(e) {\r\n    \r\n      var r = GalleryEventRetrieveElementl(e, false);\r\n\r\n      if( r.GOMidx == -1 ) { return 'exit'; }\r\n      \r\n      var idx = G.GOM.items[r.GOMidx].thumbnailIdx;\r\n      if( G.GOM.slider.hostIdx == r.GOMidx ) {\r\n        // slider on thumbnail -> open the displayed image\r\n        idx = G.GOM.items[G.GOM.slider.currentIdx].thumbnailIdx;\r\n      }\r\n      switch( r.action ) {\r\n        case 'OPEN':\r\n          ThumbnailOpen(idx, false);\r\n          return 'exit';\r\n          break;\r\n        case 'DISPLAY':\r\n          // used the display icon (ignore if selection mode)\r\n          ThumbnailOpen(idx, true);\r\n          return 'exit';\r\n          break;\r\n        case 'TOGGLESELECT':\r\n          ThumbnailSelectionToggle(idx);\r\n          return 'exit';\r\n          break;\r\n        case 'SHARE':\r\n          PopupShare(idx);\r\n          return 'exit';\r\n          break;\r\n        case 'DOWNLOAD':\r\n          DownloadImage(idx);\r\n          return 'exit';\r\n          break;\r\n        case 'INFO':\r\n          ItemDisplayInfo(G.I[idx]);\r\n          return 'exit';\r\n          break;\r\n        case 'CART':\r\n          AddToCart(idx);\r\n          return 'exit';\r\n          break;\r\n        default:\r\n          // all other actions (custom1..10, or anything else)\r\n          var fu = G.O.fnThumbnailToolCustAction;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(r.action, G.I[idx]) : window[fu](r.action, G.I[idx]);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    // Download an image\r\n    function DownloadImage(idx) {\r\n      if( G.I[idx].mediaKind != 'img' ) { return; }\r\n\r\n      \r\n      var url = G.I[idx].src;\r\n\r\n      if( G.I[idx].downloadURL != undefined && G.I[idx].downloadURL != '' ) {\r\n        url = G.I[idx].downloadURL;\r\n      }\r\n      \n      var a = document.createElement('a');\n      a.href = url;\n      // a.download = url.split('.').pop();\r\n      a.download = url.split('/').pop();\r\n      a.target = '_blank';\r\n      a.style.display = 'none';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);      \n      \r\n    }\r\n    \r\n    // add one image to the shopping cart\r\n    function AddToCart( idx ) {\r\n      // increment counter if already in shopping cart\r\n      var found=false;\r\n      for( var i=0; i<G.shoppingCart.length; i++ ) {\r\n        if( G.shoppingCart[i].idx == idx ) {\r\n          G.shoppingCart[i].cnt++;\r\n          var fu = G.O.fnShoppingCartUpdated;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(G.shoppingCart, G.I[idx]) : window[fu](G.shoppingCart, G.I[idx]);\r\n          }\r\n          TriggerCustomEvent('shoppingCartUpdated');\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // add to shopping cart\r\n      if( !found) {\r\n        G.shoppingCart.push( { idx:idx, ID:G.I[idx].GetID(), cnt:1} );\r\n        var fu=G.O.fnShoppingCartUpdated;\r\n        if( fu !== null ) {\r\n          typeof fu == 'function' ? fu(G.shoppingCart, G.I[idx]) : window[fu](G.shoppingCart, G.I[idx]);\n        }\n        TriggerCustomEvent('shoppingCartUpdated');\r\n      }\r\n    }\r\n    \r\n\r\n    // All thumbnails are set to unselected\r\n    function ThumbnailSelectionClear() {\r\n      G.GOM.nbSelected = 0;\r\n      for( var i = 0, nbTn = G.GOM.items.length; i < nbTn ; i++ ) {\r\n        var item = G .I[G.GOM.items[i].thumbnailIdx];\r\n        if( item.selected ) {\r\n          item.selected = false;\r\n          var fu = G.O.fnThumbnailSelection;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(item.$elt, item, G.I) : window[fu](item.$elt, item, G.I);\r\n          }\r\n        }\r\n        item.selected = false;\r\n      }\r\n    }\r\n    \r\n    function ThumbnailSelectionToggle( idx ){\r\n      var item = G.I[idx];\r\n      if( item.selected === true ) {\r\n        ThumbnailSelectionSet(item, false);\r\n        G.GOM.nbSelected--;\r\n        TriggerCustomEvent('itemUnSelected');\r\n      }\r\n      else {\r\n        ThumbnailSelectionSet(item, true);\r\n        G.GOM.nbSelected++;\r\n        TriggerCustomEvent('itemSelected');\r\n      }\r\n    }\r\n    \r\n    \r\n    // this replaces ThumbnailSelection()\r\n    function ThumbnailSelectionSet(item, selected ){\r\n      \r\n      item.selected = selected;\r\n      \r\n      ThumbnailSelectionSetIcon( item );\r\n      \r\n      // called when the selection status of an item changed\n      var fu=G.O.fnThumbnailSelection;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item, G.I) : window[fu](item.$elt, item, G.I);\r\n      }\r\n    \r\n    }\r\n    \r\n    function ThumbnailSelectionSetIcon( item ) {\r\n      if( item.$elt == null ) {\r\n        // thumbnail is not built\r\n        return;\r\n      }\r\n      // var $sub = item.$getElt('.nGY2GThumbnailSub');\r\n      var $sub = item.$getElt('.nGY2GThumbnail');\r\n      var $icon = item.$getElt('.nGY2GThumbnailIconImageSelect');\r\n      if( item.selected === true) {\r\n        $sub.addClass('nGY2GThumbnailSubSelected');\r\n        $icon.addClass('nGY2ThumbnailSelected');\r\n        $icon.removeClass('nGY2ThumbnailUnselected');\r\n        $icon.html(G.O.icons.thumbnailSelected);\r\n      }\r\n      else {\r\n        $sub.removeClass('nGY2GThumbnailSubSelected');\r\n        $icon.removeClass('nGY2ThumbnailSelected');\r\n        $icon.addClass('nGY2ThumbnailUnselected');\r\n        $icon.html(G.O.icons.thumbnailUnselected);\r\n      }\r\n    }\r\n    \r\n    \r\n    // display a modal popup for sharing image/album\r\n    function PopupShare(idx) {\r\n    \r\n      // SEE SAMPLES: https://gist.github.com/chrisjlee/5196139\r\n      // https://github.com/Julienh/Sharrre\r\n    \r\n      var item=G.I[idx];\r\n\r\n      var currentURL=document.location.protocol + '//' + document.location.hostname + document.location.pathname;\r\n      var newLocationHash = '#nanogallery/' + G.baseEltID + '/';\r\n      if( item.kind == 'image' ) {\r\n        newLocationHash += item.albumID + '/' + item.GetID();\r\n      }\r\n      else {\r\n        newLocationHash += item.GetID();\r\n      }\r\n    \r\n      var content = '';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"facebook\">'   + G.O.icons.shareFacebook +   '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"pinterest\">'  + G.O.icons.sharePinterest +  '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"tumblr\">'     + G.O.icons.shareTumblr +     '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"twitter\">'    + G.O.icons.shareTwitter +    '</div>';\r\n      // content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"googleplus\">' + G.O.icons.shareGooglePlus + '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"vk\">'         + G.O.icons.shareVK +         '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"mail\">'       + G.O.icons.shareMail +       '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\"></div>';\r\n      content += '<input class=\"nGY2PopupOneItemText\" readonly type=\"text\" value=\"' + currentURL+newLocationHash + '\" style=\"width:100%;text-align:center;\">';\r\n      content += '<br>';\r\n\r\n      currentURL = encodeURIComponent(document.location.protocol + '//' + document.location.hostname + document.location.pathname + newLocationHash);\r\n\r\n      var currentTitle = item.title;\r\n      var currentTn = item.thumbImg().src;\r\n      \r\n      \r\n      Popup('Share to:', content, 'Center');\r\n      \r\n      G.popup.$elt.find('.nGY2PopupOneItem').on('click', function(e) {\r\n        e.stopPropagation();\r\n        \r\n        var shareURL = '';\r\n        var found = true;\r\n        switch(jQuery(this).attr('data-share').toUpperCase()) {\r\n          case 'FACEBOOK':\r\n            // <a name=\"fb_share\" type=\"button\" href=\"http://www.facebook.com/sharer.php?u={$url}&media={$imgPath}&description={$desc}\" class=\"joinFB\">Share Your Advertise</a>\r\n            //window.open(\"https://www.facebook.com/sharer.php?u=\"+currentURL,\"\",\"height=368,width=600,left=100,top=100,menubar=0\");\r\n            shareURL = 'https://www.facebook.com/sharer.php?u=' + currentURL;\r\n            break;\r\n          case 'VK':\r\n            shareURL = 'http://vk.com/share.php?url=' + currentURL;\r\n            break;\r\n          case 'GOOGLEPLUS':\r\n            shareURL = \"https://plus.google.com/share?url=\" + currentURL;\r\n            break;\r\n          case 'TWITTER':\r\n            // shareURL=\"https://twitter.com/share?url=\"+currentURL+\"&text=\"+currentTitle;\r\n            shareURL = 'https://twitter.com/intent/tweet?text=' + currentTitle + 'url=' + currentURL;\r\n            break;\r\n          case 'PINTEREST':\r\n            // shareURL='https://pinterest.com/pin/create/bookmarklet/?media='+currentTn+'&url='+currentURL+'&description='+currentTitle;\r\n            shareURL = 'https://pinterest.com/pin/create/button/?media=' + currentTn + '&url=' + currentURL + '&description=' + currentTitle;\r\n            break;\r\n          case 'TUMBLR':\r\n            //shareURL='https://www.tumblr.com/widgets/share/tool/preview?caption=<strong>'+currentTitle+'</strong>&tags=nanogallery2&url='+currentURL+'&shareSource=legacy&posttype=photo&content='+currentTn+'&clickthroughUrl='+currentURL;\r\n            shareURL = 'http://www.tumblr.com/share/link?url=' + currentURL + '&name=' + currentTitle;\r\n            break;\r\n          case 'MAIL':\r\n            shareURL = 'mailto:?subject=' + currentTitle + '&body=' + currentURL;\r\n            break;\r\n          default:\r\n            found = false;\r\n            break;\r\n        }\r\n        \r\n        if( found ) {\r\n          window.open(shareURL, \"\" , \"height=550,width=500,left=100,top=100,menubar=0\" );\r\n          G.popup.close();\r\n          // $popup.remove();\r\n        }\r\n        \r\n      });\r\n    }\r\n    \r\n    // build a modal popup\r\n    function Popup(title, content, align) {\r\n      var pp =  '<div class=\"nGY2Popup\" style=\"opacity:0;\"><div class=\"nGY2PopupContent' + align + '\">';\r\n      pp    +=  '<div class=\"nGY2PopupCloseButton\">' + G.O.icons.buttonClose + '</div>';\r\n      pp    +=  '<div class=\"nGY2PopupTitle\">' + title + '</div>';\r\n      pp    +=  content;\r\n      pp    +=  '</div></div>';\r\n      \r\n      G.popup.$elt = jQuery(pp).appendTo('body');\r\n      setElementOnTop( G.VOM.$viewer, G.popup.$elt);\r\n      \r\n      G.popup.isDisplayed = true;\r\n      \r\n      var tweenable = new NGTweenable();\r\n      tweenable.tween({\r\n        from:       { opacity: 0 },\r\n        to:         { opacity: 1 },\r\n        easing:     'easeInOutSine',\r\n        duration:   250,\r\n        step:       function (state, att) {\r\n          G.popup.$elt.css( state );\r\n        }\r\n      });\r\n      \r\n      G.popup.$elt.find('.nGY2PopupCloseButton').on('click', function(e) {\r\n        e.stopPropagation();\r\n        G.popup.close();\r\n      });\r\n      \r\n    }\r\n\r\n\r\n    function GalleryMouseEnter(e) {\r\n      if( !G.VOM.viewerDisplayed && G.GOM.albumIdx != -1 ) {\r\n        var r = GalleryEventRetrieveElementl(e, true);\r\n        // if( r.action == 'OPEN' && r.GOMidx != -1 ) {\r\n        if( r.GOMidx != -1 ) {\r\n          var target = e.target || e.srcElement;\r\n          // if( target.getAttribute('class') != 'nGY2GThumbnail' ) { return; }\r\n          ThumbnailHover(r.GOMidx);\r\n        }\r\n      }\r\n    }\r\n    \r\n    function GalleryMouseLeave(e) {\r\n      if( !G.VOM.viewerDisplayed && G.GOM.albumIdx != -1 ) {\r\n        var r = GalleryEventRetrieveElementl(e, true);\r\n        if( r.GOMidx != -1 ) {\r\n          var target = e.target || e.srcElement;\r\n          // if( target.getAttribute('class') != 'nGY2GThumbnail' ) { return; }\r\n          ThumbnailHoverOut(r.GOMidx);\r\n        }\r\n      }\r\n    }\r\n    \r\n    function GalleryEventRetrieveElementl( e, ignoreSubItems ) {\r\n      var r = { action: 'NONE', GOMidx: -1 };\r\n      \r\n      if( e == undefined ) {\r\n        return r;\r\n      }\r\n      var target = e.target || e.srcElement;\r\n      while( target != G.$E.conTnParent[0] ) {       // loop element parent up to find the thumbnail element\r\n        if( jQuery(target).hasClass('nGY2GThumbnail') ) {\r\n          if( r.action == 'NONE' ) {\r\n            r.action = 'OPEN';\r\n          }\r\n          r.GOMidx = jQuery(target).data('index');\r\n          return r;\r\n        }\r\n        // if( !ignoreSubItems && jQuery(target).hasClass('nGY2GThumbnailIcon') ) {\r\n        if( !ignoreSubItems ) {\r\n          var a = jQuery(target).data('ngy2action');\r\n          if( a != '' && a != undefined ) {\r\n            r.action = a;\r\n          }\r\n        }\r\n        if( target.parentNode == null ) {\r\n          return r;\r\n        }\r\n        target = target.parentNode;\r\n      }\r\n      return r;\r\n    }\r\n    \r\n\r\n    // Open one thumbnail\r\n    function ThumbnailOpen( idx, ignoreSelected ) {\r\n      var item = G.I[idx];\r\n\r\n      var fu = G.O.fnThumbnailClicked;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item) : window[fu](item.$elt, item);\r\n      }\r\n      \r\n      // open URL\r\n      if( item.destinationURL !== undefined && item.destinationURL.length > 0 ) {\r\n        window.location = item.destinationURL;\r\n        return;\r\n      }\r\n\r\n      switch( item.kind ) {\r\n        case 'image':\r\n          if( ignoreSelected === false && G.GOM.nbSelected > 0 ) {\r\n            ThumbnailSelectionToggle(idx);\r\n          }\r\n          else {\r\n            // display image\r\n            DisplayPhotoIdx(idx);\r\n          }\r\n          break;\r\n        case 'album':\r\n          if( ignoreSelected === false && G.GOM.nbSelected > 0 ) {\r\n            ThumbnailSelectionToggle(idx);\r\n          }\r\n          else {\r\n            if( G.O.thumbnailAlbumDisplayImage && idx != 0 ) {\r\n              // display album content in lightbox\r\n              DisplayFirstMediaInAlbum(idx);\r\n              return;\r\n            }\r\n            else {\r\n              // display album content in gallery\r\n              DisplayAlbum('-1', item.GetID());\r\n            }\r\n          }\r\n          break;\r\n        case 'albumUp':\r\n          var parent = NGY2Item.Get(G, item.albumID);\r\n          DisplayAlbum('-1', parent.albumID);\r\n          break;\r\n      }\r\n    }\r\n    \r\n    function DisplayFirstMediaInAlbum( albumIdx ) {\r\n      if( G.O.debugMode ) { console.log('#DisplayFirstPhotoInAlbum : '+  albumIdx); }\r\n\r\n      var item = G.I[albumIdx];\r\n      \r\n      var l = G.I.length;\r\n      for( var i = 0; i < l; i++ ) {\r\n        if( G.I[i].albumID == item.GetID() ) {\r\n          DisplayPhotoIdx( i );\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // load album content\r\n      AlbumGetContent( item.GetID(), DisplayFirstMediaInAlbum, albumIdx, null );\r\n      \r\n    }\r\n    \r\n\r\n    // Open link to original image (new window)\r\n    function OpenOriginal( item ) {\r\n      switch( G.O.kind ) {\r\n        case 'flickr':\r\n          var sU = 'https://www.flickr.com/photos/' + G.O.userID + '/' + item.GetID();\r\n          if( item.albumID != '0' ) {\r\n            sU += '/in/album-' + item.albumID + '/';\r\n          }\r\n          window.open(sU, '_blank');\r\n          break;\r\n        case 'picasa':\r\n        case 'google':\r\n        case 'google2':\r\n          // no more working since Google changed the access to Google Photos in 2017\r\n          // var sU='https://plus.google.com/photos/'+G.O.userID+'/albums/'+item.albumID+'/'+item.GetID();\r\n          // window.open(sU,'_blank');\r\n          // break;\r\n        default:\r\n          var sU = item.responsiveURL();\r\n          window.open(sU, '_blank');\r\n          break;\r\n      }\r\n    }\r\n    \r\n    // Display one photo (with internal or external viewer)\r\n    function DisplayPhotoIdx( ngy2ItemIdx ) {\r\n\r\n      if( !G.O.thumbnailOpenImage ) { return; }\r\n\r\n      if( G.O.thumbnailOpenOriginal ) {\r\n        // Open link to original image\r\n        OpenOriginal( G.I[ngy2ItemIdx] );\r\n        return;\r\n      }\r\n        \r\n      var items = [];\r\n      G.VOM.currItemIdx = 0;\r\n      G.VOM.items = [];\r\n      G.VOM.albumID = G.I[ngy2ItemIdx].albumID;\r\n      \r\n      var vimg = new VImg(ngy2ItemIdx);\r\n      G.VOM.items.push(vimg);\r\n      items.push(G.I[ngy2ItemIdx]);\r\n      //TODO -> danger? -> pourquoi reconstruire la liste si d�j� ouvert (back/forward)     \r\n      var l = G.I.length;\r\n      for( var idx = ngy2ItemIdx+1; idx < l ; idx++) {\r\n        var item = G.I[idx];\r\n        if( item.kind == 'image' && item.isToDisplay(G.VOM.albumID) && item.destinationURL == '' ) {\r\n          var vimg = new VImg(idx);\r\n          G.VOM.items.push(vimg);\r\n          items.push(item);\r\n        }\r\n      }\r\n      var last = G.VOM.items.length;\r\n      var cnt = 1;\r\n      for( var idx = 0; idx < ngy2ItemIdx ; idx++) {\r\n        var item = G.I[idx];\r\n        if( item.kind == 'image' && item.isToDisplay(G.VOM.albumID) && item.destinationURL == '' ) {\r\n          var vimg = new VImg(idx);\r\n          vimg.mediaNumber = cnt;\r\n          G.VOM.items.push(vimg);\r\n          items.push(item);\r\n          cnt++;\r\n        }\r\n      }\r\n      for( var i = 0; i < last; i++ ) {\r\n        G.VOM.items[i].mediaNumber = cnt;\r\n        cnt++;\r\n      }\r\n    \r\n      // opens media with external viewer\n      var fu = G.O.fnThumbnailOpen;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(items) : window[fu](items);\r\n        return;\r\n      }\r\n    \r\n      // use internal viewer\r\n      if( !G.VOM.viewerDisplayed ) {\r\n        // build viewer and display\r\n        OpenInternalViewer();\r\n      }\r\n      else {\r\n        // viewer already displayed -> display new media in current viewer\r\n        G.VOM.$mediaCurrent.empty();\r\n        var item = G.VOM.NGY2Item(0);\r\n        var spreloader = '<div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>';\r\n        if( item.mediaKind == 'img' && item.imageWidth != 0 && item.imageHeight != 0 ) {\r\n          spreloader = '<div class=\"nGY2ViewerMediaLoaderHidden\"></div>';\r\n        }\r\n        G.VOM.$mediaCurrent.append( spreloader + item.mediaMarkup);\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(1), G.VOM.$mediaNext, 0);\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, 0);\r\n        if( item.mediaKind == 'img' ) {\r\n          G.VOM.ImageLoader.loadImage(VieweImgSizeRetrieved, item);\r\n        }\r\n        // G.VOM.$mediaCurrent.css({ opacity:0 }).attr('src','');\r\n        // G.VOM.ImageLoader.loadImage(VieweImgSizeRetrieved, G.VOM.NGY2Item(0));\r\n        // G.VOM.$mediaCurrent.children().eq(0).attr('src',G.emptyGif).attr('src', G.VOM.NGY2Item(0).responsiveURL());\r\n        DisplayInternalViewer(0, '');\r\n      }\r\n    }\r\n    \r\n    function ViewerZoomStart() {\r\n      if( G.O.viewerZoom && !G.VOM.viewerMediaIsChanged ) {\r\n        var item=G.VOM.NGY2Item(0);\r\n        if( item.imageHeight > 0 && item.imageWidth > 0 ) {\r\n          if( G.VOM.zoom.isZooming === false ) {\r\n            // default zoom\r\n            G.VOM.zoom.userFactor = 1;\r\n            G.VOM.zoom.isZooming = true;\r\n          }\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n          \r\n    function ViewerZoomIn( zoomIn ) {\r\n    if( zoomIn ) {\r\n        // zoom in\r\n        G.VOM.zoom.userFactor+=0.1;\r\n        ViewerZoomMax();\r\n      }\r\n      else {\r\n        // zoom out\r\n        G.VOM.zoom.userFactor-=0.1;\r\n        ViewerZoomMin();\r\n      }\r\n      ViewerMediaSetPosAndZoom();\r\n    }\r\n    \r\n    function ViewerZoomMax() {\r\n      if( G.VOM.zoom.userFactor > 3 ) {\r\n        G.VOM.zoom.userFactor = 3;\r\n      }\r\n    }\r\n    function ViewerZoomMin() {\n    \r\n      if( G.VOM.zoom.userFactor < 0.2 ) {\r\n        G.VOM.zoom.userFactor = 0.2;\r\n      }\r\n    }\r\n    \r\n    \r\n    \r\n    // Set position and size of all 3 media containers\r\n    function ViewerMediaSetPosAndZoom() {\r\n    \r\n      if( !G.VOM.zoom.isZooming ) {\r\n        G.VOM.zoom.userFactor = 1;\r\n      }\r\n      // window.ng_draf( function() {\r\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, true );\r\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, false );\r\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(1), G.VOM.$mediaNext, false );\r\n      // });\r\n    }\r\n    \r\n\r\n    \r\n    // Media which is not IMG -> center and set size\r\n    function ViewerMediaCenterNotImg( $mediaContainer ) {\r\n      var $media = $mediaContainer.children().eq(1);\r\n      $media.css( {'height': '80%' });\r\n      $media.css( {'width':  '90%' });\r\n      $media[0].style[G.CSStransformName] = 'translate(0px, \"50%\") ';\r\n    }\r\n    \r\n    // Set position and size of ONE media container\r\n    function ViewerMediaSetPosAndZoomOne(item, $img, isCurrent ) {\r\n\r\n      if( item.mediaKind != 'img' ) {\r\n        ViewerMediaCenterNotImg($img);\r\n        return;\r\n      }\r\n      \r\n      if( item.imageHeight == 0 || item.imageWidth == 0 ) { \r\n        ViewerSetMediaVisibility( item, $img, 0 );\r\n        return;\r\n      }\r\n\r\n      // part 1: set the image size\r\n      var zoomUserFactor = isCurrent == true ? G.VOM.zoom.userFactor : 1;\r\n      \r\n      var dpr = 1;\r\n      if( G.O.viewerImageDisplay == 'bestImageQuality' ) {\r\n        dpr = window.devicePixelRatio;\r\n      }\r\n      \r\n      // retrieve the base zoom factor (image fill screen)\r\n      var zoomBaseFactorW = (G.VOM.window.lastWidth  - G.VOM.padding.V) / (item.imageWidth  / dpr);\r\n      var zoomBaseFactorH = (G.VOM.window.lastHeight - G.VOM.padding.H) / (item.imageHeight / dpr);\r\n      var zoomBaseFactor = Math.min(zoomBaseFactorW, zoomBaseFactorH);\r\n      if( zoomBaseFactor > 1 && G.O.viewerImageDisplay != 'upscale' ) {\r\n        // no upscale\r\n        zoomBaseFactor = 1;\r\n      }\r\n\r\n      var imageCurrentHeight = (item.imageHeight / dpr) * zoomUserFactor * zoomBaseFactor;\r\n      var imageCurrentWidth  = (item.imageWidth / dpr)  * zoomUserFactor * zoomBaseFactor;\r\n      $img.children().eq(1).css( {'height': imageCurrentHeight });\r\n      $img.children().eq(1).css( {'width':  imageCurrentWidth  });\r\n\r\n      // retrieve posX/Y to center image\r\n      var posX = 0;\r\n      if( imageCurrentWidth > G.VOM.window.lastWidth ) {\r\n        posX = -(imageCurrentWidth - G.VOM.window.lastWidth)/2;\r\n      }\r\n      var posY = 0;\r\n      if( imageCurrentHeight > G.VOM.window.lastHeight ) {\r\n        posY = ( imageCurrentHeight - G.VOM.window.lastHeight ) / 2;\r\n      }\r\n      posY = 0;   // actually, it seems that the image is always centered vertically -> so no need to to anything\r\n      \r\n      // Part 2: set the X/Y position (for zoom/pan)\r\n      if( isCurrent ) {\r\n        if( !G.VOM.zoom.isZooming ) {\r\n          G.VOM.panPosX = 0;\r\n          G.VOM.panPosY = 0;\r\n        }\r\n        G.VOM.zoom.posX = posX;\r\n        G.VOM.zoom.posY = posY;\r\n        ViewerImagePanSetPosition(G.VOM.panPosX, G.VOM.panPosY, $img, false);\r\n      }\r\n      // else {\r\n        //$img[0].style[G.CSStransformName]= 'translate3D('+ posX+'px, '+ posY+'px, 0) ';\r\n      // }\r\n      else {\r\n        // set the pan position of each media container\r\n        ViewerMediaPanX( G.VOM.swipePosX );\r\n        $img.children().eq(1)[0].style[G.CSStransformName]= 'translate(0px, 0px) rotate('+ item.rotationAngle +'deg)';\n      }\r\n      \r\n    }\r\n\r\n    // position the image depending on the zoom factor and the pan X/Y position\r\n    // IMG is the only media supporting zoom/pan\r\n    function ViewerImagePanSetPosition(posX, posY, imageContainer, savePosition ) {\r\n      if( savePosition ) {\r\n        G.VOM.panPosX = posX;\r\n        G.VOM.panPosY = posY;\r\n      }\r\n\r\n      posX += G.VOM.zoom.posX;\r\n      posY += G.VOM.zoom.posY;\n      \n      // imageContainer.children().eq(1)[0].style[G.CSStransformName]= 'translate('+ posX + 'px, '+ posY + 'px)';\n      imageContainer.children().eq(1)[0].style[G.CSStransformName]= 'translate('+ posX + 'px, '+ posY + 'px) rotate('+ G.VOM.NGY2Item(0).rotationAngle +'deg)';\r\n\r\n\r\n    }\r\n    \r\n\r\n    // display media with internal viewer\r\n    function OpenInternalViewer(  ) {\r\n\r\n      G.VOM.viewerDisplayed = true;\r\n      G.GOM.firstDisplay = false;\r\n      \r\n      G.VOM.saveOverflowX = window.getComputedStyle(document.body)['overflow-x'];\r\n      G.VOM.saveOverflowY = window.getComputedStyle(document.body)['overflow-y'];\r\n      jQuery('body').css({ overflow: 'hidden' });  //avoid scrollbars\r\n\r\n      G.VOM.$cont = jQuery('<div  class=\"nGY2 nGY2ViewerContainer\" style=\"opacity:1\"></div>').appendTo('body');\r\n      \r\n      SetViewerTheme();\r\n\r\n      G.VOM.$viewer = jQuery('<div class=\"nGY2Viewer\" style=\"opacity:0\" itemscope itemtype=\"http://schema.org/ImageObject\"></div>').appendTo( G.VOM.$cont );\r\n      G.VOM.$viewer.css({ msTouchAction: 'none', touchAction: 'none' });            // avoid pinch zoom\r\n\r\n      G.VOM.currItemIdx = 0;\r\n      var sMedia = '<div class=\"nGY2ViewerMediaPan\"><div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>' + G.VOM.NGY2Item(-1).mediaMarkup + '</div>';    // previous media\r\n      sMedia    += '<div class=\"nGY2ViewerMediaPan\"><div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>' + G.VOM.NGY2Item(0).mediaMarkup  + '</div>';    // current media\r\n      sMedia    += '<div class=\"nGY2ViewerMediaPan\"><div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>' + G.VOM.NGY2Item(1).mediaMarkup  + '</div>';    // next media\r\n\r\n      var sNav = '';\r\n      var iconP = G.O.icons.viewerImgPrevious;\r\n      if( iconP != undefined && iconP != '') {\r\n        sNav += '<div class=\"nGY2ViewerAreaPrevious ngy2viewerToolAction\" data-ngy2action=\"previous\">' + iconP + '</div>';\r\n      }\r\n      var iconN = G.O.icons.viewerImgNext;\r\n      if( iconN != undefined && iconN != '') {\r\n        sNav += '<div class=\"nGY2ViewerAreaNext ngy2viewerToolAction\" data-ngy2action=\"next\">' + iconN + '</div>';\r\n      }\r\n\r\n      G.VOM.$content = jQuery('<div class=\"nGY2ViewerContent\">' + sMedia + sNav + '</div>').appendTo( G.VOM.$viewer );\r\n\r\n      var $mediaPan = G.VOM.$content.find('.nGY2ViewerMediaPan');\r\n      G.VOM.$mediaPrevious = $mediaPan.eq(0);    // pointer to previous media container\r\n      G.VOM.$mediaCurrent = $mediaPan.eq(1);     // pointer to current media container\r\n      G.VOM.$mediaNext = $mediaPan.eq(2);        // pointer to next media container\r\n\r\n      G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, G.VOM.NGY2Item(0)  );\r\n      G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, G.VOM.NGY2Item(-1) );\r\n      G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, G.VOM.NGY2Item(1)  );\r\n      \r\n      G.VOM.padding.H = parseInt(G.VOM.$content.css(\"padding-left\")) + parseInt(G.VOM.$content.css(\"padding-right\"));\r\n      G.VOM.padding.V = parseInt(G.VOM.$content.css(\"padding-top\")) + parseInt(G.VOM.$content.css(\"padding-bottom\"));\r\n      \r\n      // build media toolbar container\r\n      var vtbBg1 = '';\r\n      var vtbBg2 = ' toolbarBackground';\r\n      if( G.O.viewerToolbar.fullWidth ) {\r\n        vtbBg1 = ' toolbarBackground';\r\n        vtbBg2 = '';\r\n      }\r\n      var vtbAlign = 'text-align:center;';\r\n      switch ( G.O.viewerToolbar.align ) {\r\n        case 'left':\r\n          vtbAlign = 'text-align:left;';\r\n          break;\r\n        case 'right':\r\n          vtbAlign = 'text-align:right;';\r\n          break;\r\n      }\r\n      var sTB = '<div class=\"toolbarContainer nGEvent' + vtbBg1 + '\" style=\"visibility:' +(G.O.viewerToolbar.display ? \"visible\" : \"hidden\")+';'+vtbAlign+'\"><div class=\"toolbar nGEvent' + vtbBg2 + '\"></div></div>';\r\n      G.VOM.$toolbar = jQuery(sTB).appendTo(G.VOM.$viewer);\r\n\r\n      if( G.VOM.toolbarMode == 'min' || (G.O.viewerToolbar.autoMinimize > 0 && G.O.viewerToolbar.autoMinimize >= G.GOM.cache.viewport.w) ) {\r\n        ViewerToolbarForVisibilityMin();\r\n      }\r\n      else {\r\n        ViewerToolbarForVisibilityStd();\r\n      }\r\n      \r\n      // top-left toolbar\r\n      if( G.O.viewerTools.topLeft != '' ) {\r\n        var sTopLeft = '<div class=\"nGY2ViewerToolsTopLeft nGEvent\"><div class=\"toolbar nGEvent\">';\r\n        var sTL = G.O.viewerTools.topLeft.split(',');\r\n        for( var i = 0, sTLL = sTL.length; i < sTLL; i++) {\r\n          sTopLeft += ToolbarAddElt( sTL[i] );\r\n        }\r\n        sTopLeft += '</div></div>';\r\n        G.VOM.$toolbarTL = jQuery(sTopLeft).appendTo(G.VOM.$viewer);\r\n      }\r\n      // top-right toolbar\r\n      if( G.O.viewerTools.topRight != '' ) {\r\n        var sTopRight = '<div class=\"nGY2ViewerToolsTopRight nGEvent\"><div class=\"toolbar nGEvent\">';\r\n        var sTR = G.O.viewerTools.topRight.split(',');\r\n        for( var i = 0, sTRL = sTR.length; i < sTRL; i++) {\r\n          sTopRight += ToolbarAddElt( sTR[i] );\r\n        }\r\n        sTopRight += '</div></div>';\r\n        G.VOM.$toolbarTR = jQuery(sTopRight).appendTo(G.VOM.$viewer);\r\n      }\r\n\r\n      // set the events handler for toolbars\r\n      ViewerToolsOn();\r\n\r\n      // display logo\r\n      if( G.O.viewerDisplayLogo ) { G.$E.vwLogo=jQuery('<div class=\"nGY2 nGY2ViewerLogo\"></div>').appendTo(G.VOM.$viewer); }\r\n\r\n      // Go to fullscreen mode\r\n      if( ngscreenfull.enabled && G.O.viewerFullscreen ) { ngscreenfull.request(); }\r\n\r\n      setElementOnTop('', G.VOM.$viewer);\r\n      ResizeInternalViewer(true);\r\n      G.VOM.timeImgChanged = new Date().getTime();\r\n      \r\n      // viewer display transition\r\n      var tweenable = new NGTweenable();\r\n      tweenable.tween({\r\n        from:         { opacity: 0, posY: G.VOM.window.lastHeight*.5 },\r\n        to:           { opacity: 1, posY: 0 },\r\n        delay:        30,\r\n        duration:     500,\r\n        easing:       'easeOutQuart',\r\n        step:         function (state) {\r\n          G.VOM.$viewer.css('opacity', state.opacity);\r\n          G.VOM.$viewer[0].style[G.CSStransformName] = 'translateY(' + (state.posY) + 'px) ';\r\n        }\r\n      });\r\n\r\n      // stop click propagation on media ==> if the user clicks outside of an media, the viewer is closed\r\n      // --> no more supported since v2.0.0\r\n      // G.VOM.$viewer.find('img').on('click', function (e) { e.stopPropagation(); });\r\n      \r\n      \r\n      ViewerMediaPanX(0);\r\n      ViewerSetEvents();\r\n\r\n      DisplayInternalViewer(0, '');\r\n      \r\n      if( G.O.slideshowAutoStart ) {\r\n        G.VOM.playSlideshow = false;\r\n        SlideshowToggle();\r\n      }\r\n    }\r\n    \r\n    function ViewerEvents() {\r\n      if( !G.VOM.viewerDisplayed || G.VOM.viewerMediaIsChanged || G.VOM.NGY2Item(0).mediaKind != 'img') {\r\n        // ignore fired event if viewer not displayed or if currently changed or if current media not an image\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    \r\n    \r\n    // viewer gesture handling\r\n    function ViewerSetEvents() {\r\n\r\n      if( G.VOM.hammertime == null ) {\r\n      \r\n        G.VOM.hammertime =  new NGHammer.Manager(G.VOM.$cont[0], {\r\n          recognizers: [\r\n            [NGHammer.Pinch, { enable: true }],\r\n            [NGHammer.Pan, { direction: NGHammer.DIRECTION_ALL }]\r\n          ]\r\n        });\r\n     \r\n        // PAN\r\n        G.VOM.hammertime.on('pan', function(ev) {\r\n          if( !ViewerEvents() ) { return; }\r\n\r\n          if( G.VOM.zoom.isZooming ) {\r\n            // pan zoomed image\r\n            ViewerImagePanSetPosition(G.VOM.panPosX + ev.deltaX, G.VOM.panPosY + ev.deltaY, G.VOM.$mediaCurrent, false);\r\n            if( G.VOM.toolbarsDisplayed == true ) {\r\n              G.VOM.toolsHide();\r\n            }\r\n          }\r\n          else {\r\n            if( ev.deltaY > G.VOM.panThreshold && Math.abs(ev.deltaX) < G.VOM.panThreshold && !G.VOM.panXOnly ) {\r\n              // pan viewer down\r\n              ViewerMediaPanX( 0 );\r\n              var dist = Math.min(ev.deltaY, 200);\r\n              G.VOM.$viewer[0].style[G.CSStransformName] = 'translateY(' + dist + 'px) ';\r\n              G.VOM.$viewer.css('opacity', 1-dist/200/2);\r\n            }\r\n            else {\r\n              // pan media left/right\n              if( Math.abs(ev.deltaX) > G.VOM.panThreshold ) {\n                G.VOM.panXOnly = true;\n              }\r\n              ViewerMediaPanX( ev.deltaX );\r\n              G.VOM.$viewer[0].style[G.CSStransformName] = 'translateY(0px)';\r\n              G.VOM.$viewer.css('opacity', 1);\r\n            }\r\n          }\r\n        });\r\n\r\n        // PAN END\r\n        G.VOM.hammertime.on('panend', function(ev) {\r\n          if( !ViewerEvents() ) { return; }\n          if( G.VOM.zoom.isZooming ) {\r\n            G.VOM.timeImgChanged = new Date().getTime();\r\n            ViewerImagePanSetPosition(G.VOM.panPosX+ev.deltaX, G.VOM.panPosY+ev.deltaY, G.VOM.$mediaCurrent, true);\r\n          }\r\n          else {\n            var panY = false;\n            if( !G.VOM.panXOnly ) {\r\n              if( ev.deltaY > 50 && Math.abs(ev.deltaX) < 50 ) {\r\n                // close viewer\r\n                CloseInternalViewer(G.VOM.currItemIdx);\n                panY = true;\r\n              }\n            }\r\n            if( !panY ) {\r\n              if( Math.abs( ev.deltaX ) < 50 ) {\r\n                ViewerMediaPanX(0);\r\n              }\r\n              else {\r\n                ev.deltaX > 50 ? DisplayPreviousMedia() : DisplayNextMedia();\r\n              }\r\n            }\r\n          }\r\n          G.VOM.panXOnly = false;\n        });\r\n        \r\n        if( G.O.viewerZoom ) {\r\n        \r\n          G.VOM.hammertime.add( new NGHammer.Tap({ event: 'doubletap', taps: 2 }) );\r\n          G.VOM.hammertime.add( new NGHammer.Tap({ event: 'singletap' }) );\r\n          G.VOM.hammertime.get('doubletap').recognizeWith('singletap');\r\n          G.VOM.hammertime.get('singletap').requireFailure('doubletap');\r\n\r\n          // single tap -> next/previous media\r\n          G.VOM.hammertime.on('singletap', function(ev) {\r\n            if( !ViewerEvents() ) { return; }\r\n            StopPropagationPreventDefault(ev.srcEvent);\r\n            if( G.VOM.toolbarsDisplayed == false ) {\r\n              debounce( ViewerToolsUnHide, 100, false)();\r\n            }\r\n            else {\r\n              if( ev.target.className.indexOf('nGY2ViewerMedia') !== -1 ) {\r\n                if( ev.srcEvent.pageX < (G.GOM.cache.viewport.w/2) ) {\r\n                  DisplayPreviousMedia();\r\n                }\r\n                else {\r\n                  DisplayNextMedia();\r\n                }\r\n              }\r\n            }\r\n          });\r\n          \r\n          // double tap -> zoom\r\n          G.VOM.hammertime.on('doubletap', function(ev) {\r\n            if( !ViewerEvents() ) { return; }\r\n            StopPropagationPreventDefault(ev.srcEvent);\r\n            \r\n            if( ev.target.className.indexOf('nGY2ViewerMedia') !== -1 ) {\r\n              // double tap only on image\r\n              if( G.VOM.zoom.isZooming ) {\r\n                G.VOM.zoom.isZooming = false;\r\n                // G.VOM.zoom.userFactor = 1;\r\n                ResizeInternalViewer(true);\r\n              }\r\n              else {\r\n                if( ViewerZoomStart() ) {\r\n                  G.VOM.zoom.userFactor = 1.5;\r\n                  ViewerMediaSetPosAndZoom();\r\n                }\r\n              }\r\n            }\r\n          });\r\n        \r\n          // pinch end\r\n          G.VOM.hammertime.on('pinchend', function(ev) {\r\n            ev.srcEvent.stopPropagation();\r\n            ev.srcEvent.preventDefault();  // cancel  mouseenter event\r\n            G.VOM.timeImgChanged = new Date().getTime();\r\n          });\r\n          G.VOM.hammertime.on('pinch', function(ev) {\r\n            ev.srcEvent.stopPropagation();\r\n            ev.srcEvent.preventDefault();  // cancel  mouseenter event\r\n            \r\n            if( ViewerZoomStart() ) {\r\n              G.VOM.zoom.userFactor = ev.scale;\r\n              ViewerZoomMax();\r\n              ViewerZoomMin();\r\n              ViewerMediaSetPosAndZoom();   // center media\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          // no zoom -> click/tap on image to go to next/previous one\r\n          G.VOM.hammertime.on('tap', function(ev) {\r\n            if( !ViewerEvents() ) { return; }\r\n            StopPropagationPreventDefault(ev.srcEvent);\r\n            if( G.VOM.toolbarsDisplayed == false  ){\r\n              // display tools on tap if hidden\r\n              debounce( ViewerToolsUnHide, 100, false)();\r\n            }\r\n            else {\r\n              // display next/previous image if tools not hidden\r\n              if( ev.target.className.indexOf('nGY2ViewerMedia') !== -1 ) {\r\n                if( ev.srcEvent.pageX < (G.GOM.cache.viewport.w/2) ) {\r\n                  DisplayPreviousMedia();\r\n                }\r\n                else {\r\n                  DisplayNextMedia();\r\n                }\r\n              }\r\n            }\r\n            \r\n          });\r\n        }\r\n      }\r\n    }\r\n    \r\n    function StopPropagationPreventDefault(e) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n\r\n    // Hide toolbars on user inactivity\r\n    function ViewerToolsHide() {\r\n      if( G.VOM.viewerDisplayed ) {\r\n        G.VOM.toolbarsDisplayed = false;\r\n        ViewerToolsOpacity(0);\r\n      }\r\n    }\r\n    \r\n    function ViewerToolsUnHide() {\r\n    if( G.VOM.viewerDisplayed ) {\r\n        G.VOM.toolbarsDisplayed = true;\r\n        ViewerToolsOpacity(1);\r\n        G.VOM.toolsHide();\r\n      }\r\n    }\r\n    \r\n    function ViewerToolsOpacity( op ) {\r\n      if( G.VOM.$toolbar != null ) {\n        G.VOM.$toolbar.css('opacity', op);\n      }\n      if( G.VOM.$toolbarTL != null ) {\r\n        G.VOM.$toolbarTL.css('opacity', op);\r\n      }\r\n      if( G.VOM.$toolbarTR != null ) { \r\n        G.VOM.$toolbarTR.css('opacity', op);\r\n      }\r\n      G.VOM.$content.find('.nGY2ViewerAreaNext').css('opacity', op);\r\n      G.VOM.$content.find('.nGY2ViewerAreaPrevious').css('opacity', op);\r\n    }\r\n    \r\n    \r\n    \r\n    function ViewerToolsOn() {\r\n      // removes all events\r\n      G.VOM.$viewer.off('touchstart click', '.ngy2viewerToolAction', ViewerToolsAction); \r\n      \r\n      // action button\r\n      G.VOM.$viewer.on('touchstart click', '.ngy2viewerToolAction', ViewerToolsAction); \r\n    }\r\n\r\n    \r\n    // Actions of the buttton/elements\r\n    function ViewerToolsAction(e) {\r\n      // delay to avoid twice handling on smartphone/tablet (both touchstart click events are fired)\r\n      if( (new Date().getTime()) - G.timeLastTouchStart < 300 ) { return; }\r\n      G.timeLastTouchStart = new Date().getTime();\r\n      \r\n      var $this = $(this);\r\n      var ngy2action = $this.data('ngy2action');\r\n      if( ngy2action == undefined ) { return; }\r\n      switch( ngy2action ) {\r\n        case 'next':\r\n          StopPropagationPreventDefault(e);\r\n          DisplayNextMedia();\r\n          break;\r\n        case 'previous':\r\n          StopPropagationPreventDefault(e);\r\n          DisplayPreviousMedia();\r\n          break;\r\n        case 'playPause':\r\n          e.stopPropagation();\r\n          SlideshowToggle();\r\n          break;\r\n        case 'zoomIn':\r\n          StopPropagationPreventDefault(e);\r\n          if( ViewerZoomStart() ) { ViewerZoomIn( true ); }\r\n          break;\r\n        case 'zoomOut':\r\n          StopPropagationPreventDefault(e);\r\n          if( ViewerZoomStart() ) { ViewerZoomIn( false ); }\r\n          break;\r\n        case 'minimize':\r\n          // toggle toolbar visibility\r\n          StopPropagationPreventDefault(e);\r\n          if( G.VOM.toolbarMode == 'std' ) {\r\n            ViewerToolbarForVisibilityMin();\r\n          }\r\n          else {\r\n            ViewerToolbarForVisibilityStd();\r\n          }\r\n          break;\r\n        case 'fullScreen':\r\n          // Toggle viewer fullscreen mode on/off\r\n          e.stopPropagation();\r\n          if( ngscreenfull.enabled ) {\r\n            ngscreenfull.toggle();\r\n          }\r\n          break;\r\n        case 'info':\r\n          e.stopPropagation();\r\n          ItemDisplayInfo(G.VOM.NGY2Item(0));\r\n          break;\r\n        case 'close':\r\n          StopPropagationPreventDefault(e);\r\n          if( (new Date().getTime()) - G.VOM.timeImgChanged < 400 ) { return; }\r\n          CloseInternalViewer(G.VOM.currItemIdx);\r\n          break;\r\n        case 'download':\r\n          StopPropagationPreventDefault(e);\r\n          DownloadImage(G.VOM.items[G.VOM.currItemIdx].ngy2ItemIdx);\r\n          break;\r\n        case 'share':\r\n          StopPropagationPreventDefault(e);\r\n          PopupShare(G.VOM.items[G.VOM.currItemIdx].ngy2ItemIdx);\r\n          break;\r\n        case 'linkOriginal':\r\n          StopPropagationPreventDefault(e);\r\n          OpenOriginal( G.VOM.NGY2Item(0) );\r\n          break;\n        case 'rotateLeft':\n          StopPropagationPreventDefault(e);\n          ViewerImageRotate(-90);\n          break;\n        case 'rotateRight':\n          StopPropagationPreventDefault(e);\n          ViewerImageRotate(90);\n          break;\r\n      }\r\n      \r\n      // custom button\r\n      var fu = G.O.fnImgToolbarCustClick;\r\n      if( ngy2action.indexOf('custom') == 0  && fu !== null ) {\n        typeof fu == 'function' ? fu(ngy2action, $this, G.VOM.NGY2Item(0)) : window[fu](ngy2action, $this, G.VOM.NGY2Item(0));\r\n      }\n    }\n\n    // rotate displayed image\n    function ViewerImageRotate( angle ) {\n      var item = G.VOM.NGY2Item(0);\n      if( item.mediaKind == 'img' ) {\n        item.rotationAngle += angle;\n        item.rotationAngle = item.rotationAngle % 360;\n        if( item.rotationAngle < 0 ) {\n          item.rotationAngle += 360;\n        }\n        ViewerMediaPanX( 0 );\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, true );\n      }\n    }\r\n     \r\n\r\n    // Display photo infos\r\n    function ItemDisplayInfo( item ) {\r\n\r\n      var content = '<div class=\"nGY2PopupOneItemText\">' + item.title + '</div>';\r\n      content    += '<div class=\"nGY2PopupOneItemText\">' + item.description + '</div>';\r\n      if( item.author != '' ) {\n        content  += '<div class=\"nGY2PopupOneItemText\">' + G.O.icons.user + ' ' + item.author + '</div>';\r\n      }\n      if( item.exif.model != '' ) {\r\n        content  += '<div class=\"nGY2PopupOneItemText\">' + G.O.icons.config + ' ' + item.exif.model + '</div>';\r\n      }\r\n      var sexif = '';\r\n      sexif += item.exif.flash == '' ? '' : ' &nbsp; ' + item.exif.flash;\r\n      sexif += item.exif.focallength == '' ? '' : ' &nbsp; ' + item.exif.focallength+'mm';\r\n      sexif += item.exif.fstop == '' ? '' : ' &nbsp; f' + item.exif.fstop;\r\n      sexif += item.exif.exposure == '' ? '' : ' &nbsp; ' + item.exif.exposure+'s';\r\n      sexif += item.exif.iso == '' ? '' : ' &nbsp; ' + item.exif.iso+' ISO';\r\n      if( item.exif.time != '' ) {\r\n        // var date = new Date(parseInt(item.exif.time));\r\n        // sexif += ' &nbsp; '+date.toLocaleDateString();\r\n        sexif += ' &nbsp; ' + item.exif.time;\r\n      }\r\n      content += '<div class=\"nGY2PopupOneItemText\">' + sexif + '</div>';\r\n\r\n      if( item.exif.location != '' ) {\r\n        content += '<div class=\"nGY2PopupOneItemText\">'+G.O.icons.location+' <a href=\"http://maps.google.com/maps?z=12&t=m&q='+encodeURIComponent(item.exif.location)+'\" target=\"_blank\">'+item.exif.location+'</a></div>';\r\n        // embed google map in iframe (no api key required)\r\n        content += '<iframe width=\"300\" height=\"150\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\" src=\"https://maps.google.com/maps?&amp;t=m&amp;q='+encodeURIComponent( item.exif.location ) +'&amp;output=embed\"></iframe>';  \r\n      }\r\n\r\n      Popup(G.O.icons.viewerInfo, content, 'Left');\r\n   \r\n    }\r\n    \r\n\r\n    \r\n    function ToolbarAddElt( elt ) {\r\n      var r = '<div class=\"ngbt ngy2viewerToolAction ',\r\n      e=elt.replace(/^\\s+|\\s+$/g, '');    // remove trailing/leading whitespace\r\n      switch( e ) {\r\n        case 'minimizeButton':\r\n          var ic = G.O.icons.viewerToolbarMin;\r\n          if( G.VOM.toolbarMode == 'min' ) {\r\n            ic = G.O.icons.viewerToolbarStd;\r\n          }\r\n          r += 'minimizeButton nGEvent\" data-ngy2action=\"minimize\">'+ic+'</div>';\r\n          break;\r\n        case 'previousButton':\r\n          r += 'previousButton nGEvent\" data-ngy2action=\"previous\">'+G.O.icons.viewerPrevious+'</div>';\r\n          break;\r\n        case 'pageCounter':\r\n          r += 'pageCounter nGEvent\"></div>';\r\n          break;\r\n        case 'nextButton':\r\n          r += 'nextButton nGEvent\" data-ngy2action=\"next\">'+G.O.icons.viewerNext+'</div>';\r\n          break;\r\n        case 'playPauseButton':\r\n          r += 'playButton playPauseButton nGEvent\" data-ngy2action=\"playPause\">'+G.O.icons.viewerPlay+'</div>';\r\n          break;\r\n        case 'rotateLeft':\r\n          r += 'rotateLeftButton nGEvent\" data-ngy2action=\"rotateLeft\">'+G.O.icons.viewerRotateLeft+'</div>';\r\n          break;\r\n        case 'rotateRight':\r\n          r += 'rotateRightButton nGEvent\" data-ngy2action=\"rotateRight\">'+G.O.icons.viewerRotateRight+'</div>';\r\n          break;\r\n        case 'downloadButton':\r\n          r += 'downloadButton nGEvent\" data-ngy2action=\"download\">'+G.O.icons.viewerDownload+'</div>';\r\n          break;\r\n        case 'zoomButton':\r\n          r += 'nGEvent\" data-ngy2action=\"zoomIn\">'+G.O.icons.viewerZoomIn+'</div><div class=\"ngbt ngy2viewerToolAction nGEvent\" data-ngy2action=\"zoomOut\">'+G.O.icons.viewerZoomOut+'</div>';\r\n          break;\r\n        case 'fullscreenButton':\r\n          var s = G.O.icons.viewerFullscreenOn;\r\n          if( ngscreenfull.enabled && G.VOM.viewerIsFullscreen ) {\r\n            s = G.O.icons.viewerFullscreenOff;\r\n          }\r\n          r += 'setFullscreenButton fullscreenButton nGEvent\" data-ngy2action=\"fullScreen\">'+s+'</div>';\r\n          break;\r\n        case 'infoButton':\r\n          r += 'infoButton nGEvent\" data-ngy2action=\"info\">'+G.O.icons.viewerInfo+'</div>';\r\n          break;\r\n        case 'linkOriginalButton':\r\n          r += 'linkOriginalButton nGEvent\" data-ngy2action=\"linkOriginal\">' + G.O.icons.viewerLinkOriginal + '</div>';\r\n          break;\r\n        case 'closeButton':\r\n          r += 'closeButton nGEvent\" data-ngy2action=\"close\">'+G.O.icons.buttonClose+'</div>';\r\n          break;\r\n        case 'shareButton':\r\n          r += 'nGEvent\" data-ngy2action=\"share\">'+G.O.icons.viewerShare+'</div>';\r\n          break;\r\n        case 'label':\r\n          r += '\"><div class=\"title nGEvent\" itemprop=\"name\"></div><div class=\"description nGEvent\" itemprop=\"description\"></div></div>';\r\n          break;\r\n        default:\r\n          // custom button\r\n          if( e.indexOf('custom') == 0 ) {\r\n            var t = '';\r\n            // content to display from custom script\n            var fu = G.O.fnImgToolbarCustInit;\r\n            if( fu !== null ) {\r\n              typeof fu == 'function' ? fu(e) : window[fu](e);\r\n            }\r\n            if( t == undefined || t == '' ) {\r\n              // content from icons\r\n              var n = e.substring(6);\r\n              t = G.O.icons['viewerCustomTool'+n];\r\n            }\r\n            r += 'ngy2CustomBtn ' + e + ' nGEvent\" data-ngy2action=\"' + e + '\">' + t + '</div>';\r\n          }\r\n          else {\r\n            r = '';\r\n          }\r\n          break;\r\n      }\r\n      return r;\r\n    }\r\n    \r\n    \r\n    // toggle slideshow mode on/off\r\n    function SlideshowToggle(){\r\n      if( G.VOM.playSlideshow ) {\r\n        window.clearTimeout(G.VOM.playSlideshowTimerID);\r\n        G.VOM.playSlideshow = false;\r\n        G.VOM.$viewer.find('.playPauseButton').html(G.O.icons.viewerPlay);\r\n      }\r\n      else {\r\n        G.VOM.playSlideshow = true;\r\n        DisplayNextMedia();\r\n        G.VOM.$viewer.find('.playPauseButton').html(G.O.icons.viewerPause);\r\n      }\r\n    }\r\n\r\n    function ViewerToolbarForVisibilityStd() {\r\n      G.VOM.toolbarMode = 'std';\r\n      \r\n      var sTB = '';\r\n      var t = G.O.viewerToolbar.standard.split(',');\r\n      for( var i = 0, lt = t.length; i < lt; i++) {\r\n        sTB += ToolbarAddElt( t[i] );\r\n      }\r\n      G.VOM.$toolbar.find('.toolbar').html(sTB);\r\n      ViewerToolbarElementContent();\r\n    }\r\n    \r\n    function ViewerToolbarForVisibilityMin() {\r\n      if( G.O.viewerToolbar.minimized == undefined || G.O.viewerToolbar.minimized == '' ) {\r\n        ViewerToolbarForVisibilityStd();\r\n      }\r\n      else {\r\n        G.VOM.toolbarMode = 'min';\r\n        var sTB = '';\r\n        var t = G.O.viewerToolbar.minimized.split(',');\r\n        for( var i = 0, lt = t.length; i < lt; i++) {\r\n          sTB += ToolbarAddElt( t[i] );\r\n        }\r\n        G.VOM.$toolbar.find('.toolbar').html(sTB);\r\n        ViewerToolbarElementContent();\r\n      }\r\n    }\r\n    \r\n    function ViewerToolbarElementContent() {\r\n    \r\n      var vomIdx=G.VOM.currItemIdx;\r\n      if( vomIdx == null ) { return; }\r\n      \r\n      var item=G.VOM.NGY2Item(0);\r\n    \r\n      // LABEL\r\n      var setTxt = false;\r\n      // set title\r\n      if( item.title !== undefined && item.title != '' ) {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.title').html(item.title);\r\n        setTxt = true;\r\n      }\r\n      else {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.title').html('');\r\n      }\r\n      // set description\r\n      if( item.description !== undefined && item.description != '' ) {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.description').html(item.description);\r\n        setTxt = true;\r\n      }\r\n      else {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.description').html('');\r\n      }\r\n      \r\n      if( setTxt ) {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.label').show();\r\n      }\r\n      else {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.label').hide();\r\n      }\r\n      \r\n      // set page number\r\n      var viewerMaxImages = G.VOM.items.length;\r\n      if( viewerMaxImages > 0 ) {\r\n        G.VOM.$viewer.find('.pageCounter').html((G.VOM.items[vomIdx].mediaNumber)+'/'+viewerMaxImages);\r\n      }\r\n      \r\n      // custom elements\r\n      var $cu = G.VOM.$viewer.find('.ngy2CustomBtn');\r\n      var fu = G.O.fnImgToolbarCustDisplay;\r\n      if( $cu.length > 0 && fu !== null ) {\n        typeof fu == 'function' ? fu($cu, item) : window[fu]($cu, item);\r\n      }\n      \r\n      // set event handlers again\r\n      ViewerToolsOn();\r\n    }\r\n    \r\n    // Pan the media container in the lightbox (left/right)\r\n    function ViewerMediaPanX( posX ) {\r\n      G.VOM.swipePosX = posX;\r\n      if( G.CSStransformName == null ) {\r\n        // no pan if CSS transform not supported\r\n        // G.VOM.$mediaCurrent.css({ left: posX }); \r\n      }\r\n      else {\r\n      \r\n        // pan left/right the current media\r\n        // window.ng_draf( function() {\r\n          G.VOM.$mediaCurrent[0].style[G.CSStransformName] = 'translate(' + posX + 'px, 0px)';\r\n        // });\r\n\r\n        var itemPrevious = G.VOM.NGY2Item(-1);\n        var itemNext = G.VOM.NGY2Item(1);\n        \r\n        // next/previous media\r\n        if(  G.O.imageTransition.startsWith('SWIPE') ) {\r\n          if( itemPrevious.mediaTransition() ) {\r\n            ViewerSetMediaVisibility(G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, 1);\r\n          }\r\n          if( itemNext.mediaTransition() ) {\r\n            ViewerSetMediaVisibility(G.VOM.NGY2Item(1), G.VOM.$mediaNext, 1);\r\n          }\r\n\r\n          var sc = Math.min( Math.max( Math.abs(posX) / G.VOM.window.lastWidth, .8), 1);\r\n          if( G.O.imageTransition == 'SWIPE' ) { sc = 1; }\r\n\r\n          if( posX > 0 ) {\r\n            var dir = G.VOM.window.lastWidth;\n            if( itemPrevious.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaPrevious[0].style[G.CSStransformName] = 'translate(' + (-dir + posX) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n            if( itemNext.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaNext[0].style[G.CSStransformName] = 'translate(' + (dir) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n          }\r\n          else {\r\n            var dir = -G.VOM.window.lastWidth;\r\n            if( itemNext.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaNext[0].style[G.CSStransformName] = 'translate(' + (-dir + posX) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n            if( itemPrevious.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaPrevious[0].style[G.CSStransformName] = 'translate(' + (dir) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n          }\r\n        }\r\n        \r\n        \r\n        if(  G.O.imageTransition == 'SLIDEAPPEAR' ) {\r\n          G.VOM.$mediaPrevious[0].style[G.CSStransformName] = '';\r\n          G.VOM.$mediaNext[0].style[G.CSStransformName] = '';\r\n          if( posX < 0 ) {\r\n            var o = (-posX) / G.VOM.window.lastWidth;\r\n            if( itemNext.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemNext, G.VOM.$mediaNext, o);\r\n            }\r\n            if( itemPrevious.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemPrevious, G.VOM.$mediaPrevious, 0);\r\n            }\r\n          }\r\n          else {\r\n            var o = posX / G.VOM.window.lastWidth;\r\n            if( itemPrevious.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemPrevious, G.VOM.$mediaPrevious, o);\r\n            }\r\n            if( itemNext.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemNext, G.VOM.$mediaNext, 0);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Display next image\r\n    function DisplayNextMedia() {\r\n      if( G.VOM.viewerMediaIsChanged || ((new Date().getTime()) - G.VOM.timeImgChanged < 300) ) { return; }\r\n      \r\n      TriggerCustomEvent('lightboxNextImage');\r\n      DisplayInternalViewer(G.VOM.IdxNext(), 'nextImage');\r\n    };\r\n    \r\n    // Display previous image\r\n    function DisplayPreviousMedia() {\r\n      if( G.VOM.viewerMediaIsChanged || ((new Date().getTime()) - G.VOM.timeImgChanged < 300) ) { return; }\r\n      if( G.VOM.playSlideshow ) {\r\n        SlideshowToggle();\r\n      }\r\n      \r\n      TriggerCustomEvent('lightboxPreviousImage');\r\n      DisplayInternalViewer(G.VOM.IdxPrevious(), 'previousImage');\r\n    };\r\n    \r\n    // Display image (and run animation)\r\n    function DisplayInternalViewer( newVomIdx, displayType ) {\r\n\r\n      if( G.VOM.playSlideshow ) { window.clearTimeout(G.VOM.playSlideshowTimerID); }\r\n      \r\n      var itemOld = G.VOM.NGY2Item(0);\n      var itemNew = G.I[G.VOM.items[newVomIdx].ngy2ItemIdx];\r\n      var $new = (displayType == 'nextImage' ? G.VOM.$mediaNext : G.VOM.$mediaPrevious);\r\n      if( displayType == 'nextImage' ) {\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, 0);\r\n      }\r\n      else {\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(1), G.VOM.$mediaNext, 0);\r\n      }\r\n\r\n      G.VOM.timeImgChanged = new Date().getTime();\r\n      G.VOM.viewerMediaIsChanged = true;\r\n      G.VOM.zoom.isZooming = false;\r\n      ResizeInternalViewer(true);\r\n \r\n      if( G.O.debugMode && console.timeline ) { console.timeline('nanogallery2_viewer'); }\r\n\r\n      SetLocationHash( itemNew.albumID, itemNew.GetID() );\r\n      \r\n      // animation duration is proportional of the remaining distance\r\n      var vP = G.GOM.cache.viewport;\r\n      var dur = 400 * (vP.w - Math.abs(G.VOM.swipePosX)) / vP.w;\r\n      \r\n      if( displayType == '' ) {\r\n        // first image --> just appear / no slide animation\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n        if( G.CSStransformName == null ) {\r\n          // no CSS transform support -> no animation\r\n          ViewerSetMediaVisibility(itemNew, $new, 1);\r\n          DisplayInternalViewerComplete(displayType, newVomIdx);\r\n        }\r\n        else {\r\n          ViewerSetMediaVisibility(itemNew, $new, 0);\r\n          new NGTweenable().tween({\r\n            from:         { opacity: 0 },\r\n            to:           { opacity: 1 },\r\n            attachment:   { dT: displayType, item: itemOld },\r\n            easing:       'easeInOutSine',\r\n            delay:        30,\r\n            duration:     400,\r\n            step:         function (state, att) {\r\n              // using scale is not a good idea on Chrome -> image will be blurred\r\n              G.VOM.$content.css('opacity', state.opacity);\r\n            },\r\n            finish:       function (state, att) {\r\n              ViewerToolsUnHide();\r\n              DisplayInternalViewerComplete(att.dT, newVomIdx);\r\n            }\r\n          });\r\n        }\r\n      }\r\n      else {\r\n        // animate the image transition between 2 images\r\n        if( G.CSStransformName == null  ) {\r\n          // no CSS transform support -> no animation\r\n          ViewerSetMediaVisibility(itemNew, $new, 1);\r\n          ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n          DisplayInternalViewerComplete(displayType, newVomIdx);\r\n        }\r\n        else {\r\n          switch( G.O.imageTransition ) {\r\n            case 'SWIPE':\r\n            case 'SWIPE2':\r\n              var dir = ( displayType == 'nextImage' ? - vP.w : vP.w );\r\n              $new[0].style[G.CSStransformName] = 'translate('+(-dir)+'px, 0px) '\r\n\r\n              new NGTweenable().tween({\r\n                from:         { t: G.VOM.swipePosX  },\r\n                to:           { t: (displayType == 'nextImage' ? - vP.w : vP.w) },\r\n                attachment:   { dT: displayType, $e: $new, itemNew: itemNew, itemOld: itemOld, dir: dir },\r\n                delay:        30,\r\n                duration:     dur,\r\n                easing:       (G.O.imageTransition == 'swipe' ? 'easeInOutSine' : 'easeInOutCubic'),\r\n                step:         function (state, att) {\r\n                  // current media\r\n                  ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n                  // G.VOM.$mediaCurrent[0].style[G.CSStransformName] = 'translate(' + state.t + 'px, 0px) rotate(' + att.itemOld.rotationAngle + 'deg)';\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName] = 'translate(' + state.t + 'px, 0px)';\r\n                  // new media\r\n                  if( att.itemNew.mediaTransition() ) {\r\n                    ViewerSetMediaVisibility(att.itemNew, att.$e, 1);\r\n\r\n                    var sc = Math.min( Math.max( (Math.abs(state.t)) / G.VOM.window.lastWidth, .8), 1);\r\n                    if( G.O.imageTransition == 'SWIPE' ) { sc = 1; }\r\n                    // att.$e[0].style[G.CSStransformName] = 'translate(' + (-att.dir+state.t) + 'px, 0px) scale(' + sc + ') rotate(' + att.itemNew.rotationAngle + 'deg)';\n                    att.$e[0].style[G.CSStransformName] = 'translate(' + (-att.dir+state.t) + 'px, 0px) scale(' + sc + ')';\r\n                  }\r\n                },\r\n                finish:       function (state, att) {\r\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName] = '';\r\n                  att.$e[0].style[G.CSStransformName] = '';\r\n                  DisplayInternalViewerComplete(att.dT, newVomIdx);\r\n                }\r\n              });\r\n              break;\r\n              \r\n            case 'SLIDEAPPEAR':\r\n            default:\r\n              var dir=(displayType == 'nextImage' ? - vP.w : vP.w);\r\n              var op = (Math.abs(G.VOM.swipePosX)) / G.VOM.window.lastWidth;\r\n              $new[0].style[G.CSStransformName] = '';\r\n              new NGTweenable().tween({\r\n                from:         { o: op, t: G.VOM.swipePosX },\r\n                to:           { o: 1, t: (displayType == 'nextImage' ? - vP.w : vP.w) },\r\n                attachment:   { dT:displayType, $e:$new, itemNew: itemNew, itemOld: itemOld, dir: dir },\r\n                delay:        30,\r\n                duration:     dur,\r\n                easing:       'easeInOutSine',\r\n                step:         function (state, att) {\r\n                  // current media - translate\r\n                  // G.VOM.$mediaCurrent[0].style[G.CSStransformName]= 'translate('+state.t+'px, 0px) rotate(' + att.itemOld.rotationAngle + 'deg)';\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName]= 'translate('+state.t+'px, 0px)';\r\n                  // new media - opacity\r\n                  if( att.itemNew.mediaTransition() ) {\r\n                    ViewerSetMediaVisibility(att.itemNew, att.$e, state.o);\r\n                  }\r\n                },\r\n                finish:       function (state, att) {\r\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName]= '';\r\n                  DisplayInternalViewerComplete(att.dT, newVomIdx);\r\n                }\r\n              });\r\n              break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  \r\n\r\n    function DisplayInternalViewerComplete( displayType, newVomIdx ) {\r\n      G.VOM.currItemIdx = newVomIdx;\r\n      \r\n      var ngy2item = G.VOM.NGY2Item(0);\r\n\r\n      ViewerToolbarElementContent();\r\n      if( G.O.debugMode && console.timeline ) { console.timelineEnd('nanogallery2_viewer'); }\r\n\r\n      var fu=G.O.fnImgDisplayed;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(ngy2item) : window[fu](ngy2item);\r\n      }\r\n      \r\n      G.VOM.swipePosX = 0;\r\n      if( displayType != '' ) {\r\n        // not on first media display\r\n        // G.VOM.$mediaCurrent.off(\"click\");\r\n        G.VOM.$mediaCurrent.removeClass('imgCurrent');\r\n\r\n        var $tmp = G.VOM.$mediaCurrent;\r\n        switch( displayType ) {\r\n          case 'nextImage':\r\n            G.VOM.$mediaCurrent = G.VOM.$mediaNext;\r\n            G.VOM.$mediaNext = $tmp;\r\n            break;\r\n          case 'previousImage':\r\n            G.VOM.$mediaCurrent = G.VOM.$mediaPrevious;\r\n            G.VOM.$mediaPrevious = $tmp;\r\n            break;\r\n        }\r\n      }\r\n      \r\n      G.VOM.$mediaCurrent.addClass('imgCurrent');\r\n      \r\n      // re-sort the media containers --> current on top\r\n      var $pans = G.VOM.$content.find('.nGY2ViewerMediaPan');\r\n      G.VOM.$mediaCurrent.insertAfter($pans.last());\r\n      \r\n      if( ngy2item.mediaKind == 'img' && ngy2item.imageWidth == 0 ) {\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 0);\r\n      }\r\n      else {\r\n        G.VOM.$mediaCurrent.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n      }\r\n\r\n      \r\n      // set the new NEXT media\r\n      G.VOM.$mediaNext.empty();\r\n      var nextItem = G.VOM.NGY2Item(1);\r\n      var spreloader = '<div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>';\r\n      if( nextItem.mediaKind == 'img' && nextItem.imageWidth != 0 && nextItem.imageHeight != 0 ) {\r\n        spreloader = '<div class=\"nGY2ViewerMediaLoaderHidden\"></div>';\r\n      }\r\n      G.VOM.$mediaNext.append( spreloader + nextItem.mediaMarkup );\r\n      ViewerSetMediaVisibility(nextItem, G.VOM.$mediaNext, 0);\r\n      if( nextItem.mediaKind == 'img' ) {\r\n        G.VOM.ImageLoader.loadImage(VieweImgSizeRetrieved, nextItem);\r\n      }\n      else {\r\n        ViewerMediaCenterNotImg( G.VOM.$mediaNext );\r\n      }\r\n\r\n      // set the new PREVIOUS media\r\n      G.VOM.$mediaPrevious.empty();\r\n      var previousItem = G.VOM.NGY2Item(-1);\r\n      spreloader = '<div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>';\r\n      if( previousItem.mediaKind == 'img' && previousItem.imageWidth != 0 && previousItem.imageHeight != 0 ) {\r\n        spreloader = '<div class=\"nGY2ViewerMediaLoaderHidden\"></div>';\r\n      }\r\n      G.VOM.$mediaPrevious.append( spreloader + previousItem.mediaMarkup );\r\n      ViewerSetMediaVisibility(previousItem, G.VOM.$mediaPrevious, 0);\r\n      if( previousItem.mediaKind == 'img' ) {\r\n        G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, previousItem );\r\n      }\r\n      else {\r\n        ViewerMediaCenterNotImg( G.VOM.$mediaPrevious );\r\n      }\r\n\r\n        \r\n      // slideshow mode - wait until image is loaded to start the delay for next image\r\n      if( G.VOM.playSlideshow ) {\r\n        G.VOM.$mediaCurrent.children().eq(1).ngimagesLoaded().always( function( instance ) {\r\n          if( G.VOM.playSlideshow ) {\r\n            // in the meantime the user could have stopped the slideshow\r\n            G.VOM.playSlideshowTimerID = window.setTimeout( function(){ DisplayNextMedia(); }, G.VOM.slideshowDelay );\r\n          }\r\n        });\r\n      }\r\n      \r\n      // close viewer when user clicks outside of the image\r\n      // G.VOM.$mediaCurrent.on(\"click\",function(e){\r\n      //  e.stopPropagation();\r\n      //  if( (new Date().getTime()) - G.VOM.timeImgChanged < 400 ) { return; }\r\n      //  StopPropagationPreventDefault(e);\r\n      //  CloseInternalViewer(G.VOM.currItemIdx);\r\n      //  return false;\r\n      // });\r\n\r\n      ResizeInternalViewer();\r\n\r\n      G.VOM.viewerMediaIsChanged = false;\r\n      TriggerCustomEvent('lightboxImageDisplayed');\r\n      \r\n    }\r\n\r\n    \r\n    // Is fired as soon as the size of an image has been retrieved (the download may not be finished)\r\n    function VieweImgSizeRetrieved(w, h, item, n) {\r\n      item.imageWidth = w;\r\n      item.imageHeight = h;\r\n  \r\n      // image sized retrieved for currently displayed media\r\n      // if( G.VOM.$mediaCurrent !== null && G.VOM.$mediaCurrent.children().attr('src') == item.responsiveURL() ) {\r\n      if( G.VOM.NGY2Item(0) == item ) {\r\n        // it is the current displayed media\r\n        G.VOM.$mediaCurrent.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n        G.VOM.zoom.userFactor = 1;\r\n      }\r\n      \n      if( G.VOM.NGY2Item(1) == item ) {   // next media\n        G.VOM.$mediaNext.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\n      }\n      if( G.VOM.NGY2Item(-1) == item ) {   // previous media\n        G.VOM.$mediaPrevious.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\n      }\n      \r\n      ViewerMediaSetPosAndZoom();\r\n\r\n    }\r\n\r\n    // Viewer - Set the visibility of the media and it's container\r\n    function ViewerSetMediaVisibility(item, $media, opacity ) {\r\n      \r\n      if( item.mediaKind == 'img' && item.imageWidth == 0 ) {\r\n        // do not display image if width is unknown (--> callback will set the width when know)\r\n        // setting opacity to 0 is not enough -> it is mandatory to change also the visibility to hidden to avoid responds to events (click/touch)\r\n        // $media.children().css({ opacity: 0, visibility: 'hidden' });\n        $media.children().eq(1).css({ opacity: 0, visibility: 'hidden' });    // hide media\r\n        // $media.css({ opacity: 0, visibility: 'hidden' });\r\n        return;\r\n      }\r\n      \r\n      if( opacity == 0 ) {\r\n        // setting opacity to 0 is not enough -> it is mandatory to change also the visibility to hidden to avoid responds to events (click/touch)\r\n        // $media.css({ opacity: 0, visibility: 'hidden' });\r\n        $media.children().css({ opacity: 0, visibility: 'hidden' });    // hide media\r\n      }\r\n      else {\r\n        // $media.css({ opacity: opacity, visibility: 'visible' });\r\n        $media.children().css({ opacity: opacity, visibility: 'visible' });      // display media\n      }\r\n    }\r\n    \r\n    \r\n    // Close the internal lightbox\r\n    function CloseInternalViewer( vomIdx ) {\r\n\r\n      G.VOM.viewerMediaIsChanged = false;\r\n\r\n      if( G.VOM.viewerDisplayed ) {\r\n\r\n        // set scrollbar visible again\r\n      jQuery('body').css({ overflowX: G.VOM.saveOverflowX, overflowY: G.VOM.saveOverflowY});\r\n      // jQuery('body').css({overflow: 'visible'});\r\n        \r\n        \r\n        if( G.VOM.playSlideshow ) {\r\n          window.clearTimeout(G.VOM.playSlideshowTimerID);\r\n          G.VOM.playSlideshow = false;\r\n        }\r\n\r\n        // G.VOM.userEvents.removeEventListeners();\r\n        // G.VOM.userEvents=null;\r\n        G.VOM.hammertime.destroy();\r\n        G.VOM.hammertime = null;\r\n\r\n        if( ngscreenfull.enabled && G.VOM.viewerIsFullscreen ) {\r\n          G.VOM.viewerIsFullscreen = false;\r\n          ngscreenfull.exit();\r\n        }\r\n        \r\n        G.VOM.$cont.hide(0).off().show(0).html('').remove();\r\n        G.VOM.viewerDisplayed = false;\r\n\r\n        if( G.O.thumbnailAlbumDisplayImage ) {\r\n          // content of album displayed directly in lightbox (no gallery display for album content)\r\n          if( vomIdx == null ) {\r\n            // lightbox closed with browser back-button\r\n            // the gallery is already displayed\r\n          }\r\n          else {\r\n            var item = G.I[G.VOM.items[vomIdx].ngy2ItemIdx];\r\n            var parent = NGY2Item.Get(G, item.albumID);\r\n            if( G.GOM.albumIdx != parent.albumID ) {\r\n              // display album only if not already displayed\r\n              DisplayAlbum('-1', parent.albumID);\r\n            }\r\n            else {\r\n              GalleryResize();        \r\n              SetLocationHash( '', '' );\r\n              ThumbnailHoverReInitAll();\r\n            }\r\n          }\r\n            // DisplayAlbum( '-', G.I[G.VOM.items[vomIdx].ngy2ItemIdx].albumID );\r\n        }\r\n        else {\r\n          if( vomIdx != null ) {\r\n            if( G.GOM.albumIdx == -1 ) {\r\n              // album not displayed --> display gallery\r\n              DisplayAlbum( '', G.I[G.VOM.items[vomIdx].ngy2ItemIdx].albumID );\r\n            }\r\n            else {\r\n              GalleryResize();        \r\n              SetLocationHash( G.I[G.VOM.items[vomIdx].ngy2ItemIdx].albumID, '' );\r\n              ThumbnailHoverReInitAll();\r\n            }\r\n          }\r\n        }\r\n        G.VOM.timeImgChanged = new Date().getTime();\r\n      }\r\n    }\r\n\r\n    \r\n    // Internal viewer resized -> reposition elements\r\n    function ResizeInternalViewer( forceUpdate ) {\r\n      forceUpdate = typeof forceUpdate !== 'undefined' ? forceUpdate : false;\r\n      \r\n      if( G.VOM.$toolbar === null ) { return; }   // viewer build not finished\r\n      \r\n      \r\n      // window.requestAnimationFrame( function() {    // synchronize with screen\r\n      var windowsW = G.VOM.$viewer.width();\r\n      var windowsH = G.VOM.$viewer.height();\r\n      var $elt = G.VOM.$mediaCurrent.children().eq(1);\r\n      if( $elt == null || G.VOM.currItemIdx == -1 ) { return; }\r\n      \r\n      if( !forceUpdate && G.VOM.window.lastWidth == windowsW  && G.VOM.window.lastHeight == windowsH ) { return; }\r\n      \r\n      G.VOM.window.lastWidth = windowsW;\r\n      G.VOM.window.lastHeight = windowsH;\r\n\r\n      // var vwImgC_H=$elt.height(),\r\n      // vwImgC_W=$elt.width(),\r\n      // vwImgC_OHt=$elt.outerHeight(true),\r\n      // vwImgC_OHf=$elt.outerHeight(false);\r\n\r\n      var $tb = G.VOM.$toolbar.find('.toolbar');\r\n      var tb_OHt = $tb.outerHeight(true);\r\n\r\n      switch( G.O.viewerToolbar.position ) {\r\n        case 'topOverImage':\r\n          G.VOM.$content.css({height: windowsH, width: windowsW, top: 0  });\r\n          G.VOM.$toolbar.css({top: 0, bottom: ''});\r\n          break;\r\n        case 'top':\r\n          windowsH -= tb_OHt;\r\n          G.VOM.$content.css({height: windowsH, width: windowsW, top: tb_OHt  });\r\n          G.VOM.$toolbar.css({top: 0});\r\n          break;\r\n        case 'bottomOverImage':\r\n          G.VOM.$content.css({height:windowsH, width: windowsW, bottom: 0, top: 0  });\r\n          G.VOM.$toolbar.css({bottom: 0});\r\n          break;\r\n        case 'bottom':\r\n        default:\r\n          windowsH -= tb_OHt;\r\n          G.VOM.$content.css({ width: windowsW, top: 0, bottom: tb_OHt });\r\n          G.VOM.$toolbar.css({bottom: 0});\r\n          break;\r\n      }\r\n\r\n      if( !G.VOM.viewerMediaIsChanged && G.VOM.zoom.isZooming ) {\r\n        ViewerMediaSetPosAndZoom();\r\n      }\r\n      else {\r\n\t\t\t\tif( !G.VOM.zoom.isZooming && ( G.VOM.zoom.userFactor != 0 || G.VOM.panPosX != 0 || G.VOM.panPosY != 0 || G.VOM.zoom.posX != 0 || G.VOM.zoom.posY != 0 )) {\r\n\t\t\t\t\t// animate image zoom factor and position back to initial values\r\n\t\t\t\t\tG.VOM.zoom.isZooming= true;\t\t// activate zooming temporarily\r\n          new NGTweenable().tween({\r\n            from:           { userFactor: G.VOM.zoom.userFactor, panPosX: G.VOM.panPosX, panPosY: G.VOM.panPosY, zoomPosX: G.VOM.zoom.posX, zoomPosY: G.VOM.zoom.posY },\r\n            to:           { userFactor: 1, panPosX: 0, panPosY: 0, zoomPosX: 0, zoomPosY: 0 },\r\n            easing:       'easeInOutSine',\r\n            delay:        0,\r\n            duration:     150,\r\n            step:         function (state) {\r\n\t\t\t\t\t\t\tG.VOM.zoom.userFactor=state.userFactor;\r\n\t\t\t\t\t\t\tG.VOM.panPosX=state.panPosX;\r\n\t\t\t\t\t\t\tG.VOM.panPosY=state.panPosY;\r\n\t\t\t\t\t\t\tG.VOM.zoom.posX=state.zoomPosX;\r\n\t\t\t\t\t\t\tG.VOM.zoom.posY=state.zoomPosY;\r\n\t\t\t\t\t\t\tViewerMediaSetPosAndZoom();\r\n            },\r\n            finish:       function (state) {\r\n\t\t\t\t\t\t\tG.VOM.zoom.isZooming=false;\r\n            }\r\n          });\r\n\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tG.VOM.zoom.userFactor = 1;\r\n\t\t\t\t\tG.VOM.zoom.isZooming = false;\r\n\t\t\t\t\tG.VOM.panPosX = 0;\r\n\t\t\t\t\tG.VOM.panPosY = 0;\r\n\t\t\t\t\tG.VOM.zoom.posX = 0;\r\n\t\t\t\t\tG.VOM.zoom.posY = 0;\r\n\t\t\t\t\tViewerMediaSetPosAndZoom();\r\n\t\t\t\t}\r\n      }\r\n    }\r\n\r\n\r\n\r\n    /** @function BuildSkeleton */\r\n    /** Build the gallery structure **/\r\n    function BuildSkeleton() {\r\n    \r\n      // store markup if defined\r\n      var $elements = G.$E.base.children('a');\r\n      if( $elements.length > 0 ) {\r\n        G.O.$markup = $elements;\r\n      }\r\n      G.$E.base.text('');\r\n      G.$E.base.addClass('ngy2_container');\r\n      \r\n      // RTL or LTR\r\n      var sRTL='';\r\n      if( G.O.RTL ) {\r\n        sRTL = 'style=\"text-align:right;direction:rtl;\"';\r\n      }\r\n    \r\n      // theme\r\n      G.$E.base.addClass(G.O.theme)\r\n      // gallery color scheme\r\n      SetGalleryTheme();\r\n\r\n      // Hide icons (thumbnails and breadcrumb)\r\n      if( G.O.thumbnailLabel.get('hideIcons') ) {\r\n        G.O.icons.thumbnailAlbum = '';\r\n        G.O.icons.thumbnailImage = '';\r\n      }\r\n\r\n      // Navigation bar\r\n      var styleNavigation=\"\";\r\n      if( G.O.navigationFontSize != undefined && G.O.navigationFontSize != '' ) {\r\n        styleNavigation=' style=\"font-size:'+G.O.navigationFontSize+';\"';\r\n      }      \r\n      G.$E.conNavigationBar = jQuery('<div class=\"nGY2Navigationbar\" '+styleNavigation+'></div>').appendTo(G.$E.base);\r\n\r\n      // pre-loader\r\n      G.$E.conLoadingB = jQuery('<div class=\"nanoGalleryLBarOff\"><div></div><div></div><div></div><div></div><div></div></div>').appendTo(G.$E.base);\r\n\r\n      // gallery\r\n      G.$E.conTnParent = jQuery('<div class=\"nGY2Gallery\"></div>').appendTo( G.$E.base );\r\n      G.$E.conTn = jQuery('<div class=\"nGY2GallerySub\"></div>').appendTo( G.$E.conTnParent );\r\n\r\n      // configure gallery\r\n      switch( G.O.thumbnailAlignment ) {\r\n        case 'left':\r\n          G.$E.conTnParent.css({'text-align':'left'});\r\n          // G.$E.conNavBCon.css({'margin-left':0 });\r\n          break;\r\n        case 'right':\r\n          G.$E.conTnParent.css({'text-align':'right'});\r\n          // G.$E.conNavBCon.css({ 'margin-right':0});\r\n          break;\r\n      }\r\n      \r\n      // apply galleryBuildInit2 css settings to the gallery\r\n      if( G.O.galleryBuildInit2 !== undefined ) {\r\n      var t1=G.O.galleryBuildInit2.split('|');\r\n        for( var i=0; i<t1.length; i++ ) {\r\n          var o1=t1[i].split('_');\r\n          if( o1.length == 2 ) {\r\n            G.$E.conTn.css(o1[0], o1[1]);\r\n          }\r\n        }\r\n      }\r\n      \r\n      // configure gallery depending on some thumbnail hover effects\r\n      var effects=G.tn.hoverEffects.std.concat(G.tn.hoverEffects.level1);\r\n      for( var j=0; j<effects.length; j++) {\r\n        switch( effects[j].type ) {\r\n          case 'scale':\r\n          case 'rotateZ':\r\n          case 'rotateX':\r\n          case 'rotateY':\r\n          case 'translateX':\r\n          case 'translateY':\r\n            // handle some special cases\r\n            if( effects[j].element == '.nGY2GThumbnail' ) {\r\n              // allow thumbnail upscale over the gallery's aera\r\n              G.$E.base.css('overflow', 'visible');\r\n              G.$E.base.find('.nGY2GallerySub').css('overflow', 'visible');\r\n              G.$E.conTnParent.css('overflow', 'visible');\r\n            }\r\n            break;\r\n        }\r\n      }\r\n      \r\n      // Gallery bottom container\r\n      G.$E.conTnBottom = jQuery('<div class=\"nGY2GalleryBottom\" '+styleNavigation+'></div>').appendTo( G.$E.conTnParent );\r\n      \r\n      // portable edition\r\n      if( G.O.portable ) {\r\n        // http://www.picresize.com/\r\n        // http://base64encode.net/base64-image-encoder\r\n        // var logo='data:image/png;base64,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';\r\n        var logo = 'data:image/png;base64,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';\r\n        var st = \"font-weight:bold !important;color: #FF0075 !important;font-size: 14px !important;text-transform: lowercase !important;cursor:pointer !important;text-align: center !important;Text-Shadow: #000000 1px 0px 0px, #000000 1px 1px 0px, #000000 1px -1px 0px, #000000 -1px 1px 0px, #000000 -1px 0px 0px, #000000 -1px -1px 0px, #000000 0px 1px 0px, #000000 0px -1px 0px !important;\";\r\n        G.$E.ngy2i=jQuery('<div class=\"nGY2PortInfo\"><a href=\"http://nano.gallery\" target=\"_blank\" title=\"nanogallery2 | easy photo gallery for your website\" style=\"' + st + '\"><img src=\"' + logo + '\" style=\"height:32px !important;width:initial !important;box-shadow: none !important;vertical-align: middle !important;\"/> &nbsp; nanogallery2</a></div>').appendTo(G.$E.base);\r\n        \r\n        G.$E.ngy2i.find('a').on({\r\n          mouseenter: function () {\r\n            jQuery(this).attr('style', st);\r\n          },\r\n          mouseleave: function () {\r\n            jQuery(this).attr('style', st);\r\n          }\r\n        });\r\n      }\r\n      \r\n      // Error console\r\n      G.$E.conConsole = jQuery('<div class=\"nGY2ConsoleParent\"></div>').appendTo(G.$E.base);\r\n\r\n      // i18n translations\r\n      i18n();\r\n\r\n      // cache some thumbnails data (sizes, styles...)\r\n      ThumbnailDefCaches();\r\n\r\n      // do special settings depending for some options\r\n      // thumbnail display transition\r\n      switch( G.tn.opt.Get('displayTransition') ) {\r\n        case 'SCALEDOWN':\r\n        case 'RANDOMSCALE':\r\n        default:\r\n          G.$E.base.css('overflow', 'visible');\r\n          G.$E.conTnParent.css('overflow', 'visible');\r\n          G.$E.conTn.css('overflow', 'visible');\r\n          break;\r\n      }\r\n      \r\n    }\r\n    \r\n    function TriggerCustomEvent ( eventName ) {\r\n      // G.$E.base.trigger('pageChanged.nanogallery2', new Event('pageChanged.nanogallery2'));\r\n      var eN = eventName + '.nanogallery2';\r\n      var event=null;\r\n      try {\r\n          event = new Event( eN );\r\n        } catch(e) {\r\n          event = document.createEvent('Event');\r\n          event.initEvent(eN, false, false);\r\n        }\r\n        G.$E.base.trigger(eN, event);\r\n    }\r\n    \r\n    \r\n    /** @function SetGlobalEvents */\r\n    function SetGlobalEvents() {\r\n      // GLOBAL EVENT MANAGEMENT\r\n      \r\n      G.$E.conTnParent.on({\r\n        mouseenter: GalleryMouseEnter,\r\n        mouseleave: GalleryMouseLeave\r\n      }, \".nGY2GThumbnail\");    //pass the element as an argument to .on\r\n      \r\n      // G.GOM.hammertime = new NGHammer(G.$E.conTn[0], { touchAction: 'none' });\r\n      G.GOM.hammertime = new NGHammer( G.$E.conTn[0] );\r\n      // G.GOM.hammertime.domEvents = true;\r\n      \r\n      G.GOM.hammertime.on('pan', function(ev) {\r\n        if( !G.VOM.viewerDisplayed ) {\r\n          if( G.O.paginationSwipe && G.layout.support.rows && G.galleryDisplayMode.Get() == 'PAGINATION' ) {\n            if( Math.abs(ev.deltaY) > G.GOM.panThreshold ) {\n              G.GOM.panYOnly = true;\n            }\n            if( !G.GOM.panYOnly ) {\r\n              G.$E.conTn.css( G.CSStransformName , 'translate('+(ev.deltaX)+'px,0px)');\n            }\n          }\r\n        }\r\n      });\r\n      G.GOM.hammertime.on('panend', function(ev) {\r\n        if( !G.VOM.viewerDisplayed ) {\r\n          if( G.O.paginationSwipe && G.layout.support.rows && G.galleryDisplayMode.Get() == 'PAGINATION' ) {\r\n            if( !G.GOM.panYOnly ) {\r\n              if( ev.deltaX > 50 ) {\r\n                paginationPreviousPage();\r\n                return;\r\n              }\r\n              if(  ev.deltaX < -50 ) {\r\n                paginationNextPage();\r\n                return;\r\n              }\n            }\n            G.GOM.panYOnly = false;\r\n            G.$E.conTn.css( G.CSStransformName , 'translate(0px,0px)');\r\n            // pX=0;\r\n          }\r\n        }\r\n      });\r\n      G.GOM.hammertime.on('tap', function(ev) {\r\n        if( !G.VOM.viewerDisplayed ) {\r\n          ev.srcEvent.stopPropagation();\r\n          ev.srcEvent.preventDefault();  // cancel  mouseenter event\r\n\r\n          if( ev.pointerType == 'mouse') {\r\n            if( GalleryClicked(ev.srcEvent) == 'exit' ) { return; }\r\n          }\r\n          else {\r\n            var r = GalleryEventRetrieveElementl(ev.srcEvent, false);\r\n            if( r.GOMidx == -1 ) { return; }\r\n            if( r.action != 'NONE' && r.action != 'OPEN' ) {\r\n              // toolbar touched --> execute action\r\n              GalleryClicked(ev.srcEvent);\r\n              return;\r\n            }\r\n            \r\n            if( G.GOM.slider.hostIdx == r.GOMidx ) {\r\n              // touch on thumbnail slider -> open immediately\r\n              ThumbnailHoverOutAll();\r\n              ThumbnailOpen(G.GOM.items[G.GOM.slider.currentIdx].thumbnailIdx, true);\r\n              return;\r\n            }\r\n\r\n            if( (G.GOM.curNavLevel == 'l1' && G.O.touchAnimationL1 == false) ||  (G.GOM.curNavLevel == 'lN' && G.O.touchAnimation == false) ) {\r\n              // open on single touch (no hover animation)\r\n              ThumbnailOpen(G.GOM.items[r.GOMidx].thumbnailIdx, true);\r\n              return;\r\n            }\r\n            \r\n            if( G.O.touchAutoOpenDelay > 0 ) {\r\n              // open on single touch after end of hover animation (=defined delay)\r\n              ThumbnailHoverOutAll();\r\n              ThumbnailHover( r.GOMidx );\r\n              window.clearInterval( G.touchAutoOpenDelayTimerID );\r\n              G.touchAutoOpenDelayTimerID = window.setInterval(function(){\r\n                window.clearInterval( G.touchAutoOpenDelayTimerID );\r\n                ThumbnailOpen( G.GOM.items[r.GOMidx].thumbnailIdx, true );\r\n              }, G.O.touchAutoOpenDelay );\r\n            }\r\n            else {\r\n              // two touch scenario\r\n              if( !G.I[G.GOM.items[r.GOMidx].thumbnailIdx].hovered ) {\r\n                ThumbnailHoverOutAll();\r\n                ThumbnailHover(r.GOMidx);\r\n              }\r\n              else {\r\n                // second touch\r\n                ThumbnailOpen(G.GOM.items[r.GOMidx].thumbnailIdx, true);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      \r\n      // browser location hash management\r\n      if( G.O.locationHash ) {\r\n        // jQuery(window).bind( 'hashchange', function() {\r\n          // ProcessLocationHash();\r\n        // });\r\n        jQuery(window).on('hashchange.nanogallery2.' + G.baseEltID, function() {ProcessLocationHash();} );\r\n      }\r\n      \r\n      // Page resize / orientation change\r\n      jQuery(window).on('resize.nanogallery2.' + G.baseEltID + ' orientationChange.nanogallery2.' + G.baseEltID, debounce( ResizeWindowEvent, G.O.eventsDebounceDelay, false) );\r\n      \r\n      // Event page scrolled\r\n      jQuery(window).on('scroll.nanogallery2.' + G.baseEltID, debounce( OnScrollEvent, G.O.eventsDebounceDelay, false) );\r\n\r\n      // Debounced function to hide the toolbars on the viewer\r\n      G.VOM.toolsHide = debounce( ViewerToolsHide, G.O.viewerHideToolsDelay, false );\r\n      \r\n      // Keyboard management\r\n      jQuery(document).keyup(function(e) {\r\n        if( G.popup.isDisplayed ) {\r\n          switch( e.keyCode) {\r\n            case 27:    // Esc key\r\n              G.popup.close();\r\n              break;\r\n          }\r\n        }\r\n        else {\r\n          if( G.VOM.viewerDisplayed ) {\r\n            ViewerToolsUnHide();\r\n            switch( e.keyCode) {\r\n              case 27:    // Escape key\r\n              case 40:    // DOWN\r\n                CloseInternalViewer(G.VOM.currItemIdx);\r\n                break;\r\n              case 32:    // SPACE\r\n              case 13:    // ENTER\r\n                SlideshowToggle();\r\n                break;\r\n              case 38:    // UP\r\n              case 39:    // RIGHT\r\n              case 33:    // PAGE UP\r\n                DisplayNextMedia();\r\n                break;\r\n              case 37:    // LEFT\r\n              case 34:    // PAGE DOWN\r\n                DisplayPreviousMedia();\r\n                break;\r\n              case 35:    // END\r\n              case 36:    // BEGIN\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      // mouse wheel to zoom in/out the image displayed in the internal lightbox\r\n      jQuery(window).bind('mousewheel wheel', function(e){\r\n        if( G.VOM.viewerDisplayed ) {\r\n          var deltaY = 0;\r\n          e.preventDefault();\r\n\r\n          if( ViewerZoomStart() ) {\r\n            if (e.originalEvent.deltaY) { // FireFox 17+ (IE9+, Chrome 31+?)\r\n              deltaY = e.originalEvent.deltaY;\r\n            } else if (e.originalEvent.wheelDelta) {\r\n              deltaY = -e.originalEvent.wheelDelta;\r\n            }\r\n            ViewerZoomIn( deltaY <= 0 ? true : false );\r\n          }\r\n        }\r\n      });\r\n      \r\n      // mouse mouse -> unhide lightbox toolbars\r\n      jQuery(window).bind('mousemove', function(e){\r\n        if( G.VOM.viewerDisplayed ) {\r\n          debounce( ViewerToolsUnHide, 100, false )();\r\n        }\r\n      });\r\n      \r\n      // fullscreen mode on/off --> internal lightbox\r\n      if( ngscreenfull.enabled ) {\r\n        // ngscreenfull.onchange(() => {\r\n        ngscreenfull.onchange( function() {\r\n          if( G.VOM.viewerDisplayed ) {\r\n            if( ngscreenfull.isFullscreen ) {\r\n              G.VOM.viewerIsFullscreen=true;\r\n              G.VOM.$viewer.find('.fullscreenButton').html(G.O.icons.viewerFullscreenOff);\r\n            }\r\n            else {\r\n              G.VOM.viewerIsFullscreen=false;\r\n              G.VOM.$viewer.find('.fullscreenButton').html(G.O.icons.viewerFullscreenOn);\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n    }\r\n    \r\n    //----- Manage browser location hash (deep linking and browser back/forward)\r\n    function ProcessLocationHash() {\r\n\r\n      // standard use case -> location hash processing\r\n      if( !G.O.locationHash ) { return false; }\r\n\r\n      var curGal = '#nanogallery/' + G.baseEltID + '/',\r\n      newLocationHash = location.hash;\r\n      if( G.O.debugMode ) {\r\n        console.log('------------------------ PROCESS LOCATION HASH');\r\n        console.log('newLocationHash1: ' +newLocationHash);\r\n        console.log('G.locationHashLastUsed: ' +G.locationHashLastUsed);\r\n      }\r\n      \r\n      if( newLocationHash == '' ) {\r\n        // if( G.GOM.lastDisplayedIdx != -1 ) {\r\n        if( G.locationHashLastUsed !== '' ) {\r\n          // back button and no hash --> display first album\r\n          if( G.O.debugMode ) { console.log('display root album'  ); }\r\n          G.locationHashLastUsed = '';\r\n          if( G.O.debugMode ) { console.log('new3 G.locationHashLastUsed: ' + G.locationHashLastUsed); }\r\n          DisplayAlbum('', '0');\r\n          return true;\r\n        }\r\n      }\r\n\r\n      if( newLocationHash == G.locationHashLastUsed ) { return; }\r\n      \r\n      if( newLocationHash.indexOf(curGal) == 0 ) {\r\n        // item IDs detected\r\n        var IDs=parseIDs( newLocationHash.substring(curGal.length) );\r\n        if( IDs.imageID != '0' ) {\r\n          if( G.O.debugMode ) { console.log('display image: ' + IDs.albumID +'-'+ IDs.imageID ); }\r\n          DisplayPhoto( IDs.imageID, IDs.albumID );\r\n          return true;\r\n        }\r\n        else {\r\n          if( G.O.debugMode ) { console.log('display album: ' + IDs.albumID  ); }\r\n          DisplayAlbum( '-1', IDs.albumID );\r\n          return true;\r\n        }\r\n      }    \r\n      \r\n      return false;\r\n    }\r\n\r\n    //---- Set a new browser location hash\r\n    function SetLocationHash(albumID, imageID ) {\r\n      if( !G.O.locationHash ) { return false; }\r\n\r\n      if( G.O.debugMode ) {\r\n        console.log('------------------------ SET LOCATION HASH');\r\n      }\r\n      \r\n      if( imageID == '' && (albumID == '-1' || albumID == '0' || G.O.album == albumID ) ) {\r\n        // root album level --> do not set top.location.hash if not already set\r\n        if( location.hash != '' ) {\r\n          // try to clear the hash if set\r\n          if (\"pushState\" in history) {\r\n            history.pushState(\"\", document.title, window.location.pathname + window.location.search);\r\n          }\r\n          else {\r\n            location.hash='';\r\n          }\r\n        }\r\n        G.locationHashLastUsed='';\r\n        if( G.O.debugMode ) { console.log('new2 G.locationHashLastUsed: '+G.locationHashLastUsed); }\r\n        return;\r\n      }\r\n      \r\n      var newLocationHash='#'+'nanogallery/'+G.baseEltID+'/'+ albumID;\r\n      if( imageID != '' ) {\r\n        newLocationHash+='/'+imageID;\r\n      }\r\n\r\n      var lH=location.hash;\r\n      if( G.O.debugMode ) {\r\n        console.log('newLocationHash2: '+newLocationHash);\r\n        console.log('location.hash: '+lH);\r\n      }\r\n\r\n      G.locationHashLastUsed=newLocationHash;\r\n      if( G.O.debugMode ) { console.log('new G.locationHashLastUsed: '+G.locationHashLastUsed); }\r\n      \r\n      if(  lH == '' || lH != newLocationHash ) {\r\n        // G.locationHashLastUsed='#'+newLocationHash;\r\n        try {\r\n          top.location.hash=newLocationHash;\r\n        }\r\n        catch(e) {\r\n          // location hash is not supported by current browser --> disable the option\r\n          G.O.locationHash=false;\r\n        }\r\n      }\r\n    }\r\n    \r\n    \r\n    function ResizeWindowEvent() {\r\n      CacheViewport();\r\n\r\n      if( G.VOM.viewerDisplayed ) {\r\n        ResizeInternalViewer();\r\n      }\r\n      else {\r\n        if( G.galleryResizeEventEnabled ) {\r\n          var nw = RetrieveCurWidth();\r\n          if( G.GOM.albumIdx != -1 && \r\n                ( G.tn.settings.height[G.GOM.curNavLevel][G.GOM.curWidth] != G.tn.settings.height[G.GOM.curNavLevel][nw] || \r\n                G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth] != G.tn.settings.width[G.GOM.curNavLevel][nw] ) ) {\r\n                  // do not use settings.getH() / settings.getW()\r\n            // thumbnail size changed --> render the gallery with the new sizes\r\n            G.GOM.curWidth = nw;\r\n            //G.layout.SetEngine();\r\n            G.GOM.pagination.currentPage = 0;\r\n            GalleryRender( G.GOM.albumIdx );\r\n          }\r\n          else {\r\n            GalleryResize();\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n     \r\n    // Depreciated - if gallery currently refreshed (G.galleryResizeEventEnabled=false), page may be scrolled but it will not be refreshed again\r\n    function OnScrollEvent_OLD() {\r\n      if( !G.VOM.viewerDisplayed ) {\r\n        if( G.galleryResizeEventEnabled ) {\r\n          GalleryResize();\r\n        }\r\n        return;\r\n      }\r\n    }\r\n\r\n\r\n    function OnScrollEvent() {\r\n      if( !G.VOM.viewerDisplayed ) {\r\n        GalleryResizeOnScrollEvent();\r\n      }\r\n    }\r\n    // the gallery may currently be refreshed, so ensure that at the end of the refresh, the gallery is refreshed again because the page may have been scrolled in the meantime\r\n    function GalleryResizeOnScrollEvent() {\r\n      if( G.galleryResizeEventEnabled == false) {\r\n        window.setTimeout(GalleryResizeOnScrollEvent, 10);  // check again in 10ms\r\n      } else {\r\n        GalleryResize();\r\n      }\r\n    }\r\n\r\n\r\n    \r\n    // I18N : define text translations\r\n    function i18n() {\r\n\r\n      // browser language\r\n      G.i18nLang = (navigator.language || navigator.userLanguage).toUpperCase();\r\n      if( G.i18nLang === 'UNDEFINED') { G.i18nLang=''; }\r\n\r\n      var llang=-('_'+G.i18nLang).length;\r\n      \r\n      if( toType(G.O.i18n) == 'object' ){\r\n      \r\n        for( var key in G.O.i18n ) {\r\n          //var value = G.O.i18n[key];\r\n          var s=key.substr(llang);\r\n          if( s == ('_'+G.i18nLang) ) {\r\n            G.i18nTranslations[key.substr(0,key.length-s.length)]=G.O.i18n[key];\r\n          } \r\n          else {\r\n            G.i18nTranslations[key]=G.O.i18n[key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    function GetI18nItem( item, property ) {\r\n      var s='';\r\n      if( G.i18nLang != '' ) {\r\n        if( item[property+'_'+G.i18nLang] !== undefined && item[property+'_'+G.i18nLang].length>0 ) {\r\n          s=item[property+'_'+G.i18nLang];\r\n          return s;\r\n        }\r\n      }\r\n      s=item[property];\r\n      return s;\r\n    }\r\n\r\n    \r\n    function RetrieveCurWidth() {\r\n      var vpW = G.GOM.cache.viewport.w;\r\n      \r\n      if( G.O.breakpointSizeSM > 0 && vpW < G.O.breakpointSizeSM) { return 'xs'; }\r\n      if( G.O.breakpointSizeME > 0 && vpW < G.O.breakpointSizeME) { return 'sm'; }\r\n      if( G.O.breakpointSizeLA > 0 && vpW < G.O.breakpointSizeLA) { return 'me'; }\r\n      if( G.O.breakpointSizeXL > 0 && vpW < G.O.breakpointSizeXL) { return 'la'; }\r\n      \r\n      return 'xl';\r\n    }\r\n\r\n    \r\n    /** @function browserNotification */\r\n    function browserNotification() {\r\n      var m = 'Your browser version is not supported anymore. The image gallery cannot be displayed. <br><br>Please update to a more recent one. Download:<br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.google.com/chrome/?hl=en-US)\">Chrome</a><br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.mozilla.com/firefox/)\">Firefox</a><br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.microsoft.com/windows/internet-explorer/default.aspx\">Internet Explorer</a><br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.apple.com/safari/download/\">Safari</a>';\r\n      NanoAlert(G,  m, false);\r\n    }\r\n\r\n    // Original author : John Hrvatin, Lead Program Manager, Internet Explorer - http://blogs.msdn.com/b/ie/archive/2011/10/28/a-best-practice-for-programming-with-vendor-prefixes.aspx\r\n    function FirstSupportedPropertyName(prefixedPropertyNames) {\r\n      var tempDiv = document.createElement(\"div\");\r\n      for (var i = 0; i < prefixedPropertyNames.length; ++i) {\r\n        if (typeof tempDiv.style[prefixedPropertyNames[i]] != 'undefined')\r\n          return prefixedPropertyNames[i];\r\n      }\r\n      return null;\r\n    }\r\n\r\n    \r\n    \r\n    \r\n  }\r\n  \r\n\r\n\r\n//##########################################################################################################################\r\n//## imagesLoaded ##########################################################################################################\r\n//##########################################################################################################################\r\n\r\n// external module EMBEDED in nanogallery\r\n// NGY BUILD:\r\n// replace \"imagesLoaded\" with \"ngimagesLoaded\"\r\n// replace \"ImagesLoaded\" with \"ngImagesLoaded\"\r\n// replace \"EvEmitter\" with \"ngEvEmitter\"\r\n// replace \"var $ = window.jQuery\" with \"var $ = jQuery;\"\r\n// 2x (global.ngEvEmitter and window.ngimagesLoaded = f...)ignore package manager and set browser global\r\n\r\n\r\n\r\n/*!\r\n * imagesLoaded PACKAGED v4.1.1\r\n * JavaScript is all like \"You images are done yet or what?\"\r\n * MIT License\r\n */\r\n\r\n/**\r\n * EvEmitter v1.0.3\r\n * Lil' event emitter\r\n * MIT License\r\n */\r\n\r\n \r\n/* jshint unused: true, undef: true, strict: true */\r\n\r\n( function( global, factory ) {\r\n  // universal module definition\r\n  /* jshint strict: false */ /* globals define, module, window */\r\n//  if ( typeof define == 'function' && define.amd ) {\r\n    // AMD - RequireJS\r\n//    define( 'ev-emitter/ev-emitter',factory );\r\n//  } else if ( typeof module == 'object' && module.exports ) {\r\n    // CommonJS - Browserify, Webpack\r\n//    module.exports = factory();\r\n//  } else {\r\n    // Browser globals\r\n    global.ngEvEmitter = factory();\r\n//  }\r\n\r\n}( typeof window != 'undefined' ? window : this, function() {\r\n\r\n\r\n\r\nfunction ngEvEmitter() {}\r\n\r\nvar proto = ngEvEmitter.prototype;\r\n\r\nproto.on = function( eventName, listener ) {\r\n  if ( !eventName || !listener ) {\r\n    return;\r\n  }\r\n  // set events hash\r\n  var events = this._events = this._events || {};\r\n  // set listeners array\r\n  var listeners = events[ eventName ] = events[ eventName ] || [];\r\n  // only add once\r\n  if ( listeners.indexOf( listener ) == -1 ) {\r\n    listeners.push( listener );\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\nproto.once = function( eventName, listener ) {\r\n  if ( !eventName || !listener ) {\r\n    return;\r\n  }\r\n  // add event\r\n  this.on( eventName, listener );\r\n  // set once flag\r\n  // set onceEvents hash\r\n  var onceEvents = this._onceEvents = this._onceEvents || {};\r\n  // set onceListeners object\r\n  var onceListeners = onceEvents[ eventName ] = onceEvents[ eventName ] || {};\r\n  // set flag\r\n  onceListeners[ listener ] = true;\r\n\r\n  return this;\r\n};\r\n\r\nproto.off = function( eventName, listener ) {\r\n  var listeners = this._events && this._events[ eventName ];\r\n  if ( !listeners || !listeners.length ) {\r\n    return;\r\n  }\r\n  var index = listeners.indexOf( listener );\r\n  if ( index != -1 ) {\r\n    listeners.splice( index, 1 );\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\nproto.emitEvent = function( eventName, args ) {\r\n  var listeners = this._events && this._events[ eventName ];\r\n  if ( !listeners || !listeners.length ) {\r\n    return;\r\n  }\r\n  var i = 0;\r\n  var listener = listeners[i];\r\n  args = args || [];\r\n  // once stuff\r\n  var onceListeners = this._onceEvents && this._onceEvents[ eventName ];\r\n\r\n  while ( listener ) {\r\n    var isOnce = onceListeners && onceListeners[ listener ];\r\n    if ( isOnce ) {\r\n      // remove listener\r\n      // remove before trigger to prevent recursion\r\n      this.off( eventName, listener );\r\n      // unset once flag\r\n      delete onceListeners[ listener ];\r\n    }\r\n    // trigger listener\r\n    listener.apply( this, args );\r\n    // get next listener\r\n    i += isOnce ? 0 : 1;\r\n    listener = listeners[i];\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\nreturn ngEvEmitter;\r\n\r\n}));\r\n\r\n/*!\r\n * ngimagesLoaded v4.1.1\r\n * JavaScript is all like \"You images are done yet or what?\"\r\n * MIT License\r\n */\r\n\r\n( function( window, factory ) { 'use strict';\r\n  // universal module definition\r\n\r\n  /*global define: false, module: false, require: false */\r\n\r\n//  if ( typeof define == 'function' && define.amd ) {\r\n    // AMD\r\n//    define( [\r\n//      'ev-emitter/ev-emitter'\r\n//    ], function( ngEvEmitter ) {\r\n//      return factory( window, ngEvEmitter );\r\n//    });\r\n//  } else if ( typeof module == 'object' && module.exports ) {\r\n    // CommonJS\r\n//    module.exports = factory(\r\n//      window,\r\n//      require('ev-emitter')\r\n//    );\r\n//  } else {\r\n    // browser global\r\n    window.ngimagesLoaded = factory(\r\n      window,\r\n      window.ngEvEmitter\r\n    );\r\n  //}\r\n\r\n})( window,\r\n\r\n// --------------------------  factory -------------------------- //\r\n\r\nfunction factory( window, ngEvEmitter ) {\r\n\r\n\r\n\r\n// var $ = window.jQuery;\r\nvar $ = jQuery;\r\nvar console = window.console;\r\n\r\n// -------------------------- helpers -------------------------- //\r\n\r\n// extend objects\r\nfunction extend( a, b ) {\r\n  for ( var prop in b ) {\r\n    a[ prop ] = b[ prop ];\r\n  }\r\n  return a;\r\n}\r\n\r\n// turn element or nodeList into an array\r\nfunction makeArray( obj ) {\r\n  var ary = [];\r\n  if ( Array.isArray( obj ) ) {\r\n    // use object if already an array\r\n    ary = obj;\r\n  } else if ( typeof obj.length == 'number' ) {\r\n    // convert nodeList to array\r\n    for ( var i=0; i < obj.length; i++ ) {\r\n      ary.push( obj[i] );\r\n    }\r\n  } else {\r\n    // array of single index\r\n    ary.push( obj );\r\n  }\r\n  return ary;\r\n}\r\n\r\n// -------------------------- ngimagesLoaded -------------------------- //\r\n\r\n/**\r\n * @param {Array, Element, NodeList, String} elem\r\n * @param {Object or Function} options - if function, use as callback\r\n * @param {Function} onAlways - callback function\r\n */\r\nfunction ngImagesLoaded( elem, options, onAlways ) {\r\n  // coerce ngImagesLoaded() without new, to be new ngImagesLoaded()\r\n  if ( !( this instanceof ngImagesLoaded ) ) {\r\n    return new ngImagesLoaded( elem, options, onAlways );\r\n  }\r\n  // use elem as selector string\r\n  if ( typeof elem == 'string' ) {\r\n    elem = document.querySelectorAll( elem );\r\n  }\r\n\r\n  this.elements = makeArray( elem );\r\n  this.options = extend( {}, this.options );\r\n\r\n  if ( typeof options == 'function' ) {\r\n    onAlways = options;\r\n  } else {\r\n    extend( this.options, options );\r\n  }\r\n\r\n  if ( onAlways ) {\r\n    this.on( 'always', onAlways );\r\n  }\r\n\r\n  this.getImages();\r\n\r\n  if ( $ ) {\r\n    // add jQuery Deferred object\r\n    this.jqDeferred = new $.Deferred();\r\n  }\r\n\r\n  // HACK check async to allow time to bind listeners\r\n  setTimeout( function() {\r\n    this.check();\r\n  }.bind( this ));\r\n}\r\n\r\nngImagesLoaded.prototype = Object.create( ngEvEmitter.prototype );\r\n\r\nngImagesLoaded.prototype.options = {};\r\n\r\nngImagesLoaded.prototype.getImages = function() {\r\n  this.images = [];\r\n\r\n  // filter & find items if we have an item selector\r\n  this.elements.forEach( this.addElementImages, this );\r\n};\r\n\r\n/**\r\n * @param {Node} element\r\n */\r\nngImagesLoaded.prototype.addElementImages = function( elem ) {\r\n  // filter siblings\r\n  if ( elem.nodeName == 'IMG' ) {\r\n    this.addImage( elem );\r\n  }\r\n  // get background image on element\r\n  if ( this.options.background === true ) {\r\n    this.addElementBackgroundImages( elem );\r\n  }\r\n\r\n  // find children\r\n  // no non-element nodes, #143\r\n  var nodeType = elem.nodeType;\r\n  if ( !nodeType || !elementNodeTypes[ nodeType ] ) {\r\n    return;\r\n  }\r\n  var childImgs = elem.querySelectorAll('img');\r\n  // concat childElems to filterFound array\r\n  for ( var i=0; i < childImgs.length; i++ ) {\r\n    var img = childImgs[i];\r\n    this.addImage( img );\r\n  }\r\n\r\n  // get child background images\r\n  if ( typeof this.options.background == 'string' ) {\r\n    var children = elem.querySelectorAll( this.options.background );\r\n    for ( i=0; i < children.length; i++ ) {\r\n      var child = children[i];\r\n      this.addElementBackgroundImages( child );\r\n    }\r\n  }\r\n};\r\n\r\nvar elementNodeTypes = {\r\n  1: true,\r\n  9: true,\r\n  11: true\r\n};\r\n\r\nngImagesLoaded.prototype.addElementBackgroundImages = function( elem ) {\r\n  var style = getComputedStyle( elem );\r\n  if ( !style ) {\r\n    // Firefox returns null if in a hidden iframe https://bugzil.la/548397\r\n    return;\r\n  }\r\n  // get url inside url(\"...\")\r\n  var reURL = /url\\((['\"])?(.*?)\\1\\)/gi;\r\n  var matches = reURL.exec( style.backgroundImage );\r\n  while ( matches !== null ) {\r\n    var url = matches && matches[2];\r\n    if ( url ) {\r\n      this.addBackground( url, elem );\r\n    }\r\n    matches = reURL.exec( style.backgroundImage );\r\n  }\r\n};\r\n\r\n/**\r\n * @param {Image} img\r\n */\r\nngImagesLoaded.prototype.addImage = function( img ) {\r\n  var loadingImage = new LoadingImage( img );\r\n  this.images.push( loadingImage );\r\n};\r\n\r\nngImagesLoaded.prototype.addBackground = function( url, elem ) {\r\n  var background = new Background( url, elem );\r\n  this.images.push( background );\r\n};\r\n\r\nngImagesLoaded.prototype.check = function() {\r\n  var _this = this;\r\n  this.progressedCount = 0;\r\n  this.hasAnyBroken = false;\r\n  // complete if no images\r\n  if ( !this.images.length ) {\r\n    this.complete();\r\n    return;\r\n  }\r\n\r\n  function onProgress( image, elem, message ) {\r\n    // HACK - Chrome triggers event before object properties have changed. #83\r\n    setTimeout( function() {\r\n      _this.progress( image, elem, message );\r\n    });\r\n  }\r\n\r\n  this.images.forEach( function( loadingImage ) {\r\n    loadingImage.once( 'progress', onProgress );\r\n    loadingImage.check();\r\n  });\r\n};\r\n\r\nngImagesLoaded.prototype.progress = function( image, elem, message ) {\r\n  this.progressedCount++;\r\n  this.hasAnyBroken = this.hasAnyBroken || !image.isLoaded;\r\n  // progress event\r\n  this.emitEvent( 'progress', [ this, image, elem ] );\r\n  if ( this.jqDeferred && this.jqDeferred.notify ) {\r\n    this.jqDeferred.notify( this, image );\r\n  }\r\n  // check if completed\r\n  if ( this.progressedCount == this.images.length ) {\r\n    this.complete();\r\n  }\r\n\r\n  if ( this.options.debug && console ) {\r\n    console.log( 'progress: ' + message, image, elem );\r\n  }\r\n};\r\n\r\nngImagesLoaded.prototype.complete = function() {\r\n  var eventName = this.hasAnyBroken ? 'fail' : 'done';\r\n  this.isComplete = true;\r\n  this.emitEvent( eventName, [ this ] );\r\n  this.emitEvent( 'always', [ this ] );\r\n  if ( this.jqDeferred ) {\r\n    var jqMethod = this.hasAnyBroken ? 'reject' : 'resolve';\r\n    this.jqDeferred[ jqMethod ]( this );\r\n  }\r\n};\r\n\r\n// --------------------------  -------------------------- //\r\n\r\nfunction LoadingImage( img ) {\r\n  this.img = img;\r\n}\r\n\r\nLoadingImage.prototype = Object.create( ngEvEmitter.prototype );\r\n\r\nLoadingImage.prototype.check = function() {\r\n  // If complete is true and browser supports natural sizes,\r\n  // try to check for image status manually.\r\n  var isComplete = this.getIsImageComplete();\r\n  if ( isComplete ) {\r\n    // report based on naturalWidth\r\n    this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n    return;\r\n  }\r\n\r\n  // If none of the checks above matched, simulate loading on detached element.\r\n  this.proxyImage = new Image();\r\n  this.proxyImage.addEventListener( 'load', this );\r\n  this.proxyImage.addEventListener( 'error', this );\r\n  // bind to image as well for Firefox. #191\r\n  this.img.addEventListener( 'load', this );\r\n  this.img.addEventListener( 'error', this );\r\n  this.proxyImage.src = this.img.src;\r\n};\r\n\r\nLoadingImage.prototype.getIsImageComplete = function() {\r\n  return this.img.complete && this.img.naturalWidth !== undefined;\r\n};\r\n\r\nLoadingImage.prototype.confirm = function( isLoaded, message ) {\r\n  this.isLoaded = isLoaded;\r\n  this.emitEvent( 'progress', [ this, this.img, message ] );\r\n};\r\n\r\n// ----- events ----- //\r\n\r\n// trigger specified handler for event type\r\nLoadingImage.prototype.handleEvent = function( event ) {\r\n  var method = 'on' + event.type;\r\n  if ( this[ method ] ) {\r\n    this[ method ]( event );\r\n  }\r\n};\r\n\r\nLoadingImage.prototype.onload = function() {\r\n  this.confirm( true, 'onload' );\r\n  this.unbindEvents();\r\n};\r\n\r\nLoadingImage.prototype.onerror = function() {\r\n  this.confirm( false, 'onerror' );\r\n  this.unbindEvents();\r\n};\r\n\r\nLoadingImage.prototype.unbindEvents = function() {\r\n  this.proxyImage.removeEventListener( 'load', this );\r\n  this.proxyImage.removeEventListener( 'error', this );\r\n  this.img.removeEventListener( 'load', this );\r\n  this.img.removeEventListener( 'error', this );\r\n};\r\n\r\n// -------------------------- Background -------------------------- //\r\n\r\nfunction Background( url, element ) {\r\n  this.url = url;\r\n  this.element = element;\r\n  this.img = new Image();\r\n}\r\n\r\n// inherit LoadingImage prototype\r\nBackground.prototype = Object.create( LoadingImage.prototype );\r\n\r\nBackground.prototype.check = function() {\r\n  this.img.addEventListener( 'load', this );\r\n  this.img.addEventListener( 'error', this );\r\n  this.img.src = this.url;\r\n  // check if image is already complete\r\n  var isComplete = this.getIsImageComplete();\r\n  if ( isComplete ) {\r\n    this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n    this.unbindEvents();\r\n  }\r\n};\r\n\r\nBackground.prototype.unbindEvents = function() {\r\n  this.img.removeEventListener( 'load', this );\r\n  this.img.removeEventListener( 'error', this );\r\n};\r\n\r\nBackground.prototype.confirm = function( isLoaded, message ) {\r\n  this.isLoaded = isLoaded;\r\n  this.emitEvent( 'progress', [ this, this.element, message ] );\r\n};\r\n\r\n// -------------------------- jQuery -------------------------- //\r\n\r\nngImagesLoaded.makeJQueryPlugin = function( jQuery ) {\r\n  jQuery = jQuery || window.jQuery;\r\n  if ( !jQuery ) {\r\n    return;\r\n  }\r\n  // set local variable\r\n  $ = jQuery;\r\n  // $().ngimagesLoaded()\r\n  $.fn.ngimagesLoaded = function( options, callback ) {\r\n    var instance = new ngImagesLoaded( this, options, callback );\r\n    return instance.jqDeferred.promise( $(this) );\r\n  };\r\n};\r\n// try making plugin\r\nngImagesLoaded.makeJQueryPlugin();\r\n\r\n// --------------------------  -------------------------- //\r\n\r\nreturn ngImagesLoaded;\r\n\r\n});\r\n\r\n\r\n\r\n//##########################################################################################################################\r\n//## screenfull.js #########################################################################################################\r\n//##########################################################################################################################\r\n\r\n// screenfull.js\r\n// v4.0.1\r\n// by sindresorhus - https://github.com/sindresorhus\r\n// from: https://github.com/sindresorhus/screenfull.js\r\n\r\n// external module embeded in nanogallery\r\n// NGY BUILD:\r\n// replace \"screenfull\" with \"ngscreenfull\"\r\n// \r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tvar document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\r\n\tvar isCommonjs = typeof module !== 'undefined' && module.exports;\r\n\tvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\r\n\r\n\tvar fn = (function () {\r\n\t\tvar val;\r\n\r\n\t\tvar fnMap = [\r\n\t\t\t[\r\n\t\t\t\t'requestFullscreen',\r\n\t\t\t\t'exitFullscreen',\r\n\t\t\t\t'fullscreenElement',\r\n\t\t\t\t'fullscreenEnabled',\r\n\t\t\t\t'fullscreenchange',\r\n\t\t\t\t'fullscreenerror'\r\n\t\t\t],\r\n\t\t\t// New WebKit\r\n\t\t\t[\r\n\t\t\t\t'webkitRequestFullscreen',\r\n\t\t\t\t'webkitExitFullscreen',\r\n\t\t\t\t'webkitFullscreenElement',\r\n\t\t\t\t'webkitFullscreenEnabled',\r\n\t\t\t\t'webkitfullscreenchange',\r\n\t\t\t\t'webkitfullscreenerror'\r\n\r\n\t\t\t],\r\n\t\t\t// Old WebKit (Safari 5.1)\r\n\t\t\t[\r\n\t\t\t\t'webkitRequestFullScreen',\r\n\t\t\t\t'webkitCancelFullScreen',\r\n\t\t\t\t'webkitCurrentFullScreenElement',\r\n\t\t\t\t'webkitCancelFullScreen',\r\n\t\t\t\t'webkitfullscreenchange',\r\n\t\t\t\t'webkitfullscreenerror'\r\n\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\t'mozRequestFullScreen',\r\n\t\t\t\t'mozCancelFullScreen',\r\n\t\t\t\t'mozFullScreenElement',\r\n\t\t\t\t'mozFullScreenEnabled',\r\n\t\t\t\t'mozfullscreenchange',\r\n\t\t\t\t'mozfullscreenerror'\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\t'msRequestFullscreen',\r\n\t\t\t\t'msExitFullscreen',\r\n\t\t\t\t'msFullscreenElement',\r\n\t\t\t\t'msFullscreenEnabled',\r\n\t\t\t\t'MSFullscreenChange',\r\n\t\t\t\t'MSFullscreenError'\r\n\t\t\t]\r\n\t\t];\r\n\r\n\t\tvar i = 0;\r\n\t\tvar l = fnMap.length;\r\n\t\tvar ret = {};\r\n\r\n\t\tfor (; i < l; i++) {\r\n\t\t\tval = fnMap[i];\r\n\t\t\tif (val && val[1] in document) {\r\n\t\t\t\tfor (i = 0; i < val.length; i++) {\r\n\t\t\t\t\tret[fnMap[0][i]] = val[i];\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t})();\r\n\r\n\tvar eventNameMap = {\r\n\t\tchange: fn.fullscreenchange,\r\n\t\terror: fn.fullscreenerror\r\n\t};\r\n\r\n\tvar ngscreenfull = {\r\n\t\trequest: function (elem) {\r\n\t\t\treturn new Promise(function (resolve) {\r\n\t\t\t\tvar request = fn.requestFullscreen;\r\n\r\n\t\t\t\tvar onFullScreenEntered = function () {\r\n\t\t\t\t\tthis.off('change', onFullScreenEntered);\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}.bind(this);\r\n\r\n\t\t\t\telem = elem || document.documentElement;\r\n\r\n\t\t\t\t// Work around Safari 5.1 bug: reports support for\r\n\t\t\t\t// keyboard in fullscreen even though it doesn't.\r\n\t\t\t\t// Browser sniffing, since the alternative with\r\n\t\t\t\t// setTimeout is even worse.\r\n\t\t\t\tif (/ Version\\/5\\.1(?:\\.\\d+)? Safari\\//.test(navigator.userAgent)) {\r\n\t\t\t\t\telem[request]();\r\n\t\t\t\t} else {\r\n\t\t\t\t\telem[request](keyboardAllowed ? Element.ALLOW_KEYBOARD_INPUT : {});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.on('change', onFullScreenEntered);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\texit: function () {\r\n\t\t\treturn new Promise(function (resolve) {\r\n\t\t\t\tif (!this.isFullscreen) {\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar onFullScreenExit = function () {\r\n\t\t\t\t\tthis.off('change', onFullScreenExit);\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}.bind(this);\r\n\r\n\t\t\t\tdocument[fn.exitFullscreen]();\r\n\r\n\t\t\t\tthis.on('change', onFullScreenExit);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\ttoggle: function (elem) {\r\n\t\t\treturn this.isFullscreen ? this.exit() : this.request(elem);\r\n\t\t},\r\n\t\tonchange: function (callback) {\r\n\t\t\tthis.on('change', callback);\r\n\t\t},\r\n\t\tonerror: function (callback) {\r\n\t\t\tthis.on('error', callback);\r\n\t\t},\r\n\t\ton: function (event, callback) {\r\n\t\t\tvar eventName = eventNameMap[event];\r\n\t\t\tif (eventName) {\r\n\t\t\t\tdocument.addEventListener(eventName, callback, false);\r\n\t\t\t}\r\n\t\t},\r\n\t\toff: function (event, callback) {\r\n\t\t\tvar eventName = eventNameMap[event];\r\n\t\t\tif (eventName) {\r\n\t\t\t\tdocument.removeEventListener(eventName, callback, false);\r\n\t\t\t}\r\n\t\t},\r\n\t\traw: fn\r\n\t};\r\n\r\n\tif (!fn) {\r\n\t\tif (isCommonjs) {\r\n\t\t\tmodule.exports = false;\r\n\t\t} else {\r\n\t\t\twindow.ngscreenfull = false;\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tObject.defineProperties(ngscreenfull, {\r\n\t\tisFullscreen: {\r\n\t\t\tget: function () {\r\n\t\t\t\treturn Boolean(document[fn.fullscreenElement]);\r\n\t\t\t}\r\n\t\t},\r\n\t\telement: {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function () {\r\n\t\t\t\treturn document[fn.fullscreenElement];\r\n\t\t\t}\r\n\t\t},\r\n\t\tenabled: {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function () {\r\n\t\t\t\t// Coerce to boolean in case of old WebKit\r\n\t\t\t\treturn Boolean(document[fn.fullscreenEnabled]);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tif (isCommonjs) {\r\n\t\tmodule.exports = ngscreenfull;\r\n\t} else {\r\n\t\twindow.ngscreenfull = ngscreenfull;\r\n\t}\r\n})();\r\n\r\n\r\n  \r\n//##########################################################################################################################\r\n//## Shifty ################################################################################################################\r\n//##########################################################################################################################\r\n  \r\n /*!\r\n * Shifty\r\n * By Jeremy Kahn - jeremyckahn@gmail.com\r\n */\r\n\r\n// external module EMBEDED in nanogallery\r\n// NGY BUILD:\r\n// \r\n// replace \"Tweenable\" with \"NGTweenable\"\r\n// replace \"define.amd\" with \"define.amdDISABLED\"\r\n/* shifty - v1.5.3 - 2016-11-29 - http://jeremyckahn.github.io/shifty */\r\n;(function () {\r\n  var root = this || Function('return this')();\r\n\r\n/**\r\n * Shifty Core\r\n * By Jeremy Kahn - jeremyckahn@gmail.com\r\n */\r\n\r\nvar NGTweenable = (function () {\r\n\r\n  'use strict';\r\n\r\n  // Aliases that get defined later in this function\r\n  var formula;\r\n\r\n  // CONSTANTS\r\n  var DEFAULT_SCHEDULE_FUNCTION;\r\n  var DEFAULT_EASING = 'linear';\r\n  var DEFAULT_DURATION = 500;\r\n  var UPDATE_TIME = 1000 / 60;\r\n\r\n  var _now = Date.now\r\n       ? Date.now\r\n       : function () {return +new Date();};\r\n\r\n  var now = typeof SHIFTY_DEBUG_NOW !== 'undefined' ? SHIFTY_DEBUG_NOW : _now;\r\n\r\n  if (typeof window !== 'undefined') {\r\n    // requestAnimationFrame() shim by Paul Irish (modified for Shifty)\r\n    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n    DEFAULT_SCHEDULE_FUNCTION = window.requestAnimationFrame\r\n       || window.webkitRequestAnimationFrame\r\n       || window.oRequestAnimationFrame\r\n       || window.msRequestAnimationFrame\r\n       || (window.mozCancelRequestAnimationFrame\r\n       && window.mozRequestAnimationFrame)\r\n       || setTimeout;\r\n  } else {\r\n    DEFAULT_SCHEDULE_FUNCTION = setTimeout;\r\n  }\r\n\r\n  function noop () {\r\n    // NOOP!\r\n  }\r\n\r\n  /**\r\n   * Handy shortcut for doing a for-in loop. This is not a \"normal\" each\r\n   * function, it is optimized for Shifty.  The iterator function only receives\r\n   * the property name, not the value.\r\n   * @param {Object} obj\r\n   * @param {Function(string)} fn\r\n   * @private\r\n   */\r\n  function each (obj, fn) {\r\n    var key;\r\n    for (key in obj) {\r\n      if (Object.hasOwnProperty.call(obj, key)) {\r\n        fn(key);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Perform a shallow copy of Object properties.\r\n   * @param {Object} targetObject The object to copy into\r\n   * @param {Object} srcObject The object to copy from\r\n   * @return {Object} A reference to the augmented `targetObj` Object\r\n   * @private\r\n   */\r\n  function shallowCopy (targetObj, srcObj) {\r\n    each(srcObj, function (prop) {\r\n      targetObj[prop] = srcObj[prop];\r\n    });\r\n\r\n    return targetObj;\r\n  }\r\n\r\n  /**\r\n   * Copies each property from src onto target, but only if the property to\r\n   * copy to target is undefined.\r\n   * @param {Object} target Missing properties in this Object are filled in\r\n   * @param {Object} src\r\n   * @private\r\n   */\r\n  function defaults (target, src) {\r\n    each(src, function (prop) {\r\n      if (typeof target[prop] === 'undefined') {\r\n        target[prop] = src[prop];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Calculates the interpolated tween values of an Object for a given\r\n   * timestamp.\r\n   * @param {Number} forPosition The position to compute the state for.\r\n   * @param {Object} currentState Current state properties.\r\n   * @param {Object} originalState: The original state properties the Object is\r\n   * tweening from.\r\n   * @param {Object} targetState: The destination state properties the Object\r\n   * is tweening to.\r\n   * @param {number} duration: The length of the tween in milliseconds.\r\n   * @param {number} timestamp: The UNIX epoch time at which the tween began.\r\n   * @param {Object} easing: This Object's keys must correspond to the keys in\r\n   * targetState.\r\n   * @private\r\n   */\r\n  function tweenProps (forPosition, currentState, originalState, targetState,\r\n    duration, timestamp, easing) {\r\n    var normalizedPosition =\r\n        forPosition < timestamp ? 0 : (forPosition - timestamp) / duration;\r\n\r\n\r\n    var prop;\r\n    var easingObjectProp;\r\n    var easingFn;\r\n    for (prop in currentState) {\r\n      if (currentState.hasOwnProperty(prop)) {\r\n        easingObjectProp = easing[prop];\r\n        easingFn = typeof easingObjectProp === 'function'\r\n          ? easingObjectProp\r\n          : formula[easingObjectProp];\r\n\r\n        currentState[prop] = tweenProp(\r\n          originalState[prop],\r\n          targetState[prop],\r\n          easingFn,\r\n          normalizedPosition\r\n        );\r\n      }\r\n    }\r\n\r\n    return currentState;\r\n  }\r\n\r\n  /**\r\n   * Tweens a single property.\r\n   * @param {number} start The value that the tween started from.\r\n   * @param {number} end The value that the tween should end at.\r\n   * @param {Function} easingFunc The easing curve to apply to the tween.\r\n   * @param {number} position The normalized position (between 0.0 and 1.0) to\r\n   * calculate the midpoint of 'start' and 'end' against.\r\n   * @return {number} The tweened value.\r\n   * @private\r\n   */\r\n  function tweenProp (start, end, easingFunc, position) {\r\n    return start + (end - start) * easingFunc(position);\r\n  }\r\n\r\n  /**\r\n   * Applies a filter to NGTweenable instance.\r\n   * @param {NGTweenable} tweenable The `NGTweenable` instance to call the filter\r\n   * upon.\r\n   * @param {String} filterName The name of the filter to apply.\r\n   * @private\r\n   */\r\n  function applyFilter (tweenable, filterName) {\r\n    var filters = NGTweenable.prototype.filter;\r\n    var args = tweenable._filterArgs;\r\n\r\n    each(filters, function (name) {\r\n      if (typeof filters[name][filterName] !== 'undefined') {\r\n        filters[name][filterName].apply(tweenable, args);\r\n      }\r\n    });\r\n  }\r\n\r\n  var timeoutHandler_endTime;\r\n  var timeoutHandler_currentTime;\r\n  var timeoutHandler_isEnded;\r\n  var timeoutHandler_offset;\r\n  /**\r\n   * Handles the update logic for one step of a tween.\r\n   * @param {NGTweenable} tweenable\r\n   * @param {number} timestamp\r\n   * @param {number} delay\r\n   * @param {number} duration\r\n   * @param {Object} currentState\r\n   * @param {Object} originalState\r\n   * @param {Object} targetState\r\n   * @param {Object} easing\r\n   * @param {Function(Object, *, number)} step\r\n   * @param {Function(Function,number)}} schedule\r\n   * @param {number=} opt_currentTimeOverride Needed for accurate timestamp in\r\n   * NGTweenable#seek.\r\n   * @private\r\n   */\r\n  function timeoutHandler (tweenable, timestamp, delay, duration, currentState,\r\n    originalState, targetState, easing, step, schedule,\r\n    opt_currentTimeOverride) {\r\n\r\n    timeoutHandler_endTime = timestamp + delay + duration;\r\n\r\n    timeoutHandler_currentTime =\r\n    Math.min(opt_currentTimeOverride || now(), timeoutHandler_endTime);\r\n\r\n    timeoutHandler_isEnded =\r\n      timeoutHandler_currentTime >= timeoutHandler_endTime;\r\n\r\n    timeoutHandler_offset = duration - (\r\n      timeoutHandler_endTime - timeoutHandler_currentTime);\r\n\r\n    if (tweenable.isPlaying()) {\r\n      if (timeoutHandler_isEnded) {\r\n        step(targetState, tweenable._attachment, timeoutHandler_offset);\r\n        tweenable.stop(true);\r\n      } else {\r\n        tweenable._scheduleId =\r\n          schedule(tweenable._timeoutHandler, UPDATE_TIME);\r\n\r\n        applyFilter(tweenable, 'beforeTween');\r\n\r\n        // If the animation has not yet reached the start point (e.g., there was\r\n        // delay that has not yet completed), just interpolate the starting\r\n        // position of the tween.\r\n        if (timeoutHandler_currentTime < (timestamp + delay)) {\r\n          tweenProps(1, currentState, originalState, targetState, 1, 1, easing);\r\n        } else {\r\n          tweenProps(timeoutHandler_currentTime, currentState, originalState,\r\n            targetState, duration, timestamp + delay, easing);\r\n        }\r\n\r\n        applyFilter(tweenable, 'afterTween');\r\n\r\n        step(currentState, tweenable._attachment, timeoutHandler_offset);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Creates a usable easing Object from a string, a function or another easing\r\n   * Object.  If `easing` is an Object, then this function clones it and fills\r\n   * in the missing properties with `\"linear\"`.\r\n   * @param {Object.<string|Function>} fromTweenParams\r\n   * @param {Object|string|Function} easing\r\n   * @return {Object.<string|Function>}\r\n   * @private\r\n   */\r\n  function composeEasingObject (fromTweenParams, easing) {\r\n    var composedEasing = {};\r\n    var typeofEasing = typeof easing;\r\n\r\n    if (typeofEasing === 'string' || typeofEasing === 'function') {\r\n      each(fromTweenParams, function (prop) {\r\n        composedEasing[prop] = easing;\r\n      });\r\n    } else {\r\n      each(fromTweenParams, function (prop) {\r\n        if (!composedEasing[prop]) {\r\n          composedEasing[prop] = easing[prop] || DEFAULT_EASING;\r\n        }\r\n      });\r\n    }\r\n\r\n    return composedEasing;\r\n  }\r\n\r\n  /**\r\n   * NGTweenable constructor.\r\n   * @class NGTweenable\r\n   * @param {Object=} opt_initialState The values that the initial tween should\r\n   * start at if a `from` object is not provided to `{{#crossLink\r\n   * \"NGTweenable/tween:method\"}}{{/crossLink}}` or `{{#crossLink\r\n   * \"NGTweenable/setConfig:method\"}}{{/crossLink}}`.\r\n   * @param {Object=} opt_config Configuration object to be passed to\r\n   * `{{#crossLink \"NGTweenable/setConfig:method\"}}{{/crossLink}}`.\r\n   * @module NGTweenable\r\n   * @constructor\r\n   */\r\n  function NGTweenable (opt_initialState, opt_config) {\r\n    this._currentState = opt_initialState || {};\r\n    this._configured = false;\r\n    this._scheduleFunction = DEFAULT_SCHEDULE_FUNCTION;\r\n\r\n    // To prevent unnecessary calls to setConfig do not set default\r\n    // configuration here.  Only set default configuration immediately before\r\n    // tweening if none has been set.\r\n    if (typeof opt_config !== 'undefined') {\r\n      this.setConfig(opt_config);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure and start a tween.\r\n   * @method tween\r\n   * @param {Object=} opt_config Configuration object to be passed to\r\n   * `{{#crossLink \"NGTweenable/setConfig:method\"}}{{/crossLink}}`.\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.tween = function (opt_config) {\r\n    if (this._isTweening) {\r\n      return this;\r\n    }\r\n\r\n    // Only set default config if no configuration has been set previously and\r\n    // none is provided now.\r\n    if (opt_config !== undefined || !this._configured) {\r\n      this.setConfig(opt_config);\r\n    }\r\n\r\n    this._timestamp = now();\r\n    this._start(this.get(), this._attachment);\r\n    return this.resume();\r\n  };\r\n\r\n  /**\r\n   * Configure a tween that will start at some point in the future.\r\n   *\r\n   * @method setConfig\r\n   * @param {Object} config The following values are valid:\r\n   * - __from__ (_Object=_): Starting position.  If omitted, `{{#crossLink\r\n   *   \"NGTweenable/get:method\"}}get(){{/crossLink}}` is used.\r\n   * - __to__ (_Object=_): Ending position.\r\n   * - __duration__ (_number=_): How many milliseconds to animate for.\r\n   * - __delay__ (_delay=_): How many milliseconds to wait before starting the\r\n   *   tween.\r\n   * - __start__ (_Function(Object, *)_): Function to execute when the tween\r\n   *   begins.  Receives the state of the tween as the first parameter and\r\n   *   `attachment` as the second parameter.\r\n   * - __step__ (_Function(Object, *, number)_): Function to execute on every\r\n   *   tick.  Receives `{{#crossLink\r\n   *   \"NGTweenable/get:method\"}}get(){{/crossLink}}` as the first parameter,\r\n   *   `attachment` as the second parameter, and the time elapsed since the\r\n   *   start of the tween as the third. This function is not called on the\r\n   *   final step of the animation, but `finish` is.\r\n   * - __finish__ (_Function(Object, *)_): Function to execute upon tween\r\n   *   completion.  Receives the state of the tween as the first parameter and\r\n   *   `attachment` as the second parameter.\r\n   * - __easing__ (_Object.<string|Function>|string|Function=_): Easing curve\r\n   *   name(s) or function(s) to use for the tween.\r\n   * - __attachment__ (_*_): Cached value that is passed to the\r\n   *   `step`/`start`/`finish` methods.\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.setConfig = function (config) {\r\n    config = config || {};\r\n    this._configured = true;\r\n\r\n    // Attach something to this NGTweenable instance (e.g.: a DOM element, an\r\n    // object, a string, etc.);\r\n    this._attachment = config.attachment;\r\n\r\n    // Init the internal state\r\n    this._pausedAtTime = null;\r\n    this._scheduleId = null;\r\n    this._delay = config.delay || 0;\r\n    this._start = config.start || noop;\r\n    this._step = config.step || noop;\r\n    this._finish = config.finish || noop;\r\n    this._duration = config.duration || DEFAULT_DURATION;\r\n    this._currentState = shallowCopy({}, config.from || this.get());\r\n    this._originalState = this.get();\r\n    this._targetState = shallowCopy({}, config.to || this.get());\r\n\r\n    var self = this;\r\n    this._timeoutHandler = function () {\r\n      timeoutHandler(self,\r\n        self._timestamp,\r\n        self._delay,\r\n        self._duration,\r\n        self._currentState,\r\n        self._originalState,\r\n        self._targetState,\r\n        self._easing,\r\n        self._step,\r\n        self._scheduleFunction\r\n      );\r\n    };\r\n\r\n    // Aliases used below\r\n    var currentState = this._currentState;\r\n    var targetState = this._targetState;\r\n\r\n    // Ensure that there is always something to tween to.\r\n    defaults(targetState, currentState);\r\n\r\n    this._easing = composeEasingObject(\r\n      currentState, config.easing || DEFAULT_EASING);\r\n\r\n    this._filterArgs =\r\n      [currentState, this._originalState, targetState, this._easing];\r\n\r\n    applyFilter(this, 'tweenCreated');\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * @method get\r\n   * @return {Object} The current state.\r\n   */\r\n  NGTweenable.prototype.get = function () {\r\n    return shallowCopy({}, this._currentState);\r\n  };\r\n\r\n  /**\r\n   * @method set\r\n   * @param {Object} state The current state.\r\n   */\r\n  NGTweenable.prototype.set = function (state) {\r\n    this._currentState = state;\r\n  };\r\n\r\n  /**\r\n   * Pause a tween.  Paused tweens can be resumed from the point at which they\r\n   * were paused.  This is different from `{{#crossLink\r\n   * \"NGTweenable/stop:method\"}}{{/crossLink}}`, as that method\r\n   * causes a tween to start over when it is resumed.\r\n   * @method pause\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.pause = function () {\r\n    this._pausedAtTime = now();\r\n    this._isPaused = true;\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Resume a paused tween.\r\n   * @method resume\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.resume = function () {\r\n    if (this._isPaused) {\r\n      this._timestamp += now() - this._pausedAtTime;\r\n    }\r\n\r\n    this._isPaused = false;\r\n    this._isTweening = true;\r\n\r\n    this._timeoutHandler();\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Move the state of the animation to a specific point in the tween's\r\n   * timeline.  If the animation is not running, this will cause the `step`\r\n   * handlers to be called.\r\n   * @method seek\r\n   * @param {millisecond} millisecond The millisecond of the animation to seek\r\n   * to.  This must not be less than `0`.\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.seek = function (millisecond) {\r\n    millisecond = Math.max(millisecond, 0);\r\n    var currentTime = now();\r\n\r\n    if ((this._timestamp + millisecond) === 0) {\r\n      return this;\r\n    }\r\n\r\n    this._timestamp = currentTime - millisecond;\r\n\r\n    if (!this.isPlaying()) {\r\n      this._isTweening = true;\r\n      this._isPaused = false;\r\n\r\n      // If the animation is not running, call timeoutHandler to make sure that\r\n      // any step handlers are run.\r\n      timeoutHandler(this,\r\n        this._timestamp,\r\n        this._delay,\r\n        this._duration,\r\n        this._currentState,\r\n        this._originalState,\r\n        this._targetState,\r\n        this._easing,\r\n        this._step,\r\n        this._scheduleFunction,\r\n        currentTime\r\n      );\r\n\r\n      this.pause();\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Stops and cancels a tween.\r\n   * @param {boolean=} gotoEnd If `false` or omitted, the tween just stops at\r\n   * its current state, and the `finish` handler is not invoked.  If `true`,\r\n   * the tweened object's values are instantly set to the target values, and\r\n   * `finish` is invoked.\r\n   * @method stop\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.stop = function (gotoEnd) {\r\n    this._isTweening = false;\r\n    this._isPaused = false;\r\n    this._timeoutHandler = noop;\r\n\r\n    (root.cancelAnimationFrame            ||\r\n    root.webkitCancelAnimationFrame     ||\r\n    root.oCancelAnimationFrame          ||\r\n    root.msCancelAnimationFrame         ||\r\n    root.mozCancelRequestAnimationFrame ||\r\n    root.clearTimeout)(this._scheduleId);\r\n\r\n    if (gotoEnd) {\r\n      applyFilter(this, 'beforeTween');\r\n      tweenProps(\r\n        1,\r\n        this._currentState,\r\n        this._originalState,\r\n        this._targetState,\r\n        1,\r\n        0,\r\n        this._easing\r\n      );\r\n      applyFilter(this, 'afterTween');\r\n      applyFilter(this, 'afterTweenEnd');\r\n      this._finish.call(this, this._currentState, this._attachment);\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * @method isPlaying\r\n   * @return {boolean} Whether or not a tween is running.\r\n   */\r\n  NGTweenable.prototype.isPlaying = function () {\r\n    return this._isTweening && !this._isPaused;\r\n  };\r\n\r\n  /**\r\n   * Set a custom schedule function.\r\n   *\r\n   * If a custom function is not set,\r\n   * [`requestAnimationFrame`](https://developer.mozilla.org/en-US/docs/Web/API/window.requestAnimationFrame)\r\n   * is used if available, otherwise\r\n   * [`setTimeout`](https://developer.mozilla.org/en-US/docs/Web/API/Window.setTimeout)\r\n   * is used.\r\n   * @method setScheduleFunction\r\n   * @param {Function(Function,number)} scheduleFunction The function to be\r\n   * used to schedule the next frame to be rendered.\r\n   */\r\n  NGTweenable.prototype.setScheduleFunction = function (scheduleFunction) {\r\n    this._scheduleFunction = scheduleFunction;\r\n  };\r\n\r\n  /**\r\n   * `delete` all \"own\" properties.  Call this when the `NGTweenable` instance\r\n   * is no longer needed to free memory.\r\n   * @method dispose\r\n   */\r\n  NGTweenable.prototype.dispose = function () {\r\n    var prop;\r\n    for (prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        delete this[prop];\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Filters are used for transforming the properties of a tween at various\r\n   * points in a NGTweenable's life cycle.  See the README for more info on this.\r\n   * @private\r\n   */\r\n  NGTweenable.prototype.filter = {};\r\n\r\n  /**\r\n   * This object contains all of the tweens available to Shifty.  It is\r\n   * extensible - simply attach properties to the `NGTweenable.prototype.formula`\r\n   * Object following the same format as `linear`.\r\n   *\r\n   * `pos` should be a normalized `number` (between 0 and 1).\r\n   * @property formula\r\n   * @type {Object(function)}\r\n   */\r\n  NGTweenable.prototype.formula = {\r\n    linear: function (pos) {\r\n      return pos;\r\n    }\r\n  };\r\n\r\n  formula = NGTweenable.prototype.formula;\r\n\r\n  shallowCopy(NGTweenable, {\r\n    'now': now\r\n    ,'each': each\r\n    ,'tweenProps': tweenProps\r\n    ,'tweenProp': tweenProp\r\n    ,'applyFilter': applyFilter\r\n    ,'shallowCopy': shallowCopy\r\n    ,'defaults': defaults\r\n    ,'composeEasingObject': composeEasingObject\r\n  });\r\n\r\n  // `root` is provided in the intro/outro files.\r\n\r\n  // A hook used for unit testing.\r\n  if (typeof SHIFTY_DEBUG_NOW === 'function') {\r\n    root.timeoutHandler = timeoutHandler;\r\n  }\r\n\r\n  // Bootstrap NGTweenable appropriately for the environment.\r\n  if (typeof exports === 'object') {\r\n    // CommonJS\r\n    module.exports = NGTweenable;\r\n  } else if (typeof define === 'function' && define.amdDISABLED) {\r\n    // AMD\r\n    define(function () {return NGTweenable;});\r\n  } else if (typeof root.NGTweenable === 'undefined') {\r\n    // Browser: Make `NGTweenable` globally accessible.\r\n    root.NGTweenable = NGTweenable;\r\n  }\r\n\r\n  return NGTweenable;\r\n\r\n} ());\r\n\r\n/*!\r\n * All equations are adapted from Thomas Fuchs'\r\n * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/penner.js).\r\n *\r\n * Based on Easing Equations (c) 2003 [Robert\r\n * Penner](http://www.robertpenner.com/), all rights reserved. This work is\r\n * [subject to terms](http://www.robertpenner.com/easing_terms_of_use.html).\r\n */\r\n\r\n/*!\r\n *  TERMS OF USE - EASING EQUATIONS\r\n *  Open source under the BSD License.\r\n *  Easing Equations (c) 2003 Robert Penner, all rights reserved.\r\n */\r\n\r\n;(function () {\r\n\r\n  NGTweenable.shallowCopy(NGTweenable.prototype.formula, {\r\n    easeInQuad: function (pos) {\r\n      return Math.pow(pos, 2);\r\n    },\r\n\r\n    easeOutQuad: function (pos) {\r\n      return -(Math.pow((pos - 1), 2) - 1);\r\n    },\r\n\r\n    easeInOutQuad: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,2);}\r\n      return -0.5 * ((pos -= 2) * pos - 2);\r\n    },\r\n\r\n    easeInCubic: function (pos) {\r\n      return Math.pow(pos, 3);\r\n    },\r\n\r\n    easeOutCubic: function (pos) {\r\n      return (Math.pow((pos - 1), 3) + 1);\r\n    },\r\n\r\n    easeInOutCubic: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,3);}\r\n      return 0.5 * (Math.pow((pos - 2),3) + 2);\r\n    },\r\n\r\n    easeInQuart: function (pos) {\r\n      return Math.pow(pos, 4);\r\n    },\r\n\r\n    easeOutQuart: function (pos) {\r\n      return -(Math.pow((pos - 1), 4) - 1);\r\n    },\r\n\r\n    easeInOutQuart: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,4);}\r\n      return -0.5 * ((pos -= 2) * Math.pow(pos,3) - 2);\r\n    },\r\n\r\n    easeInQuint: function (pos) {\r\n      return Math.pow(pos, 5);\r\n    },\r\n\r\n    easeOutQuint: function (pos) {\r\n      return (Math.pow((pos - 1), 5) + 1);\r\n    },\r\n\r\n    easeInOutQuint: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,5);}\r\n      return 0.5 * (Math.pow((pos - 2),5) + 2);\r\n    },\r\n\r\n    easeInSine: function (pos) {\r\n      return -Math.cos(pos * (Math.PI / 2)) + 1;\r\n    },\r\n\r\n    easeOutSine: function (pos) {\r\n      return Math.sin(pos * (Math.PI / 2));\r\n    },\r\n\r\n    easeInOutSine: function (pos) {\r\n      return (-0.5 * (Math.cos(Math.PI * pos) - 1));\r\n    },\r\n\r\n    easeInExpo: function (pos) {\r\n      return (pos === 0) ? 0 : Math.pow(2, 10 * (pos - 1));\r\n    },\r\n\r\n    easeOutExpo: function (pos) {\r\n      return (pos === 1) ? 1 : -Math.pow(2, -10 * pos) + 1;\r\n    },\r\n\r\n    easeInOutExpo: function (pos) {\r\n      if (pos === 0) {return 0;}\r\n      if (pos === 1) {return 1;}\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(2,10 * (pos - 1));}\r\n      return 0.5 * (-Math.pow(2, -10 * --pos) + 2);\r\n    },\r\n\r\n    easeInCirc: function (pos) {\r\n      return -(Math.sqrt(1 - (pos * pos)) - 1);\r\n    },\r\n\r\n    easeOutCirc: function (pos) {\r\n      return Math.sqrt(1 - Math.pow((pos - 1), 2));\r\n    },\r\n\r\n    easeInOutCirc: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return -0.5 * (Math.sqrt(1 - pos * pos) - 1);}\r\n      return 0.5 * (Math.sqrt(1 - (pos -= 2) * pos) + 1);\r\n    },\r\n\r\n    easeOutBounce: function (pos) {\r\n      if ((pos) < (1 / 2.75)) {\r\n        return (7.5625 * pos * pos);\r\n      } else if (pos < (2 / 2.75)) {\r\n        return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);\r\n      } else if (pos < (2.5 / 2.75)) {\r\n        return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);\r\n      } else {\r\n        return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);\r\n      }\r\n    },\r\n\r\n    easeInBack: function (pos) {\r\n      var s = 1.70158;\r\n      return (pos) * pos * ((s + 1) * pos - s);\r\n    },\r\n\r\n    easeOutBack: function (pos) {\r\n      var s = 1.70158;\r\n      return (pos = pos - 1) * pos * ((s + 1) * pos + s) + 1;\r\n    },\r\n\r\n    easeInOutBack: function (pos) {\r\n      var s = 1.70158;\r\n      if ((pos /= 0.5) < 1) {\r\n        return 0.5 * (pos * pos * (((s *= (1.525)) + 1) * pos - s));\r\n      }\r\n      return 0.5 * ((pos -= 2) * pos * (((s *= (1.525)) + 1) * pos + s) + 2);\r\n    },\r\n\r\n    elastic: function (pos) {\r\n      // jshint maxlen:90\r\n      return -1 * Math.pow(4,-8 * pos) * Math.sin((pos * 6 - 1) * (2 * Math.PI) / 2) + 1;\r\n    },\r\n\r\n    swingFromTo: function (pos) {\r\n      var s = 1.70158;\r\n      return ((pos /= 0.5) < 1) ?\r\n          0.5 * (pos * pos * (((s *= (1.525)) + 1) * pos - s)) :\r\n          0.5 * ((pos -= 2) * pos * (((s *= (1.525)) + 1) * pos + s) + 2);\r\n    },\r\n\r\n    swingFrom: function (pos) {\r\n      var s = 1.70158;\r\n      return pos * pos * ((s + 1) * pos - s);\r\n    },\r\n\r\n    swingTo: function (pos) {\r\n      var s = 1.70158;\r\n      return (pos -= 1) * pos * ((s + 1) * pos + s) + 1;\r\n    },\r\n\r\n    bounce: function (pos) {\r\n      if (pos < (1 / 2.75)) {\r\n        return (7.5625 * pos * pos);\r\n      } else if (pos < (2 / 2.75)) {\r\n        return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);\r\n      } else if (pos < (2.5 / 2.75)) {\r\n        return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);\r\n      } else {\r\n        return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);\r\n      }\r\n    },\r\n\r\n    bouncePast: function (pos) {\r\n      if (pos < (1 / 2.75)) {\r\n        return (7.5625 * pos * pos);\r\n      } else if (pos < (2 / 2.75)) {\r\n        return 2 - (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);\r\n      } else if (pos < (2.5 / 2.75)) {\r\n        return 2 - (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);\r\n      } else {\r\n        return 2 - (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);\r\n      }\r\n    },\r\n\r\n    easeFromTo: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,4);}\r\n      return -0.5 * ((pos -= 2) * Math.pow(pos,3) - 2);\r\n    },\r\n\r\n    easeFrom: function (pos) {\r\n      return Math.pow(pos,4);\r\n    },\r\n\r\n    easeTo: function (pos) {\r\n      return Math.pow(pos,0.25);\r\n    }\r\n  });\r\n\r\n}());\r\n\r\n// jshint maxlen:100\r\n/**\r\n * The Bezier magic in this file is adapted/copied almost wholesale from\r\n * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/cubic-bezier.js),\r\n * which was adapted from Apple code (which probably came from\r\n * [here](http://opensource.apple.com/source/WebCore/WebCore-955.66/platform/graphics/UnitBezier.h)).\r\n * Special thanks to Apple and Thomas Fuchs for much of this code.\r\n */\r\n\r\n/**\r\n *  Copyright (c) 2006 Apple Computer, Inc. All rights reserved.\r\n *\r\n *  Redistribution and use in source and binary forms, with or without\r\n *  modification, are permitted provided that the following conditions are met:\r\n *\r\n *  1. Redistributions of source code must retain the above copyright notice,\r\n *  this list of conditions and the following disclaimer.\r\n *\r\n *  2. Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation\r\n *  and/or other materials provided with the distribution.\r\n *\r\n *  3. Neither the name of the copyright holder(s) nor the names of any\r\n *  contributors may be used to endorse or promote products derived from\r\n *  this software without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n *  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\r\n *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n;(function () {\r\n  // port of webkit cubic bezier handling by http://www.netzgesta.de/dev/\r\n  function cubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration) {\r\n    var ax = 0,bx = 0,cx = 0,ay = 0,by = 0,cy = 0;\r\n    function sampleCurveX(t) {\r\n      return ((ax * t + bx) * t + cx) * t;\r\n    }\r\n    function sampleCurveY(t) {\r\n      return ((ay * t + by) * t + cy) * t;\r\n    }\r\n    function sampleCurveDerivativeX(t) {\r\n      return (3.0 * ax * t + 2.0 * bx) * t + cx;\r\n    }\r\n    function solveEpsilon(duration) {\r\n      return 1.0 / (200.0 * duration);\r\n    }\r\n    function solve(x,epsilon) {\r\n      return sampleCurveY(solveCurveX(x, epsilon));\r\n    }\r\n    function fabs(n) {\r\n      if (n >= 0) {\r\n        return n;\r\n      } else {\r\n        return 0 - n;\r\n      }\r\n    }\r\n    function solveCurveX(x, epsilon) {\r\n      var t0,t1,t2,x2,d2,i;\r\n      for (t2 = x, i = 0; i < 8; i++) {\r\n        x2 = sampleCurveX(t2) - x;\r\n        if (fabs(x2) < epsilon) {\r\n          return t2;\r\n        }\r\n        d2 = sampleCurveDerivativeX(t2);\r\n        if (fabs(d2) < 1e-6) {\r\n          break;\r\n        }\r\n        t2 = t2 - x2 / d2;\r\n      }\r\n      t0 = 0.0;\r\n      t1 = 1.0;\r\n      t2 = x;\r\n      if (t2 < t0) {\r\n        return t0;\r\n      }\r\n      if (t2 > t1) {\r\n        return t1;\r\n      }\r\n      while (t0 < t1) {\r\n        x2 = sampleCurveX(t2);\r\n        if (fabs(x2 - x) < epsilon) {\r\n          return t2;\r\n        }\r\n        if (x > x2) {\r\n          t0 = t2;\r\n        }else {\r\n          t1 = t2;\r\n        }\r\n        t2 = (t1 - t0) * 0.5 + t0;\r\n      }\r\n      return t2; // Failure.\r\n    }\r\n    cx = 3.0 * p1x;\r\n    bx = 3.0 * (p2x - p1x) - cx;\r\n    ax = 1.0 - cx - bx;\r\n    cy = 3.0 * p1y;\r\n    by = 3.0 * (p2y - p1y) - cy;\r\n    ay = 1.0 - cy - by;\r\n    return solve(t, solveEpsilon(duration));\r\n  }\r\n  /**\r\n   *  getCubicBezierTransition(x1, y1, x2, y2) -> Function\r\n   *\r\n   *  Generates a transition easing function that is compatible\r\n   *  with WebKit's CSS transitions `-webkit-transition-timing-function`\r\n   *  CSS property.\r\n   *\r\n   *  The W3C has more information about CSS3 transition timing functions:\r\n   *  http://www.w3.org/TR/css3-transitions/#transition-timing-function_tag\r\n   *\r\n   *  @param {number} x1\r\n   *  @param {number} y1\r\n   *  @param {number} x2\r\n   *  @param {number} y2\r\n   *  @return {function}\r\n   *  @private\r\n   */\r\n  function getCubicBezierTransition (x1, y1, x2, y2) {\r\n    return function (pos) {\r\n      return cubicBezierAtTime(pos,x1,y1,x2,y2,1);\r\n    };\r\n  }\r\n  // End ported code\r\n\r\n  /**\r\n   * Create a Bezier easing function and attach it to `{{#crossLink\r\n   * \"NGTweenable/formula:property\"}}NGTweenable#formula{{/crossLink}}`.  This\r\n   * function gives you total control over the easing curve.  Matthew Lein's\r\n   * [Ceaser](http://matthewlein.com/ceaser/) is a useful tool for visualizing\r\n   * the curves you can make with this function.\r\n   * @method setBezierFunction\r\n   * @param {string} name The name of the easing curve.  Overwrites the old\r\n   * easing function on `{{#crossLink\r\n   * \"NGTweenable/formula:property\"}}NGTweenable#formula{{/crossLink}}` if it\r\n   * exists.\r\n   * @param {number} x1\r\n   * @param {number} y1\r\n   * @param {number} x2\r\n   * @param {number} y2\r\n   * @return {function} The easing function that was attached to\r\n   * NGTweenable.prototype.formula.\r\n   */\r\n  NGTweenable.setBezierFunction = function (name, x1, y1, x2, y2) {\r\n    var cubicBezierTransition = getCubicBezierTransition(x1, y1, x2, y2);\r\n    cubicBezierTransition.displayName = name;\r\n    cubicBezierTransition.x1 = x1;\r\n    cubicBezierTransition.y1 = y1;\r\n    cubicBezierTransition.x2 = x2;\r\n    cubicBezierTransition.y2 = y2;\r\n\r\n    return NGTweenable.prototype.formula[name] = cubicBezierTransition;\r\n  };\r\n\r\n\r\n  /**\r\n   * `delete` an easing function from `{{#crossLink\r\n   * \"NGTweenable/formula:property\"}}NGTweenable#formula{{/crossLink}}`.  Be\r\n   * careful with this method, as it `delete`s whatever easing formula matches\r\n   * `name` (which means you can delete standard Shifty easing functions).\r\n   * @method unsetBezierFunction\r\n   * @param {string} name The name of the easing function to delete.\r\n   * @return {function}\r\n   */\r\n  NGTweenable.unsetBezierFunction = function (name) {\r\n    delete NGTweenable.prototype.formula[name];\r\n  };\r\n\r\n})();\r\n\r\n;(function () {\r\n\r\n  function getInterpolatedValues (\r\n    from, current, targetState, position, easing, delay) {\r\n    return NGTweenable.tweenProps(\r\n      position, current, from, targetState, 1, delay, easing);\r\n  }\r\n\r\n  // Fake a NGTweenable and patch some internals.  This approach allows us to\r\n  // skip uneccessary processing and object recreation, cutting down on garbage\r\n  // collection pauses.\r\n  var mockNGTweenable = new NGTweenable();\r\n  mockNGTweenable._filterArgs = [];\r\n\r\n  /**\r\n   * Compute the midpoint of two Objects.  This method effectively calculates a\r\n   * specific frame of animation that `{{#crossLink\r\n   * \"NGTweenable/tween:method\"}}{{/crossLink}}` does many times over the course\r\n   * of a full tween.\r\n   *\r\n   *     var interpolatedValues = NGTweenable.interpolate({\r\n   *       width: '100px',\r\n   *       opacity: 0,\r\n   *       color: '#fff'\r\n   *     }, {\r\n   *       width: '200px',\r\n   *       opacity: 1,\r\n   *       color: '#000'\r\n   *     }, 0.5);\r\n   *\r\n   *     console.log(interpolatedValues);\r\n   *     // {opacity: 0.5, width: \"150px\", color: \"rgb(127,127,127)\"}\r\n   *\r\n   * @static\r\n   * @method interpolate\r\n   * @param {Object} from The starting values to tween from.\r\n   * @param {Object} targetState The ending values to tween to.\r\n   * @param {number} position The normalized position value (between `0.0` and\r\n   * `1.0`) to interpolate the values between `from` and `to` for.  `from`\r\n   * represents `0` and `to` represents `1`.\r\n   * @param {Object.<string|Function>|string|Function} easing The easing\r\n   * curve(s) to calculate the midpoint against.  You can reference any easing\r\n   * function attached to `NGTweenable.prototype.formula`, or provide the easing\r\n   * function(s) directly.  If omitted, this defaults to \"linear\".\r\n   * @param {number=} opt_delay Optional delay to pad the beginning of the\r\n   * interpolated tween with.  This increases the range of `position` from (`0`\r\n   * through `1`) to (`0` through `1 + opt_delay`).  So, a delay of `0.5` would\r\n   * increase all valid values of `position` to numbers between `0` and `1.5`.\r\n   * @return {Object}\r\n   */\r\n  NGTweenable.interpolate = function (\r\n    from, targetState, position, easing, opt_delay) {\r\n\r\n    var current = NGTweenable.shallowCopy({}, from);\r\n    var delay = opt_delay || 0;\r\n    var easingObject = NGTweenable.composeEasingObject(\r\n      from, easing || 'linear');\r\n\r\n    mockNGTweenable.set({});\r\n\r\n    // Alias and reuse the _filterArgs array instead of recreating it.\r\n    var filterArgs = mockNGTweenable._filterArgs;\r\n    filterArgs.length = 0;\r\n    filterArgs[0] = current;\r\n    filterArgs[1] = from;\r\n    filterArgs[2] = targetState;\r\n    filterArgs[3] = easingObject;\r\n\r\n    // Any defined value transformation must be applied\r\n    NGTweenable.applyFilter(mockNGTweenable, 'tweenCreated');\r\n    NGTweenable.applyFilter(mockNGTweenable, 'beforeTween');\r\n\r\n    var interpolatedValues = getInterpolatedValues(\r\n      from, current, targetState, position, easingObject, delay);\r\n\r\n    // Transform values back into their original format\r\n    NGTweenable.applyFilter(mockNGTweenable, 'afterTween');\r\n\r\n    return interpolatedValues;\r\n  };\r\n\r\n}());\r\n\r\n/**\r\n * This module adds string interpolation support to Shifty.\r\n *\r\n * The Token extension allows Shifty to tween numbers inside of strings.  Among\r\n * other things, this allows you to animate CSS properties.  For example, you\r\n * can do this:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(45px)' },\r\n *       to: { transform: 'translateX(90xp)' }\r\n *     });\r\n *\r\n * `translateX(45)` will be tweened to `translateX(90)`.  To demonstrate:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(45px)' },\r\n *       to: { transform: 'translateX(90px)' },\r\n *       step: function (state) {\r\n *         console.log(state.transform);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will log something like this in the console:\r\n *\r\n *     translateX(60.3px)\r\n *     ...\r\n *     translateX(76.05px)\r\n *     ...\r\n *     translateX(90px)\r\n *\r\n * Another use for this is animating colors:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { color: 'rgb(0,255,0)' },\r\n *       to: { color: 'rgb(255,0,255)' },\r\n *       step: function (state) {\r\n *         console.log(state.color);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will log something like this:\r\n *\r\n *     rgb(84,170,84)\r\n *     ...\r\n *     rgb(170,84,170)\r\n *     ...\r\n *     rgb(255,0,255)\r\n *\r\n * This extension also supports hexadecimal colors, in both long (`#ff00ff`)\r\n * and short (`#f0f`) forms.  Be aware that hexadecimal input values will be\r\n * converted into the equivalent RGB output values.  This is done to optimize\r\n * for performance.\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { color: '#0f0' },\r\n *       to: { color: '#f0f' },\r\n *       step: function (state) {\r\n *         console.log(state.color);\r\n *       }\r\n *     });\r\n *\r\n * This snippet will generate the same output as the one before it because\r\n * equivalent values were supplied (just in hexadecimal form rather than RGB):\r\n *\r\n *     rgb(84,170,84)\r\n *     ...\r\n *     rgb(170,84,170)\r\n *     ...\r\n *     rgb(255,0,255)\r\n *\r\n * ## Easing support\r\n *\r\n * Easing works somewhat differently in the Token extension.  This is because\r\n * some CSS properties have multiple values in them, and you might need to\r\n * tween each value along its own easing curve.  A basic example:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(0px) translateY(0px)' },\r\n *       to: { transform:   'translateX(100px) translateY(100px)' },\r\n *       easing: { transform: 'easeInQuad' },\r\n *       step: function (state) {\r\n *         console.log(state.transform);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will create values like this:\r\n *\r\n *     translateX(11.56px) translateY(11.56px)\r\n *     ...\r\n *     translateX(46.24px) translateY(46.24px)\r\n *     ...\r\n *     translateX(100px) translateY(100px)\r\n *\r\n * In this case, the values for `translateX` and `translateY` are always the\r\n * same for each step of the tween, because they have the same start and end\r\n * points and both use the same easing curve.  We can also tween `translateX`\r\n * and `translateY` along independent curves:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(0px) translateY(0px)' },\r\n *       to: { transform:   'translateX(100px) translateY(100px)' },\r\n *       easing: { transform: 'easeInQuad bounce' },\r\n *       step: function (state) {\r\n *         console.log(state.transform);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will create values like this:\r\n *\r\n *     translateX(10.89px) translateY(82.35px)\r\n *     ...\r\n *     translateX(44.89px) translateY(86.73px)\r\n *     ...\r\n *     translateX(100px) translateY(100px)\r\n *\r\n * `translateX` and `translateY` are not in sync anymore, because `easeInQuad`\r\n * was specified for `translateX` and `bounce` for `translateY`.  Mixing and\r\n * matching easing curves can make for some interesting motion in your\r\n * animations.\r\n *\r\n * The order of the space-separated easing curves correspond the token values\r\n * they apply to.  If there are more token values than easing curves listed,\r\n * the last easing curve listed is used.\r\n * @submodule NGTweenable.token\r\n */\r\n\r\n// token function is defined above only so that dox-foundation sees it as\r\n// documentation and renders it.  It is never used, and is optimized away at\r\n// build time.\r\n\r\n;(function (NGTweenable) {\r\n\r\n  /**\r\n   * @typedef {{\r\n   *   formatString: string\r\n   *   chunkNames: Array.<string>\r\n   * }}\r\n   * @private\r\n   */\r\n  var formatManifest;\r\n\r\n  // CONSTANTS\r\n\r\n  var R_NUMBER_COMPONENT = /(\\d|\\-|\\.)/;\r\n  var R_FORMAT_CHUNKS = /([^\\-0-9\\.]+)/g;\r\n  var R_UNFORMATTED_VALUES = /[0-9.\\-]+/g;\r\n  var R_RGB = new RegExp(\r\n    'rgb\\\\(' + R_UNFORMATTED_VALUES.source +\r\n    (/,\\s*/.source) + R_UNFORMATTED_VALUES.source +\r\n    (/,\\s*/.source) + R_UNFORMATTED_VALUES.source + '\\\\)', 'g');\r\n  var R_RGB_PREFIX = /^.*\\(/;\r\n  var R_HEX = /#([0-9]|[a-f]){3,6}/gi;\r\n  var VALUE_PLACEHOLDER = 'VAL';\r\n\r\n  // HELPERS\r\n\r\n  /**\r\n   * @param {Array.number} rawValues\r\n   * @param {string} prefix\r\n   *\r\n   * @return {Array.<string>}\r\n   * @private\r\n   */\r\n  function getFormatChunksFrom (rawValues, prefix) {\r\n    var accumulator = [];\r\n\r\n    var rawValuesLength = rawValues.length;\r\n    var i;\r\n\r\n    for (i = 0; i < rawValuesLength; i++) {\r\n      accumulator.push('_' + prefix + '_' + i);\r\n    }\r\n\r\n    return accumulator;\r\n  }\r\n\r\n  /**\r\n   * @param {string} formattedString\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function getFormatStringFrom (formattedString) {\r\n    var chunks = formattedString.match(R_FORMAT_CHUNKS);\r\n\r\n    if (!chunks) {\r\n      // chunks will be null if there were no tokens to parse in\r\n      // formattedString (for example, if formattedString is '2').  Coerce\r\n      // chunks to be useful here.\r\n      chunks = ['', ''];\r\n\r\n      // If there is only one chunk, assume that the string is a number\r\n      // followed by a token...\r\n      // NOTE: This may be an unwise assumption.\r\n    } else if (chunks.length === 1 ||\r\n      // ...or if the string starts with a number component (\".\", \"-\", or a\r\n      // digit)...\r\n    formattedString.charAt(0).match(R_NUMBER_COMPONENT)) {\r\n      // ...prepend an empty string here to make sure that the formatted number\r\n      // is properly replaced by VALUE_PLACEHOLDER\r\n      chunks.unshift('');\r\n    }\r\n\r\n    return chunks.join(VALUE_PLACEHOLDER);\r\n  }\r\n\r\n  /**\r\n   * Convert all hex color values within a string to an rgb string.\r\n   *\r\n   * @param {Object} stateObject\r\n   *\r\n   * @return {Object} The modified obj\r\n   * @private\r\n   */\r\n  function sanitizeObjectForHexProps (stateObject) {\r\n    NGTweenable.each(stateObject, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n\r\n      if (typeof currentProp === 'string' && currentProp.match(R_HEX)) {\r\n        stateObject[prop] = sanitizeHexChunksToRGB(currentProp);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {string} str\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function  sanitizeHexChunksToRGB (str) {\r\n    return filterStringChunks(R_HEX, str, convertHexToRGB);\r\n  }\r\n\r\n  /**\r\n   * @param {string} hexString\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function convertHexToRGB (hexString) {\r\n    var rgbArr = hexToRGBArray(hexString);\r\n    return 'rgb(' + rgbArr[0] + ',' + rgbArr[1] + ',' + rgbArr[2] + ')';\r\n  }\r\n\r\n  var hexToRGBArray_returnArray = [];\r\n  /**\r\n   * Convert a hexadecimal string to an array with three items, one each for\r\n   * the red, blue, and green decimal values.\r\n   *\r\n   * @param {string} hex A hexadecimal string.\r\n   *\r\n   * @returns {Array.<number>} The converted Array of RGB values if `hex` is a\r\n   * valid string, or an Array of three 0's.\r\n   * @private\r\n   */\r\n  function hexToRGBArray (hex) {\r\n\r\n    hex = hex.replace(/#/, '');\r\n\r\n    // If the string is a shorthand three digit hex notation, normalize it to\r\n    // the standard six digit notation\r\n    if (hex.length === 3) {\r\n      hex = hex.split('');\r\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\r\n    }\r\n\r\n    hexToRGBArray_returnArray[0] = hexToDec(hex.substr(0, 2));\r\n    hexToRGBArray_returnArray[1] = hexToDec(hex.substr(2, 2));\r\n    hexToRGBArray_returnArray[2] = hexToDec(hex.substr(4, 2));\r\n\r\n    return hexToRGBArray_returnArray;\r\n  }\r\n\r\n  /**\r\n   * Convert a base-16 number to base-10.\r\n   *\r\n   * @param {Number|String} hex The value to convert\r\n   *\r\n   * @returns {Number} The base-10 equivalent of `hex`.\r\n   * @private\r\n   */\r\n  function hexToDec (hex) {\r\n    return parseInt(hex, 16);\r\n  }\r\n\r\n  /**\r\n   * Runs a filter operation on all chunks of a string that match a RegExp\r\n   *\r\n   * @param {RegExp} pattern\r\n   * @param {string} unfilteredString\r\n   * @param {function(string)} filter\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function filterStringChunks (pattern, unfilteredString, filter) {\r\n    var pattenMatches = unfilteredString.match(pattern);\r\n    var filteredString = unfilteredString.replace(pattern, VALUE_PLACEHOLDER);\r\n\r\n    if (pattenMatches) {\r\n      var pattenMatchesLength = pattenMatches.length;\r\n      var currentChunk;\r\n\r\n      for (var i = 0; i < pattenMatchesLength; i++) {\r\n        currentChunk = pattenMatches.shift();\r\n        filteredString = filteredString.replace(\r\n          VALUE_PLACEHOLDER, filter(currentChunk));\r\n      }\r\n    }\r\n\r\n    return filteredString;\r\n  }\r\n\r\n  /**\r\n   * Check for floating point values within rgb strings and rounds them.\r\n   *\r\n   * @param {string} formattedString\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function sanitizeRGBChunks (formattedString) {\r\n    return filterStringChunks(R_RGB, formattedString, sanitizeRGBChunk);\r\n  }\r\n\r\n  /**\r\n   * @param {string} rgbChunk\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function sanitizeRGBChunk (rgbChunk) {\r\n    var numbers = rgbChunk.match(R_UNFORMATTED_VALUES);\r\n    var numbersLength = numbers.length;\r\n    var sanitizedString = rgbChunk.match(R_RGB_PREFIX)[0];\r\n\r\n    for (var i = 0; i < numbersLength; i++) {\r\n      sanitizedString += parseInt(numbers[i], 10) + ',';\r\n    }\r\n\r\n    sanitizedString = sanitizedString.slice(0, -1) + ')';\r\n\r\n    return sanitizedString;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   *\r\n   * @return {Object} An Object of formatManifests that correspond to\r\n   * the string properties of stateObject\r\n   * @private\r\n   */\r\n  function getFormatManifests (stateObject) {\r\n    var manifestAccumulator = {};\r\n\r\n    NGTweenable.each(stateObject, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n\r\n      if (typeof currentProp === 'string') {\r\n        var rawValues = getValuesFrom(currentProp);\r\n\r\n        manifestAccumulator[prop] = {\r\n          'formatString': getFormatStringFrom(currentProp)\r\n          ,'chunkNames': getFormatChunksFrom(rawValues, prop)\r\n        };\r\n      }\r\n    });\r\n\r\n    return manifestAccumulator;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Object} formatManifests\r\n   * @private\r\n   */\r\n  function expandFormattedProperties (stateObject, formatManifests) {\r\n    NGTweenable.each(formatManifests, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n      var rawValues = getValuesFrom(currentProp);\r\n      var rawValuesLength = rawValues.length;\r\n\r\n      for (var i = 0; i < rawValuesLength; i++) {\r\n        stateObject[formatManifests[prop].chunkNames[i]] = +rawValues[i];\r\n      }\r\n\r\n      delete stateObject[prop];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Object} formatManifests\r\n   * @private\r\n   */\r\n  function collapseFormattedProperties (stateObject, formatManifests) {\r\n    NGTweenable.each(formatManifests, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n      var formatChunks = extractPropertyChunks(\r\n        stateObject, formatManifests[prop].chunkNames);\r\n      var valuesList = getValuesList(\r\n        formatChunks, formatManifests[prop].chunkNames);\r\n      currentProp = getFormattedValues(\r\n        formatManifests[prop].formatString, valuesList);\r\n      stateObject[prop] = sanitizeRGBChunks(currentProp);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Array.<string>} chunkNames\r\n   *\r\n   * @return {Object} The extracted value chunks.\r\n   * @private\r\n   */\r\n  function extractPropertyChunks (stateObject, chunkNames) {\r\n    var extractedValues = {};\r\n    var currentChunkName, chunkNamesLength = chunkNames.length;\r\n\r\n    for (var i = 0; i < chunkNamesLength; i++) {\r\n      currentChunkName = chunkNames[i];\r\n      extractedValues[currentChunkName] = stateObject[currentChunkName];\r\n      delete stateObject[currentChunkName];\r\n    }\r\n\r\n    return extractedValues;\r\n  }\r\n\r\n  var getValuesList_accumulator = [];\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Array.<string>} chunkNames\r\n   *\r\n   * @return {Array.<number>}\r\n   * @private\r\n   */\r\n  function getValuesList (stateObject, chunkNames) {\r\n    getValuesList_accumulator.length = 0;\r\n    var chunkNamesLength = chunkNames.length;\r\n\r\n    for (var i = 0; i < chunkNamesLength; i++) {\r\n      getValuesList_accumulator.push(stateObject[chunkNames[i]]);\r\n    }\r\n\r\n    return getValuesList_accumulator;\r\n  }\r\n\r\n  /**\r\n   * @param {string} formatString\r\n   * @param {Array.<number>} rawValues\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function getFormattedValues (formatString, rawValues) {\r\n    var formattedValueString = formatString;\r\n    var rawValuesLength = rawValues.length;\r\n\r\n    for (var i = 0; i < rawValuesLength; i++) {\r\n      formattedValueString = formattedValueString.replace(\r\n        VALUE_PLACEHOLDER, +rawValues[i].toFixed(4));\r\n    }\r\n\r\n    return formattedValueString;\r\n  }\r\n\r\n  /**\r\n   * Note: It's the duty of the caller to convert the Array elements of the\r\n   * return value into numbers.  This is a performance optimization.\r\n   *\r\n   * @param {string} formattedString\r\n   *\r\n   * @return {Array.<string>|null}\r\n   * @private\r\n   */\r\n  function getValuesFrom (formattedString) {\r\n    return formattedString.match(R_UNFORMATTED_VALUES);\r\n  }\r\n\r\n  /**\r\n   * @param {Object} easingObject\r\n   * @param {Object} tokenData\r\n   * @private\r\n   */\r\n  function expandEasingObject (easingObject, tokenData) {\r\n    NGTweenable.each(tokenData, function (prop) {\r\n      var currentProp = tokenData[prop];\r\n      var chunkNames = currentProp.chunkNames;\r\n      var chunkLength = chunkNames.length;\r\n\r\n      var easing = easingObject[prop];\r\n      var i;\r\n\r\n      if (typeof easing === 'string') {\r\n        var easingChunks = easing.split(' ');\r\n        var lastEasingChunk = easingChunks[easingChunks.length - 1];\r\n\r\n        for (i = 0; i < chunkLength; i++) {\r\n          easingObject[chunkNames[i]] = easingChunks[i] || lastEasingChunk;\r\n        }\r\n\r\n      } else {\r\n        for (i = 0; i < chunkLength; i++) {\r\n          easingObject[chunkNames[i]] = easing;\r\n        }\r\n      }\r\n\r\n      delete easingObject[prop];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Object} easingObject\r\n   * @param {Object} tokenData\r\n   * @private\r\n   */\r\n  function collapseEasingObject (easingObject, tokenData) {\r\n    NGTweenable.each(tokenData, function (prop) {\r\n      var currentProp = tokenData[prop];\r\n      var chunkNames = currentProp.chunkNames;\r\n      var chunkLength = chunkNames.length;\r\n\r\n      var firstEasing = easingObject[chunkNames[0]];\r\n      var typeofEasings = typeof firstEasing;\r\n\r\n      if (typeofEasings === 'string') {\r\n        var composedEasingString = '';\r\n\r\n        for (var i = 0; i < chunkLength; i++) {\r\n          composedEasingString += ' ' + easingObject[chunkNames[i]];\r\n          delete easingObject[chunkNames[i]];\r\n        }\r\n\r\n        easingObject[prop] = composedEasingString.substr(1);\r\n      } else {\r\n        easingObject[prop] = firstEasing;\r\n      }\r\n    });\r\n  }\r\n\r\n  NGTweenable.prototype.filter.token = {\r\n    'tweenCreated': function (currentState, fromState, toState, easingObject) {\r\n      sanitizeObjectForHexProps(currentState);\r\n      sanitizeObjectForHexProps(fromState);\r\n      sanitizeObjectForHexProps(toState);\r\n      this._tokenData = getFormatManifests(currentState);\r\n    },\r\n\r\n    'beforeTween': function (currentState, fromState, toState, easingObject) {\r\n      expandEasingObject(easingObject, this._tokenData);\r\n      expandFormattedProperties(currentState, this._tokenData);\r\n      expandFormattedProperties(fromState, this._tokenData);\r\n      expandFormattedProperties(toState, this._tokenData);\r\n    },\r\n\r\n    'afterTween': function (currentState, fromState, toState, easingObject) {\r\n      collapseFormattedProperties(currentState, this._tokenData);\r\n      collapseFormattedProperties(fromState, this._tokenData);\r\n      collapseFormattedProperties(toState, this._tokenData);\r\n      collapseEasingObject(easingObject, this._tokenData);\r\n    }\r\n  };\r\n\r\n} (NGTweenable));\r\n\r\n}).call(null);\r\n\r\n\r\n\r\n\r\n//##########################################################################################################################\r\n//## HAMMER.JS #############################################################################################################\r\n//##########################################################################################################################\r\n\r\n// HAMMER.JS\r\n\r\n// external module EMBEDED in nanogallery\r\n// NGY BUILD:\r\n// replace \"Hammer\" with \"NGHammer\" (case sensitive)\r\n// replace \"var SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\" with \"var SUPPORT_POINTER_EVENTS = false;\"\r\n// replace \"define.amd\" with \"define.amdDISABLED\"\r\n\r\n\r\n\r\n/*! NGHammer.JS - v2.0.7 - 2016-04-22\r\n * http://hammerjs.github.io/\r\n *\r\n * Copyright (c) 2016 Jorik Tangelder;\r\n * Licensed under the MIT license */\r\n(function(window, document, exportName, undefined) {\r\n  'use strict';\r\n\r\nvar VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\r\nvar TEST_ELEMENT = document.createElement('div');\r\n\r\nvar TYPE_FUNCTION = 'function';\r\n\r\nvar round = Math.round;\r\nvar abs = Math.abs;\r\nvar now = Date.now;\r\n\r\n/**\r\n * set a timeout with a given scope\r\n * @param {Function} fn\r\n * @param {Number} timeout\r\n * @param {Object} context\r\n * @returns {number}\r\n */\r\nfunction setTimeoutContext(fn, timeout, context) {\r\n    return setTimeout(bindFn(fn, context), timeout);\r\n}\r\n\r\n/**\r\n * if the argument is an array, we want to execute the fn on each entry\r\n * if it aint an array we don't want to do a thing.\r\n * this is used by all the methods that accept a single and array argument.\r\n * @param {*|Array} arg\r\n * @param {String} fn\r\n * @param {Object} [context]\r\n * @returns {Boolean}\r\n */\r\nfunction invokeArrayArg(arg, fn, context) {\r\n    if (Array.isArray(arg)) {\r\n        each(arg, context[fn], context);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * walk objects and arrays\r\n * @param {Object} obj\r\n * @param {Function} iterator\r\n * @param {Object} context\r\n */\r\nfunction each(obj, iterator, context) {\r\n    var i;\r\n\r\n    if (!obj) {\r\n        return;\r\n    }\r\n\r\n    if (obj.forEach) {\r\n        obj.forEach(iterator, context);\r\n    } else if (obj.length !== undefined) {\r\n        i = 0;\r\n        while (i < obj.length) {\r\n            iterator.call(context, obj[i], i, obj);\r\n            i++;\r\n        }\r\n    } else {\r\n        for (i in obj) {\r\n            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * wrap a method with a deprecation warning and stack trace\r\n * @param {Function} method\r\n * @param {String} name\r\n * @param {String} message\r\n * @returns {Function} A new function wrapping the supplied method.\r\n */\r\nfunction deprecate(method, name, message) {\r\n    var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\r\n    return function() {\r\n        var e = new Error('get-stack-trace');\r\n        var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '')\r\n            .replace(/^\\s+at\\s+/gm, '')\r\n            .replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\r\n\r\n        var log = window.console && (window.console.warn || window.console.log);\r\n        if (log) {\r\n            log.call(window.console, deprecationMessage, stack);\r\n        }\r\n        return method.apply(this, arguments);\r\n    };\r\n}\r\n\r\n/**\r\n * extend object.\r\n * means that properties in dest will be overwritten by the ones in src.\r\n * @param {Object} target\r\n * @param {...Object} objects_to_assign\r\n * @returns {Object} target\r\n */\r\nvar assign;\r\nif (typeof Object.assign !== 'function') {\r\n    assign = function assign(target) {\r\n        if (target === undefined || target === null) {\r\n            throw new TypeError('Cannot convert undefined or null to object');\r\n        }\r\n\r\n        var output = Object(target);\r\n        for (var index = 1; index < arguments.length; index++) {\r\n            var source = arguments[index];\r\n            if (source !== undefined && source !== null) {\r\n                for (var nextKey in source) {\r\n                    if (source.hasOwnProperty(nextKey)) {\r\n                        output[nextKey] = source[nextKey];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    };\r\n} else {\r\n    assign = Object.assign;\r\n}\r\n\r\n/**\r\n * extend object.\r\n * means that properties in dest will be overwritten by the ones in src.\r\n * @param {Object} dest\r\n * @param {Object} src\r\n * @param {Boolean} [merge=false]\r\n * @returns {Object} dest\r\n */\r\nvar extend = deprecate(function extend(dest, src, merge) {\r\n    var keys = Object.keys(src);\r\n    var i = 0;\r\n    while (i < keys.length) {\r\n        if (!merge || (merge && dest[keys[i]] === undefined)) {\r\n            dest[keys[i]] = src[keys[i]];\r\n        }\r\n        i++;\r\n    }\r\n    return dest;\r\n}, 'extend', 'Use `assign`.');\r\n\r\n/**\r\n * merge the values from src in the dest.\r\n * means that properties that exist in dest will not be overwritten by src\r\n * @param {Object} dest\r\n * @param {Object} src\r\n * @returns {Object} dest\r\n */\r\nvar merge = deprecate(function merge(dest, src) {\r\n    return extend(dest, src, true);\r\n}, 'merge', 'Use `assign`.');\r\n\r\n/**\r\n * simple class inheritance\r\n * @param {Function} child\r\n * @param {Function} base\r\n * @param {Object} [properties]\r\n */\r\nfunction inherit(child, base, properties) {\r\n    var baseP = base.prototype,\r\n        childP;\r\n\r\n    childP = child.prototype = Object.create(baseP);\r\n    childP.constructor = child;\r\n    childP._super = baseP;\r\n\r\n    if (properties) {\r\n        assign(childP, properties);\r\n    }\r\n}\r\n\r\n/**\r\n * simple function bind\r\n * @param {Function} fn\r\n * @param {Object} context\r\n * @returns {Function}\r\n */\r\nfunction bindFn(fn, context) {\r\n    return function boundFn() {\r\n        return fn.apply(context, arguments);\r\n    };\r\n}\r\n\r\n/**\r\n * let a boolean value also be a function that must return a boolean\r\n * this first item in args will be used as the context\r\n * @param {Boolean|Function} val\r\n * @param {Array} [args]\r\n * @returns {Boolean}\r\n */\r\nfunction boolOrFn(val, args) {\r\n    if (typeof val == TYPE_FUNCTION) {\r\n        return val.apply(args ? args[0] || undefined : undefined, args);\r\n    }\r\n    return val;\r\n}\r\n\r\n/**\r\n * use the val2 when val1 is undefined\r\n * @param {*} val1\r\n * @param {*} val2\r\n * @returns {*}\r\n */\r\nfunction ifUndefined(val1, val2) {\r\n    return (val1 === undefined) ? val2 : val1;\r\n}\r\n\r\n/**\r\n * addEventListener with multiple events at once\r\n * @param {EventTarget} target\r\n * @param {String} types\r\n * @param {Function} handler\r\n */\r\nfunction addEventListeners(target, types, handler) {\r\n    each(splitStr(types), function(type) {\r\n        target.addEventListener(type, handler, false);\r\n    });\r\n}\r\n\r\n/**\r\n * removeEventListener with multiple events at once\r\n * @param {EventTarget} target\r\n * @param {String} types\r\n * @param {Function} handler\r\n */\r\nfunction removeEventListeners(target, types, handler) {\r\n    each(splitStr(types), function(type) {\r\n        target.removeEventListener(type, handler, false);\r\n    });\r\n}\r\n\r\n/**\r\n * find if a node is in the given parent\r\n * @method hasParent\r\n * @param {HTMLElement} node\r\n * @param {HTMLElement} parent\r\n * @return {Boolean} found\r\n */\r\nfunction hasParent(node, parent) {\r\n    while (node) {\r\n        if (node == parent) {\r\n            return true;\r\n        }\r\n        node = node.parentNode;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * small indexOf wrapper\r\n * @param {String} str\r\n * @param {String} find\r\n * @returns {Boolean} found\r\n */\r\nfunction inStr(str, find) {\r\n    return str.indexOf(find) > -1;\r\n}\r\n\r\n/**\r\n * split string on whitespace\r\n * @param {String} str\r\n * @returns {Array} words\r\n */\r\nfunction splitStr(str) {\r\n    return str.trim().split(/\\s+/g);\r\n}\r\n\r\n/**\r\n * find if a array contains the object using indexOf or a simple polyFill\r\n * @param {Array} src\r\n * @param {String} find\r\n * @param {String} [findByKey]\r\n * @return {Boolean|Number} false when not found, or the index\r\n */\r\nfunction inArray(src, find, findByKey) {\r\n    if (src.indexOf && !findByKey) {\r\n        return src.indexOf(find);\r\n    } else {\r\n        var i = 0;\r\n        while (i < src.length) {\r\n            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {\r\n                return i;\r\n            }\r\n            i++;\r\n        }\r\n        return -1;\r\n    }\r\n}\r\n\r\n/**\r\n * convert array-like objects to real arrays\r\n * @param {Object} obj\r\n * @returns {Array}\r\n */\r\nfunction toArray(obj) {\r\n    return Array.prototype.slice.call(obj, 0);\r\n}\r\n\r\n/**\r\n * unique array with objects based on a key (like 'id') or just by the array's value\r\n * @param {Array} src [{id:1},{id:2},{id:1}]\r\n * @param {String} [key]\r\n * @param {Boolean} [sort=False]\r\n * @returns {Array} [{id:1},{id:2}]\r\n */\r\nfunction uniqueArray(src, key, sort) {\r\n    var results = [];\r\n    var values = [];\r\n    var i = 0;\r\n\r\n    while (i < src.length) {\r\n        var val = key ? src[i][key] : src[i];\r\n        if (inArray(values, val) < 0) {\r\n            results.push(src[i]);\r\n        }\r\n        values[i] = val;\r\n        i++;\r\n    }\r\n\r\n    if (sort) {\r\n        if (!key) {\r\n            results = results.sort();\r\n        } else {\r\n            results = results.sort(function sortUniqueArray(a, b) {\r\n                return a[key] > b[key];\r\n            });\r\n        }\r\n    }\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * get the prefixed property\r\n * @param {Object} obj\r\n * @param {String} property\r\n * @returns {String|Undefined} prefixed\r\n */\r\nfunction prefixed(obj, property) {\r\n    var prefix, prop;\r\n    var camelProp = property[0].toUpperCase() + property.slice(1);\r\n\r\n    var i = 0;\r\n    while (i < VENDOR_PREFIXES.length) {\r\n        prefix = VENDOR_PREFIXES[i];\r\n        prop = (prefix) ? prefix + camelProp : property;\r\n\r\n        if (prop in obj) {\r\n            return prop;\r\n        }\r\n        i++;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * get a unique id\r\n * @returns {number} uniqueId\r\n */\r\nvar _uniqueId = 1;\r\nfunction uniqueId() {\r\n    return _uniqueId++;\r\n}\r\n\r\n/**\r\n * get the window object of an element\r\n * @param {HTMLElement} element\r\n * @returns {DocumentView|Window}\r\n */\r\nfunction getWindowForElement(element) {\r\n    var doc = element.ownerDocument || element;\r\n    return (doc.defaultView || doc.parentWindow || window);\r\n}\r\n\r\nvar MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\r\n\r\nvar SUPPORT_TOUCH = ('ontouchstart' in window);\r\n// var SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\r\nvar SUPPORT_POINTER_EVENTS = false;\r\nvar SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\r\n\r\nvar INPUT_TYPE_TOUCH = 'touch';\r\nvar INPUT_TYPE_PEN = 'pen';\r\nvar INPUT_TYPE_MOUSE = 'mouse';\r\nvar INPUT_TYPE_KINECT = 'kinect';\r\n\r\nvar COMPUTE_INTERVAL = 25;\r\n\r\nvar INPUT_START = 1;\r\nvar INPUT_MOVE = 2;\r\nvar INPUT_END = 4;\r\nvar INPUT_CANCEL = 8;\r\n\r\nvar DIRECTION_NONE = 1;\r\nvar DIRECTION_LEFT = 2;\r\nvar DIRECTION_RIGHT = 4;\r\nvar DIRECTION_UP = 8;\r\nvar DIRECTION_DOWN = 16;\r\n\r\nvar DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\r\nvar DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\r\nvar DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\r\n\r\nvar PROPS_XY = ['x', 'y'];\r\nvar PROPS_CLIENT_XY = ['clientX', 'clientY'];\r\n\r\n/**\r\n * create new input type manager\r\n * @param {Manager} manager\r\n * @param {Function} callback\r\n * @returns {Input}\r\n * @constructor\r\n */\r\nfunction Input(manager, callback) {\r\n    var self = this;\r\n    this.manager = manager;\r\n    this.callback = callback;\r\n    this.element = manager.element;\r\n    this.target = manager.options.inputTarget;\r\n\r\n    // smaller wrapper around the handler, for the scope and the enabled state of the manager,\r\n    // so when disabled the input events are completely bypassed.\r\n    this.domHandler = function(ev) {\r\n        if (boolOrFn(manager.options.enable, [manager])) {\r\n            self.handler(ev);\r\n        }\r\n    };\r\n\r\n    this.init();\r\n\r\n}\r\n\r\nInput.prototype = {\r\n    /**\r\n     * should handle the inputEvent data and trigger the callback\r\n     * @virtual\r\n     */\r\n    handler: function() { },\r\n\r\n    /**\r\n     * bind the events\r\n     */\r\n    init: function() {\r\n        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\r\n        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\r\n        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\r\n    },\r\n\r\n    /**\r\n     * unbind the events\r\n     */\r\n    destroy: function() {\r\n        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\r\n        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\r\n        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\r\n    }\r\n};\r\n\r\n/**\r\n * create new input type manager\r\n * called by the Manager constructor\r\n * @param {NGHammer} manager\r\n * @returns {Input}\r\n */\r\nfunction createInputInstance(manager) {\r\n    var Type;\r\n    var inputClass = manager.options.inputClass;\r\n\r\n    if (inputClass) {\r\n        Type = inputClass;\r\n    } else if (SUPPORT_POINTER_EVENTS) {\r\n        Type = PointerEventInput;\r\n    } else if (SUPPORT_ONLY_TOUCH) {\r\n        Type = TouchInput;\r\n    } else if (!SUPPORT_TOUCH) {\r\n        Type = MouseInput;\r\n    } else {\r\n        Type = TouchMouseInput;\r\n    }\r\n    return new (Type)(manager, inputHandler);\r\n}\r\n\r\n/**\r\n * handle input events\r\n * @param {Manager} manager\r\n * @param {String} eventType\r\n * @param {Object} input\r\n */\r\nfunction inputHandler(manager, eventType, input) {\r\n    var pointersLen = input.pointers.length;\r\n    var changedPointersLen = input.changedPointers.length;\r\n    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));\r\n    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));\r\n\r\n    input.isFirst = !!isFirst;\r\n    input.isFinal = !!isFinal;\r\n\r\n    if (isFirst) {\r\n        manager.session = {};\r\n    }\r\n\r\n    // source event is the normalized value of the domEvents\r\n    // like 'touchstart, mouseup, pointerdown'\r\n    input.eventType = eventType;\r\n\r\n    // compute scale, rotation etc\r\n    computeInputData(manager, input);\r\n\r\n    // emit secret event\r\n    manager.emit('hammer.input', input);\r\n\r\n    manager.recognize(input);\r\n    manager.session.prevInput = input;\r\n}\r\n\r\n/**\r\n * extend the data with some usable properties like scale, rotate, velocity etc\r\n * @param {Object} manager\r\n * @param {Object} input\r\n */\r\nfunction computeInputData(manager, input) {\r\n    var session = manager.session;\r\n    var pointers = input.pointers;\r\n    var pointersLength = pointers.length;\r\n\r\n    // store the first input to calculate the distance and direction\r\n    if (!session.firstInput) {\r\n        session.firstInput = simpleCloneInputData(input);\r\n    }\r\n\r\n    // to compute scale and rotation we need to store the multiple touches\r\n    if (pointersLength > 1 && !session.firstMultiple) {\r\n        session.firstMultiple = simpleCloneInputData(input);\r\n    } else if (pointersLength === 1) {\r\n        session.firstMultiple = false;\r\n    }\r\n\r\n    var firstInput = session.firstInput;\r\n    var firstMultiple = session.firstMultiple;\r\n    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\r\n\r\n    var center = input.center = getCenter(pointers);\r\n    input.timeStamp = now();\r\n    input.deltaTime = input.timeStamp - firstInput.timeStamp;\r\n\r\n    input.angle = getAngle(offsetCenter, center);\r\n    input.distance = getDistance(offsetCenter, center);\r\n\r\n    computeDeltaXY(session, input);\r\n    input.offsetDirection = getDirection(input.deltaX, input.deltaY);\r\n\r\n    var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\r\n    input.overallVelocityX = overallVelocity.x;\r\n    input.overallVelocityY = overallVelocity.y;\r\n    input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;\r\n\r\n    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\r\n    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\r\n\r\n    input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >\r\n        session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);\r\n\r\n    computeIntervalInputData(session, input);\r\n\r\n    // find the correct target\r\n    var target = manager.element;\r\n    if (hasParent(input.srcEvent.target, target)) {\r\n        target = input.srcEvent.target;\r\n    }\r\n    input.target = target;\r\n}\r\n\r\nfunction computeDeltaXY(session, input) {\r\n    var center = input.center;\r\n    var offset = session.offsetDelta || {};\r\n    var prevDelta = session.prevDelta || {};\r\n    var prevInput = session.prevInput || {};\r\n\r\n    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\r\n        prevDelta = session.prevDelta = {\r\n            x: prevInput.deltaX || 0,\r\n            y: prevInput.deltaY || 0\r\n        };\r\n\r\n        offset = session.offsetDelta = {\r\n            x: center.x,\r\n            y: center.y\r\n        };\r\n    }\r\n\r\n    input.deltaX = prevDelta.x + (center.x - offset.x);\r\n    input.deltaY = prevDelta.y + (center.y - offset.y);\r\n}\r\n\r\n/**\r\n * velocity is calculated every x ms\r\n * @param {Object} session\r\n * @param {Object} input\r\n */\r\nfunction computeIntervalInputData(session, input) {\r\n    var last = session.lastInterval || input,\r\n        deltaTime = input.timeStamp - last.timeStamp,\r\n        velocity, velocityX, velocityY, direction;\r\n\r\n    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\r\n        var deltaX = input.deltaX - last.deltaX;\r\n        var deltaY = input.deltaY - last.deltaY;\r\n\r\n        var v = getVelocity(deltaTime, deltaX, deltaY);\r\n        velocityX = v.x;\r\n        velocityY = v.y;\r\n        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\r\n        direction = getDirection(deltaX, deltaY);\r\n\r\n        session.lastInterval = input;\r\n    } else {\r\n        // use latest velocity info if it doesn't overtake a minimum period\r\n        velocity = last.velocity;\r\n        velocityX = last.velocityX;\r\n        velocityY = last.velocityY;\r\n        direction = last.direction;\r\n    }\r\n\r\n    input.velocity = velocity;\r\n    input.velocityX = velocityX;\r\n    input.velocityY = velocityY;\r\n    input.direction = direction;\r\n}\r\n\r\n/**\r\n * create a simple clone from the input used for storage of firstInput and firstMultiple\r\n * @param {Object} input\r\n * @returns {Object} clonedInputData\r\n */\r\nfunction simpleCloneInputData(input) {\r\n    // make a simple copy of the pointers because we will get a reference if we don't\r\n    // we only need clientXY for the calculations\r\n    var pointers = [];\r\n    var i = 0;\r\n    while (i < input.pointers.length) {\r\n        pointers[i] = {\r\n            clientX: round(input.pointers[i].clientX),\r\n            clientY: round(input.pointers[i].clientY)\r\n        };\r\n        i++;\r\n    }\r\n\r\n    return {\r\n        timeStamp: now(),\r\n        pointers: pointers,\r\n        center: getCenter(pointers),\r\n        deltaX: input.deltaX,\r\n        deltaY: input.deltaY\r\n    };\r\n}\r\n\r\n/**\r\n * get the center of all the pointers\r\n * @param {Array} pointers\r\n * @return {Object} center contains `x` and `y` properties\r\n */\r\nfunction getCenter(pointers) {\r\n    var pointersLength = pointers.length;\r\n\r\n    // no need to loop when only one touch\r\n    if (pointersLength === 1) {\r\n        return {\r\n            x: round(pointers[0].clientX),\r\n            y: round(pointers[0].clientY)\r\n        };\r\n    }\r\n\r\n    var x = 0, y = 0, i = 0;\r\n    while (i < pointersLength) {\r\n        x += pointers[i].clientX;\r\n        y += pointers[i].clientY;\r\n        i++;\r\n    }\r\n\r\n    return {\r\n        x: round(x / pointersLength),\r\n        y: round(y / pointersLength)\r\n    };\r\n}\r\n\r\n/**\r\n * calculate the velocity between two points. unit is in px per ms.\r\n * @param {Number} deltaTime\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @return {Object} velocity `x` and `y`\r\n */\r\nfunction getVelocity(deltaTime, x, y) {\r\n    return {\r\n        x: x / deltaTime || 0,\r\n        y: y / deltaTime || 0\r\n    };\r\n}\r\n\r\n/**\r\n * get the direction between two points\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @return {Number} direction\r\n */\r\nfunction getDirection(x, y) {\r\n    if (x === y) {\r\n        return DIRECTION_NONE;\r\n    }\r\n\r\n    if (abs(x) >= abs(y)) {\r\n        return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\r\n    }\r\n    return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\r\n}\r\n\r\n/**\r\n * calculate the absolute distance between two points\r\n * @param {Object} p1 {x, y}\r\n * @param {Object} p2 {x, y}\r\n * @param {Array} [props] containing x and y keys\r\n * @return {Number} distance\r\n */\r\nfunction getDistance(p1, p2, props) {\r\n    if (!props) {\r\n        props = PROPS_XY;\r\n    }\r\n    var x = p2[props[0]] - p1[props[0]],\r\n        y = p2[props[1]] - p1[props[1]];\r\n\r\n    return Math.sqrt((x * x) + (y * y));\r\n}\r\n\r\n/**\r\n * calculate the angle between two coordinates\r\n * @param {Object} p1\r\n * @param {Object} p2\r\n * @param {Array} [props] containing x and y keys\r\n * @return {Number} angle\r\n */\r\nfunction getAngle(p1, p2, props) {\r\n    if (!props) {\r\n        props = PROPS_XY;\r\n    }\r\n    var x = p2[props[0]] - p1[props[0]],\r\n        y = p2[props[1]] - p1[props[1]];\r\n    return Math.atan2(y, x) * 180 / Math.PI;\r\n}\r\n\r\n/**\r\n * calculate the rotation degrees between two pointersets\r\n * @param {Array} start array of pointers\r\n * @param {Array} end array of pointers\r\n * @return {Number} rotation\r\n */\r\nfunction getRotation(start, end) {\r\n    return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\r\n}\r\n\r\n/**\r\n * calculate the scale factor between two pointersets\r\n * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\r\n * @param {Array} start array of pointers\r\n * @param {Array} end array of pointers\r\n * @return {Number} scale\r\n */\r\nfunction getScale(start, end) {\r\n    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\r\n}\r\n\r\nvar MOUSE_INPUT_MAP = {\r\n    mousedown: INPUT_START,\r\n    mousemove: INPUT_MOVE,\r\n    mouseup: INPUT_END\r\n};\r\n\r\nvar MOUSE_ELEMENT_EVENTS = 'mousedown';\r\nvar MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\r\n\r\n/**\r\n * Mouse events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction MouseInput() {\r\n    this.evEl = MOUSE_ELEMENT_EVENTS;\r\n    this.evWin = MOUSE_WINDOW_EVENTS;\r\n\r\n    this.pressed = false; // mousedown state\r\n\r\n    Input.apply(this, arguments);\r\n}\r\n\r\ninherit(MouseInput, Input, {\r\n    /**\r\n     * handle mouse events\r\n     * @param {Object} ev\r\n     */\r\n    handler: function MEhandler(ev) {\r\n        var eventType = MOUSE_INPUT_MAP[ev.type];\r\n\r\n        // on start we want to have the left mouse button down\r\n        if (eventType & INPUT_START && ev.button === 0) {\r\n            this.pressed = true;\r\n        }\r\n\r\n        if (eventType & INPUT_MOVE && ev.which !== 1) {\r\n            eventType = INPUT_END;\r\n        }\r\n\r\n        // mouse must be down\r\n        if (!this.pressed) {\r\n            return;\r\n        }\r\n\r\n        if (eventType & INPUT_END) {\r\n            this.pressed = false;\r\n        }\r\n\r\n        this.callback(this.manager, eventType, {\r\n            pointers: [ev],\r\n            changedPointers: [ev],\r\n            pointerType: INPUT_TYPE_MOUSE,\r\n            srcEvent: ev\r\n        });\r\n    }\r\n});\r\n\r\nvar POINTER_INPUT_MAP = {\r\n    pointerdown: INPUT_START,\r\n    pointermove: INPUT_MOVE,\r\n    pointerup: INPUT_END,\r\n    pointercancel: INPUT_CANCEL,\r\n    pointerout: INPUT_CANCEL\r\n};\r\n\r\n// in IE10 the pointer types is defined as an enum\r\nvar IE10_POINTER_TYPE_ENUM = {\r\n    2: INPUT_TYPE_TOUCH,\r\n    3: INPUT_TYPE_PEN,\r\n    4: INPUT_TYPE_MOUSE,\r\n    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\r\n};\r\n\r\nvar POINTER_ELEMENT_EVENTS = 'pointerdown';\r\nvar POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\r\n\r\n// IE10 has prefixed support, and case-sensitive\r\nif (window.MSPointerEvent && !window.PointerEvent) {\r\n    POINTER_ELEMENT_EVENTS = 'MSPointerDown';\r\n    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\r\n}\r\n\r\n/**\r\n * Pointer events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction PointerEventInput() {\r\n    this.evEl = POINTER_ELEMENT_EVENTS;\r\n    this.evWin = POINTER_WINDOW_EVENTS;\r\n\r\n    Input.apply(this, arguments);\r\n\r\n    this.store = (this.manager.session.pointerEvents = []);\r\n}\r\n\r\ninherit(PointerEventInput, Input, {\r\n    /**\r\n     * handle mouse events\r\n     * @param {Object} ev\r\n     */\r\n    handler: function PEhandler(ev) {\r\n        var store = this.store;\r\n        var removePointer = false;\r\n\r\n        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\r\n        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\r\n        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\r\n\r\n        var isTouch = (pointerType == INPUT_TYPE_TOUCH);\r\n\r\n        // get index of the event in the store\r\n        var storeIndex = inArray(store, ev.pointerId, 'pointerId');\r\n\r\n        // start and mouse must be down\r\n        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\r\n            if (storeIndex < 0) {\r\n                store.push(ev);\r\n                storeIndex = store.length - 1;\r\n            }\r\n        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\r\n            removePointer = true;\r\n        }\r\n\r\n        // it not found, so the pointer hasn't been down (so it's probably a hover)\r\n        if (storeIndex < 0) {\r\n            return;\r\n        }\r\n\r\n        // update the event in the store\r\n        store[storeIndex] = ev;\r\n\r\n        this.callback(this.manager, eventType, {\r\n            pointers: store,\r\n            changedPointers: [ev],\r\n            pointerType: pointerType,\r\n            srcEvent: ev\r\n        });\r\n\r\n        if (removePointer) {\r\n            // remove from the store\r\n            store.splice(storeIndex, 1);\r\n        }\r\n    }\r\n});\r\n\r\nvar SINGLE_TOUCH_INPUT_MAP = {\r\n    touchstart: INPUT_START,\r\n    touchmove: INPUT_MOVE,\r\n    touchend: INPUT_END,\r\n    touchcancel: INPUT_CANCEL\r\n};\r\n\r\nvar SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\r\nvar SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\r\n\r\n/**\r\n * Touch events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction SingleTouchInput() {\r\n    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\r\n    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\r\n    this.started = false;\r\n\r\n    Input.apply(this, arguments);\r\n}\r\n\r\ninherit(SingleTouchInput, Input, {\r\n    handler: function TEhandler(ev) {\r\n        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\r\n\r\n        // should we handle the touch events?\r\n        if (type === INPUT_START) {\r\n            this.started = true;\r\n        }\r\n\r\n        if (!this.started) {\r\n            return;\r\n        }\r\n\r\n        var touches = normalizeSingleTouches.call(this, ev, type);\r\n\r\n        // when done, reset the started state\r\n        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\r\n            this.started = false;\r\n        }\r\n\r\n        this.callback(this.manager, type, {\r\n            pointers: touches[0],\r\n            changedPointers: touches[1],\r\n            pointerType: INPUT_TYPE_TOUCH,\r\n            srcEvent: ev\r\n        });\r\n    }\r\n});\r\n\r\n/**\r\n * @this {TouchInput}\r\n * @param {Object} ev\r\n * @param {Number} type flag\r\n * @returns {undefined|Array} [all, changed]\r\n */\r\nfunction normalizeSingleTouches(ev, type) {\r\n    var all = toArray(ev.touches);\r\n    var changed = toArray(ev.changedTouches);\r\n\r\n    if (type & (INPUT_END | INPUT_CANCEL)) {\r\n        all = uniqueArray(all.concat(changed), 'identifier', true);\r\n    }\r\n\r\n    return [all, changed];\r\n}\r\n\r\nvar TOUCH_INPUT_MAP = {\r\n    touchstart: INPUT_START,\r\n    touchmove: INPUT_MOVE,\r\n    touchend: INPUT_END,\r\n    touchcancel: INPUT_CANCEL\r\n};\r\n\r\nvar TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\r\n\r\n/**\r\n * Multi-user touch events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction TouchInput() {\r\n    this.evTarget = TOUCH_TARGET_EVENTS;\r\n    this.targetIds = {};\r\n\r\n    Input.apply(this, arguments);\r\n}\r\n\r\ninherit(TouchInput, Input, {\r\n    handler: function MTEhandler(ev) {\r\n        var type = TOUCH_INPUT_MAP[ev.type];\r\n        var touches = getTouches.call(this, ev, type);\r\n        if (!touches) {\r\n            return;\r\n        }\r\n\r\n        this.callback(this.manager, type, {\r\n            pointers: touches[0],\r\n            changedPointers: touches[1],\r\n            pointerType: INPUT_TYPE_TOUCH,\r\n            srcEvent: ev\r\n        });\r\n    }\r\n});\r\n\r\n/**\r\n * @this {TouchInput}\r\n * @param {Object} ev\r\n * @param {Number} type flag\r\n * @returns {undefined|Array} [all, changed]\r\n */\r\nfunction getTouches(ev, type) {\r\n    var allTouches = toArray(ev.touches);\r\n    var targetIds = this.targetIds;\r\n\r\n    // when there is only one touch, the process can be simplified\r\n    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\r\n        targetIds[allTouches[0].identifier] = true;\r\n        return [allTouches, allTouches];\r\n    }\r\n\r\n    var i,\r\n        targetTouches,\r\n        changedTouches = toArray(ev.changedTouches),\r\n        changedTargetTouches = [],\r\n        target = this.target;\r\n\r\n    // get target touches from touches\r\n    targetTouches = allTouches.filter(function(touch) {\r\n        return hasParent(touch.target, target);\r\n    });\r\n\r\n    // collect touches\r\n    if (type === INPUT_START) {\r\n        i = 0;\r\n        while (i < targetTouches.length) {\r\n            targetIds[targetTouches[i].identifier] = true;\r\n            i++;\r\n        }\r\n    }\r\n\r\n    // filter changed touches to only contain touches that exist in the collected target ids\r\n    i = 0;\r\n    while (i < changedTouches.length) {\r\n        if (targetIds[changedTouches[i].identifier]) {\r\n            changedTargetTouches.push(changedTouches[i]);\r\n        }\r\n\r\n        // cleanup removed touches\r\n        if (type & (INPUT_END | INPUT_CANCEL)) {\r\n            delete targetIds[changedTouches[i].identifier];\r\n        }\r\n        i++;\r\n    }\r\n\r\n    if (!changedTargetTouches.length) {\r\n        return;\r\n    }\r\n\r\n    return [\r\n        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\r\n        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),\r\n        changedTargetTouches\r\n    ];\r\n}\r\n\r\n/**\r\n * Combined touch and mouse input\r\n *\r\n * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\r\n * This because touch devices also emit mouse events while doing a touch.\r\n *\r\n * @constructor\r\n * @extends Input\r\n */\r\n\r\nvar DEDUP_TIMEOUT = 2500;\r\nvar DEDUP_DISTANCE = 25;\r\n\r\nfunction TouchMouseInput() {\r\n    Input.apply(this, arguments);\r\n\r\n    var handler = bindFn(this.handler, this);\r\n    this.touch = new TouchInput(this.manager, handler);\r\n    this.mouse = new MouseInput(this.manager, handler);\r\n\r\n    this.primaryTouch = null;\r\n    this.lastTouches = [];\r\n}\r\n\r\ninherit(TouchMouseInput, Input, {\r\n    /**\r\n     * handle mouse and touch events\r\n     * @param {NGHammer} manager\r\n     * @param {String} inputEvent\r\n     * @param {Object} inputData\r\n     */\r\n    handler: function TMEhandler(manager, inputEvent, inputData) {\r\n        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),\r\n            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);\r\n\r\n        if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\r\n            return;\r\n        }\r\n\r\n        // when we're in a touch event, record touches to  de-dupe synthetic mouse event\r\n        if (isTouch) {\r\n            recordTouches.call(this, inputEvent, inputData);\r\n        } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\r\n            return;\r\n        }\r\n\r\n        this.callback(manager, inputEvent, inputData);\r\n    },\r\n\r\n    /**\r\n     * remove the event listeners\r\n     */\r\n    destroy: function destroy() {\r\n        this.touch.destroy();\r\n        this.mouse.destroy();\r\n    }\r\n});\r\n\r\nfunction recordTouches(eventType, eventData) {\r\n    if (eventType & INPUT_START) {\r\n        this.primaryTouch = eventData.changedPointers[0].identifier;\r\n        setLastTouch.call(this, eventData);\r\n    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\r\n        setLastTouch.call(this, eventData);\r\n    }\r\n}\r\n\r\nfunction setLastTouch(eventData) {\r\n    var touch = eventData.changedPointers[0];\r\n\r\n    if (touch.identifier === this.primaryTouch) {\r\n        var lastTouch = {x: touch.clientX, y: touch.clientY};\r\n        this.lastTouches.push(lastTouch);\r\n        var lts = this.lastTouches;\r\n        var removeLastTouch = function() {\r\n            var i = lts.indexOf(lastTouch);\r\n            if (i > -1) {\r\n                lts.splice(i, 1);\r\n            }\r\n        };\r\n        setTimeout(removeLastTouch, DEDUP_TIMEOUT);\r\n    }\r\n}\r\n\r\nfunction isSyntheticEvent(eventData) {\r\n    var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;\r\n    for (var i = 0; i < this.lastTouches.length; i++) {\r\n        var t = this.lastTouches[i];\r\n        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);\r\n        if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nvar PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\r\nvar NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\r\n\r\n// magical touchAction value\r\nvar TOUCH_ACTION_COMPUTE = 'compute';\r\nvar TOUCH_ACTION_AUTO = 'auto';\r\nvar TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\r\nvar TOUCH_ACTION_NONE = 'none';\r\nvar TOUCH_ACTION_PAN_X = 'pan-x';\r\nvar TOUCH_ACTION_PAN_Y = 'pan-y';\r\nvar TOUCH_ACTION_MAP = getTouchActionProps();\r\n\r\n/**\r\n * Touch Action\r\n * sets the touchAction property or uses the js alternative\r\n * @param {Manager} manager\r\n * @param {String} value\r\n * @constructor\r\n */\r\nfunction TouchAction(manager, value) {\r\n    this.manager = manager;\r\n    this.set(value);\r\n}\r\n\r\nTouchAction.prototype = {\r\n    /**\r\n     * set the touchAction value on the element or enable the polyfill\r\n     * @param {String} value\r\n     */\r\n    set: function(value) {\r\n        // find out the touch-action by the event handlers\r\n        if (value == TOUCH_ACTION_COMPUTE) {\r\n            value = this.compute();\r\n        }\r\n\r\n        if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\r\n            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\r\n        }\r\n        this.actions = value.toLowerCase().trim();\r\n    },\r\n\r\n    /**\r\n     * just re-set the touchAction value\r\n     */\r\n    update: function() {\r\n        this.set(this.manager.options.touchAction);\r\n    },\r\n\r\n    /**\r\n     * compute the value for the touchAction property based on the recognizer's settings\r\n     * @returns {String} value\r\n     */\r\n    compute: function() {\r\n        var actions = [];\r\n        each(this.manager.recognizers, function(recognizer) {\r\n            if (boolOrFn(recognizer.options.enable, [recognizer])) {\r\n                actions = actions.concat(recognizer.getTouchAction());\r\n            }\r\n        });\r\n        return cleanTouchActions(actions.join(' '));\r\n    },\r\n\r\n    /**\r\n     * this method is called on each input cycle and provides the preventing of the browser behavior\r\n     * @param {Object} input\r\n     */\r\n    preventDefaults: function(input) {\r\n        var srcEvent = input.srcEvent;\r\n        var direction = input.offsetDirection;\r\n\r\n        // if the touch action did prevented once this session\r\n        if (this.manager.session.prevented) {\r\n            srcEvent.preventDefault();\r\n            return;\r\n        }\r\n\r\n        var actions = this.actions;\r\n        var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\r\n        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\r\n        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\r\n\r\n        if (hasNone) {\r\n            //do not prevent defaults if this is a tap gesture\r\n\r\n            var isTapPointer = input.pointers.length === 1;\r\n            var isTapMovement = input.distance < 2;\r\n            var isTapTouchTime = input.deltaTime < 250;\r\n\r\n            if (isTapPointer && isTapMovement && isTapTouchTime) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (hasPanX && hasPanY) {\r\n            // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\r\n            return;\r\n        }\r\n\r\n        if (hasNone ||\r\n            (hasPanY && direction & DIRECTION_HORIZONTAL) ||\r\n            (hasPanX && direction & DIRECTION_VERTICAL)) {\r\n            return this.preventSrc(srcEvent);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\r\n     * @param {Object} srcEvent\r\n     */\r\n    preventSrc: function(srcEvent) {\r\n        this.manager.session.prevented = true;\r\n        srcEvent.preventDefault();\r\n    }\r\n};\r\n\r\n/**\r\n * when the touchActions are collected they are not a valid value, so we need to clean things up. *\r\n * @param {String} actions\r\n * @returns {*}\r\n */\r\nfunction cleanTouchActions(actions) {\r\n    // none\r\n    if (inStr(actions, TOUCH_ACTION_NONE)) {\r\n        return TOUCH_ACTION_NONE;\r\n    }\r\n\r\n    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\r\n    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\r\n\r\n    // if both pan-x and pan-y are set (different recognizers\r\n    // for different directions, e.g. horizontal pan but vertical swipe?)\r\n    // we need none (as otherwise with pan-x pan-y combined none of these\r\n    // recognizers will work, since the browser would handle all panning\r\n    if (hasPanX && hasPanY) {\r\n        return TOUCH_ACTION_NONE;\r\n    }\r\n\r\n    // pan-x OR pan-y\r\n    if (hasPanX || hasPanY) {\r\n        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\r\n    }\r\n\r\n    // manipulation\r\n    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\r\n        return TOUCH_ACTION_MANIPULATION;\r\n    }\r\n\r\n    return TOUCH_ACTION_AUTO;\r\n}\r\n\r\nfunction getTouchActionProps() {\r\n    if (!NATIVE_TOUCH_ACTION) {\r\n        return false;\r\n    }\r\n    var touchMap = {};\r\n    var cssSupports = window.CSS && window.CSS.supports;\r\n    ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {\r\n\r\n        // If css.supports is not supported but there is native touch-action assume it supports\r\n        // all values. This is the case for IE 10 and 11.\r\n        touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\r\n    });\r\n    return touchMap;\r\n}\r\n\r\n/**\r\n * Recognizer flow explained; *\r\n * All recognizers have the initial state of POSSIBLE when a input session starts.\r\n * The definition of a input session is from the first input until the last input, with all it's movement in it. *\r\n * Example session for mouse-input: mousedown -> mousemove -> mouseup\r\n *\r\n * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\r\n * which determines with state it should be.\r\n *\r\n * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\r\n * POSSIBLE to give it another change on the next cycle.\r\n *\r\n *               Possible\r\n *                  |\r\n *            +-----+---------------+\r\n *            |                     |\r\n *      +-----+-----+               |\r\n *      |           |               |\r\n *   Failed      Cancelled          |\r\n *                          +-------+------+\r\n *                          |              |\r\n *                      Recognized       Began\r\n *                                         |\r\n *                                      Changed\r\n *                                         |\r\n *                                  Ended/Recognized\r\n */\r\nvar STATE_POSSIBLE = 1;\r\nvar STATE_BEGAN = 2;\r\nvar STATE_CHANGED = 4;\r\nvar STATE_ENDED = 8;\r\nvar STATE_RECOGNIZED = STATE_ENDED;\r\nvar STATE_CANCELLED = 16;\r\nvar STATE_FAILED = 32;\r\n\r\n/**\r\n * Recognizer\r\n * Every recognizer needs to extend from this class.\r\n * @constructor\r\n * @param {Object} options\r\n */\r\nfunction Recognizer(options) {\r\n    this.options = assign({}, this.defaults, options || {});\r\n\r\n    this.id = uniqueId();\r\n\r\n    this.manager = null;\r\n\r\n    // default is enable true\r\n    this.options.enable = ifUndefined(this.options.enable, true);\r\n\r\n    this.state = STATE_POSSIBLE;\r\n\r\n    this.simultaneous = {};\r\n    this.requireFail = [];\r\n}\r\n\r\nRecognizer.prototype = {\r\n    /**\r\n     * @virtual\r\n     * @type {Object}\r\n     */\r\n    defaults: {},\r\n\r\n    /**\r\n     * set options\r\n     * @param {Object} options\r\n     * @return {Recognizer}\r\n     */\r\n    set: function(options) {\r\n        assign(this.options, options);\r\n\r\n        // also update the touchAction, in case something changed about the directions/enabled state\r\n        this.manager && this.manager.touchAction.update();\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * recognize simultaneous with an other recognizer.\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    recognizeWith: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\r\n            return this;\r\n        }\r\n\r\n        var simultaneous = this.simultaneous;\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        if (!simultaneous[otherRecognizer.id]) {\r\n            simultaneous[otherRecognizer.id] = otherRecognizer;\r\n            otherRecognizer.recognizeWith(this);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * drop the simultaneous link. it doesnt remove the link on the other recognizer.\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    dropRecognizeWith: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\r\n            return this;\r\n        }\r\n\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        delete this.simultaneous[otherRecognizer.id];\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * recognizer can only run when an other is failing\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    requireFailure: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\r\n            return this;\r\n        }\r\n\r\n        var requireFail = this.requireFail;\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        if (inArray(requireFail, otherRecognizer) === -1) {\r\n            requireFail.push(otherRecognizer);\r\n            otherRecognizer.requireFailure(this);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * drop the requireFailure link. it does not remove the link on the other recognizer.\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    dropRequireFailure: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\r\n            return this;\r\n        }\r\n\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        var index = inArray(this.requireFail, otherRecognizer);\r\n        if (index > -1) {\r\n            this.requireFail.splice(index, 1);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * has require failures boolean\r\n     * @returns {boolean}\r\n     */\r\n    hasRequireFailures: function() {\r\n        return this.requireFail.length > 0;\r\n    },\r\n\r\n    /**\r\n     * if the recognizer can recognize simultaneous with an other recognizer\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Boolean}\r\n     */\r\n    canRecognizeWith: function(otherRecognizer) {\r\n        return !!this.simultaneous[otherRecognizer.id];\r\n    },\r\n\r\n    /**\r\n     * You should use `tryEmit` instead of `emit` directly to check\r\n     * that all the needed recognizers has failed before emitting.\r\n     * @param {Object} input\r\n     */\r\n    emit: function(input) {\r\n        var self = this;\r\n        var state = this.state;\r\n\r\n        function emit(event) {\r\n            self.manager.emit(event, input);\r\n        }\r\n\r\n        // 'panstart' and 'panmove'\r\n        if (state < STATE_ENDED) {\r\n            emit(self.options.event + stateStr(state));\r\n        }\r\n\r\n        emit(self.options.event); // simple 'eventName' events\r\n\r\n        if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)\r\n            emit(input.additionalEvent);\r\n        }\r\n\r\n        // panend and pancancel\r\n        if (state >= STATE_ENDED) {\r\n            emit(self.options.event + stateStr(state));\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Check that all the require failure recognizers has failed,\r\n     * if true, it emits a gesture event,\r\n     * otherwise, setup the state to FAILED.\r\n     * @param {Object} input\r\n     */\r\n    tryEmit: function(input) {\r\n        if (this.canEmit()) {\r\n            return this.emit(input);\r\n        }\r\n        // it's failing anyway\r\n        this.state = STATE_FAILED;\r\n    },\r\n\r\n    /**\r\n     * can we emit?\r\n     * @returns {boolean}\r\n     */\r\n    canEmit: function() {\r\n        var i = 0;\r\n        while (i < this.requireFail.length) {\r\n            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\r\n                return false;\r\n            }\r\n            i++;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * update the recognizer\r\n     * @param {Object} inputData\r\n     */\r\n    recognize: function(inputData) {\r\n        // make a new copy of the inputData\r\n        // so we can change the inputData without messing up the other recognizers\r\n        var inputDataClone = assign({}, inputData);\r\n\r\n        // is is enabled and allow recognizing?\r\n        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\r\n            this.reset();\r\n            this.state = STATE_FAILED;\r\n            return;\r\n        }\r\n\r\n        // reset when we've reached the end\r\n        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\r\n            this.state = STATE_POSSIBLE;\r\n        }\r\n\r\n        this.state = this.process(inputDataClone);\r\n\r\n        // the recognizer has recognized a gesture\r\n        // so trigger an event\r\n        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\r\n            this.tryEmit(inputDataClone);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * return the state of the recognizer\r\n     * the actual recognizing happens in this method\r\n     * @virtual\r\n     * @param {Object} inputData\r\n     * @returns {Const} STATE\r\n     */\r\n    process: function(inputData) { }, // jshint ignore:line\r\n\r\n    /**\r\n     * return the preferred touch-action\r\n     * @virtual\r\n     * @returns {Array}\r\n     */\r\n    getTouchAction: function() { },\r\n\r\n    /**\r\n     * called when the gesture isn't allowed to recognize\r\n     * like when another is being recognized or it is disabled\r\n     * @virtual\r\n     */\r\n    reset: function() { }\r\n};\r\n\r\n/**\r\n * get a usable string, used as event postfix\r\n * @param {Const} state\r\n * @returns {String} state\r\n */\r\nfunction stateStr(state) {\r\n    if (state & STATE_CANCELLED) {\r\n        return 'cancel';\r\n    } else if (state & STATE_ENDED) {\r\n        return 'end';\r\n    } else if (state & STATE_CHANGED) {\r\n        return 'move';\r\n    } else if (state & STATE_BEGAN) {\r\n        return 'start';\r\n    }\r\n    return '';\r\n}\r\n\r\n/**\r\n * direction cons to string\r\n * @param {Const} direction\r\n * @returns {String}\r\n */\r\nfunction directionStr(direction) {\r\n    if (direction == DIRECTION_DOWN) {\r\n        return 'down';\r\n    } else if (direction == DIRECTION_UP) {\r\n        return 'up';\r\n    } else if (direction == DIRECTION_LEFT) {\r\n        return 'left';\r\n    } else if (direction == DIRECTION_RIGHT) {\r\n        return 'right';\r\n    }\r\n    return '';\r\n}\r\n\r\n/**\r\n * get a recognizer by name if it is bound to a manager\r\n * @param {Recognizer|String} otherRecognizer\r\n * @param {Recognizer} recognizer\r\n * @returns {Recognizer}\r\n */\r\nfunction getRecognizerByNameIfManager(otherRecognizer, recognizer) {\r\n    var manager = recognizer.manager;\r\n    if (manager) {\r\n        return manager.get(otherRecognizer);\r\n    }\r\n    return otherRecognizer;\r\n}\r\n\r\n/**\r\n * This recognizer is just used as a base for the simple attribute recognizers.\r\n * @constructor\r\n * @extends Recognizer\r\n */\r\nfunction AttrRecognizer() {\r\n    Recognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(AttrRecognizer, Recognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof AttrRecognizer\r\n     */\r\n    defaults: {\r\n        /**\r\n         * @type {Number}\r\n         * @default 1\r\n         */\r\n        pointers: 1\r\n    },\r\n\r\n    /**\r\n     * Used to check if it the recognizer receives valid input, like input.distance > 10.\r\n     * @memberof AttrRecognizer\r\n     * @param {Object} input\r\n     * @returns {Boolean} recognized\r\n     */\r\n    attrTest: function(input) {\r\n        var optionPointers = this.options.pointers;\r\n        return optionPointers === 0 || input.pointers.length === optionPointers;\r\n    },\r\n\r\n    /**\r\n     * Process the input and return the state for the recognizer\r\n     * @memberof AttrRecognizer\r\n     * @param {Object} input\r\n     * @returns {*} State\r\n     */\r\n    process: function(input) {\r\n        var state = this.state;\r\n        var eventType = input.eventType;\r\n\r\n        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\r\n        var isValid = this.attrTest(input);\r\n\r\n        // on cancel input and we've recognized before, return STATE_CANCELLED\r\n        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\r\n            return state | STATE_CANCELLED;\r\n        } else if (isRecognized || isValid) {\r\n            if (eventType & INPUT_END) {\r\n                return state | STATE_ENDED;\r\n            } else if (!(state & STATE_BEGAN)) {\r\n                return STATE_BEGAN;\r\n            }\r\n            return state | STATE_CHANGED;\r\n        }\r\n        return STATE_FAILED;\r\n    }\r\n});\r\n\r\n/**\r\n * Pan\r\n * Recognized when the pointer is down and moved in the allowed direction.\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction PanRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n\r\n    this.pX = null;\r\n    this.pY = null;\r\n}\r\n\r\ninherit(PanRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PanRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'pan',\r\n        threshold: 10,\r\n        pointers: 1,\r\n        direction: DIRECTION_ALL\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        var direction = this.options.direction;\r\n        var actions = [];\r\n        if (direction & DIRECTION_HORIZONTAL) {\r\n            actions.push(TOUCH_ACTION_PAN_Y);\r\n        }\r\n        if (direction & DIRECTION_VERTICAL) {\r\n            actions.push(TOUCH_ACTION_PAN_X);\r\n        }\r\n        return actions;\r\n    },\r\n\r\n    directionTest: function(input) {\r\n        var options = this.options;\r\n        var hasMoved = true;\r\n        var distance = input.distance;\r\n        var direction = input.direction;\r\n        var x = input.deltaX;\r\n        var y = input.deltaY;\r\n\r\n        // lock to axis?\r\n        if (!(direction & options.direction)) {\r\n            if (options.direction & DIRECTION_HORIZONTAL) {\r\n                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\r\n                hasMoved = x != this.pX;\r\n                distance = Math.abs(input.deltaX);\r\n            } else {\r\n                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\r\n                hasMoved = y != this.pY;\r\n                distance = Math.abs(input.deltaY);\r\n            }\r\n        }\r\n        input.direction = direction;\r\n        return hasMoved && distance > options.threshold && direction & options.direction;\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        return AttrRecognizer.prototype.attrTest.call(this, input) &&\r\n            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\r\n    },\r\n\r\n    emit: function(input) {\r\n\r\n        this.pX = input.deltaX;\r\n        this.pY = input.deltaY;\r\n\r\n        var direction = directionStr(input.direction);\r\n\r\n        if (direction) {\r\n            input.additionalEvent = this.options.event + direction;\r\n        }\r\n        this._super.emit.call(this, input);\r\n    }\r\n});\r\n\r\n/**\r\n * Pinch\r\n * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction PinchRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(PinchRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PinchRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'pinch',\r\n        threshold: 0,\r\n        pointers: 2\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_NONE];\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        return this._super.attrTest.call(this, input) &&\r\n            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\r\n    },\r\n\r\n    emit: function(input) {\r\n        if (input.scale !== 1) {\r\n            var inOut = input.scale < 1 ? 'in' : 'out';\r\n            input.additionalEvent = this.options.event + inOut;\r\n        }\r\n        this._super.emit.call(this, input);\r\n    }\r\n});\r\n\r\n/**\r\n * Press\r\n * Recognized when the pointer is down for x ms without any movement.\r\n * @constructor\r\n * @extends Recognizer\r\n */\r\nfunction PressRecognizer() {\r\n    Recognizer.apply(this, arguments);\r\n\r\n    this._timer = null;\r\n    this._input = null;\r\n}\r\n\r\ninherit(PressRecognizer, Recognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PressRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'press',\r\n        pointers: 1,\r\n        time: 251, // minimal time of the pointer to be pressed\r\n        threshold: 9 // a minimal movement is ok, but keep it low\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_AUTO];\r\n    },\r\n\r\n    process: function(input) {\r\n        var options = this.options;\r\n        var validPointers = input.pointers.length === options.pointers;\r\n        var validMovement = input.distance < options.threshold;\r\n        var validTime = input.deltaTime > options.time;\r\n\r\n        this._input = input;\r\n\r\n        // we only allow little movement\r\n        // and we've reached an end event, so a tap is possible\r\n        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {\r\n            this.reset();\r\n        } else if (input.eventType & INPUT_START) {\r\n            this.reset();\r\n            this._timer = setTimeoutContext(function() {\r\n                this.state = STATE_RECOGNIZED;\r\n                this.tryEmit();\r\n            }, options.time, this);\r\n        } else if (input.eventType & INPUT_END) {\r\n            return STATE_RECOGNIZED;\r\n        }\r\n        return STATE_FAILED;\r\n    },\r\n\r\n    reset: function() {\r\n        clearTimeout(this._timer);\r\n    },\r\n\r\n    emit: function(input) {\r\n        if (this.state !== STATE_RECOGNIZED) {\r\n            return;\r\n        }\r\n\r\n        if (input && (input.eventType & INPUT_END)) {\r\n            this.manager.emit(this.options.event + 'up', input);\r\n        } else {\r\n            this._input.timeStamp = now();\r\n            this.manager.emit(this.options.event, this._input);\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * Rotate\r\n * Recognized when two or more pointer are moving in a circular motion.\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction RotateRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(RotateRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof RotateRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'rotate',\r\n        threshold: 0,\r\n        pointers: 2\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_NONE];\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        return this._super.attrTest.call(this, input) &&\r\n            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\r\n    }\r\n});\r\n\r\n/**\r\n * Swipe\r\n * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction SwipeRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(SwipeRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof SwipeRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'swipe',\r\n        threshold: 10,\r\n        velocity: 0.3,\r\n        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\r\n        pointers: 1\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return PanRecognizer.prototype.getTouchAction.call(this);\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        var direction = this.options.direction;\r\n        var velocity;\r\n\r\n        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\r\n            velocity = input.overallVelocity;\r\n        } else if (direction & DIRECTION_HORIZONTAL) {\r\n            velocity = input.overallVelocityX;\r\n        } else if (direction & DIRECTION_VERTICAL) {\r\n            velocity = input.overallVelocityY;\r\n        }\r\n\r\n        return this._super.attrTest.call(this, input) &&\r\n            direction & input.offsetDirection &&\r\n            input.distance > this.options.threshold &&\r\n            input.maxPointers == this.options.pointers &&\r\n            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\r\n    },\r\n\r\n    emit: function(input) {\r\n        var direction = directionStr(input.offsetDirection);\r\n        if (direction) {\r\n            this.manager.emit(this.options.event + direction, input);\r\n        }\r\n\r\n        this.manager.emit(this.options.event, input);\r\n    }\r\n});\r\n\r\n/**\r\n * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\r\n * between the given interval and position. The delay option can be used to recognize multi-taps without firing\r\n * a single tap.\r\n *\r\n * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\r\n * multi-taps being recognized.\r\n * @constructor\r\n * @extends Recognizer\r\n */\r\nfunction TapRecognizer() {\r\n    Recognizer.apply(this, arguments);\r\n\r\n    // previous time and center,\r\n    // used for tap counting\r\n    this.pTime = false;\r\n    this.pCenter = false;\r\n\r\n    this._timer = null;\r\n    this._input = null;\r\n    this.count = 0;\r\n}\r\n\r\ninherit(TapRecognizer, Recognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PinchRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'tap',\r\n        pointers: 1,\r\n        taps: 1,\r\n        interval: 300, // max time between the multi-tap taps\r\n        time: 250, // max time of the pointer to be down (like finger on the screen)\r\n        threshold: 9, // a minimal movement is ok, but keep it low\r\n        posThreshold: 10 // a multi-tap can be a bit off the initial position\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_MANIPULATION];\r\n    },\r\n\r\n    process: function(input) {\r\n        var options = this.options;\r\n\r\n        var validPointers = input.pointers.length === options.pointers;\r\n        var validMovement = input.distance < options.threshold;\r\n        var validTouchTime = input.deltaTime < options.time;\r\n\r\n        this.reset();\r\n\r\n        if ((input.eventType & INPUT_START) && (this.count === 0)) {\r\n            return this.failTimeout();\r\n        }\r\n\r\n        // we only allow little movement\r\n        // and we've reached an end event, so a tap is possible\r\n        if (validMovement && validTouchTime && validPointers) {\r\n            if (input.eventType != INPUT_END) {\r\n                return this.failTimeout();\r\n            }\r\n\r\n            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;\r\n            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\r\n\r\n            this.pTime = input.timeStamp;\r\n            this.pCenter = input.center;\r\n\r\n            if (!validMultiTap || !validInterval) {\r\n                this.count = 1;\r\n            } else {\r\n                this.count += 1;\r\n            }\r\n\r\n            this._input = input;\r\n\r\n            // if tap count matches we have recognized it,\r\n            // else it has began recognizing...\r\n            var tapCount = this.count % options.taps;\r\n            if (tapCount === 0) {\r\n                // no failing requirements, immediately trigger the tap event\r\n                // or wait as long as the multitap interval to trigger\r\n                if (!this.hasRequireFailures()) {\r\n                    return STATE_RECOGNIZED;\r\n                } else {\r\n                    this._timer = setTimeoutContext(function() {\r\n                        this.state = STATE_RECOGNIZED;\r\n                        this.tryEmit();\r\n                    }, options.interval, this);\r\n                    return STATE_BEGAN;\r\n                }\r\n            }\r\n        }\r\n        return STATE_FAILED;\r\n    },\r\n\r\n    failTimeout: function() {\r\n        this._timer = setTimeoutContext(function() {\r\n            this.state = STATE_FAILED;\r\n        }, this.options.interval, this);\r\n        return STATE_FAILED;\r\n    },\r\n\r\n    reset: function() {\r\n        clearTimeout(this._timer);\r\n    },\r\n\r\n    emit: function() {\r\n        if (this.state == STATE_RECOGNIZED) {\r\n            this._input.tapCount = this.count;\r\n            this.manager.emit(this.options.event, this._input);\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * Simple way to create a manager with a default set of recognizers.\r\n * @param {HTMLElement} element\r\n * @param {Object} [options]\r\n * @constructor\r\n */\r\nfunction NGHammer(element, options) {\r\n    options = options || {};\r\n    options.recognizers = ifUndefined(options.recognizers, NGHammer.defaults.preset);\r\n    return new Manager(element, options);\r\n}\r\n\r\n/**\r\n * @const {string}\r\n */\r\nNGHammer.VERSION = '2.0.7';\r\n\r\n/**\r\n * default settings\r\n * @namespace\r\n */\r\nNGHammer.defaults = {\r\n    /**\r\n     * set if DOM events are being triggered.\r\n     * But this is slower and unused by simple implementations, so disabled by default.\r\n     * @type {Boolean}\r\n     * @default false\r\n     */\r\n    domEvents: false,\r\n\r\n    /**\r\n     * The value for the touchAction property/fallback.\r\n     * When set to `compute` it will magically set the correct value based on the added recognizers.\r\n     * @type {String}\r\n     * @default compute\r\n     */\r\n    touchAction: TOUCH_ACTION_COMPUTE,\r\n\r\n    /**\r\n     * @type {Boolean}\r\n     * @default true\r\n     */\r\n    enable: true,\r\n\r\n    /**\r\n     * EXPERIMENTAL FEATURE -- can be removed/changed\r\n     * Change the parent input target element.\r\n     * If Null, then it is being set the to main element.\r\n     * @type {Null|EventTarget}\r\n     * @default null\r\n     */\r\n    inputTarget: null,\r\n\r\n    /**\r\n     * force an input class\r\n     * @type {Null|Function}\r\n     * @default null\r\n     */\r\n    inputClass: null,\r\n\r\n    /**\r\n     * Default recognizer setup when calling `NGHammer()`\r\n     * When creating a new Manager these will be skipped.\r\n     * @type {Array}\r\n     */\r\n    preset: [\r\n        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\r\n        [RotateRecognizer, {enable: false}],\r\n        [PinchRecognizer, {enable: false}, ['rotate']],\r\n        [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],\r\n        [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],\r\n        [TapRecognizer],\r\n        [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],\r\n        [PressRecognizer]\r\n    ],\r\n\r\n    /**\r\n     * Some CSS properties can be used to improve the working of NGHammer.\r\n     * Add them to this method and they will be set when creating a new Manager.\r\n     * @namespace\r\n     */\r\n    cssProps: {\r\n        /**\r\n         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        userSelect: 'none',\r\n\r\n        /**\r\n         * Disable the Windows Phone grippers when pressing an element.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        touchSelect: 'none',\r\n\r\n        /**\r\n         * Disables the default callout shown when you touch and hold a touch target.\r\n         * On iOS, when you touch and hold a touch target such as a link, Safari displays\r\n         * a callout containing information about the link. This property allows you to disable that callout.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        touchCallout: 'none',\r\n\r\n        /**\r\n         * Specifies whether zooming is enabled. Used by IE10>\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        contentZooming: 'none',\r\n\r\n        /**\r\n         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        userDrag: 'none',\r\n\r\n        /**\r\n         * Overrides the highlight color shown when the user taps a link or a JavaScript\r\n         * clickable element in iOS. This property obeys the alpha value, if specified.\r\n         * @type {String}\r\n         * @default 'rgba(0,0,0,0)'\r\n         */\r\n        tapHighlightColor: 'rgba(0,0,0,0)'\r\n    }\r\n};\r\n\r\nvar STOP = 1;\r\nvar FORCED_STOP = 2;\r\n\r\n/**\r\n * Manager\r\n * @param {HTMLElement} element\r\n * @param {Object} [options]\r\n * @constructor\r\n */\r\nfunction Manager(element, options) {\r\n    this.options = assign({}, NGHammer.defaults, options || {});\r\n\r\n    this.options.inputTarget = this.options.inputTarget || element;\r\n\r\n    this.handlers = {};\r\n    this.session = {};\r\n    this.recognizers = [];\r\n    this.oldCssProps = {};\r\n\r\n    this.element = element;\r\n    this.input = createInputInstance(this);\r\n    this.touchAction = new TouchAction(this, this.options.touchAction);\r\n\r\n    toggleCssProps(this, true);\r\n\r\n    each(this.options.recognizers, function(item) {\r\n        var recognizer = this.add(new (item[0])(item[1]));\r\n        item[2] && recognizer.recognizeWith(item[2]);\r\n        item[3] && recognizer.requireFailure(item[3]);\r\n    }, this);\r\n}\r\n\r\nManager.prototype = {\r\n    /**\r\n     * set options\r\n     * @param {Object} options\r\n     * @returns {Manager}\r\n     */\r\n    set: function(options) {\r\n        assign(this.options, options);\r\n\r\n        // Options that need a little more setup\r\n        if (options.touchAction) {\r\n            this.touchAction.update();\r\n        }\r\n        if (options.inputTarget) {\r\n            // Clean up existing event listeners and reinitialize\r\n            this.input.destroy();\r\n            this.input.target = options.inputTarget;\r\n            this.input.init();\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * stop recognizing for this session.\r\n     * This session will be discarded, when a new [input]start event is fired.\r\n     * When forced, the recognizer cycle is stopped immediately.\r\n     * @param {Boolean} [force]\r\n     */\r\n    stop: function(force) {\r\n        this.session.stopped = force ? FORCED_STOP : STOP;\r\n    },\r\n\r\n    /**\r\n     * run the recognizers!\r\n     * called by the inputHandler function on every movement of the pointers (touches)\r\n     * it walks through all the recognizers and tries to detect the gesture that is being made\r\n     * @param {Object} inputData\r\n     */\r\n    recognize: function(inputData) {\r\n        var session = this.session;\r\n        if (session.stopped) {\r\n            return;\r\n        }\r\n\r\n        // run the touch-action polyfill\r\n        this.touchAction.preventDefaults(inputData);\r\n\r\n        var recognizer;\r\n        var recognizers = this.recognizers;\r\n\r\n        // this holds the recognizer that is being recognized.\r\n        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\r\n        // if no recognizer is detecting a thing, it is set to `null`\r\n        var curRecognizer = session.curRecognizer;\r\n\r\n        // reset when the last recognizer is recognized\r\n        // or when we're in a new session\r\n        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {\r\n            curRecognizer = session.curRecognizer = null;\r\n        }\r\n\r\n        var i = 0;\r\n        while (i < recognizers.length) {\r\n            recognizer = recognizers[i];\r\n\r\n            // find out if we are allowed try to recognize the input for this one.\r\n            // 1.   allow if the session is NOT forced stopped (see the .stop() method)\r\n            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\r\n            //      that is being recognized.\r\n            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\r\n            //      this can be setup with the `recognizeWith()` method on the recognizer.\r\n            if (session.stopped !== FORCED_STOP && ( // 1\r\n                    !curRecognizer || recognizer == curRecognizer || // 2\r\n                    recognizer.canRecognizeWith(curRecognizer))) { // 3\r\n                recognizer.recognize(inputData);\r\n            } else {\r\n                recognizer.reset();\r\n            }\r\n\r\n            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\r\n            // current active recognizer. but only if we don't already have an active recognizer\r\n            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\r\n                curRecognizer = session.curRecognizer = recognizer;\r\n            }\r\n            i++;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * get a recognizer by its event name.\r\n     * @param {Recognizer|String} recognizer\r\n     * @returns {Recognizer|Null}\r\n     */\r\n    get: function(recognizer) {\r\n        if (recognizer instanceof Recognizer) {\r\n            return recognizer;\r\n        }\r\n\r\n        var recognizers = this.recognizers;\r\n        for (var i = 0; i < recognizers.length; i++) {\r\n            if (recognizers[i].options.event == recognizer) {\r\n                return recognizers[i];\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * add a recognizer to the manager\r\n     * existing recognizers with the same event name will be removed\r\n     * @param {Recognizer} recognizer\r\n     * @returns {Recognizer|Manager}\r\n     */\r\n    add: function(recognizer) {\r\n        if (invokeArrayArg(recognizer, 'add', this)) {\r\n            return this;\r\n        }\r\n\r\n        // remove existing\r\n        var existing = this.get(recognizer.options.event);\r\n        if (existing) {\r\n            this.remove(existing);\r\n        }\r\n\r\n        this.recognizers.push(recognizer);\r\n        recognizer.manager = this;\r\n\r\n        this.touchAction.update();\r\n        return recognizer;\r\n    },\r\n\r\n    /**\r\n     * remove a recognizer by name or instance\r\n     * @param {Recognizer|String} recognizer\r\n     * @returns {Manager}\r\n     */\r\n    remove: function(recognizer) {\r\n        if (invokeArrayArg(recognizer, 'remove', this)) {\r\n            return this;\r\n        }\r\n\r\n        recognizer = this.get(recognizer);\r\n\r\n        // let's make sure this recognizer exists\r\n        if (recognizer) {\r\n            var recognizers = this.recognizers;\r\n            var index = inArray(recognizers, recognizer);\r\n\r\n            if (index !== -1) {\r\n                recognizers.splice(index, 1);\r\n                this.touchAction.update();\r\n            }\r\n        }\r\n\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * bind event\r\n     * @param {String} events\r\n     * @param {Function} handler\r\n     * @returns {EventEmitter} this\r\n     */\r\n    on: function(events, handler) {\r\n        if (events === undefined) {\r\n            return;\r\n        }\r\n        if (handler === undefined) {\r\n            return;\r\n        }\r\n\r\n        var handlers = this.handlers;\r\n        each(splitStr(events), function(event) {\r\n            handlers[event] = handlers[event] || [];\r\n            handlers[event].push(handler);\r\n        });\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * unbind event, leave emit blank to remove all handlers\r\n     * @param {String} events\r\n     * @param {Function} [handler]\r\n     * @returns {EventEmitter} this\r\n     */\r\n    off: function(events, handler) {\r\n        if (events === undefined) {\r\n            return;\r\n        }\r\n\r\n        var handlers = this.handlers;\r\n        each(splitStr(events), function(event) {\r\n            if (!handler) {\r\n                delete handlers[event];\r\n            } else {\r\n                handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\r\n            }\r\n        });\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * emit event to the listeners\r\n     * @param {String} event\r\n     * @param {Object} data\r\n     */\r\n    emit: function(event, data) {\r\n        // we also want to trigger dom events\r\n        if (this.options.domEvents) {\r\n            triggerDomEvent(event, data);\r\n        }\r\n\r\n        // no handlers, so skip it all\r\n        var handlers = this.handlers[event] && this.handlers[event].slice();\r\n        if (!handlers || !handlers.length) {\r\n            return;\r\n        }\r\n\r\n        data.type = event;\r\n        data.preventDefault = function() {\r\n            data.srcEvent.preventDefault();\r\n        };\r\n\r\n        var i = 0;\r\n        while (i < handlers.length) {\r\n            handlers[i](data);\r\n            i++;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * destroy the manager and unbinds all events\r\n     * it doesn't unbind dom events, that is the user own responsibility\r\n     */\r\n    destroy: function() {\r\n        this.element && toggleCssProps(this, false);\r\n\r\n        this.handlers = {};\r\n        this.session = {};\r\n        this.input.destroy();\r\n        this.element = null;\r\n    }\r\n};\r\n\r\n/**\r\n * add/remove the css properties as defined in manager.options.cssProps\r\n * @param {Manager} manager\r\n * @param {Boolean} add\r\n */\r\nfunction toggleCssProps(manager, add) {\r\n    var element = manager.element;\r\n    if (!element.style) {\r\n        return;\r\n    }\r\n    var prop;\r\n    each(manager.options.cssProps, function(value, name) {\r\n        prop = prefixed(element.style, name);\r\n        if (add) {\r\n            manager.oldCssProps[prop] = element.style[prop];\r\n            element.style[prop] = value;\r\n        } else {\r\n            element.style[prop] = manager.oldCssProps[prop] || '';\r\n        }\r\n    });\r\n    if (!add) {\r\n        manager.oldCssProps = {};\r\n    }\r\n}\r\n\r\n/**\r\n * trigger dom event\r\n * @param {String} event\r\n * @param {Object} data\r\n */\r\nfunction triggerDomEvent(event, data) {\r\n    var gestureEvent = document.createEvent('Event');\r\n    gestureEvent.initEvent(event, true, true);\r\n    gestureEvent.gesture = data;\r\n    data.target.dispatchEvent(gestureEvent);\r\n}\r\n\r\nassign(NGHammer, {\r\n    INPUT_START: INPUT_START,\r\n    INPUT_MOVE: INPUT_MOVE,\r\n    INPUT_END: INPUT_END,\r\n    INPUT_CANCEL: INPUT_CANCEL,\r\n\r\n    STATE_POSSIBLE: STATE_POSSIBLE,\r\n    STATE_BEGAN: STATE_BEGAN,\r\n    STATE_CHANGED: STATE_CHANGED,\r\n    STATE_ENDED: STATE_ENDED,\r\n    STATE_RECOGNIZED: STATE_RECOGNIZED,\r\n    STATE_CANCELLED: STATE_CANCELLED,\r\n    STATE_FAILED: STATE_FAILED,\r\n\r\n    DIRECTION_NONE: DIRECTION_NONE,\r\n    DIRECTION_LEFT: DIRECTION_LEFT,\r\n    DIRECTION_RIGHT: DIRECTION_RIGHT,\r\n    DIRECTION_UP: DIRECTION_UP,\r\n    DIRECTION_DOWN: DIRECTION_DOWN,\r\n    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\r\n    DIRECTION_VERTICAL: DIRECTION_VERTICAL,\r\n    DIRECTION_ALL: DIRECTION_ALL,\r\n\r\n    Manager: Manager,\r\n    Input: Input,\r\n    TouchAction: TouchAction,\r\n\r\n    TouchInput: TouchInput,\r\n    MouseInput: MouseInput,\r\n    PointerEventInput: PointerEventInput,\r\n    TouchMouseInput: TouchMouseInput,\r\n    SingleTouchInput: SingleTouchInput,\r\n\r\n    Recognizer: Recognizer,\r\n    AttrRecognizer: AttrRecognizer,\r\n    Tap: TapRecognizer,\r\n    Pan: PanRecognizer,\r\n    Swipe: SwipeRecognizer,\r\n    Pinch: PinchRecognizer,\r\n    Rotate: RotateRecognizer,\r\n    Press: PressRecognizer,\r\n\r\n    on: addEventListeners,\r\n    off: removeEventListeners,\r\n    each: each,\r\n    merge: merge,\r\n    extend: extend,\r\n    assign: assign,\r\n    inherit: inherit,\r\n    bindFn: bindFn,\r\n    prefixed: prefixed\r\n});\r\n\r\n// this prevents errors when NGHammer is loaded in the presence of an AMD\r\n//  style loader but by script tag, not by the loader.\r\nvar freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line\r\nfreeGlobal.NGHammer = NGHammer;\r\n\r\nif (typeof define === 'function' && define.amdDISABLED) {\r\n    define(function() {\r\n        return NGHammer;\r\n    });\r\n} else if (typeof module != 'undefined' && module.exports) {\r\n    module.exports = NGHammer;\r\n} else {\r\n    window[exportName] = NGHammer;\r\n}\r\n\r\n})(window, document, 'NGHammer');\r\n\r\n\r\n\r\n\r\n\r\n\r\n// END NANOGALLERY2\r\n// }( jQuery )));\r\n}));\r\n\r\n\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n\r\n// nanogallery2 auto start whithout javascript call\r\n(function(){\r\n  'use strict';\r\n  jQuery(document).ready(function () {\r\n  \r\n    // var t=document.querySelectorAll('[data-nanogallery2-portable]');\r\n    // if( t.length > 0 ) {\r\n      // portable mode\r\n      // var link = document.createElement('link');\r\n      // link.setAttribute(\"rel\", \"stylesheet\");\r\n      // link.setAttribute(\"type\", \"text/css\");\r\n      // link.onload = function(){\r\n        // for( var i=0; i < t.length; i++ ) {\r\n          // jQuery(t[i]).nanogallery2(jQuery(t[i]).data('nanogallery2-portable'));\r\n        // }\r\n      // }\r\n      // link.setAttribute(\"href\", '//nano.gallery/css/nanogallery2.css');\r\n      // document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n    // }\r\n    // else {\r\n      // standard mode\r\n      var t=document.querySelectorAll('[data-nanogallery2]');\r\n      for( var i=0; i < t.length; i++ ) {\r\n        jQuery( t[i] ).nanogallery2( jQuery(t[i]).data('nanogallery2') );\r\n      }\r\n    // }\r\n    \r\n  });\r\n}).call(null);\r\n\r\n\n","/*** IMPORTS FROM imports-loader ***/\nvar module = (module || {});\nmodule.exports = undefined;\nvar exports = undefined;\n\n// extracted by mini-css-extract-plugin\nexport {};\n"],"names":["module","exports","undefined","factory","$","ColorHelperToRGB","color","obj","document","getElementById","createElement","id","style","cssText","body","appendChild","getComputedStyle","ShadeBlendConvert","p","from","to","rgba","toUpperCase","substring","sbcRip","d","l","length","RGB","Object","split","i","slice","parseFloat","r","parseInt","Math","round","h","b","f","t","toString","cloneJSObject","temp","constructor","key","getViewport","$win","jQuery","window","scrollLeft","scrollTop","w","width","height","inViewportVert","$elt","threshold","wp","eltOS","offset","th","outerHeight","top","setElementOnTop","start","elt","highest_index","each","cur","this","css","toType","call","match","toLowerCase","nanoGALLERY2","ReloadAlbum","G","O","kind","albumIdx","GOM","albumID","I","GetID","item","selected","contentIsLoaded","DisplayAlbum","ItemsSetSelectedValue","items","value","j","ThumbnailSelectionSet","ItemsSelectedGet","selectedItems","push","Get","option","Set","ThumbnailSelectionClear","GalleryRender","Refresh","Resize","GalleryResize","DisplayItem","itemID","IDs","parseIDs","imageID","DisplayPhoto","CountItemsToDisplay","gIdx","cnt","idx","isToDisplay","Search","search","albumSearch","Search2","searchTitle","searchTags","albumSearchTags","Search2Execute","Destroy","hammertime","destroy","VOM","baseEltID","remove","NGY2Item","New","i18nTranslations","breadcrumbHome","navigationBar","$newContent","$E","base","empty","removeData","locationHash","off","firstDisplay","CloseViewer","CloseInternalViewer","MinimizeToolbar","ViewerToolbarForVisibilityMin","MaximizeToolbar","ViewerToolbarForVisibilityStd","PaginationPreviousPage","paginationPreviousPage","PaginationNextPage","paginationNextPage","PaginationGotoPage","page","conPagin","data","pagination","currentPage","animate","GalleryDisplayPart1","GalleryDisplayPart2","PaginationCountPages","ceil","row","galleryMaxRows","throttle","func","wait","options","context","args","result","timeout","previous","later","leading","Date","getTime","apply","now","remaining","arguments","clearTimeout","trailing","setTimeout","debounce","execAsap","delayed","ng_draf","cb","requestAnimationFrame","requestTimeout","fn","delay","requestAnimFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","clearRequestTimeout","handle","cancelAnimationFrame","webkitCancelAnimationFrame","webkitCancelRequestAnimationFrame","mozCancelRequestAnimationFrame","oCancelRequestAnimationFrame","msCancelRequestAnimationFrame","VImg","index","$e","ngy2ItemIdx","mediaNumber","posX","posY","Id","conTnParent","conLoadingB","conConsole","conNavigationBar","conTnBottom","shoppingCart","layout","internal","engine","support","rows","prerequisite","imageSize","SetEngine","tn","settings","curNavLevel","curWidth","getMosaic","galleryResizeEventEnabled","l1","lN","galleryMaxItems","galleryFilterTags","galleryDisplayMode","galleryLastRowFull","gallerySorting","galleryDisplayTransition","galleryDisplayTransitionDuration","$currentTouchedThumbnail","opt","crop","stacks","stacksTranslateX","stacksTranslateY","stacksTranslateZ","stacksRotateX","stacksRotateY","stacksRotateZ","stacksScale","gutterHeight","gutterWidth","baseGridHeight","displayTransition","displayTransitionStartVal","displayTransitionEasing","displayTransitionDuration","displayInterval","scale","borderWidth","borderHeight","labelHeight","get","defaultSize","xs","sm","me","la","xl","getWidth","getOuterWidth","getHeight","getOuterHeight","xsc","smc","mec","lac","xlc","getH","cl","cw","mosaic","getW","l1Factor","lNFactor","mosaicCalcFactor","maxW","maxH","n","max","hoverEffects","std","level1","buildInit","toolbar","album","topLeft","topRight","bottomLeft","bottomRight","image","albumUp","label","title","desc","getTitle","getDesc","getLabel","s","RTL","scrollTimeOut","emptyGif","CSStransformName","FirstSupportedPropertyName","CSStransformStyle","CSSperspective","CSSbackfaceVisibilityName","CSStransitionName","CSSanimationName","GalleryResizeThrottled","blackList","whiteList","albumList","locationHashLastUsed","custGlobals","touchAutoOpenDelayTimerID","i18nLang","timeLastTouchStart","markupOrApiProcessed","clipArea","displayArea","displayAreaLast","displayedMoreSteps","$imgPreloader","thumbnails2Display","itemsDisplayed","firstDisplayTime","displayed","cache","viewport","containerOffset","areaWidth","nbSelected","panThreshold","panYOnly","lastFullRow","lastDisplayedIdx","len","userEvents","lastZIndex","lastRandomValue","slider","hostIdx","hostItem","currentIdx","nextIdx","timerID","tween","thumbnailIdx","GTn","left","imageWidth","imageHeight","resizedContentWidth","resizedContentHeight","neverDisplayed","inDisplayArea","viewerDisplayed","viewerIsFullscreen","infoDisplayed","toolbarsDisplayed","toolsHide","saveOverflowX","saveOverflowY","zoom","userFactor","isZooming","padding","H","V","lastWidth","lastHeight","$cont","$viewer","$toolbar","$toolbarTL","$toolbarTR","$content","$mediaPrevious","$mediaCurrent","$mediaNext","toolbarMode","playSlideshow","playSlideshowTimerID","slideshowDelay","currItemIdx","viewerMediaIsChanged","IdxPrevious","IdxNext","swipePosX","panPosX","panPosY","panXOnly","viewerTheme","timeImgChanged","ImageLoader","maxChecks","list","intervalHandle","loadImage","ngitem","mediaKind","img","Image","src","responsiveURL","url","checks","setInterval","interval","count","clearInterval","popup","isDisplayed","close","NGTweenable","opacity","attachment","easing","duration","step","state","att","finish","galleryTheme_dark","background","borderTop","borderBottom","borderRight","borderLeft","navigationBreadcrumb","colorHover","borderRadius","navigationFilter","colorSelected","backgroundSelected","thumbnail","backgroundImage","borderColor","labelOpacity","labelBackground","titleColor","titleBgColor","titleShadow","descriptionColor","descriptionBgColor","descriptionShadow","stackBackground","thumbnailIcon","shapeBorder","shapeColor","shapeSelectedColor","galleryTheme_light","viewerTheme_dark","imageBorder","imageBoxShadow","barBackground","barBorder","barColor","barDescriptionColor","viewerTheme_border","viewerTheme_light","NanoAlert","NGY2Tools","NanoConsoleLog","processStartOptions","ProcessLocationHash","processStartOptionsPart2","openOnStart","GetIdx","SetLocationHash","AlbumGetContent","GalleryBottomManage","ManagePagination","nb","html","icons","galleryMoreButton","on","e","breadcrumbAdd","ic","breadcrumbHideIcons","breadcrumbAlbum","$newDiv","appendTo","find","breadcrumbOnlyCurrentLevel","click","breadcrumbAddSeparator","lastAlbumID","$newSep","breadcrumbSeparatorRtl","breadcrumbSeparator","sepAlbumIdx","GalleryNavigationBar","displayBreadcrumb","thumbnailAlbumDisplayImage","newLevel","lstItems","curIdx","breadcrumbAutoHideTopLevel","BreadcrumbBuild","nTags","albumTagList","navigationFilterUnselected","tagClass","inArray","albumTagListSel","navigationFilterSelected","$this","tag","text","replace","hasClass","tidx","splice","toggleClass","navigationFilterSelectedAll","children","nbPages","GalleryRenderGetInterval","galleryPaginationMode","paginationPrevious","firstPage","lastPage","paginationVisiblePages","numberOfPagesToDisplay","nbBeforeAfter","isOdd","c","elt$","TriggerCustomEvent","paginationNext","num","n1","ThumbnailHoverOutAll","n2","pn","nbTn","firstRow","lastRow","firstTn","curTn","galleryDisplayMoreStep","fu","fnGalleryRenderStart","galleryRenderDelay","GalleryRenderPart1","hideNavigationBar","galleryOTop","oldN","clone","GalleryRenderPart2","isNaN","conTn","hovered","$Elts","eltTransform","eltFilter","thumbnailImgRevealed","GalleryRenderPart3","thumbnailLabel","ThumbnailGetLabelHeight","fnGalleryRenderEnd","GalleryPopulateGOM","GallerySetLayout","GalleryAppear","debugMode","console","log","preloadImages","imageSizeRequested","thumbImg","fnGalleryObjectModelBuilt","$newImg","gi_imgLoad","ngimagesLoaded","instance","isLoaded","getAttribute","naturalWidth","naturalHeight","thumbs","object","property","hasOwnProperty","GallerySetLayoutWidthtAuto","GallerySetLayoutHeightAuto","GallerySetLayoutMosaic","GallerySetLayoutGrid","fnGalleryLayoutApplied","curCol","curRow","colHeight","maxCol","NbThumbnailsPerRow","scaleFactor","tnWidth","curPosY","thumbnailAlignment","min","totalGutterWidth","contentWidth","baseHeight","deleted","curPosX","imageRatio","trunc","minColHeight","x","lastPosX","rowLastItem","rowNum","rowHeight","bNewRow","maxRowHeightVertical","maxRowHeightHorizontal","rowHasVertical","rowHasHorizontal","tnHeight","nbTnInCurrRow","floor","rowHeightLimit","ratio","rH","rh","nbCols","mosaicPattern","cLeft","curPatternElt","cWidth","cols","newAreaWidth","contentHeight","forceTransition","CacheViewport","tnToDisplay","tnToReDisplay","lastTnIdx","ThumbnailBuild","display","lastDisplayedIdxNew","$getElt","nbBuild","ThumbnailSetPosition","ThumbnailDisplayAnimBatch","GOMidx","newTop","last","thumbnailWaitImageLoaded","ThumbnailImageReveal","ThumbnailAppear","topOld","vp","thumbnailDisplayOutsideScreen","galleryResizeAnimation","dispose","ThumbnailAppearFinish","thumbnailLevelUp","thumbnailOpenImage","thumbnailSliderDelay","GalleryThumbnailSliderSetContent","GalleryThumbnailSliderBuildAndStart","removeClass","addClass","insertAfter","CSSTransformSet","CSSTransformApply","GalleryThumbnailSliderSetNextContent","GalleryThumbnailSliderStartTransition","newItem","bgImg","imageDominantColors","attr","tweenable","stop","ngy2itemContent","_isTweening","thumbnailAlbum","thumbnailImage","getThumbnailTitle","getTumbnailDescription","newElt","newEltIdx","theme","join","ThumbnailBuildStacks","bgColor","ns","ThumbnailBuildAlbumpUp","mp","thumbnailAlbumUp","lastOne","hoverInitDone","sTitle","bg","imageDominantColor","op","thumbnailSelectable","bgSize","s1","s2","ThumbnailBuildTools","fnThumbnailInit","ThumbnailOverInit","lastThumbnail","tb","ThumbnailBuildToolbarOne","position","pos","icon","minWidth","tIcon","test","sp","thumbnailCounter","getContentLength","numberItems","thumbnailShare","thumbnailDownload","thumbnailInfo","thumbnailCart","thumbnailDisplay","cust","featured","thumbnailFeatured","thumbnailSelected","thumbnailUnselected","thumbnailImageTitle","ml","sDesc","thumbnailImageDescription","thumbnailAlbumDescription","description","tnW","nbMaxTn","maxItemsPerLine","fnThumbnailDisplayEffect","fnThumbnailL1DisplayEffect","itm","o","eq","ThumbnailDisplayAnim2","randomIntFromInterval","random","oFrom","oTo","scales","zi","translateY","rotateX","rotateY","translateX","tw","forEach","one","perspective","orgIdx","y","fnThumbnailHoverInit","inits","CSSFilterSet","CSSFilterApply","effects","firstKeyframe","type","ThumbnailHoverReInitAll","ThumbnailHover","fnThumbnailHover","hoverin","message","ThumbnailHoverOut","fnThumbnailHoverOut","hoverout","DisplayPhotoIdx","fnToCall","fnParam1","fnParam2","AlbumGetMarkupOrApi","nanogallery2","initiateGallery2","params","$markup","DefineVariables","SetPolyFills","BuildSkeleton","SetGlobalEvents","albumToDisplay","photoset","indexOf","authkey","decodeURIComponent","encodeURIComponent","mediaList","youtube","getID","thumbUrl","markup","vimeo","dailymotion","m","selfhosted","extension","pop","GetContentApiObject","GetContentMarkup","StartsWithProtocol","path","nbTitles","AlbumPostProcess","bind","GetI18nItem","RetrieveCurWidth","itemsBaseURL","thumbsrc","srct","thumbsrcX2","srct2x","GetImageTitle","tags","ID","setMediaURL","media","mediaMarkup","imgtWidth","imgtHeight","lst","turl","destURL","destinationURL","downloadURL","exifModel","exif","model","exifFlash","flash","exifFocalLength","focallength","exifFStop","fstop","exifExposure","exposure","exifIso","iso","exifTime","time","exifLocation","location","customData","fnProcessData","$elements","attributes","name","st","extend","thumbnailToolbarImage","thumbnailToolbarAlbum","thumbnailL1Label","set","albumList2","Array","ThumbnailOpt","thumbnailDisplayTransitionParse","cfg","level","Number","thumbnailCrop","thumbnailL1Crop","galleryL1DisplayMode","galleryL1MaxRows","galleryL1LastRowFull","galleryL1Sorting","galleryL1DisplayTransition","galleryL1DisplayTransitionDuration","galleryL1MaxItems","galleryL1FilterTags","thumbnailDisplayTransition","thumbnailL1DisplayTransition","thumbnailSizeSM","breakpointSizeSM","thumbnailSizeME","breakpointSizeME","thumbnailSizeLA","breakpointSizeLA","thumbnailSizeXL","breakpointSizeXL","thumbnailL1BuildInit2","t1","o1","trim","i1","NewTBuildInit","ThumbnailOverEffectsGetCSSElement","thumbnailBuildInit2","tL1HE","thumbnailL1HoverEffect2","tmp","oDef","NewTHoverEffect","ThumbnailHoverEffectExtract","ThumbnailOverEffectsPreset","tHE","thumbnailHoverEffect2","ThumbnailSizes","srcOpt","onlyl1","ThumbnailsSetSize","ws","v","charAt","touchAnimationL1","touchAnimation","thumbnailHeight","thumbnailWidth","thumbnailL1Height","thumbnailL1Width","thumbnailBorderHorizontal","thumbnailBorderVertical","thumbnailLabelHeight","galleryMosaic","JSON","parse","stringify","galleryL1Mosaic","imageTransition","effect","easings","foundEasing","durationBack","delayBack","newEffects","rgb","GalleryThemeGetCurrent","easingBack","animParam","ThumbnailStyle","titleMultiLine","descriptionMultiLine","align","titleFontSize","descriptionFontSize","displayDescription","ThumbnailDefCaches","dir","cs","galleryTheme","SetGalleryTheme","colorScheme","border","append","SetViewerTheme","colorSchemeViewer","Function","prototype","oThis","TypeError","aArgs","fToBind","fNOP","fBound","concat","lastTime","vendors","currTime","timeToCall","removeIf","String","startsWith","searchString","GalleryClicked","GalleryEventRetrieveElementl","action","ThumbnailOpen","ThumbnailSelectionToggle","PopupShare","DownloadImage","ItemDisplayInfo","AddToCart","fnThumbnailToolCustAction","a","href","download","target","removeChild","found","fnShoppingCartUpdated","fnThumbnailSelection","ThumbnailSelectionSetIcon","$sub","$icon","currentURL","protocol","hostname","pathname","newLocationHash","content","shareFacebook","sharePinterest","shareTumblr","shareTwitter","shareVK","shareMail","currentTitle","currentTn","Popup","stopPropagation","shareURL","open","pp","buttonClose","GalleryMouseEnter","srcElement","GalleryMouseLeave","ignoreSubItems","parentNode","ignoreSelected","fnThumbnailClicked","DisplayFirstMediaInAlbum","OpenOriginal","sU","userID","thumbnailOpenOriginal","vimg","fnThumbnailOpen","spreloader","ViewerSetMediaVisibility","VieweImgSizeRetrieved","DisplayInternalViewer","OpenInternalViewer","ViewerZoomStart","viewerZoom","ViewerZoomIn","zoomIn","ViewerZoomMax","ViewerZoomMin","ViewerMediaSetPosAndZoom","ViewerMediaSetPosAndZoomOne","ViewerMediaCenterNotImg","$mediaContainer","$media","$img","isCurrent","zoomUserFactor","dpr","viewerImageDisplay","devicePixelRatio","zoomBaseFactorW","zoomBaseFactorH","zoomBaseFactor","imageCurrentHeight","imageCurrentWidth","ViewerImagePanSetPosition","ViewerMediaPanX","rotationAngle","imageContainer","savePosition","overflow","msTouchAction","touchAction","sMedia","sNav","iconP","viewerImgPrevious","iconN","viewerImgNext","$mediaPan","vtbBg1","vtbBg2","viewerToolbar","fullWidth","vtbAlign","sTB","autoMinimize","viewerTools","sTopLeft","sTL","sTLL","ToolbarAddElt","sTopRight","sTR","sTRL","ViewerToolsOn","viewerDisplayLogo","vwLogo","ngscreenfull","enabled","viewerFullscreen","request","ResizeInternalViewer","ViewerSetEvents","slideshowAutoStart","SlideshowToggle","ViewerEvents","NGHammer","Manager","recognizers","Pinch","enable","Pan","direction","DIRECTION_ALL","ev","deltaX","deltaY","abs","dist","panY","DisplayPreviousMedia","DisplayNextMedia","add","Tap","event","taps","recognizeWith","requireFailure","StopPropagationPreventDefault","srcEvent","ViewerToolsUnHide","className","pageX","preventDefault","ViewerToolsHide","ViewerToolsOpacity","ViewerToolsAction","ngy2action","toggle","ViewerImageRotate","fnImgToolbarCustClick","angle","author","user","config","sexif","viewerInfo","viewerToolbarMin","viewerToolbarStd","viewerPrevious","viewerNext","viewerPlay","viewerRotateLeft","viewerRotateRight","viewerDownload","viewerZoomIn","viewerZoomOut","viewerFullscreenOn","viewerFullscreenOff","viewerLinkOriginal","viewerShare","fnImgToolbarCustInit","viewerPause","standard","lt","ViewerToolbarElementContent","minimized","vomIdx","setTxt","show","hide","viewerMaxImages","$cu","fnImgToolbarCustDisplay","itemPrevious","itemNext","mediaTransition","sc","newVomIdx","displayType","itemOld","itemNew","$new","timeline","vP","dur","DisplayInternalViewerComplete","dT","ngy2item","timelineEnd","fnImgDisplayed","$tmp","$pans","nextItem","previousItem","always","visibility","overflowX","overflowY","exit","parent","forceUpdate","windowsW","windowsH","tb_OHt","bottom","zoomPosX","zoomPosY","styleNavigation","navigationFontSize","galleryBuildInit2","portable","logo","ngy2i","mouseenter","mouseleave","i18n","eventName","eN","Event","createEvent","initEvent","trigger","paginationSwipe","pointerType","touchAutoOpenDelay","ResizeWindowEvent","eventsDebounceDelay","OnScrollEvent","viewerHideToolsDelay","keyup","keyCode","originalEvent","wheelDelta","onchange","isFullscreen","curGal","hash","history","pushState","lH","nw","GalleryResizeOnScrollEvent","navigator","language","userLanguage","llang","substr","vpW","prefixedPropertyNames","tempDiv","_this","init","FilterAlbumName","msg","verbose","minHeight","PreloaderDisplay","AreaShuffle","GetImageTitleFromURL","imageURL","shift","sortOrder","maxItems","currentAlbum","filter","reverse","sort","nextId","flickrThumbSizes","picasaThumbs","contentLength","imageCounter","eltEffect","paginationLastPage","paginationLastWidth","kw","thumbnailFeaturedKeyword","re","matches","exec","setTags","escapeHtml","delete","foundIdx","foundGOMidx","addToGOM","entityMap","string","allowHTMLinData","ValueApplyPercent","str","percent","ar","get_nextId","forceRefresh","removeElt","viewerTransitionMediaKind","imageSet","thumbSet","screenSize","thumbSetImgHeight","thumbSetImgWidth","tnImg","lstTags","tfound","checkTagFilter","isSearchTagFound","isSearchFound","filterTags","eltClass","nbStacks","pTranslateX","pTranslateY","pTranslateZ","pTranslate","pRotateX","pRotateY","pRotateZ","pRotate","pScale","translateZ","translate","IE","isGingerbread","rotateZ","rotate","transform","blur","brightness","grayscale","sepia","contrast","saturate","WebkitFilter","hoverIn","cssKind","initialValue","lastValue","animeFrom","animeTo","animeDuration","animeDelay","animeEasing","defaultOptions","nG2","poogleplusUseUrlCrossDomain","flickrSkipOriginal","dataProvider","dataCharset","galleryLayoutEngine","thumbnailCropScaleFactor","thumbnailBaseGridHeight","thumbnailL1BaseGridHeight","thumbnailGutterWidth","thumbnailL1GutterWidth","thumbnailGutterHeight","thumbnailL1GutterHeight","thumbnailStacks","thumbnailL1Stacks","thumbnailStacksTranslateX","thumbnailL1StacksTranslateX","thumbnailStacksTranslateY","thumbnailL1StacksTranslateY","thumbnailStacksTranslateZ","thumbnailL1StacksTranslateZ","thumbnailStacksRotateX","thumbnailL1StacksRotateX","thumbnailStacksRotateY","thumbnailL1StacksRotateY","thumbnailStacksRotateZ","thumbnailL1StacksRotateZ","thumbnailStacksScale","thumbnailL1StacksScale","titleMaxLength","descriptionMaxLength","hideIcons","thumbnailDisplayInterval","thumbnailL1DisplayInterval","thumbnailDisplayTransitionDuration","thumbnailL1DisplayTransitionDuration","thumbnailGlobalImageTitle","thumbnailGlobalAlbumTitle","viewer","fnViewerInfo","thumbnailCustomTool1","thumbnailCustomTool2","thumbnailCustomTool3","thumbnailCustomTool4","thumbnailCustomTool5","thumbnailCustomTool6","thumbnailCustomTool7","thumbnailCustomTool8","thumbnailCustomTool9","thumbnailCustomTool10","viewerCustomTool1","viewerCustomTool2","viewerCustomTool3","viewerCustomTool4","viewerCustomTool5","viewerCustomTool6","viewerCustomTool7","viewerCustomTool8","viewerCustomTool9","viewerCustomTool10","gallery","lightbox","global","ngEvEmitter","proto","listener","events","_events","listeners","once","onceEvents","_onceEvents","emitEvent","onceListeners","isOnce","prop","makeArray","ary","isArray","ngImagesLoaded","elem","onAlways","querySelectorAll","elements","getImages","jqDeferred","Deferred","check","create","images","addElementImages","nodeName","addImage","addElementBackgroundImages","nodeType","elementNodeTypes","childImgs","child","LoadingImage","Background","reURL","addBackground","loadingImage","onProgress","progress","progressedCount","hasAnyBroken","complete","notify","debug","isComplete","jqMethod","getIsImageComplete","confirm","proxyImage","addEventListener","handleEvent","method","onload","unbindEvents","onerror","removeEventListener","makeJQueryPlugin","promise","isCommonjs","keyboardAllowed","Element","val","fnMap","ret","eventNameMap","change","fullscreenchange","error","fullscreenerror","Promise","resolve","requestFullscreen","onFullScreenEntered","documentElement","userAgent","ALLOW_KEYBOARD_INPUT","onFullScreenExit","exitFullscreen","raw","defineProperties","Boolean","fullscreenElement","enumerable","fullscreenEnabled","root","formula","DEFAULT_SCHEDULE_FUNCTION","timeoutHandler_endTime","timeoutHandler_currentTime","timeoutHandler_isEnded","timeoutHandler_offset","DEFAULT_EASING","DEFAULT_DURATION","UPDATE_TIME","_now","SHIFTY_DEBUG_NOW","noop","shallowCopy","targetObj","srcObj","defaults","tweenProps","forPosition","currentState","originalState","targetState","timestamp","easingObjectProp","easingFn","normalizedPosition","tweenProp","end","easingFunc","applyFilter","filterName","filters","_filterArgs","timeoutHandler","schedule","opt_currentTimeOverride","isPlaying","_attachment","_scheduleId","_timeoutHandler","composeEasingObject","fromTweenParams","composedEasing","typeofEasing","opt_initialState","opt_config","_currentState","_configured","_scheduleFunction","setConfig","_timestamp","_start","resume","_pausedAtTime","_delay","_step","_finish","_duration","_originalState","_targetState","self","_easing","pause","_isPaused","seek","millisecond","currentTime","gotoEnd","oCancelAnimationFrame","msCancelAnimationFrame","setScheduleFunction","scheduleFunction","linear","amdDISABLED","easeInQuad","pow","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","cos","PI","easeOutSine","sin","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","sqrt","easeOutCirc","easeInOutCirc","easeOutBounce","easeInBack","easeOutBack","easeInOutBack","elastic","swingFromTo","swingFrom","swingTo","bounce","bouncePast","easeFromTo","easeFrom","easeTo","cubicBezierAtTime","p1x","p1y","p2x","p2y","ax","bx","cx","ay","by","cy","sampleCurveX","sampleCurveY","sampleCurveDerivativeX","solveEpsilon","solve","epsilon","solveCurveX","fabs","t0","t2","x2","d2","getCubicBezierTransition","x1","y1","y2","setBezierFunction","cubicBezierTransition","displayName","unsetBezierFunction","getInterpolatedValues","current","mockNGTweenable","interpolate","opt_delay","easingObject","filterArgs","interpolatedValues","R_NUMBER_COMPONENT","R_FORMAT_CHUNKS","R_UNFORMATTED_VALUES","R_RGB","RegExp","source","R_RGB_PREFIX","R_HEX","VALUE_PLACEHOLDER","getFormatChunksFrom","rawValues","prefix","accumulator","rawValuesLength","getFormatStringFrom","formattedString","chunks","unshift","sanitizeObjectForHexProps","stateObject","currentProp","sanitizeHexChunksToRGB","filterStringChunks","convertHexToRGB","hexString","rgbArr","hexToRGBArray","hexToRGBArray_returnArray","hex","hexToDec","pattern","unfilteredString","pattenMatches","filteredString","currentChunk","pattenMatchesLength","sanitizeRGBChunks","sanitizeRGBChunk","rgbChunk","numbers","numbersLength","sanitizedString","getFormatManifests","manifestAccumulator","getValuesFrom","expandFormattedProperties","formatManifests","chunkNames","collapseFormattedProperties","valuesList","getValuesList","extractPropertyChunks","getFormattedValues","formatString","currentChunkName","extractedValues","chunkNamesLength","getValuesList_accumulator","formattedValueString","toFixed","expandEasingObject","tokenData","chunkLength","easingChunks","lastEasingChunk","collapseEasingObject","firstEasing","composedEasingString","token","fromState","toState","_tokenData","exportName","assign","VENDOR_PREFIXES","TEST_ELEMENT","TYPE_FUNCTION","setTimeoutContext","bindFn","invokeArrayArg","arg","iterator","deprecate","deprecationMessage","Error","stack","warn","output","nextKey","dest","merge","keys","inherit","properties","childP","baseP","_super","boolOrFn","ifUndefined","val1","val2","addEventListeners","types","handler","splitStr","removeEventListeners","hasParent","node","inStr","findByKey","toArray","uniqueArray","results","values","prefixed","camelProp","_uniqueId","uniqueId","getWindowForElement","doc","ownerDocument","defaultView","parentWindow","SUPPORT_TOUCH","SUPPORT_POINTER_EVENTS","SUPPORT_ONLY_TOUCH","INPUT_TYPE_TOUCH","INPUT_TYPE_PEN","INPUT_TYPE_MOUSE","INPUT_TYPE_KINECT","COMPUTE_INTERVAL","INPUT_START","INPUT_MOVE","INPUT_END","INPUT_CANCEL","DIRECTION_NONE","DIRECTION_LEFT","DIRECTION_RIGHT","DIRECTION_UP","DIRECTION_DOWN","DIRECTION_HORIZONTAL","DIRECTION_VERTICAL","PROPS_XY","PROPS_CLIENT_XY","Input","manager","inputTarget","domHandler","createInputInstance","inputClass","PointerEventInput","TouchInput","TouchMouseInput","MouseInput","inputHandler","eventType","input","pointersLen","pointers","changedPointersLen","changedPointers","isFirst","isFinal","session","computeInputData","emit","recognize","prevInput","pointersLength","firstInput","simpleCloneInputData","firstMultiple","offsetCenter","center","getCenter","timeStamp","deltaTime","getAngle","distance","getDistance","computeDeltaXY","offsetDirection","getDirection","overallVelocity","getVelocity","overallVelocityX","overallVelocityY","getScale","rotation","getRotation","maxPointers","computeIntervalInputData","offsetDelta","prevDelta","velocity","velocityX","velocityY","lastInterval","clientX","clientY","p1","p2","props","atan2","evEl","evTarget","evWin","MOUSE_INPUT_MAP","mousedown","mousemove","mouseup","MOUSE_ELEMENT_EVENTS","MOUSE_WINDOW_EVENTS","pressed","button","which","POINTER_INPUT_MAP","pointerdown","pointermove","pointerup","pointercancel","pointerout","IE10_POINTER_TYPE_ENUM","POINTER_ELEMENT_EVENTS","POINTER_WINDOW_EVENTS","store","pointerEvents","MSPointerEvent","PointerEvent","removePointer","eventTypeNormalized","isTouch","storeIndex","pointerId","SINGLE_TOUCH_INPUT_MAP","touchstart","touchmove","touchend","touchcancel","SINGLE_TOUCH_TARGET_EVENTS","SINGLE_TOUCH_WINDOW_EVENTS","SingleTouchInput","started","normalizeSingleTouches","all","touches","changed","changedTouches","TOUCH_INPUT_MAP","TOUCH_TARGET_EVENTS","targetIds","getTouches","allTouches","identifier","targetTouches","changedTargetTouches","touch","DEDUP_TIMEOUT","DEDUP_DISTANCE","mouse","primaryTouch","lastTouches","recordTouches","eventData","setLastTouch","lastTouch","lts","isSyntheticEvent","dx","dy","inputEvent","inputData","isMouse","sourceCapabilities","firesTouchEvents","PREFIXED_TOUCH_ACTION","NATIVE_TOUCH_ACTION","TOUCH_ACTION_COMPUTE","TOUCH_ACTION_AUTO","TOUCH_ACTION_MANIPULATION","TOUCH_ACTION_NONE","TOUCH_ACTION_PAN_X","TOUCH_ACTION_PAN_Y","TOUCH_ACTION_MAP","getTouchActionProps","TouchAction","cleanTouchActions","actions","hasPanX","hasPanY","touchMap","cssSupports","CSS","supports","compute","update","recognizer","getTouchAction","preventDefaults","prevented","hasNone","isTapPointer","isTapMovement","isTapTouchTime","preventSrc","STATE_POSSIBLE","STATE_BEGAN","STATE_CHANGED","STATE_ENDED","STATE_RECOGNIZED","STATE_CANCELLED","STATE_FAILED","Recognizer","simultaneous","requireFail","stateStr","directionStr","getRecognizerByNameIfManager","otherRecognizer","AttrRecognizer","PanRecognizer","pX","pY","PinchRecognizer","PressRecognizer","_timer","_input","RotateRecognizer","SwipeRecognizer","TapRecognizer","pTime","pCenter","preset","dropRecognizeWith","dropRequireFailure","hasRequireFailures","canRecognizeWith","additionalEvent","tryEmit","canEmit","inputDataClone","reset","process","attrTest","optionPointers","isRecognized","isValid","directionTest","hasMoved","inOut","validPointers","validMovement","validTime","posThreshold","validTouchTime","failTimeout","validInterval","validMultiTap","tapCount","VERSION","domEvents","cssProps","userSelect","touchSelect","touchCallout","contentZooming","userDrag","tapHighlightColor","STOP","FORCED_STOP","handlers","oldCssProps","toggleCssProps","triggerDomEvent","gestureEvent","gesture","dispatchEvent","force","stopped","curRecognizer","existing","Swipe","Rotate","Press","ready"],"sourceRoot":""}